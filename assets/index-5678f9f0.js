(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))m(_);new MutationObserver(_=>{for(const b of _)if(b.type==="childList")for(const P of b.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&m(P)}).observe(document,{childList:!0,subtree:!0});function u(_){const b={};return _.integrity&&(b.integrity=_.integrity),_.referrerpolicy&&(b.referrerPolicy=_.referrerpolicy),_.crossorigin==="use-credentials"?b.credentials="include":_.crossorigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function m(_){if(_.ep)return;_.ep=!0;const b=u(_);fetch(_.href,b)}})();var su=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hf={},j1={get exports(){return hf},set exports(n){hf=n}},Dd={},Rt={},$1={get exports(){return Rt},set exports(n){Rt=n}},ln={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yc=Symbol.for("react.element"),G1=Symbol.for("react.portal"),Z1=Symbol.for("react.fragment"),q1=Symbol.for("react.strict_mode"),W1=Symbol.for("react.profiler"),X1=Symbol.for("react.provider"),H1=Symbol.for("react.context"),K1=Symbol.for("react.forward_ref"),J1=Symbol.for("react.suspense"),Y1=Symbol.for("react.memo"),Q1=Symbol.for("react.lazy"),Ty=Symbol.iterator;function ew(n){return n===null||typeof n!="object"?null:(n=Ty&&n[Ty]||n["@@iterator"],typeof n=="function"?n:null)}var V_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j_=Object.assign,$_={};function Lu(n,o,u){this.props=n,this.context=o,this.refs=$_,this.updater=u||V_}Lu.prototype.isReactComponent={};Lu.prototype.setState=function(n,o){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,o,"setState")};Lu.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function G_(){}G_.prototype=Lu.prototype;function lm(n,o,u){this.props=n,this.context=o,this.refs=$_,this.updater=u||V_}var um=lm.prototype=new G_;um.constructor=lm;j_(um,Lu.prototype);um.isPureReactComponent=!0;var Cy=Array.isArray,Z_=Object.prototype.hasOwnProperty,cm={current:null},q_={key:!0,ref:!0,__self:!0,__source:!0};function W_(n,o,u){var m,_={},b=null,P=null;if(o!=null)for(m in o.ref!==void 0&&(P=o.ref),o.key!==void 0&&(b=""+o.key),o)Z_.call(o,m)&&!q_.hasOwnProperty(m)&&(_[m]=o[m]);var l=arguments.length-2;if(l===1)_.children=u;else if(1<l){for(var G=Array(l),J=0;J<l;J++)G[J]=arguments[J+2];_.children=G}if(n&&n.defaultProps)for(m in l=n.defaultProps,l)_[m]===void 0&&(_[m]=l[m]);return{$$typeof:Yc,type:n,key:b,ref:P,props:_,_owner:cm.current}}function tw(n,o){return{$$typeof:Yc,type:n.type,key:o,ref:n.ref,props:n.props,_owner:n._owner}}function hm(n){return typeof n=="object"&&n!==null&&n.$$typeof===Yc}function nw(n){var o={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(u){return o[u]})}var ky=/\/+/g;function Bp(n,o){return typeof n=="object"&&n!==null&&n.key!=null?nw(""+n.key):o.toString(36)}function Yh(n,o,u,m,_){var b=typeof n;(b==="undefined"||b==="boolean")&&(n=null);var P=!1;if(n===null)P=!0;else switch(b){case"string":case"number":P=!0;break;case"object":switch(n.$$typeof){case Yc:case G1:P=!0}}if(P)return P=n,_=_(P),n=m===""?"."+Bp(P,0):m,Cy(_)?(u="",n!=null&&(u=n.replace(ky,"$&/")+"/"),Yh(_,o,u,"",function(J){return J})):_!=null&&(hm(_)&&(_=tw(_,u+(!_.key||P&&P.key===_.key?"":(""+_.key).replace(ky,"$&/")+"/")+n)),o.push(_)),1;if(P=0,m=m===""?".":m+":",Cy(n))for(var l=0;l<n.length;l++){b=n[l];var G=m+Bp(b,l);P+=Yh(b,o,u,G,_)}else if(G=ew(n),typeof G=="function")for(n=G.call(n),l=0;!(b=n.next()).done;)b=b.value,G=m+Bp(b,l++),P+=Yh(b,o,u,G,_);else if(b==="object")throw o=String(n),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return P}function Rh(n,o,u){if(n==null)return n;var m=[],_=0;return Yh(n,m,"","",function(b){return o.call(u,b,_++)}),m}function rw(n){if(n._status===-1){var o=n._result;o=o(),o.then(function(u){(n._status===0||n._status===-1)&&(n._status=1,n._result=u)},function(u){(n._status===0||n._status===-1)&&(n._status=2,n._result=u)}),n._status===-1&&(n._status=0,n._result=o)}if(n._status===1)return n._result.default;throw n._result}var Ni={current:null},Qh={transition:null},iw={ReactCurrentDispatcher:Ni,ReactCurrentBatchConfig:Qh,ReactCurrentOwner:cm};ln.Children={map:Rh,forEach:function(n,o,u){Rh(n,function(){o.apply(this,arguments)},u)},count:function(n){var o=0;return Rh(n,function(){o++}),o},toArray:function(n){return Rh(n,function(o){return o})||[]},only:function(n){if(!hm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ln.Component=Lu;ln.Fragment=Z1;ln.Profiler=W1;ln.PureComponent=lm;ln.StrictMode=q1;ln.Suspense=J1;ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iw;ln.cloneElement=function(n,o,u){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var m=j_({},n.props),_=n.key,b=n.ref,P=n._owner;if(o!=null){if(o.ref!==void 0&&(b=o.ref,P=cm.current),o.key!==void 0&&(_=""+o.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(G in o)Z_.call(o,G)&&!q_.hasOwnProperty(G)&&(m[G]=o[G]===void 0&&l!==void 0?l[G]:o[G])}var G=arguments.length-2;if(G===1)m.children=u;else if(1<G){l=Array(G);for(var J=0;J<G;J++)l[J]=arguments[J+2];m.children=l}return{$$typeof:Yc,type:n.type,key:_,ref:b,props:m,_owner:P}};ln.createContext=function(n){return n={$$typeof:H1,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:X1,_context:n},n.Consumer=n};ln.createElement=W_;ln.createFactory=function(n){var o=W_.bind(null,n);return o.type=n,o};ln.createRef=function(){return{current:null}};ln.forwardRef=function(n){return{$$typeof:K1,render:n}};ln.isValidElement=hm;ln.lazy=function(n){return{$$typeof:Q1,_payload:{_status:-1,_result:n},_init:rw}};ln.memo=function(n,o){return{$$typeof:Y1,type:n,compare:o===void 0?null:o}};ln.startTransition=function(n){var o=Qh.transition;Qh.transition={};try{n()}finally{Qh.transition=o}};ln.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ln.useCallback=function(n,o){return Ni.current.useCallback(n,o)};ln.useContext=function(n){return Ni.current.useContext(n)};ln.useDebugValue=function(){};ln.useDeferredValue=function(n){return Ni.current.useDeferredValue(n)};ln.useEffect=function(n,o){return Ni.current.useEffect(n,o)};ln.useId=function(){return Ni.current.useId()};ln.useImperativeHandle=function(n,o,u){return Ni.current.useImperativeHandle(n,o,u)};ln.useInsertionEffect=function(n,o){return Ni.current.useInsertionEffect(n,o)};ln.useLayoutEffect=function(n,o){return Ni.current.useLayoutEffect(n,o)};ln.useMemo=function(n,o){return Ni.current.useMemo(n,o)};ln.useReducer=function(n,o,u){return Ni.current.useReducer(n,o,u)};ln.useRef=function(n){return Ni.current.useRef(n)};ln.useState=function(n){return Ni.current.useState(n)};ln.useSyncExternalStore=function(n,o,u){return Ni.current.useSyncExternalStore(n,o,u)};ln.useTransition=function(){return Ni.current.useTransition()};ln.version="18.2.0";(function(n){n.exports=ln})($1);const ow=V1(Rt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sw=Rt,aw=Symbol.for("react.element"),lw=Symbol.for("react.fragment"),uw=Object.prototype.hasOwnProperty,cw=sw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hw={key:!0,ref:!0,__self:!0,__source:!0};function X_(n,o,u){var m,_={},b=null,P=null;u!==void 0&&(b=""+u),o.key!==void 0&&(b=""+o.key),o.ref!==void 0&&(P=o.ref);for(m in o)uw.call(o,m)&&!hw.hasOwnProperty(m)&&(_[m]=o[m]);if(n&&n.defaultProps)for(m in o=n.defaultProps,o)_[m]===void 0&&(_[m]=o[m]);return{$$typeof:aw,type:n,key:b,ref:P,props:_,_owner:cw.current}}Dd.Fragment=lw;Dd.jsx=X_;Dd.jsxs=X_;(function(n){n.exports=Dd})(j1);const Ec=hf.jsx;var df={},Dc={},dw={get exports(){return Dc},set exports(n){Dc=n}},To={},pf={},pw={get exports(){return pf},set exports(n){pf=n}},H_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function o(ut,Pt){var He=ut.length;ut.push(Pt);e:for(;0<He;){var un=He-1>>>1,Tn=ut[un];if(0<_(Tn,Pt))ut[un]=Pt,ut[He]=Tn,He=un;else break e}}function u(ut){return ut.length===0?null:ut[0]}function m(ut){if(ut.length===0)return null;var Pt=ut[0],He=ut.pop();if(He!==Pt){ut[0]=He;e:for(var un=0,Tn=ut.length,fi=Tn>>>1;un<fi;){var Ur=2*(un+1)-1,Vr=ut[Ur],_r=Ur+1,ti=ut[_r];if(0>_(Vr,He))_r<Tn&&0>_(ti,Vr)?(ut[un]=ti,ut[_r]=He,un=_r):(ut[un]=Vr,ut[Ur]=He,un=Ur);else if(_r<Tn&&0>_(ti,He))ut[un]=ti,ut[_r]=He,un=_r;else break e}}return Pt}function _(ut,Pt){var He=ut.sortIndex-Pt.sortIndex;return He!==0?He:ut.id-Pt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;n.unstable_now=function(){return b.now()}}else{var P=Date,l=P.now();n.unstable_now=function(){return P.now()-l}}var G=[],J=[],we=1,fe=null,H=3,tt=!1,Xe=!1,$e=!1,fn=typeof setTimeout=="function"?setTimeout:null,pe=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function he(ut){for(var Pt=u(J);Pt!==null;){if(Pt.callback===null)m(J);else if(Pt.startTime<=ut)m(J),Pt.sortIndex=Pt.expirationTime,o(G,Pt);else break;Pt=u(J)}}function Ne(ut){if($e=!1,he(ut),!Xe)if(u(G)!==null)Xe=!0,It(Ge);else{var Pt=u(J);Pt!==null&&ei(Ne,Pt.startTime-ut)}}function Ge(ut,Pt){Xe=!1,$e&&($e=!1,pe(ft),ft=-1),tt=!0;var He=H;try{for(he(Pt),fe=u(G);fe!==null&&(!(fe.expirationTime>Pt)||ut&&!rn());){var un=fe.callback;if(typeof un=="function"){fe.callback=null,H=fe.priorityLevel;var Tn=un(fe.expirationTime<=Pt);Pt=n.unstable_now(),typeof Tn=="function"?fe.callback=Tn:fe===u(G)&&m(G),he(Pt)}else m(G);fe=u(G)}if(fe!==null)var fi=!0;else{var Ur=u(J);Ur!==null&&ei(Ne,Ur.startTime-Pt),fi=!1}return fi}finally{fe=null,H=He,tt=!1}}var lt=!1,yt=null,ft=-1,xn=5,kt=-1;function rn(){return!(n.unstable_now()-kt<xn)}function Nn(){if(yt!==null){var ut=n.unstable_now();kt=ut;var Pt=!0;try{Pt=yt(!0,ut)}finally{Pt?cr():(lt=!1,yt=null)}}else lt=!1}var cr;if(typeof ie=="function")cr=function(){ie(Nn)};else if(typeof MessageChannel<"u"){var zn=new MessageChannel,hr=zn.port2;zn.port1.onmessage=Nn,cr=function(){hr.postMessage(null)}}else cr=function(){fn(Nn,0)};function It(ut){yt=ut,lt||(lt=!0,cr())}function ei(ut,Pt){ft=fn(function(){ut(n.unstable_now())},Pt)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ut){ut.callback=null},n.unstable_continueExecution=function(){Xe||tt||(Xe=!0,It(Ge))},n.unstable_forceFrameRate=function(ut){0>ut||125<ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xn=0<ut?Math.floor(1e3/ut):5},n.unstable_getCurrentPriorityLevel=function(){return H},n.unstable_getFirstCallbackNode=function(){return u(G)},n.unstable_next=function(ut){switch(H){case 1:case 2:case 3:var Pt=3;break;default:Pt=H}var He=H;H=Pt;try{return ut()}finally{H=He}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ut,Pt){switch(ut){case 1:case 2:case 3:case 4:case 5:break;default:ut=3}var He=H;H=ut;try{return Pt()}finally{H=He}},n.unstable_scheduleCallback=function(ut,Pt,He){var un=n.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?un+He:un):He=un,ut){case 1:var Tn=-1;break;case 2:Tn=250;break;case 5:Tn=1073741823;break;case 4:Tn=1e4;break;default:Tn=5e3}return Tn=He+Tn,ut={id:we++,callback:Pt,priorityLevel:ut,startTime:He,expirationTime:Tn,sortIndex:-1},He>un?(ut.sortIndex=He,o(J,ut),u(G)===null&&ut===u(J)&&($e?(pe(ft),ft=-1):$e=!0,ei(Ne,He-un))):(ut.sortIndex=Tn,o(G,ut),Xe||tt||(Xe=!0,It(Ge))),ut},n.unstable_shouldYield=rn,n.unstable_wrapCallback=function(ut){var Pt=H;return function(){var He=H;H=Pt;try{return ut.apply(this,arguments)}finally{H=He}}}})(H_);(function(n){n.exports=H_})(pw);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K_=Rt,Eo=pf;function Ze(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var J_=new Set,Rc={};function Bl(n,o){Tu(n,o),Tu(n+"Capture",o)}function Tu(n,o){for(Rc[n]=o,n=0;n<o.length;n++)J_.add(o[n])}var aa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ff=Object.prototype.hasOwnProperty,fw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Iy={},My={};function mw(n){return ff.call(My,n)?!0:ff.call(Iy,n)?!1:fw.test(n)?My[n]=!0:(Iy[n]=!0,!1)}function gw(n,o,u,m){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:u!==null?!u.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function yw(n,o,u,m){if(o===null||typeof o>"u"||gw(n,o,u,m))return!0;if(m)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ui(n,o,u,m,_,b,P){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=_,this.mustUseProperty=u,this.propertyName=n,this.type=o,this.sanitizeURL=b,this.removeEmptyString=P}var pi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){pi[n]=new Ui(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];pi[o]=new Ui(o,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){pi[n]=new Ui(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){pi[n]=new Ui(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){pi[n]=new Ui(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){pi[n]=new Ui(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){pi[n]=new Ui(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){pi[n]=new Ui(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){pi[n]=new Ui(n,5,!1,n.toLowerCase(),null,!1,!1)});var dm=/[\-:]([a-z])/g;function pm(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(dm,pm);pi[o]=new Ui(o,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(dm,pm);pi[o]=new Ui(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(dm,pm);pi[o]=new Ui(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){pi[n]=new Ui(n,1,!1,n.toLowerCase(),null,!1,!1)});pi.xlinkHref=new Ui("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){pi[n]=new Ui(n,1,!1,n.toLowerCase(),null,!0,!0)});function fm(n,o,u,m){var _=pi.hasOwnProperty(o)?pi[o]:null;(_!==null?_.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(yw(o,u,_,m)&&(u=null),m||_===null?mw(o)&&(u===null?n.removeAttribute(o):n.setAttribute(o,""+u)):_.mustUseProperty?n[_.propertyName]=u===null?_.type===3?!1:"":u:(o=_.attributeName,m=_.attributeNamespace,u===null?n.removeAttribute(o):(_=_.type,u=_===3||_===4&&u===!0?"":""+u,m?n.setAttributeNS(m,o,u):n.setAttribute(o,u))))}var ha=K_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Fh=Symbol.for("react.element"),au=Symbol.for("react.portal"),lu=Symbol.for("react.fragment"),mm=Symbol.for("react.strict_mode"),mf=Symbol.for("react.profiler"),Y_=Symbol.for("react.provider"),Q_=Symbol.for("react.context"),gm=Symbol.for("react.forward_ref"),gf=Symbol.for("react.suspense"),yf=Symbol.for("react.suspense_list"),ym=Symbol.for("react.memo"),La=Symbol.for("react.lazy"),ev=Symbol.for("react.offscreen"),Py=Symbol.iterator;function dc(n){return n===null||typeof n!="object"?null:(n=Py&&n[Py]||n["@@iterator"],typeof n=="function"?n:null)}var ir=Object.assign,Op;function xc(n){if(Op===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Op=o&&o[1]||""}return`
`+Op+n}var Np=!1;function Up(n,o){if(!n||Np)return"";Np=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(J){var m=J}Reflect.construct(n,[],o)}else{try{o.call()}catch(J){m=J}n.call(o.prototype)}else{try{throw Error()}catch(J){m=J}n()}}catch(J){if(J&&m&&typeof J.stack=="string"){for(var _=J.stack.split(`
`),b=m.stack.split(`
`),P=_.length-1,l=b.length-1;1<=P&&0<=l&&_[P]!==b[l];)l--;for(;1<=P&&0<=l;P--,l--)if(_[P]!==b[l]){if(P!==1||l!==1)do if(P--,l--,0>l||_[P]!==b[l]){var G=`
`+_[P].replace(" at new "," at ");return n.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",n.displayName)),G}while(1<=P&&0<=l);break}}}finally{Np=!1,Error.prepareStackTrace=u}return(n=n?n.displayName||n.name:"")?xc(n):""}function _w(n){switch(n.tag){case 5:return xc(n.type);case 16:return xc("Lazy");case 13:return xc("Suspense");case 19:return xc("SuspenseList");case 0:case 2:case 15:return n=Up(n.type,!1),n;case 11:return n=Up(n.type.render,!1),n;case 1:return n=Up(n.type,!0),n;default:return""}}function _f(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case lu:return"Fragment";case au:return"Portal";case mf:return"Profiler";case mm:return"StrictMode";case gf:return"Suspense";case yf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Q_:return(n.displayName||"Context")+".Consumer";case Y_:return(n._context.displayName||"Context")+".Provider";case gm:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ym:return o=n.displayName||null,o!==null?o:_f(n.type)||"Memo";case La:o=n._payload,n=n._init;try{return _f(n(o))}catch{}}return null}function vw(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _f(o);case 8:return o===mm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Xa(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function tv(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function xw(n){var o=tv(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),m=""+n[o];if(!n.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var _=u.get,b=u.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return _.call(this)},set:function(P){m=""+P,b.call(this,P)}}),Object.defineProperty(n,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(P){m=""+P},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Bh(n){n._valueTracker||(n._valueTracker=xw(n))}function nv(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return n&&(m=tv(n)?n.checked?"true":"false":n.value),n=m,n!==u?(o.setValue(n),!0):!1}function cd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vf(n,o){var u=o.checked;return ir({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??n._wrapperState.initialChecked})}function Ay(n,o){var u=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;u=Xa(o.value!=null?o.value:u),n._wrapperState={initialChecked:m,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function rv(n,o){o=o.checked,o!=null&&fm(n,"checked",o,!1)}function xf(n,o){rv(n,o);var u=Xa(o.value),m=o.type;if(u!=null)m==="number"?(u===0&&n.value===""||n.value!=u)&&(n.value=""+u):n.value!==""+u&&(n.value=""+u);else if(m==="submit"||m==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?wf(n,o.type,u):o.hasOwnProperty("defaultValue")&&wf(n,o.type,Xa(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function zy(n,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,u||o===n.value||(n.value=o),n.defaultValue=o}u=n.name,u!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,u!==""&&(n.name=u)}function wf(n,o,u){(o!=="number"||cd(n.ownerDocument)!==n)&&(u==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+u&&(n.defaultValue=""+u))}var wc=Array.isArray;function vu(n,o,u,m){if(n=n.options,o){o={};for(var _=0;_<u.length;_++)o["$"+u[_]]=!0;for(u=0;u<n.length;u++)_=o.hasOwnProperty("$"+n[u].value),n[u].selected!==_&&(n[u].selected=_),_&&m&&(n[u].defaultSelected=!0)}else{for(u=""+Xa(u),o=null,_=0;_<n.length;_++){if(n[_].value===u){n[_].selected=!0,m&&(n[_].defaultSelected=!0);return}o!==null||n[_].disabled||(o=n[_])}o!==null&&(o.selected=!0)}}function bf(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Ze(91));return ir({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ly(n,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(Ze(92));if(wc(u)){if(1<u.length)throw Error(Ze(93));u=u[0]}o=u}o==null&&(o=""),u=o}n._wrapperState={initialValue:Xa(u)}}function iv(n,o){var u=Xa(o.value),m=Xa(o.defaultValue);u!=null&&(u=""+u,u!==n.value&&(n.value=u),o.defaultValue==null&&n.defaultValue!==u&&(n.defaultValue=u)),m!=null&&(n.defaultValue=""+m)}function Dy(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function ov(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sf(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?ov(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Oh,sv=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,m,_){MSApp.execUnsafeLocalFunction(function(){return n(o,u,m,_)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(Oh=Oh||document.createElement("div"),Oh.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Oh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function Fc(n,o){if(o){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=o;return}}n.textContent=o}var Tc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ww=["Webkit","ms","Moz","O"];Object.keys(Tc).forEach(function(n){ww.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),Tc[o]=Tc[n]})});function av(n,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||Tc.hasOwnProperty(n)&&Tc[n]?(""+o).trim():o+"px"}function lv(n,o){n=n.style;for(var u in o)if(o.hasOwnProperty(u)){var m=u.indexOf("--")===0,_=av(u,o[u],m);u==="float"&&(u="cssFloat"),m?n.setProperty(u,_):n[u]=_}}var bw=ir({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ef(n,o){if(o){if(bw[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Ze(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Ze(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Ze(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Ze(62))}}function Tf(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cf=null;function _m(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var kf=null,xu=null,wu=null;function Ry(n){if(n=th(n)){if(typeof kf!="function")throw Error(Ze(280));var o=n.stateNode;o&&(o=Nd(o),kf(n.stateNode,n.type,o))}}function uv(n){xu?wu?wu.push(n):wu=[n]:xu=n}function cv(){if(xu){var n=xu,o=wu;if(wu=xu=null,Ry(n),o)for(n=0;n<o.length;n++)Ry(o[n])}}function hv(n,o){return n(o)}function dv(){}var Vp=!1;function pv(n,o,u){if(Vp)return n(o,u);Vp=!0;try{return hv(n,o,u)}finally{Vp=!1,(xu!==null||wu!==null)&&(dv(),cv())}}function Bc(n,o){var u=n.stateNode;if(u===null)return null;var m=Nd(u);if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(n=n.type,m=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!m;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(Ze(231,o,typeof u));return u}var If=!1;if(aa)try{var pc={};Object.defineProperty(pc,"passive",{get:function(){If=!0}}),window.addEventListener("test",pc,pc),window.removeEventListener("test",pc,pc)}catch{If=!1}function Sw(n,o,u,m,_,b,P,l,G){var J=Array.prototype.slice.call(arguments,3);try{o.apply(u,J)}catch(we){this.onError(we)}}var Cc=!1,hd=null,dd=!1,Mf=null,Ew={onError:function(n){Cc=!0,hd=n}};function Tw(n,o,u,m,_,b,P,l,G){Cc=!1,hd=null,Sw.apply(Ew,arguments)}function Cw(n,o,u,m,_,b,P,l,G){if(Tw.apply(this,arguments),Cc){if(Cc){var J=hd;Cc=!1,hd=null}else throw Error(Ze(198));dd||(dd=!0,Mf=J)}}function Ol(n){var o=n,u=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,o.flags&4098&&(u=o.return),n=o.return;while(n)}return o.tag===3?u:null}function fv(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function Fy(n){if(Ol(n)!==n)throw Error(Ze(188))}function kw(n){var o=n.alternate;if(!o){if(o=Ol(n),o===null)throw Error(Ze(188));return o!==n?null:n}for(var u=n,m=o;;){var _=u.return;if(_===null)break;var b=_.alternate;if(b===null){if(m=_.return,m!==null){u=m;continue}break}if(_.child===b.child){for(b=_.child;b;){if(b===u)return Fy(_),n;if(b===m)return Fy(_),o;b=b.sibling}throw Error(Ze(188))}if(u.return!==m.return)u=_,m=b;else{for(var P=!1,l=_.child;l;){if(l===u){P=!0,u=_,m=b;break}if(l===m){P=!0,m=_,u=b;break}l=l.sibling}if(!P){for(l=b.child;l;){if(l===u){P=!0,u=b,m=_;break}if(l===m){P=!0,m=b,u=_;break}l=l.sibling}if(!P)throw Error(Ze(189))}}if(u.alternate!==m)throw Error(Ze(190))}if(u.tag!==3)throw Error(Ze(188));return u.stateNode.current===u?n:o}function mv(n){return n=kw(n),n!==null?gv(n):null}function gv(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=gv(n);if(o!==null)return o;n=n.sibling}return null}var yv=Eo.unstable_scheduleCallback,By=Eo.unstable_cancelCallback,Iw=Eo.unstable_shouldYield,Mw=Eo.unstable_requestPaint,yr=Eo.unstable_now,Pw=Eo.unstable_getCurrentPriorityLevel,vm=Eo.unstable_ImmediatePriority,_v=Eo.unstable_UserBlockingPriority,pd=Eo.unstable_NormalPriority,Aw=Eo.unstable_LowPriority,vv=Eo.unstable_IdlePriority,Rd=null,Ds=null;function zw(n){if(Ds&&typeof Ds.onCommitFiberRoot=="function")try{Ds.onCommitFiberRoot(Rd,n,void 0,(n.current.flags&128)===128)}catch{}}var ls=Math.clz32?Math.clz32:Rw,Lw=Math.log,Dw=Math.LN2;function Rw(n){return n>>>=0,n===0?32:31-(Lw(n)/Dw|0)|0}var Nh=64,Uh=4194304;function bc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function fd(n,o){var u=n.pendingLanes;if(u===0)return 0;var m=0,_=n.suspendedLanes,b=n.pingedLanes,P=u&268435455;if(P!==0){var l=P&~_;l!==0?m=bc(l):(b&=P,b!==0&&(m=bc(b)))}else P=u&~_,P!==0?m=bc(P):b!==0&&(m=bc(b));if(m===0)return 0;if(o!==0&&o!==m&&!(o&_)&&(_=m&-m,b=o&-o,_>=b||_===16&&(b&4194240)!==0))return o;if(m&4&&(m|=u&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=m;0<o;)u=31-ls(o),_=1<<u,m|=n[u],o&=~_;return m}function Fw(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bw(n,o){for(var u=n.suspendedLanes,m=n.pingedLanes,_=n.expirationTimes,b=n.pendingLanes;0<b;){var P=31-ls(b),l=1<<P,G=_[P];G===-1?(!(l&u)||l&m)&&(_[P]=Fw(l,o)):G<=o&&(n.expiredLanes|=l),b&=~l}}function Pf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function xv(){var n=Nh;return Nh<<=1,!(Nh&4194240)&&(Nh=64),n}function jp(n){for(var o=[],u=0;31>u;u++)o.push(n);return o}function Qc(n,o,u){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-ls(o),n[o]=u}function Ow(n,o){var u=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var m=n.eventTimes;for(n=n.expirationTimes;0<u;){var _=31-ls(u),b=1<<_;o[_]=0,m[_]=-1,n[_]=-1,u&=~b}}function xm(n,o){var u=n.entangledLanes|=o;for(n=n.entanglements;u;){var m=31-ls(u),_=1<<m;_&o|n[m]&o&&(n[m]|=o),u&=~_}}var Mn=0;function wv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var bv,wm,Sv,Ev,Tv,Af=!1,Vh=[],Ua=null,Va=null,ja=null,Oc=new Map,Nc=new Map,Ra=[],Nw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Oy(n,o){switch(n){case"focusin":case"focusout":Ua=null;break;case"dragenter":case"dragleave":Va=null;break;case"mouseover":case"mouseout":ja=null;break;case"pointerover":case"pointerout":Oc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nc.delete(o.pointerId)}}function fc(n,o,u,m,_,b){return n===null||n.nativeEvent!==b?(n={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:b,targetContainers:[_]},o!==null&&(o=th(o),o!==null&&wm(o)),n):(n.eventSystemFlags|=m,o=n.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),n)}function Uw(n,o,u,m,_){switch(o){case"focusin":return Ua=fc(Ua,n,o,u,m,_),!0;case"dragenter":return Va=fc(Va,n,o,u,m,_),!0;case"mouseover":return ja=fc(ja,n,o,u,m,_),!0;case"pointerover":var b=_.pointerId;return Oc.set(b,fc(Oc.get(b)||null,n,o,u,m,_)),!0;case"gotpointercapture":return b=_.pointerId,Nc.set(b,fc(Nc.get(b)||null,n,o,u,m,_)),!0}return!1}function Cv(n){var o=kl(n.target);if(o!==null){var u=Ol(o);if(u!==null){if(o=u.tag,o===13){if(o=fv(u),o!==null){n.blockedOn=o,Tv(n.priority,function(){Sv(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ed(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var u=zf(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(u===null){u=n.nativeEvent;var m=new u.constructor(u.type,u);Cf=m,u.target.dispatchEvent(m),Cf=null}else return o=th(u),o!==null&&wm(o),n.blockedOn=u,!1;o.shift()}return!0}function Ny(n,o,u){ed(n)&&u.delete(o)}function Vw(){Af=!1,Ua!==null&&ed(Ua)&&(Ua=null),Va!==null&&ed(Va)&&(Va=null),ja!==null&&ed(ja)&&(ja=null),Oc.forEach(Ny),Nc.forEach(Ny)}function mc(n,o){n.blockedOn===o&&(n.blockedOn=null,Af||(Af=!0,Eo.unstable_scheduleCallback(Eo.unstable_NormalPriority,Vw)))}function Uc(n){function o(_){return mc(_,n)}if(0<Vh.length){mc(Vh[0],n);for(var u=1;u<Vh.length;u++){var m=Vh[u];m.blockedOn===n&&(m.blockedOn=null)}}for(Ua!==null&&mc(Ua,n),Va!==null&&mc(Va,n),ja!==null&&mc(ja,n),Oc.forEach(o),Nc.forEach(o),u=0;u<Ra.length;u++)m=Ra[u],m.blockedOn===n&&(m.blockedOn=null);for(;0<Ra.length&&(u=Ra[0],u.blockedOn===null);)Cv(u),u.blockedOn===null&&Ra.shift()}var bu=ha.ReactCurrentBatchConfig,md=!0;function jw(n,o,u,m){var _=Mn,b=bu.transition;bu.transition=null;try{Mn=1,bm(n,o,u,m)}finally{Mn=_,bu.transition=b}}function $w(n,o,u,m){var _=Mn,b=bu.transition;bu.transition=null;try{Mn=4,bm(n,o,u,m)}finally{Mn=_,bu.transition=b}}function bm(n,o,u,m){if(md){var _=zf(n,o,u,m);if(_===null)Yp(n,o,m,gd,u),Oy(n,m);else if(Uw(_,n,o,u,m))m.stopPropagation();else if(Oy(n,m),o&4&&-1<Nw.indexOf(n)){for(;_!==null;){var b=th(_);if(b!==null&&bv(b),b=zf(n,o,u,m),b===null&&Yp(n,o,m,gd,u),b===_)break;_=b}_!==null&&m.stopPropagation()}else Yp(n,o,m,null,u)}}var gd=null;function zf(n,o,u,m){if(gd=null,n=_m(m),n=kl(n),n!==null)if(o=Ol(n),o===null)n=null;else if(u=o.tag,u===13){if(n=fv(o),n!==null)return n;n=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return gd=n,null}function kv(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Pw()){case vm:return 1;case _v:return 4;case pd:case Aw:return 16;case vv:return 536870912;default:return 16}default:return 16}}var Oa=null,Sm=null,td=null;function Iv(){if(td)return td;var n,o=Sm,u=o.length,m,_="value"in Oa?Oa.value:Oa.textContent,b=_.length;for(n=0;n<u&&o[n]===_[n];n++);var P=u-n;for(m=1;m<=P&&o[u-m]===_[b-m];m++);return td=_.slice(n,1<m?1-m:void 0)}function nd(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function jh(){return!0}function Uy(){return!1}function Co(n){function o(u,m,_,b,P){this._reactName=u,this._targetInst=_,this.type=m,this.nativeEvent=b,this.target=P,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(u=n[l],this[l]=u?u(b):b[l]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?jh:Uy,this.isPropagationStopped=Uy,this}return ir(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=jh)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=jh)},persist:function(){},isPersistent:jh}),o}var Du={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Em=Co(Du),eh=ir({},Du,{view:0,detail:0}),Gw=Co(eh),$p,Gp,gc,Fd=ir({},eh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tm,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==gc&&(gc&&n.type==="mousemove"?($p=n.screenX-gc.screenX,Gp=n.screenY-gc.screenY):Gp=$p=0,gc=n),$p)},movementY:function(n){return"movementY"in n?n.movementY:Gp}}),Vy=Co(Fd),Zw=ir({},Fd,{dataTransfer:0}),qw=Co(Zw),Ww=ir({},eh,{relatedTarget:0}),Zp=Co(Ww),Xw=ir({},Du,{animationName:0,elapsedTime:0,pseudoElement:0}),Hw=Co(Xw),Kw=ir({},Du,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Jw=Co(Kw),Yw=ir({},Du,{data:0}),jy=Co(Yw),Qw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nb(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=tb[n])?!!o[n]:!1}function Tm(){return nb}var rb=ir({},eh,{key:function(n){if(n.key){var o=Qw[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=nd(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?eb[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tm,charCode:function(n){return n.type==="keypress"?nd(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?nd(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),ib=Co(rb),ob=ir({},Fd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$y=Co(ob),sb=ir({},eh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tm}),ab=Co(sb),lb=ir({},Du,{propertyName:0,elapsedTime:0,pseudoElement:0}),ub=Co(lb),cb=ir({},Fd,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),hb=Co(cb),db=[9,13,27,32],Cm=aa&&"CompositionEvent"in window,kc=null;aa&&"documentMode"in document&&(kc=document.documentMode);var pb=aa&&"TextEvent"in window&&!kc,Mv=aa&&(!Cm||kc&&8<kc&&11>=kc),Gy=String.fromCharCode(32),Zy=!1;function Pv(n,o){switch(n){case"keyup":return db.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Av(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var uu=!1;function fb(n,o){switch(n){case"compositionend":return Av(o);case"keypress":return o.which!==32?null:(Zy=!0,Gy);case"textInput":return n=o.data,n===Gy&&Zy?null:n;default:return null}}function mb(n,o){if(uu)return n==="compositionend"||!Cm&&Pv(n,o)?(n=Iv(),td=Sm=Oa=null,uu=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Mv&&o.locale!=="ko"?null:o.data;default:return null}}var gb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qy(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!gb[n.type]:o==="textarea"}function zv(n,o,u,m){uv(m),o=yd(o,"onChange"),0<o.length&&(u=new Em("onChange","change",null,u,m),n.push({event:u,listeners:o}))}var Ic=null,Vc=null;function yb(n){$v(n,0)}function Bd(n){var o=du(n);if(nv(o))return n}function _b(n,o){if(n==="change")return o}var Lv=!1;if(aa){var qp;if(aa){var Wp="oninput"in document;if(!Wp){var Wy=document.createElement("div");Wy.setAttribute("oninput","return;"),Wp=typeof Wy.oninput=="function"}qp=Wp}else qp=!1;Lv=qp&&(!document.documentMode||9<document.documentMode)}function Xy(){Ic&&(Ic.detachEvent("onpropertychange",Dv),Vc=Ic=null)}function Dv(n){if(n.propertyName==="value"&&Bd(Vc)){var o=[];zv(o,Vc,n,_m(n)),pv(yb,o)}}function vb(n,o,u){n==="focusin"?(Xy(),Ic=o,Vc=u,Ic.attachEvent("onpropertychange",Dv)):n==="focusout"&&Xy()}function xb(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Bd(Vc)}function wb(n,o){if(n==="click")return Bd(o)}function bb(n,o){if(n==="input"||n==="change")return Bd(o)}function Sb(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var cs=typeof Object.is=="function"?Object.is:Sb;function jc(n,o){if(cs(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var u=Object.keys(n),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var _=u[m];if(!ff.call(o,_)||!cs(n[_],o[_]))return!1}return!0}function Hy(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ky(n,o){var u=Hy(n);n=0;for(var m;u;){if(u.nodeType===3){if(m=n+u.textContent.length,n<=o&&m>=o)return{node:u,offset:o-n};n=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Hy(u)}}function Rv(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?Rv(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function Fv(){for(var n=window,o=cd();o instanceof n.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)n=o.contentWindow;else break;o=cd(n.document)}return o}function km(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function Eb(n){var o=Fv(),u=n.focusedElem,m=n.selectionRange;if(o!==u&&u&&u.ownerDocument&&Rv(u.ownerDocument.documentElement,u)){if(m!==null&&km(u)){if(o=m.start,n=m.end,n===void 0&&(n=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(n,u.value.length);else if(n=(o=u.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var _=u.textContent.length,b=Math.min(m.start,_);m=m.end===void 0?b:Math.min(m.end,_),!n.extend&&b>m&&(_=m,m=b,b=_),_=Ky(u,b);var P=Ky(u,m);_&&P&&(n.rangeCount!==1||n.anchorNode!==_.node||n.anchorOffset!==_.offset||n.focusNode!==P.node||n.focusOffset!==P.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),n.removeAllRanges(),b>m?(n.addRange(o),n.extend(P.node,P.offset)):(o.setEnd(P.node,P.offset),n.addRange(o)))}}for(o=[],n=u;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)n=o[u],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Tb=aa&&"documentMode"in document&&11>=document.documentMode,cu=null,Lf=null,Mc=null,Df=!1;function Jy(n,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Df||cu==null||cu!==cd(m)||(m=cu,"selectionStart"in m&&km(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Mc&&jc(Mc,m)||(Mc=m,m=yd(Lf,"onSelect"),0<m.length&&(o=new Em("onSelect","select",null,o,u),n.push({event:o,listeners:m}),o.target=cu)))}function $h(n,o){var u={};return u[n.toLowerCase()]=o.toLowerCase(),u["Webkit"+n]="webkit"+o,u["Moz"+n]="moz"+o,u}var hu={animationend:$h("Animation","AnimationEnd"),animationiteration:$h("Animation","AnimationIteration"),animationstart:$h("Animation","AnimationStart"),transitionend:$h("Transition","TransitionEnd")},Xp={},Bv={};aa&&(Bv=document.createElement("div").style,"AnimationEvent"in window||(delete hu.animationend.animation,delete hu.animationiteration.animation,delete hu.animationstart.animation),"TransitionEvent"in window||delete hu.transitionend.transition);function Od(n){if(Xp[n])return Xp[n];if(!hu[n])return n;var o=hu[n],u;for(u in o)if(o.hasOwnProperty(u)&&u in Bv)return Xp[n]=o[u];return n}var Ov=Od("animationend"),Nv=Od("animationiteration"),Uv=Od("animationstart"),Vv=Od("transitionend"),jv=new Map,Yy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ka(n,o){jv.set(n,o),Bl(o,[n])}for(var Hp=0;Hp<Yy.length;Hp++){var Kp=Yy[Hp],Cb=Kp.toLowerCase(),kb=Kp[0].toUpperCase()+Kp.slice(1);Ka(Cb,"on"+kb)}Ka(Ov,"onAnimationEnd");Ka(Nv,"onAnimationIteration");Ka(Uv,"onAnimationStart");Ka("dblclick","onDoubleClick");Ka("focusin","onFocus");Ka("focusout","onBlur");Ka(Vv,"onTransitionEnd");Tu("onMouseEnter",["mouseout","mouseover"]);Tu("onMouseLeave",["mouseout","mouseover"]);Tu("onPointerEnter",["pointerout","pointerover"]);Tu("onPointerLeave",["pointerout","pointerover"]);Bl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ib=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sc));function Qy(n,o,u){var m=n.type||"unknown-event";n.currentTarget=u,Cw(m,o,void 0,n),n.currentTarget=null}function $v(n,o){o=(o&4)!==0;for(var u=0;u<n.length;u++){var m=n[u],_=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var P=m.length-1;0<=P;P--){var l=m[P],G=l.instance,J=l.currentTarget;if(l=l.listener,G!==b&&_.isPropagationStopped())break e;Qy(_,l,J),b=G}else for(P=0;P<m.length;P++){if(l=m[P],G=l.instance,J=l.currentTarget,l=l.listener,G!==b&&_.isPropagationStopped())break e;Qy(_,l,J),b=G}}}if(dd)throw n=Mf,dd=!1,Mf=null,n}function Zn(n,o){var u=o[Nf];u===void 0&&(u=o[Nf]=new Set);var m=n+"__bubble";u.has(m)||(Gv(o,n,2,!1),u.add(m))}function Jp(n,o,u){var m=0;o&&(m|=4),Gv(u,n,m,o)}var Gh="_reactListening"+Math.random().toString(36).slice(2);function $c(n){if(!n[Gh]){n[Gh]=!0,J_.forEach(function(u){u!=="selectionchange"&&(Ib.has(u)||Jp(u,!1,n),Jp(u,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Gh]||(o[Gh]=!0,Jp("selectionchange",!1,o))}}function Gv(n,o,u,m){switch(kv(o)){case 1:var _=jw;break;case 4:_=$w;break;default:_=bm}u=_.bind(null,o,u,n),_=void 0,!If||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),m?_!==void 0?n.addEventListener(o,u,{capture:!0,passive:_}):n.addEventListener(o,u,!0):_!==void 0?n.addEventListener(o,u,{passive:_}):n.addEventListener(o,u,!1)}function Yp(n,o,u,m,_){var b=m;if(!(o&1)&&!(o&2)&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var l=m.stateNode.containerInfo;if(l===_||l.nodeType===8&&l.parentNode===_)break;if(P===4)for(P=m.return;P!==null;){var G=P.tag;if((G===3||G===4)&&(G=P.stateNode.containerInfo,G===_||G.nodeType===8&&G.parentNode===_))return;P=P.return}for(;l!==null;){if(P=kl(l),P===null)return;if(G=P.tag,G===5||G===6){m=b=P;continue e}l=l.parentNode}}m=m.return}pv(function(){var J=b,we=_m(u),fe=[];e:{var H=jv.get(n);if(H!==void 0){var tt=Em,Xe=n;switch(n){case"keypress":if(nd(u)===0)break e;case"keydown":case"keyup":tt=ib;break;case"focusin":Xe="focus",tt=Zp;break;case"focusout":Xe="blur",tt=Zp;break;case"beforeblur":case"afterblur":tt=Zp;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=Vy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=qw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=ab;break;case Ov:case Nv:case Uv:tt=Hw;break;case Vv:tt=ub;break;case"scroll":tt=Gw;break;case"wheel":tt=hb;break;case"copy":case"cut":case"paste":tt=Jw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=$y}var $e=(o&4)!==0,fn=!$e&&n==="scroll",pe=$e?H!==null?H+"Capture":null:H;$e=[];for(var ie=J,he;ie!==null;){he=ie;var Ne=he.stateNode;if(he.tag===5&&Ne!==null&&(he=Ne,pe!==null&&(Ne=Bc(ie,pe),Ne!=null&&$e.push(Gc(ie,Ne,he)))),fn)break;ie=ie.return}0<$e.length&&(H=new tt(H,Xe,null,u,we),fe.push({event:H,listeners:$e}))}}if(!(o&7)){e:{if(H=n==="mouseover"||n==="pointerover",tt=n==="mouseout"||n==="pointerout",H&&u!==Cf&&(Xe=u.relatedTarget||u.fromElement)&&(kl(Xe)||Xe[la]))break e;if((tt||H)&&(H=we.window===we?we:(H=we.ownerDocument)?H.defaultView||H.parentWindow:window,tt?(Xe=u.relatedTarget||u.toElement,tt=J,Xe=Xe?kl(Xe):null,Xe!==null&&(fn=Ol(Xe),Xe!==fn||Xe.tag!==5&&Xe.tag!==6)&&(Xe=null)):(tt=null,Xe=J),tt!==Xe)){if($e=Vy,Ne="onMouseLeave",pe="onMouseEnter",ie="mouse",(n==="pointerout"||n==="pointerover")&&($e=$y,Ne="onPointerLeave",pe="onPointerEnter",ie="pointer"),fn=tt==null?H:du(tt),he=Xe==null?H:du(Xe),H=new $e(Ne,ie+"leave",tt,u,we),H.target=fn,H.relatedTarget=he,Ne=null,kl(we)===J&&($e=new $e(pe,ie+"enter",Xe,u,we),$e.target=he,$e.relatedTarget=fn,Ne=$e),fn=Ne,tt&&Xe)t:{for($e=tt,pe=Xe,ie=0,he=$e;he;he=ou(he))ie++;for(he=0,Ne=pe;Ne;Ne=ou(Ne))he++;for(;0<ie-he;)$e=ou($e),ie--;for(;0<he-ie;)pe=ou(pe),he--;for(;ie--;){if($e===pe||pe!==null&&$e===pe.alternate)break t;$e=ou($e),pe=ou(pe)}$e=null}else $e=null;tt!==null&&e_(fe,H,tt,$e,!1),Xe!==null&&fn!==null&&e_(fe,fn,Xe,$e,!0)}}e:{if(H=J?du(J):window,tt=H.nodeName&&H.nodeName.toLowerCase(),tt==="select"||tt==="input"&&H.type==="file")var Ge=_b;else if(qy(H))if(Lv)Ge=bb;else{Ge=xb;var lt=vb}else(tt=H.nodeName)&&tt.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(Ge=wb);if(Ge&&(Ge=Ge(n,J))){zv(fe,Ge,u,we);break e}lt&&lt(n,H,J),n==="focusout"&&(lt=H._wrapperState)&&lt.controlled&&H.type==="number"&&wf(H,"number",H.value)}switch(lt=J?du(J):window,n){case"focusin":(qy(lt)||lt.contentEditable==="true")&&(cu=lt,Lf=J,Mc=null);break;case"focusout":Mc=Lf=cu=null;break;case"mousedown":Df=!0;break;case"contextmenu":case"mouseup":case"dragend":Df=!1,Jy(fe,u,we);break;case"selectionchange":if(Tb)break;case"keydown":case"keyup":Jy(fe,u,we)}var yt;if(Cm)e:{switch(n){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else uu?Pv(n,u)&&(ft="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(ft="onCompositionStart");ft&&(Mv&&u.locale!=="ko"&&(uu||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&uu&&(yt=Iv()):(Oa=we,Sm="value"in Oa?Oa.value:Oa.textContent,uu=!0)),lt=yd(J,ft),0<lt.length&&(ft=new jy(ft,n,null,u,we),fe.push({event:ft,listeners:lt}),yt?ft.data=yt:(yt=Av(u),yt!==null&&(ft.data=yt)))),(yt=pb?fb(n,u):mb(n,u))&&(J=yd(J,"onBeforeInput"),0<J.length&&(we=new jy("onBeforeInput","beforeinput",null,u,we),fe.push({event:we,listeners:J}),we.data=yt))}$v(fe,o)})}function Gc(n,o,u){return{instance:n,listener:o,currentTarget:u}}function yd(n,o){for(var u=o+"Capture",m=[];n!==null;){var _=n,b=_.stateNode;_.tag===5&&b!==null&&(_=b,b=Bc(n,u),b!=null&&m.unshift(Gc(n,b,_)),b=Bc(n,o),b!=null&&m.push(Gc(n,b,_))),n=n.return}return m}function ou(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function e_(n,o,u,m,_){for(var b=o._reactName,P=[];u!==null&&u!==m;){var l=u,G=l.alternate,J=l.stateNode;if(G!==null&&G===m)break;l.tag===5&&J!==null&&(l=J,_?(G=Bc(u,b),G!=null&&P.unshift(Gc(u,G,l))):_||(G=Bc(u,b),G!=null&&P.push(Gc(u,G,l)))),u=u.return}P.length!==0&&n.push({event:o,listeners:P})}var Mb=/\r\n?/g,Pb=/\u0000|\uFFFD/g;function t_(n){return(typeof n=="string"?n:""+n).replace(Mb,`
`).replace(Pb,"")}function Zh(n,o,u){if(o=t_(o),t_(n)!==o&&u)throw Error(Ze(425))}function _d(){}var Rf=null,Ff=null;function Bf(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Of=typeof setTimeout=="function"?setTimeout:void 0,Ab=typeof clearTimeout=="function"?clearTimeout:void 0,n_=typeof Promise=="function"?Promise:void 0,zb=typeof queueMicrotask=="function"?queueMicrotask:typeof n_<"u"?function(n){return n_.resolve(null).then(n).catch(Lb)}:Of;function Lb(n){setTimeout(function(){throw n})}function Qp(n,o){var u=o,m=0;do{var _=u.nextSibling;if(n.removeChild(u),_&&_.nodeType===8)if(u=_.data,u==="/$"){if(m===0){n.removeChild(_),Uc(o);return}m--}else u!=="$"&&u!=="$?"&&u!=="$!"||m++;u=_}while(u);Uc(o)}function $a(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function r_(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return n;o--}else u==="/$"&&o++}n=n.previousSibling}return null}var Ru=Math.random().toString(36).slice(2),Ls="__reactFiber$"+Ru,Zc="__reactProps$"+Ru,la="__reactContainer$"+Ru,Nf="__reactEvents$"+Ru,Db="__reactListeners$"+Ru,Rb="__reactHandles$"+Ru;function kl(n){var o=n[Ls];if(o)return o;for(var u=n.parentNode;u;){if(o=u[la]||u[Ls]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(n=r_(n);n!==null;){if(u=n[Ls])return u;n=r_(n)}return o}n=u,u=n.parentNode}return null}function th(n){return n=n[Ls]||n[la],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function du(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ze(33))}function Nd(n){return n[Zc]||null}var Uf=[],pu=-1;function Ja(n){return{current:n}}function qn(n){0>pu||(n.current=Uf[pu],Uf[pu]=null,pu--)}function jn(n,o){pu++,Uf[pu]=n.current,n.current=o}var Ha={},ki=Ja(Ha),to=Ja(!1),zl=Ha;function Cu(n,o){var u=n.type.contextTypes;if(!u)return Ha;var m=n.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var _={},b;for(b in u)_[b]=o[b];return m&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=_),_}function no(n){return n=n.childContextTypes,n!=null}function vd(){qn(to),qn(ki)}function i_(n,o,u){if(ki.current!==Ha)throw Error(Ze(168));jn(ki,o),jn(to,u)}function Zv(n,o,u){var m=n.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return u;m=m.getChildContext();for(var _ in m)if(!(_ in o))throw Error(Ze(108,vw(n)||"Unknown",_));return ir({},u,m)}function xd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ha,zl=ki.current,jn(ki,n),jn(to,to.current),!0}function o_(n,o,u){var m=n.stateNode;if(!m)throw Error(Ze(169));u?(n=Zv(n,o,zl),m.__reactInternalMemoizedMergedChildContext=n,qn(to),qn(ki),jn(ki,n)):qn(to),jn(to,u)}var ra=null,Ud=!1,ef=!1;function qv(n){ra===null?ra=[n]:ra.push(n)}function Fb(n){Ud=!0,qv(n)}function Ya(){if(!ef&&ra!==null){ef=!0;var n=0,o=Mn;try{var u=ra;for(Mn=1;n<u.length;n++){var m=u[n];do m=m(!0);while(m!==null)}ra=null,Ud=!1}catch(_){throw ra!==null&&(ra=ra.slice(n+1)),yv(vm,Ya),_}finally{Mn=o,ef=!1}}return null}var fu=[],mu=0,wd=null,bd=0,Vo=[],jo=0,Ll=null,ia=1,oa="";function Tl(n,o){fu[mu++]=bd,fu[mu++]=wd,wd=n,bd=o}function Wv(n,o,u){Vo[jo++]=ia,Vo[jo++]=oa,Vo[jo++]=Ll,Ll=n;var m=ia;n=oa;var _=32-ls(m)-1;m&=~(1<<_),u+=1;var b=32-ls(o)+_;if(30<b){var P=_-_%5;b=(m&(1<<P)-1).toString(32),m>>=P,_-=P,ia=1<<32-ls(o)+_|u<<_|m,oa=b+n}else ia=1<<b|u<<_|m,oa=n}function Im(n){n.return!==null&&(Tl(n,1),Wv(n,1,0))}function Mm(n){for(;n===wd;)wd=fu[--mu],fu[mu]=null,bd=fu[--mu],fu[mu]=null;for(;n===Ll;)Ll=Vo[--jo],Vo[jo]=null,oa=Vo[--jo],Vo[jo]=null,ia=Vo[--jo],Vo[jo]=null}var So=null,bo=null,Yn=!1,as=null;function Xv(n,o){var u=$o(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=n,o=n.deletions,o===null?(n.deletions=[u],n.flags|=16):o.push(u)}function s_(n,o){switch(n.tag){case 5:var u=n.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,So=n,bo=$a(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,So=n,bo=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=Ll!==null?{id:ia,overflow:oa}:null,n.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=$o(18,null,null,0),u.stateNode=o,u.return=n,n.child=u,So=n,bo=null,!0):!1;default:return!1}}function Vf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function jf(n){if(Yn){var o=bo;if(o){var u=o;if(!s_(n,o)){if(Vf(n))throw Error(Ze(418));o=$a(u.nextSibling);var m=So;o&&s_(n,o)?Xv(m,u):(n.flags=n.flags&-4097|2,Yn=!1,So=n)}}else{if(Vf(n))throw Error(Ze(418));n.flags=n.flags&-4097|2,Yn=!1,So=n}}}function a_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;So=n}function qh(n){if(n!==So)return!1;if(!Yn)return a_(n),Yn=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!Bf(n.type,n.memoizedProps)),o&&(o=bo)){if(Vf(n))throw Hv(),Error(Ze(418));for(;o;)Xv(n,o),o=$a(o.nextSibling)}if(a_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ze(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"){if(o===0){bo=$a(n.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}n=n.nextSibling}bo=null}}else bo=So?$a(n.stateNode.nextSibling):null;return!0}function Hv(){for(var n=bo;n;)n=$a(n.nextSibling)}function ku(){bo=So=null,Yn=!1}function Pm(n){as===null?as=[n]:as.push(n)}var Bb=ha.ReactCurrentBatchConfig;function os(n,o){if(n&&n.defaultProps){o=ir({},o),n=n.defaultProps;for(var u in n)o[u]===void 0&&(o[u]=n[u]);return o}return o}var Sd=Ja(null),Ed=null,gu=null,Am=null;function zm(){Am=gu=Ed=null}function Lm(n){var o=Sd.current;qn(Sd),n._currentValue=o}function $f(n,o,u){for(;n!==null;){var m=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),n===u)break;n=n.return}}function Su(n,o){Ed=n,Am=gu=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&o&&(eo=!0),n.firstContext=null)}function Zo(n){var o=n._currentValue;if(Am!==n)if(n={context:n,memoizedValue:o,next:null},gu===null){if(Ed===null)throw Error(Ze(308));gu=n,Ed.dependencies={lanes:0,firstContext:n}}else gu=gu.next=n;return o}var Il=null;function Dm(n){Il===null?Il=[n]:Il.push(n)}function Kv(n,o,u,m){var _=o.interleaved;return _===null?(u.next=u,Dm(o)):(u.next=_.next,_.next=u),o.interleaved=u,ua(n,m)}function ua(n,o){n.lanes|=o;var u=n.alternate;for(u!==null&&(u.lanes|=o),u=n,n=n.return;n!==null;)n.childLanes|=o,u=n.alternate,u!==null&&(u.childLanes|=o),u=n,n=n.return;return u.tag===3?u.stateNode:null}var Da=!1;function Rm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jv(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function sa(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function Ga(n,o,u){var m=n.updateQueue;if(m===null)return null;if(m=m.shared,vn&2){var _=m.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),m.pending=o,ua(n,u)}return _=m.interleaved,_===null?(o.next=o,Dm(m)):(o.next=_.next,_.next=o),m.interleaved=o,ua(n,u)}function rd(n,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var m=o.lanes;m&=n.pendingLanes,u|=m,o.lanes=u,xm(n,u)}}function l_(n,o){var u=n.updateQueue,m=n.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var _=null,b=null;if(u=u.firstBaseUpdate,u!==null){do{var P={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};b===null?_=b=P:b=b.next=P,u=u.next}while(u!==null);b===null?_=b=o:b=b.next=o}else _=b=o;u={baseState:m.baseState,firstBaseUpdate:_,lastBaseUpdate:b,shared:m.shared,effects:m.effects},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=o:n.next=o,u.lastBaseUpdate=o}function Td(n,o,u,m){var _=n.updateQueue;Da=!1;var b=_.firstBaseUpdate,P=_.lastBaseUpdate,l=_.shared.pending;if(l!==null){_.shared.pending=null;var G=l,J=G.next;G.next=null,P===null?b=J:P.next=J,P=G;var we=n.alternate;we!==null&&(we=we.updateQueue,l=we.lastBaseUpdate,l!==P&&(l===null?we.firstBaseUpdate=J:l.next=J,we.lastBaseUpdate=G))}if(b!==null){var fe=_.baseState;P=0,we=J=G=null,l=b;do{var H=l.lane,tt=l.eventTime;if((m&H)===H){we!==null&&(we=we.next={eventTime:tt,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Xe=n,$e=l;switch(H=o,tt=u,$e.tag){case 1:if(Xe=$e.payload,typeof Xe=="function"){fe=Xe.call(tt,fe,H);break e}fe=Xe;break e;case 3:Xe.flags=Xe.flags&-65537|128;case 0:if(Xe=$e.payload,H=typeof Xe=="function"?Xe.call(tt,fe,H):Xe,H==null)break e;fe=ir({},fe,H);break e;case 2:Da=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,H=_.effects,H===null?_.effects=[l]:H.push(l))}else tt={eventTime:tt,lane:H,tag:l.tag,payload:l.payload,callback:l.callback,next:null},we===null?(J=we=tt,G=fe):we=we.next=tt,P|=H;if(l=l.next,l===null){if(l=_.shared.pending,l===null)break;H=l,l=H.next,H.next=null,_.lastBaseUpdate=H,_.shared.pending=null}}while(1);if(we===null&&(G=fe),_.baseState=G,_.firstBaseUpdate=J,_.lastBaseUpdate=we,o=_.shared.interleaved,o!==null){_=o;do P|=_.lane,_=_.next;while(_!==o)}else b===null&&(_.shared.lanes=0);Rl|=P,n.lanes=P,n.memoizedState=fe}}function u_(n,o,u){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var m=n[o],_=m.callback;if(_!==null){if(m.callback=null,m=u,typeof _!="function")throw Error(Ze(191,_));_.call(m)}}}var Yv=new K_.Component().refs;function Gf(n,o,u,m){o=n.memoizedState,u=u(m,o),u=u==null?o:ir({},o,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var Vd={isMounted:function(n){return(n=n._reactInternals)?Ol(n)===n:!1},enqueueSetState:function(n,o,u){n=n._reactInternals;var m=Oi(),_=qa(n),b=sa(m,_);b.payload=o,u!=null&&(b.callback=u),o=Ga(n,b,_),o!==null&&(us(o,n,_,m),rd(o,n,_))},enqueueReplaceState:function(n,o,u){n=n._reactInternals;var m=Oi(),_=qa(n),b=sa(m,_);b.tag=1,b.payload=o,u!=null&&(b.callback=u),o=Ga(n,b,_),o!==null&&(us(o,n,_,m),rd(o,n,_))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var u=Oi(),m=qa(n),_=sa(u,m);_.tag=2,o!=null&&(_.callback=o),o=Ga(n,_,m),o!==null&&(us(o,n,m,u),rd(o,n,m))}};function c_(n,o,u,m,_,b,P){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(m,b,P):o.prototype&&o.prototype.isPureReactComponent?!jc(u,m)||!jc(_,b):!0}function Qv(n,o,u){var m=!1,_=Ha,b=o.contextType;return typeof b=="object"&&b!==null?b=Zo(b):(_=no(o)?zl:ki.current,m=o.contextTypes,b=(m=m!=null)?Cu(n,_):Ha),o=new o(u,b),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Vd,n.stateNode=o,o._reactInternals=n,m&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=_,n.__reactInternalMemoizedMaskedChildContext=b),o}function h_(n,o,u,m){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==n&&Vd.enqueueReplaceState(o,o.state,null)}function Zf(n,o,u,m){var _=n.stateNode;_.props=u,_.state=n.memoizedState,_.refs=Yv,Rm(n);var b=o.contextType;typeof b=="object"&&b!==null?_.context=Zo(b):(b=no(o)?zl:ki.current,_.context=Cu(n,b)),_.state=n.memoizedState,b=o.getDerivedStateFromProps,typeof b=="function"&&(Gf(n,o,b,u),_.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Vd.enqueueReplaceState(_,_.state,null),Td(n,u,_,m),_.state=n.memoizedState),typeof _.componentDidMount=="function"&&(n.flags|=4194308)}function yc(n,o,u){if(n=u.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(Ze(309));var m=u.stateNode}if(!m)throw Error(Ze(147,n));var _=m,b=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===b?o.ref:(o=function(P){var l=_.refs;l===Yv&&(l=_.refs={}),P===null?delete l[b]:l[b]=P},o._stringRef=b,o)}if(typeof n!="string")throw Error(Ze(284));if(!u._owner)throw Error(Ze(290,n))}return n}function Wh(n,o){throw n=Object.prototype.toString.call(o),Error(Ze(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function d_(n){var o=n._init;return o(n._payload)}function e0(n){function o(pe,ie){if(n){var he=pe.deletions;he===null?(pe.deletions=[ie],pe.flags|=16):he.push(ie)}}function u(pe,ie){if(!n)return null;for(;ie!==null;)o(pe,ie),ie=ie.sibling;return null}function m(pe,ie){for(pe=new Map;ie!==null;)ie.key!==null?pe.set(ie.key,ie):pe.set(ie.index,ie),ie=ie.sibling;return pe}function _(pe,ie){return pe=Wa(pe,ie),pe.index=0,pe.sibling=null,pe}function b(pe,ie,he){return pe.index=he,n?(he=pe.alternate,he!==null?(he=he.index,he<ie?(pe.flags|=2,ie):he):(pe.flags|=2,ie)):(pe.flags|=1048576,ie)}function P(pe){return n&&pe.alternate===null&&(pe.flags|=2),pe}function l(pe,ie,he,Ne){return ie===null||ie.tag!==6?(ie=lf(he,pe.mode,Ne),ie.return=pe,ie):(ie=_(ie,he),ie.return=pe,ie)}function G(pe,ie,he,Ne){var Ge=he.type;return Ge===lu?we(pe,ie,he.props.children,Ne,he.key):ie!==null&&(ie.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===La&&d_(Ge)===ie.type)?(Ne=_(ie,he.props),Ne.ref=yc(pe,ie,he),Ne.return=pe,Ne):(Ne=ud(he.type,he.key,he.props,null,pe.mode,Ne),Ne.ref=yc(pe,ie,he),Ne.return=pe,Ne)}function J(pe,ie,he,Ne){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==he.containerInfo||ie.stateNode.implementation!==he.implementation?(ie=uf(he,pe.mode,Ne),ie.return=pe,ie):(ie=_(ie,he.children||[]),ie.return=pe,ie)}function we(pe,ie,he,Ne,Ge){return ie===null||ie.tag!==7?(ie=Al(he,pe.mode,Ne,Ge),ie.return=pe,ie):(ie=_(ie,he),ie.return=pe,ie)}function fe(pe,ie,he){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=lf(""+ie,pe.mode,he),ie.return=pe,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case Fh:return he=ud(ie.type,ie.key,ie.props,null,pe.mode,he),he.ref=yc(pe,null,ie),he.return=pe,he;case au:return ie=uf(ie,pe.mode,he),ie.return=pe,ie;case La:var Ne=ie._init;return fe(pe,Ne(ie._payload),he)}if(wc(ie)||dc(ie))return ie=Al(ie,pe.mode,he,null),ie.return=pe,ie;Wh(pe,ie)}return null}function H(pe,ie,he,Ne){var Ge=ie!==null?ie.key:null;if(typeof he=="string"&&he!==""||typeof he=="number")return Ge!==null?null:l(pe,ie,""+he,Ne);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case Fh:return he.key===Ge?G(pe,ie,he,Ne):null;case au:return he.key===Ge?J(pe,ie,he,Ne):null;case La:return Ge=he._init,H(pe,ie,Ge(he._payload),Ne)}if(wc(he)||dc(he))return Ge!==null?null:we(pe,ie,he,Ne,null);Wh(pe,he)}return null}function tt(pe,ie,he,Ne,Ge){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return pe=pe.get(he)||null,l(ie,pe,""+Ne,Ge);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case Fh:return pe=pe.get(Ne.key===null?he:Ne.key)||null,G(ie,pe,Ne,Ge);case au:return pe=pe.get(Ne.key===null?he:Ne.key)||null,J(ie,pe,Ne,Ge);case La:var lt=Ne._init;return tt(pe,ie,he,lt(Ne._payload),Ge)}if(wc(Ne)||dc(Ne))return pe=pe.get(he)||null,we(ie,pe,Ne,Ge,null);Wh(ie,Ne)}return null}function Xe(pe,ie,he,Ne){for(var Ge=null,lt=null,yt=ie,ft=ie=0,xn=null;yt!==null&&ft<he.length;ft++){yt.index>ft?(xn=yt,yt=null):xn=yt.sibling;var kt=H(pe,yt,he[ft],Ne);if(kt===null){yt===null&&(yt=xn);break}n&&yt&&kt.alternate===null&&o(pe,yt),ie=b(kt,ie,ft),lt===null?Ge=kt:lt.sibling=kt,lt=kt,yt=xn}if(ft===he.length)return u(pe,yt),Yn&&Tl(pe,ft),Ge;if(yt===null){for(;ft<he.length;ft++)yt=fe(pe,he[ft],Ne),yt!==null&&(ie=b(yt,ie,ft),lt===null?Ge=yt:lt.sibling=yt,lt=yt);return Yn&&Tl(pe,ft),Ge}for(yt=m(pe,yt);ft<he.length;ft++)xn=tt(yt,pe,ft,he[ft],Ne),xn!==null&&(n&&xn.alternate!==null&&yt.delete(xn.key===null?ft:xn.key),ie=b(xn,ie,ft),lt===null?Ge=xn:lt.sibling=xn,lt=xn);return n&&yt.forEach(function(rn){return o(pe,rn)}),Yn&&Tl(pe,ft),Ge}function $e(pe,ie,he,Ne){var Ge=dc(he);if(typeof Ge!="function")throw Error(Ze(150));if(he=Ge.call(he),he==null)throw Error(Ze(151));for(var lt=Ge=null,yt=ie,ft=ie=0,xn=null,kt=he.next();yt!==null&&!kt.done;ft++,kt=he.next()){yt.index>ft?(xn=yt,yt=null):xn=yt.sibling;var rn=H(pe,yt,kt.value,Ne);if(rn===null){yt===null&&(yt=xn);break}n&&yt&&rn.alternate===null&&o(pe,yt),ie=b(rn,ie,ft),lt===null?Ge=rn:lt.sibling=rn,lt=rn,yt=xn}if(kt.done)return u(pe,yt),Yn&&Tl(pe,ft),Ge;if(yt===null){for(;!kt.done;ft++,kt=he.next())kt=fe(pe,kt.value,Ne),kt!==null&&(ie=b(kt,ie,ft),lt===null?Ge=kt:lt.sibling=kt,lt=kt);return Yn&&Tl(pe,ft),Ge}for(yt=m(pe,yt);!kt.done;ft++,kt=he.next())kt=tt(yt,pe,ft,kt.value,Ne),kt!==null&&(n&&kt.alternate!==null&&yt.delete(kt.key===null?ft:kt.key),ie=b(kt,ie,ft),lt===null?Ge=kt:lt.sibling=kt,lt=kt);return n&&yt.forEach(function(Nn){return o(pe,Nn)}),Yn&&Tl(pe,ft),Ge}function fn(pe,ie,he,Ne){if(typeof he=="object"&&he!==null&&he.type===lu&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case Fh:e:{for(var Ge=he.key,lt=ie;lt!==null;){if(lt.key===Ge){if(Ge=he.type,Ge===lu){if(lt.tag===7){u(pe,lt.sibling),ie=_(lt,he.props.children),ie.return=pe,pe=ie;break e}}else if(lt.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===La&&d_(Ge)===lt.type){u(pe,lt.sibling),ie=_(lt,he.props),ie.ref=yc(pe,lt,he),ie.return=pe,pe=ie;break e}u(pe,lt);break}else o(pe,lt);lt=lt.sibling}he.type===lu?(ie=Al(he.props.children,pe.mode,Ne,he.key),ie.return=pe,pe=ie):(Ne=ud(he.type,he.key,he.props,null,pe.mode,Ne),Ne.ref=yc(pe,ie,he),Ne.return=pe,pe=Ne)}return P(pe);case au:e:{for(lt=he.key;ie!==null;){if(ie.key===lt)if(ie.tag===4&&ie.stateNode.containerInfo===he.containerInfo&&ie.stateNode.implementation===he.implementation){u(pe,ie.sibling),ie=_(ie,he.children||[]),ie.return=pe,pe=ie;break e}else{u(pe,ie);break}else o(pe,ie);ie=ie.sibling}ie=uf(he,pe.mode,Ne),ie.return=pe,pe=ie}return P(pe);case La:return lt=he._init,fn(pe,ie,lt(he._payload),Ne)}if(wc(he))return Xe(pe,ie,he,Ne);if(dc(he))return $e(pe,ie,he,Ne);Wh(pe,he)}return typeof he=="string"&&he!==""||typeof he=="number"?(he=""+he,ie!==null&&ie.tag===6?(u(pe,ie.sibling),ie=_(ie,he),ie.return=pe,pe=ie):(u(pe,ie),ie=lf(he,pe.mode,Ne),ie.return=pe,pe=ie),P(pe)):u(pe,ie)}return fn}var Iu=e0(!0),t0=e0(!1),nh={},Rs=Ja(nh),qc=Ja(nh),Wc=Ja(nh);function Ml(n){if(n===nh)throw Error(Ze(174));return n}function Fm(n,o){switch(jn(Wc,o),jn(qc,n),jn(Rs,nh),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Sf(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=Sf(o,n)}qn(Rs),jn(Rs,o)}function Mu(){qn(Rs),qn(qc),qn(Wc)}function n0(n){Ml(Wc.current);var o=Ml(Rs.current),u=Sf(o,n.type);o!==u&&(jn(qc,n),jn(Rs,u))}function Bm(n){qc.current===n&&(qn(Rs),qn(qc))}var nr=Ja(0);function Cd(n){for(var o=n;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var tf=[];function Om(){for(var n=0;n<tf.length;n++)tf[n]._workInProgressVersionPrimary=null;tf.length=0}var id=ha.ReactCurrentDispatcher,nf=ha.ReactCurrentBatchConfig,Dl=0,rr=null,Or=null,Yr=null,kd=!1,Pc=!1,Xc=0,Ob=0;function Ei(){throw Error(Ze(321))}function Nm(n,o){if(o===null)return!1;for(var u=0;u<o.length&&u<n.length;u++)if(!cs(n[u],o[u]))return!1;return!0}function Um(n,o,u,m,_,b){if(Dl=b,rr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,id.current=n===null||n.memoizedState===null?jb:$b,n=u(m,_),Pc){b=0;do{if(Pc=!1,Xc=0,25<=b)throw Error(Ze(301));b+=1,Yr=Or=null,o.updateQueue=null,id.current=Gb,n=u(m,_)}while(Pc)}if(id.current=Id,o=Or!==null&&Or.next!==null,Dl=0,Yr=Or=rr=null,kd=!1,o)throw Error(Ze(300));return n}function Vm(){var n=Xc!==0;return Xc=0,n}function zs(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yr===null?rr.memoizedState=Yr=n:Yr=Yr.next=n,Yr}function qo(){if(Or===null){var n=rr.alternate;n=n!==null?n.memoizedState:null}else n=Or.next;var o=Yr===null?rr.memoizedState:Yr.next;if(o!==null)Yr=o,Or=n;else{if(n===null)throw Error(Ze(310));Or=n,n={memoizedState:Or.memoizedState,baseState:Or.baseState,baseQueue:Or.baseQueue,queue:Or.queue,next:null},Yr===null?rr.memoizedState=Yr=n:Yr=Yr.next=n}return Yr}function Hc(n,o){return typeof o=="function"?o(n):o}function rf(n){var o=qo(),u=o.queue;if(u===null)throw Error(Ze(311));u.lastRenderedReducer=n;var m=Or,_=m.baseQueue,b=u.pending;if(b!==null){if(_!==null){var P=_.next;_.next=b.next,b.next=P}m.baseQueue=_=b,u.pending=null}if(_!==null){b=_.next,m=m.baseState;var l=P=null,G=null,J=b;do{var we=J.lane;if((Dl&we)===we)G!==null&&(G=G.next={lane:0,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null}),m=J.hasEagerState?J.eagerState:n(m,J.action);else{var fe={lane:we,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null};G===null?(l=G=fe,P=m):G=G.next=fe,rr.lanes|=we,Rl|=we}J=J.next}while(J!==null&&J!==b);G===null?P=m:G.next=l,cs(m,o.memoizedState)||(eo=!0),o.memoizedState=m,o.baseState=P,o.baseQueue=G,u.lastRenderedState=m}if(n=u.interleaved,n!==null){_=n;do b=_.lane,rr.lanes|=b,Rl|=b,_=_.next;while(_!==n)}else _===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function of(n){var o=qo(),u=o.queue;if(u===null)throw Error(Ze(311));u.lastRenderedReducer=n;var m=u.dispatch,_=u.pending,b=o.memoizedState;if(_!==null){u.pending=null;var P=_=_.next;do b=n(b,P.action),P=P.next;while(P!==_);cs(b,o.memoizedState)||(eo=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),u.lastRenderedState=b}return[b,m]}function r0(){}function i0(n,o){var u=rr,m=qo(),_=o(),b=!cs(m.memoizedState,_);if(b&&(m.memoizedState=_,eo=!0),m=m.queue,jm(a0.bind(null,u,m,n),[n]),m.getSnapshot!==o||b||Yr!==null&&Yr.memoizedState.tag&1){if(u.flags|=2048,Kc(9,s0.bind(null,u,m,_,o),void 0,null),Qr===null)throw Error(Ze(349));Dl&30||o0(u,o,_)}return _}function o0(n,o,u){n.flags|=16384,n={getSnapshot:o,value:u},o=rr.updateQueue,o===null?(o={lastEffect:null,stores:null},rr.updateQueue=o,o.stores=[n]):(u=o.stores,u===null?o.stores=[n]:u.push(n))}function s0(n,o,u,m){o.value=u,o.getSnapshot=m,l0(o)&&u0(n)}function a0(n,o,u){return u(function(){l0(o)&&u0(n)})}function l0(n){var o=n.getSnapshot;n=n.value;try{var u=o();return!cs(n,u)}catch{return!0}}function u0(n){var o=ua(n,1);o!==null&&us(o,n,1,-1)}function p_(n){var o=zs();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hc,lastRenderedState:n},o.queue=n,n=n.dispatch=Vb.bind(null,rr,n),[o.memoizedState,n]}function Kc(n,o,u,m){return n={tag:n,create:o,destroy:u,deps:m,next:null},o=rr.updateQueue,o===null?(o={lastEffect:null,stores:null},rr.updateQueue=o,o.lastEffect=n.next=n):(u=o.lastEffect,u===null?o.lastEffect=n.next=n:(m=u.next,u.next=n,n.next=m,o.lastEffect=n)),n}function c0(){return qo().memoizedState}function od(n,o,u,m){var _=zs();rr.flags|=n,_.memoizedState=Kc(1|o,u,void 0,m===void 0?null:m)}function jd(n,o,u,m){var _=qo();m=m===void 0?null:m;var b=void 0;if(Or!==null){var P=Or.memoizedState;if(b=P.destroy,m!==null&&Nm(m,P.deps)){_.memoizedState=Kc(o,u,b,m);return}}rr.flags|=n,_.memoizedState=Kc(1|o,u,b,m)}function f_(n,o){return od(8390656,8,n,o)}function jm(n,o){return jd(2048,8,n,o)}function h0(n,o){return jd(4,2,n,o)}function d0(n,o){return jd(4,4,n,o)}function p0(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function f0(n,o,u){return u=u!=null?u.concat([n]):null,jd(4,4,p0.bind(null,o,n),u)}function $m(){}function m0(n,o){var u=qo();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&Nm(o,m[1])?m[0]:(u.memoizedState=[n,o],n)}function g0(n,o){var u=qo();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&Nm(o,m[1])?m[0]:(n=n(),u.memoizedState=[n,o],n)}function y0(n,o,u){return Dl&21?(cs(u,o)||(u=xv(),rr.lanes|=u,Rl|=u,n.baseState=!0),o):(n.baseState&&(n.baseState=!1,eo=!0),n.memoizedState=u)}function Nb(n,o){var u=Mn;Mn=u!==0&&4>u?u:4,n(!0);var m=nf.transition;nf.transition={};try{n(!1),o()}finally{Mn=u,nf.transition=m}}function _0(){return qo().memoizedState}function Ub(n,o,u){var m=qa(n);if(u={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null},v0(n))x0(o,u);else if(u=Kv(n,o,u,m),u!==null){var _=Oi();us(u,n,m,_),w0(u,o,m)}}function Vb(n,o,u){var m=qa(n),_={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null};if(v0(n))x0(o,_);else{var b=n.alternate;if(n.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var P=o.lastRenderedState,l=b(P,u);if(_.hasEagerState=!0,_.eagerState=l,cs(l,P)){var G=o.interleaved;G===null?(_.next=_,Dm(o)):(_.next=G.next,G.next=_),o.interleaved=_;return}}catch{}finally{}u=Kv(n,o,_,m),u!==null&&(_=Oi(),us(u,n,m,_),w0(u,o,m))}}function v0(n){var o=n.alternate;return n===rr||o!==null&&o===rr}function x0(n,o){Pc=kd=!0;var u=n.pending;u===null?o.next=o:(o.next=u.next,u.next=o),n.pending=o}function w0(n,o,u){if(u&4194240){var m=o.lanes;m&=n.pendingLanes,u|=m,o.lanes=u,xm(n,u)}}var Id={readContext:Zo,useCallback:Ei,useContext:Ei,useEffect:Ei,useImperativeHandle:Ei,useInsertionEffect:Ei,useLayoutEffect:Ei,useMemo:Ei,useReducer:Ei,useRef:Ei,useState:Ei,useDebugValue:Ei,useDeferredValue:Ei,useTransition:Ei,useMutableSource:Ei,useSyncExternalStore:Ei,useId:Ei,unstable_isNewReconciler:!1},jb={readContext:Zo,useCallback:function(n,o){return zs().memoizedState=[n,o===void 0?null:o],n},useContext:Zo,useEffect:f_,useImperativeHandle:function(n,o,u){return u=u!=null?u.concat([n]):null,od(4194308,4,p0.bind(null,o,n),u)},useLayoutEffect:function(n,o){return od(4194308,4,n,o)},useInsertionEffect:function(n,o){return od(4,2,n,o)},useMemo:function(n,o){var u=zs();return o=o===void 0?null:o,n=n(),u.memoizedState=[n,o],n},useReducer:function(n,o,u){var m=zs();return o=u!==void 0?u(o):o,m.memoizedState=m.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},m.queue=n,n=n.dispatch=Ub.bind(null,rr,n),[m.memoizedState,n]},useRef:function(n){var o=zs();return n={current:n},o.memoizedState=n},useState:p_,useDebugValue:$m,useDeferredValue:function(n){return zs().memoizedState=n},useTransition:function(){var n=p_(!1),o=n[0];return n=Nb.bind(null,n[1]),zs().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,u){var m=rr,_=zs();if(Yn){if(u===void 0)throw Error(Ze(407));u=u()}else{if(u=o(),Qr===null)throw Error(Ze(349));Dl&30||o0(m,o,u)}_.memoizedState=u;var b={value:u,getSnapshot:o};return _.queue=b,f_(a0.bind(null,m,b,n),[n]),m.flags|=2048,Kc(9,s0.bind(null,m,b,u,o),void 0,null),u},useId:function(){var n=zs(),o=Qr.identifierPrefix;if(Yn){var u=oa,m=ia;u=(m&~(1<<32-ls(m)-1)).toString(32)+u,o=":"+o+"R"+u,u=Xc++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=Ob++,o=":"+o+"r"+u.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},$b={readContext:Zo,useCallback:m0,useContext:Zo,useEffect:jm,useImperativeHandle:f0,useInsertionEffect:h0,useLayoutEffect:d0,useMemo:g0,useReducer:rf,useRef:c0,useState:function(){return rf(Hc)},useDebugValue:$m,useDeferredValue:function(n){var o=qo();return y0(o,Or.memoizedState,n)},useTransition:function(){var n=rf(Hc)[0],o=qo().memoizedState;return[n,o]},useMutableSource:r0,useSyncExternalStore:i0,useId:_0,unstable_isNewReconciler:!1},Gb={readContext:Zo,useCallback:m0,useContext:Zo,useEffect:jm,useImperativeHandle:f0,useInsertionEffect:h0,useLayoutEffect:d0,useMemo:g0,useReducer:of,useRef:c0,useState:function(){return of(Hc)},useDebugValue:$m,useDeferredValue:function(n){var o=qo();return Or===null?o.memoizedState=n:y0(o,Or.memoizedState,n)},useTransition:function(){var n=of(Hc)[0],o=qo().memoizedState;return[n,o]},useMutableSource:r0,useSyncExternalStore:i0,useId:_0,unstable_isNewReconciler:!1};function Pu(n,o){try{var u="",m=o;do u+=_w(m),m=m.return;while(m);var _=u}catch(b){_=`
Error generating stack: `+b.message+`
`+b.stack}return{value:n,source:o,stack:_,digest:null}}function sf(n,o,u){return{value:n,source:null,stack:u??null,digest:o??null}}function qf(n,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var Zb=typeof WeakMap=="function"?WeakMap:Map;function b0(n,o,u){u=sa(-1,u),u.tag=3,u.payload={element:null};var m=o.value;return u.callback=function(){Pd||(Pd=!0,nm=m),qf(n,o)},u}function S0(n,o,u){u=sa(-1,u),u.tag=3;var m=n.type.getDerivedStateFromError;if(typeof m=="function"){var _=o.value;u.payload=function(){return m(_)},u.callback=function(){qf(n,o)}}var b=n.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(u.callback=function(){qf(n,o),typeof m!="function"&&(Za===null?Za=new Set([this]):Za.add(this));var P=o.stack;this.componentDidCatch(o.value,{componentStack:P!==null?P:""})}),u}function m_(n,o,u){var m=n.pingCache;if(m===null){m=n.pingCache=new Zb;var _=new Set;m.set(o,_)}else _=m.get(o),_===void 0&&(_=new Set,m.set(o,_));_.has(u)||(_.add(u),n=o2.bind(null,n,o,u),o.then(n,n))}function g_(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function y_(n,o,u,m,_){return n.mode&1?(n.flags|=65536,n.lanes=_,n):(n===o?n.flags|=65536:(n.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=sa(-1,1),o.tag=2,Ga(u,o,1))),u.lanes|=1),n)}var qb=ha.ReactCurrentOwner,eo=!1;function Bi(n,o,u,m){o.child=n===null?t0(o,null,u,m):Iu(o,n.child,u,m)}function __(n,o,u,m,_){u=u.render;var b=o.ref;return Su(o,_),m=Um(n,o,u,m,b,_),u=Vm(),n!==null&&!eo?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~_,ca(n,o,_)):(Yn&&u&&Im(o),o.flags|=1,Bi(n,o,m,_),o.child)}function v_(n,o,u,m,_){if(n===null){var b=u.type;return typeof b=="function"&&!Jm(b)&&b.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=b,E0(n,o,b,m,_)):(n=ud(u.type,null,m,o,o.mode,_),n.ref=o.ref,n.return=o,o.child=n)}if(b=n.child,!(n.lanes&_)){var P=b.memoizedProps;if(u=u.compare,u=u!==null?u:jc,u(P,m)&&n.ref===o.ref)return ca(n,o,_)}return o.flags|=1,n=Wa(b,m),n.ref=o.ref,n.return=o,o.child=n}function E0(n,o,u,m,_){if(n!==null){var b=n.memoizedProps;if(jc(b,m)&&n.ref===o.ref)if(eo=!1,o.pendingProps=m=b,(n.lanes&_)!==0)n.flags&131072&&(eo=!0);else return o.lanes=n.lanes,ca(n,o,_)}return Wf(n,o,u,m,_)}function T0(n,o,u){var m=o.pendingProps,_=m.children,b=n!==null?n.memoizedState:null;if(m.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},jn(_u,wo),wo|=u;else{if(!(u&1073741824))return n=b!==null?b.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,jn(_u,wo),wo|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=b!==null?b.baseLanes:u,jn(_u,wo),wo|=m}else b!==null?(m=b.baseLanes|u,o.memoizedState=null):m=u,jn(_u,wo),wo|=m;return Bi(n,o,_,u),o.child}function C0(n,o){var u=o.ref;(n===null&&u!==null||n!==null&&n.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function Wf(n,o,u,m,_){var b=no(u)?zl:ki.current;return b=Cu(o,b),Su(o,_),u=Um(n,o,u,m,b,_),m=Vm(),n!==null&&!eo?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~_,ca(n,o,_)):(Yn&&m&&Im(o),o.flags|=1,Bi(n,o,u,_),o.child)}function x_(n,o,u,m,_){if(no(u)){var b=!0;xd(o)}else b=!1;if(Su(o,_),o.stateNode===null)sd(n,o),Qv(o,u,m),Zf(o,u,m,_),m=!0;else if(n===null){var P=o.stateNode,l=o.memoizedProps;P.props=l;var G=P.context,J=u.contextType;typeof J=="object"&&J!==null?J=Zo(J):(J=no(u)?zl:ki.current,J=Cu(o,J));var we=u.getDerivedStateFromProps,fe=typeof we=="function"||typeof P.getSnapshotBeforeUpdate=="function";fe||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(l!==m||G!==J)&&h_(o,P,m,J),Da=!1;var H=o.memoizedState;P.state=H,Td(o,m,P,_),G=o.memoizedState,l!==m||H!==G||to.current||Da?(typeof we=="function"&&(Gf(o,u,we,m),G=o.memoizedState),(l=Da||c_(o,u,l,m,H,G,J))?(fe||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(o.flags|=4194308)):(typeof P.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=G),P.props=m,P.state=G,P.context=J,m=l):(typeof P.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{P=o.stateNode,Jv(n,o),l=o.memoizedProps,J=o.type===o.elementType?l:os(o.type,l),P.props=J,fe=o.pendingProps,H=P.context,G=u.contextType,typeof G=="object"&&G!==null?G=Zo(G):(G=no(u)?zl:ki.current,G=Cu(o,G));var tt=u.getDerivedStateFromProps;(we=typeof tt=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(l!==fe||H!==G)&&h_(o,P,m,G),Da=!1,H=o.memoizedState,P.state=H,Td(o,m,P,_);var Xe=o.memoizedState;l!==fe||H!==Xe||to.current||Da?(typeof tt=="function"&&(Gf(o,u,tt,m),Xe=o.memoizedState),(J=Da||c_(o,u,J,m,H,Xe,G)||!1)?(we||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(m,Xe,G),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(m,Xe,G)),typeof P.componentDidUpdate=="function"&&(o.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof P.componentDidUpdate!="function"||l===n.memoizedProps&&H===n.memoizedState||(o.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&H===n.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=Xe),P.props=m,P.state=Xe,P.context=G,m=J):(typeof P.componentDidUpdate!="function"||l===n.memoizedProps&&H===n.memoizedState||(o.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&H===n.memoizedState||(o.flags|=1024),m=!1)}return Xf(n,o,u,m,b,_)}function Xf(n,o,u,m,_,b){C0(n,o);var P=(o.flags&128)!==0;if(!m&&!P)return _&&o_(o,u,!1),ca(n,o,b);m=o.stateNode,qb.current=o;var l=P&&typeof u.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,n!==null&&P?(o.child=Iu(o,n.child,null,b),o.child=Iu(o,null,l,b)):Bi(n,o,l,b),o.memoizedState=m.state,_&&o_(o,u,!0),o.child}function k0(n){var o=n.stateNode;o.pendingContext?i_(n,o.pendingContext,o.pendingContext!==o.context):o.context&&i_(n,o.context,!1),Fm(n,o.containerInfo)}function w_(n,o,u,m,_){return ku(),Pm(_),o.flags|=256,Bi(n,o,u,m),o.child}var Hf={dehydrated:null,treeContext:null,retryLane:0};function Kf(n){return{baseLanes:n,cachePool:null,transitions:null}}function I0(n,o,u){var m=o.pendingProps,_=nr.current,b=!1,P=(o.flags&128)!==0,l;if((l=P)||(l=n!==null&&n.memoizedState===null?!1:(_&2)!==0),l?(b=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(_|=1),jn(nr,_&1),n===null)return jf(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(o.mode&1?n.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(P=m.children,n=m.fallback,b?(m=o.mode,b=o.child,P={mode:"hidden",children:P},!(m&1)&&b!==null?(b.childLanes=0,b.pendingProps=P):b=Zd(P,m,0,null),n=Al(n,m,u,null),b.return=o,n.return=o,b.sibling=n,o.child=b,o.child.memoizedState=Kf(u),o.memoizedState=Hf,n):Gm(o,P));if(_=n.memoizedState,_!==null&&(l=_.dehydrated,l!==null))return Wb(n,o,P,m,l,_,u);if(b){b=m.fallback,P=o.mode,_=n.child,l=_.sibling;var G={mode:"hidden",children:m.children};return!(P&1)&&o.child!==_?(m=o.child,m.childLanes=0,m.pendingProps=G,o.deletions=null):(m=Wa(_,G),m.subtreeFlags=_.subtreeFlags&14680064),l!==null?b=Wa(l,b):(b=Al(b,P,u,null),b.flags|=2),b.return=o,m.return=o,m.sibling=b,o.child=m,m=b,b=o.child,P=n.child.memoizedState,P=P===null?Kf(u):{baseLanes:P.baseLanes|u,cachePool:null,transitions:P.transitions},b.memoizedState=P,b.childLanes=n.childLanes&~u,o.memoizedState=Hf,m}return b=n.child,n=b.sibling,m=Wa(b,{mode:"visible",children:m.children}),!(o.mode&1)&&(m.lanes=u),m.return=o,m.sibling=null,n!==null&&(u=o.deletions,u===null?(o.deletions=[n],o.flags|=16):u.push(n)),o.child=m,o.memoizedState=null,m}function Gm(n,o){return o=Zd({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function Xh(n,o,u,m){return m!==null&&Pm(m),Iu(o,n.child,null,u),n=Gm(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function Wb(n,o,u,m,_,b,P){if(u)return o.flags&256?(o.flags&=-257,m=sf(Error(Ze(422))),Xh(n,o,P,m)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(b=m.fallback,_=o.mode,m=Zd({mode:"visible",children:m.children},_,0,null),b=Al(b,_,P,null),b.flags|=2,m.return=o,b.return=o,m.sibling=b,o.child=m,o.mode&1&&Iu(o,n.child,null,P),o.child.memoizedState=Kf(P),o.memoizedState=Hf,b);if(!(o.mode&1))return Xh(n,o,P,null);if(_.data==="$!"){if(m=_.nextSibling&&_.nextSibling.dataset,m)var l=m.dgst;return m=l,b=Error(Ze(419)),m=sf(b,m,void 0),Xh(n,o,P,m)}if(l=(P&n.childLanes)!==0,eo||l){if(m=Qr,m!==null){switch(P&-P){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(m.suspendedLanes|P)?0:_,_!==0&&_!==b.retryLane&&(b.retryLane=_,ua(n,_),us(m,n,_,-1))}return Km(),m=sf(Error(Ze(421))),Xh(n,o,P,m)}return _.data==="$?"?(o.flags|=128,o.child=n.child,o=s2.bind(null,n),_._reactRetry=o,null):(n=b.treeContext,bo=$a(_.nextSibling),So=o,Yn=!0,as=null,n!==null&&(Vo[jo++]=ia,Vo[jo++]=oa,Vo[jo++]=Ll,ia=n.id,oa=n.overflow,Ll=o),o=Gm(o,m.children),o.flags|=4096,o)}function b_(n,o,u){n.lanes|=o;var m=n.alternate;m!==null&&(m.lanes|=o),$f(n.return,o,u)}function af(n,o,u,m,_){var b=n.memoizedState;b===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:_}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=m,b.tail=u,b.tailMode=_)}function M0(n,o,u){var m=o.pendingProps,_=m.revealOrder,b=m.tail;if(Bi(n,o,m.children,u),m=nr.current,m&2)m=m&1|2,o.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&b_(n,u,o);else if(n.tag===19)b_(n,u,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}m&=1}if(jn(nr,m),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(u=o.child,_=null;u!==null;)n=u.alternate,n!==null&&Cd(n)===null&&(_=u),u=u.sibling;u=_,u===null?(_=o.child,o.child=null):(_=u.sibling,u.sibling=null),af(o,!1,_,u,b);break;case"backwards":for(u=null,_=o.child,o.child=null;_!==null;){if(n=_.alternate,n!==null&&Cd(n)===null){o.child=_;break}n=_.sibling,_.sibling=u,u=_,_=n}af(o,!0,u,null,b);break;case"together":af(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function sd(n,o){!(o.mode&1)&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function ca(n,o,u){if(n!==null&&(o.dependencies=n.dependencies),Rl|=o.lanes,!(u&o.childLanes))return null;if(n!==null&&o.child!==n.child)throw Error(Ze(153));if(o.child!==null){for(n=o.child,u=Wa(n,n.pendingProps),o.child=u,u.return=o;n.sibling!==null;)n=n.sibling,u=u.sibling=Wa(n,n.pendingProps),u.return=o;u.sibling=null}return o.child}function Xb(n,o,u){switch(o.tag){case 3:k0(o),ku();break;case 5:n0(o);break;case 1:no(o.type)&&xd(o);break;case 4:Fm(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,_=o.memoizedProps.value;jn(Sd,m._currentValue),m._currentValue=_;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(jn(nr,nr.current&1),o.flags|=128,null):u&o.child.childLanes?I0(n,o,u):(jn(nr,nr.current&1),n=ca(n,o,u),n!==null?n.sibling:null);jn(nr,nr.current&1);break;case 19:if(m=(u&o.childLanes)!==0,n.flags&128){if(m)return M0(n,o,u);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),jn(nr,nr.current),m)break;return null;case 22:case 23:return o.lanes=0,T0(n,o,u)}return ca(n,o,u)}var P0,Jf,A0,z0;P0=function(n,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)n.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};Jf=function(){};A0=function(n,o,u,m){var _=n.memoizedProps;if(_!==m){n=o.stateNode,Ml(Rs.current);var b=null;switch(u){case"input":_=vf(n,_),m=vf(n,m),b=[];break;case"select":_=ir({},_,{value:void 0}),m=ir({},m,{value:void 0}),b=[];break;case"textarea":_=bf(n,_),m=bf(n,m),b=[];break;default:typeof _.onClick!="function"&&typeof m.onClick=="function"&&(n.onclick=_d)}Ef(u,m);var P;u=null;for(J in _)if(!m.hasOwnProperty(J)&&_.hasOwnProperty(J)&&_[J]!=null)if(J==="style"){var l=_[J];for(P in l)l.hasOwnProperty(P)&&(u||(u={}),u[P]="")}else J!=="dangerouslySetInnerHTML"&&J!=="children"&&J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&J!=="autoFocus"&&(Rc.hasOwnProperty(J)?b||(b=[]):(b=b||[]).push(J,null));for(J in m){var G=m[J];if(l=_!=null?_[J]:void 0,m.hasOwnProperty(J)&&G!==l&&(G!=null||l!=null))if(J==="style")if(l){for(P in l)!l.hasOwnProperty(P)||G&&G.hasOwnProperty(P)||(u||(u={}),u[P]="");for(P in G)G.hasOwnProperty(P)&&l[P]!==G[P]&&(u||(u={}),u[P]=G[P])}else u||(b||(b=[]),b.push(J,u)),u=G;else J==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,l=l?l.__html:void 0,G!=null&&l!==G&&(b=b||[]).push(J,G)):J==="children"?typeof G!="string"&&typeof G!="number"||(b=b||[]).push(J,""+G):J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&(Rc.hasOwnProperty(J)?(G!=null&&J==="onScroll"&&Zn("scroll",n),b||l===G||(b=[])):(b=b||[]).push(J,G))}u&&(b=b||[]).push("style",u);var J=b;(o.updateQueue=J)&&(o.flags|=4)}};z0=function(n,o,u,m){u!==m&&(o.flags|=4)};function _c(n,o){if(!Yn)switch(n.tailMode){case"hidden":o=n.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:m.sibling=null}}function Ti(n){var o=n.alternate!==null&&n.alternate.child===n.child,u=0,m=0;if(o)for(var _=n.child;_!==null;)u|=_.lanes|_.childLanes,m|=_.subtreeFlags&14680064,m|=_.flags&14680064,_.return=n,_=_.sibling;else for(_=n.child;_!==null;)u|=_.lanes|_.childLanes,m|=_.subtreeFlags,m|=_.flags,_.return=n,_=_.sibling;return n.subtreeFlags|=m,n.childLanes=u,o}function Hb(n,o,u){var m=o.pendingProps;switch(Mm(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ti(o),null;case 1:return no(o.type)&&vd(),Ti(o),null;case 3:return m=o.stateNode,Mu(),qn(to),qn(ki),Om(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(n===null||n.child===null)&&(qh(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,as!==null&&(om(as),as=null))),Jf(n,o),Ti(o),null;case 5:Bm(o);var _=Ml(Wc.current);if(u=o.type,n!==null&&o.stateNode!=null)A0(n,o,u,m,_),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(Ze(166));return Ti(o),null}if(n=Ml(Rs.current),qh(o)){m=o.stateNode,u=o.type;var b=o.memoizedProps;switch(m[Ls]=o,m[Zc]=b,n=(o.mode&1)!==0,u){case"dialog":Zn("cancel",m),Zn("close",m);break;case"iframe":case"object":case"embed":Zn("load",m);break;case"video":case"audio":for(_=0;_<Sc.length;_++)Zn(Sc[_],m);break;case"source":Zn("error",m);break;case"img":case"image":case"link":Zn("error",m),Zn("load",m);break;case"details":Zn("toggle",m);break;case"input":Ay(m,b),Zn("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!b.multiple},Zn("invalid",m);break;case"textarea":Ly(m,b),Zn("invalid",m)}Ef(u,b),_=null;for(var P in b)if(b.hasOwnProperty(P)){var l=b[P];P==="children"?typeof l=="string"?m.textContent!==l&&(b.suppressHydrationWarning!==!0&&Zh(m.textContent,l,n),_=["children",l]):typeof l=="number"&&m.textContent!==""+l&&(b.suppressHydrationWarning!==!0&&Zh(m.textContent,l,n),_=["children",""+l]):Rc.hasOwnProperty(P)&&l!=null&&P==="onScroll"&&Zn("scroll",m)}switch(u){case"input":Bh(m),zy(m,b,!0);break;case"textarea":Bh(m),Dy(m);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(m.onclick=_d)}m=_,o.updateQueue=m,m!==null&&(o.flags|=4)}else{P=_.nodeType===9?_:_.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=ov(u)),n==="http://www.w3.org/1999/xhtml"?u==="script"?(n=P.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof m.is=="string"?n=P.createElement(u,{is:m.is}):(n=P.createElement(u),u==="select"&&(P=n,m.multiple?P.multiple=!0:m.size&&(P.size=m.size))):n=P.createElementNS(n,u),n[Ls]=o,n[Zc]=m,P0(n,o,!1,!1),o.stateNode=n;e:{switch(P=Tf(u,m),u){case"dialog":Zn("cancel",n),Zn("close",n),_=m;break;case"iframe":case"object":case"embed":Zn("load",n),_=m;break;case"video":case"audio":for(_=0;_<Sc.length;_++)Zn(Sc[_],n);_=m;break;case"source":Zn("error",n),_=m;break;case"img":case"image":case"link":Zn("error",n),Zn("load",n),_=m;break;case"details":Zn("toggle",n),_=m;break;case"input":Ay(n,m),_=vf(n,m),Zn("invalid",n);break;case"option":_=m;break;case"select":n._wrapperState={wasMultiple:!!m.multiple},_=ir({},m,{value:void 0}),Zn("invalid",n);break;case"textarea":Ly(n,m),_=bf(n,m),Zn("invalid",n);break;default:_=m}Ef(u,_),l=_;for(b in l)if(l.hasOwnProperty(b)){var G=l[b];b==="style"?lv(n,G):b==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&sv(n,G)):b==="children"?typeof G=="string"?(u!=="textarea"||G!=="")&&Fc(n,G):typeof G=="number"&&Fc(n,""+G):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(Rc.hasOwnProperty(b)?G!=null&&b==="onScroll"&&Zn("scroll",n):G!=null&&fm(n,b,G,P))}switch(u){case"input":Bh(n),zy(n,m,!1);break;case"textarea":Bh(n),Dy(n);break;case"option":m.value!=null&&n.setAttribute("value",""+Xa(m.value));break;case"select":n.multiple=!!m.multiple,b=m.value,b!=null?vu(n,!!m.multiple,b,!1):m.defaultValue!=null&&vu(n,!!m.multiple,m.defaultValue,!0);break;default:typeof _.onClick=="function"&&(n.onclick=_d)}switch(u){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Ti(o),null;case 6:if(n&&o.stateNode!=null)z0(n,o,n.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(Ze(166));if(u=Ml(Wc.current),Ml(Rs.current),qh(o)){if(m=o.stateNode,u=o.memoizedProps,m[Ls]=o,(b=m.nodeValue!==u)&&(n=So,n!==null))switch(n.tag){case 3:Zh(m.nodeValue,u,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Zh(m.nodeValue,u,(n.mode&1)!==0)}b&&(o.flags|=4)}else m=(u.nodeType===9?u:u.ownerDocument).createTextNode(m),m[Ls]=o,o.stateNode=m}return Ti(o),null;case 13:if(qn(nr),m=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Yn&&bo!==null&&o.mode&1&&!(o.flags&128))Hv(),ku(),o.flags|=98560,b=!1;else if(b=qh(o),m!==null&&m.dehydrated!==null){if(n===null){if(!b)throw Error(Ze(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(Ze(317));b[Ls]=o}else ku(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;Ti(o),b=!1}else as!==null&&(om(as),as=null),b=!0;if(!b)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(m=m!==null,m!==(n!==null&&n.memoizedState!==null)&&m&&(o.child.flags|=8192,o.mode&1&&(n===null||nr.current&1?Nr===0&&(Nr=3):Km())),o.updateQueue!==null&&(o.flags|=4),Ti(o),null);case 4:return Mu(),Jf(n,o),n===null&&$c(o.stateNode.containerInfo),Ti(o),null;case 10:return Lm(o.type._context),Ti(o),null;case 17:return no(o.type)&&vd(),Ti(o),null;case 19:if(qn(nr),b=o.memoizedState,b===null)return Ti(o),null;if(m=(o.flags&128)!==0,P=b.rendering,P===null)if(m)_c(b,!1);else{if(Nr!==0||n!==null&&n.flags&128)for(n=o.child;n!==null;){if(P=Cd(n),P!==null){for(o.flags|=128,_c(b,!1),m=P.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=u,u=o.child;u!==null;)b=u,n=m,b.flags&=14680066,P=b.alternate,P===null?(b.childLanes=0,b.lanes=n,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=P.childLanes,b.lanes=P.lanes,b.child=P.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=P.memoizedProps,b.memoizedState=P.memoizedState,b.updateQueue=P.updateQueue,b.type=P.type,n=P.dependencies,b.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),u=u.sibling;return jn(nr,nr.current&1|2),o.child}n=n.sibling}b.tail!==null&&yr()>Au&&(o.flags|=128,m=!0,_c(b,!1),o.lanes=4194304)}else{if(!m)if(n=Cd(P),n!==null){if(o.flags|=128,m=!0,u=n.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),_c(b,!0),b.tail===null&&b.tailMode==="hidden"&&!P.alternate&&!Yn)return Ti(o),null}else 2*yr()-b.renderingStartTime>Au&&u!==1073741824&&(o.flags|=128,m=!0,_c(b,!1),o.lanes=4194304);b.isBackwards?(P.sibling=o.child,o.child=P):(u=b.last,u!==null?u.sibling=P:o.child=P,b.last=P)}return b.tail!==null?(o=b.tail,b.rendering=o,b.tail=o.sibling,b.renderingStartTime=yr(),o.sibling=null,u=nr.current,jn(nr,m?u&1|2:u&1),o):(Ti(o),null);case 22:case 23:return Hm(),m=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==m&&(o.flags|=8192),m&&o.mode&1?wo&1073741824&&(Ti(o),o.subtreeFlags&6&&(o.flags|=8192)):Ti(o),null;case 24:return null;case 25:return null}throw Error(Ze(156,o.tag))}function Kb(n,o){switch(Mm(o),o.tag){case 1:return no(o.type)&&vd(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return Mu(),qn(to),qn(ki),Om(),n=o.flags,n&65536&&!(n&128)?(o.flags=n&-65537|128,o):null;case 5:return Bm(o),null;case 13:if(qn(nr),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(Ze(340));ku()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return qn(nr),null;case 4:return Mu(),null;case 10:return Lm(o.type._context),null;case 22:case 23:return Hm(),null;case 24:return null;default:return null}}var Hh=!1,Ci=!1,Jb=typeof WeakSet=="function"?WeakSet:Set,xt=null;function yu(n,o){var u=n.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(m){ur(n,o,m)}else u.current=null}function Yf(n,o,u){try{u()}catch(m){ur(n,o,m)}}var S_=!1;function Yb(n,o){if(Rf=md,n=Fv(),km(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var _=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{u.nodeType,b.nodeType}catch{u=null;break e}var P=0,l=-1,G=-1,J=0,we=0,fe=n,H=null;t:for(;;){for(var tt;fe!==u||_!==0&&fe.nodeType!==3||(l=P+_),fe!==b||m!==0&&fe.nodeType!==3||(G=P+m),fe.nodeType===3&&(P+=fe.nodeValue.length),(tt=fe.firstChild)!==null;)H=fe,fe=tt;for(;;){if(fe===n)break t;if(H===u&&++J===_&&(l=P),H===b&&++we===m&&(G=P),(tt=fe.nextSibling)!==null)break;fe=H,H=fe.parentNode}fe=tt}u=l===-1||G===-1?null:{start:l,end:G}}else u=null}u=u||{start:0,end:0}}else u=null;for(Ff={focusedElem:n,selectionRange:u},md=!1,xt=o;xt!==null;)if(o=xt,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,xt=n;else for(;xt!==null;){o=xt;try{var Xe=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Xe!==null){var $e=Xe.memoizedProps,fn=Xe.memoizedState,pe=o.stateNode,ie=pe.getSnapshotBeforeUpdate(o.elementType===o.type?$e:os(o.type,$e),fn);pe.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var he=o.stateNode.containerInfo;he.nodeType===1?he.textContent="":he.nodeType===9&&he.documentElement&&he.removeChild(he.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ze(163))}}catch(Ne){ur(o,o.return,Ne)}if(n=o.sibling,n!==null){n.return=o.return,xt=n;break}xt=o.return}return Xe=S_,S_=!1,Xe}function Ac(n,o,u){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var _=m=m.next;do{if((_.tag&n)===n){var b=_.destroy;_.destroy=void 0,b!==void 0&&Yf(o,u,b)}_=_.next}while(_!==m)}}function $d(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&n)===n){var m=u.create;u.destroy=m()}u=u.next}while(u!==o)}}function Qf(n){var o=n.ref;if(o!==null){var u=n.stateNode;switch(n.tag){case 5:n=u;break;default:n=u}typeof o=="function"?o(n):o.current=n}}function L0(n){var o=n.alternate;o!==null&&(n.alternate=null,L0(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[Ls],delete o[Zc],delete o[Nf],delete o[Db],delete o[Rb])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function D0(n){return n.tag===5||n.tag===3||n.tag===4}function E_(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||D0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function em(n,o,u){var m=n.tag;if(m===5||m===6)n=n.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(n,o):u.insertBefore(n,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(n,u)):(o=u,o.appendChild(n)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=_d));else if(m!==4&&(n=n.child,n!==null))for(em(n,o,u),n=n.sibling;n!==null;)em(n,o,u),n=n.sibling}function tm(n,o,u){var m=n.tag;if(m===5||m===6)n=n.stateNode,o?u.insertBefore(n,o):u.appendChild(n);else if(m!==4&&(n=n.child,n!==null))for(tm(n,o,u),n=n.sibling;n!==null;)tm(n,o,u),n=n.sibling}var hi=null,ss=!1;function za(n,o,u){for(u=u.child;u!==null;)R0(n,o,u),u=u.sibling}function R0(n,o,u){if(Ds&&typeof Ds.onCommitFiberUnmount=="function")try{Ds.onCommitFiberUnmount(Rd,u)}catch{}switch(u.tag){case 5:Ci||yu(u,o);case 6:var m=hi,_=ss;hi=null,za(n,o,u),hi=m,ss=_,hi!==null&&(ss?(n=hi,u=u.stateNode,n.nodeType===8?n.parentNode.removeChild(u):n.removeChild(u)):hi.removeChild(u.stateNode));break;case 18:hi!==null&&(ss?(n=hi,u=u.stateNode,n.nodeType===8?Qp(n.parentNode,u):n.nodeType===1&&Qp(n,u),Uc(n)):Qp(hi,u.stateNode));break;case 4:m=hi,_=ss,hi=u.stateNode.containerInfo,ss=!0,za(n,o,u),hi=m,ss=_;break;case 0:case 11:case 14:case 15:if(!Ci&&(m=u.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){_=m=m.next;do{var b=_,P=b.destroy;b=b.tag,P!==void 0&&(b&2||b&4)&&Yf(u,o,P),_=_.next}while(_!==m)}za(n,o,u);break;case 1:if(!Ci&&(yu(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=u.memoizedProps,m.state=u.memoizedState,m.componentWillUnmount()}catch(l){ur(u,o,l)}za(n,o,u);break;case 21:za(n,o,u);break;case 22:u.mode&1?(Ci=(m=Ci)||u.memoizedState!==null,za(n,o,u),Ci=m):za(n,o,u);break;default:za(n,o,u)}}function T_(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var u=n.stateNode;u===null&&(u=n.stateNode=new Jb),o.forEach(function(m){var _=a2.bind(null,n,m);u.has(m)||(u.add(m),m.then(_,_))})}}function is(n,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var _=u[m];try{var b=n,P=o,l=P;e:for(;l!==null;){switch(l.tag){case 5:hi=l.stateNode,ss=!1;break e;case 3:hi=l.stateNode.containerInfo,ss=!0;break e;case 4:hi=l.stateNode.containerInfo,ss=!0;break e}l=l.return}if(hi===null)throw Error(Ze(160));R0(b,P,_),hi=null,ss=!1;var G=_.alternate;G!==null&&(G.return=null),_.return=null}catch(J){ur(_,o,J)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)F0(o,n),o=o.sibling}function F0(n,o){var u=n.alternate,m=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(is(o,n),As(n),m&4){try{Ac(3,n,n.return),$d(3,n)}catch($e){ur(n,n.return,$e)}try{Ac(5,n,n.return)}catch($e){ur(n,n.return,$e)}}break;case 1:is(o,n),As(n),m&512&&u!==null&&yu(u,u.return);break;case 5:if(is(o,n),As(n),m&512&&u!==null&&yu(u,u.return),n.flags&32){var _=n.stateNode;try{Fc(_,"")}catch($e){ur(n,n.return,$e)}}if(m&4&&(_=n.stateNode,_!=null)){var b=n.memoizedProps,P=u!==null?u.memoizedProps:b,l=n.type,G=n.updateQueue;if(n.updateQueue=null,G!==null)try{l==="input"&&b.type==="radio"&&b.name!=null&&rv(_,b),Tf(l,P);var J=Tf(l,b);for(P=0;P<G.length;P+=2){var we=G[P],fe=G[P+1];we==="style"?lv(_,fe):we==="dangerouslySetInnerHTML"?sv(_,fe):we==="children"?Fc(_,fe):fm(_,we,fe,J)}switch(l){case"input":xf(_,b);break;case"textarea":iv(_,b);break;case"select":var H=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!b.multiple;var tt=b.value;tt!=null?vu(_,!!b.multiple,tt,!1):H!==!!b.multiple&&(b.defaultValue!=null?vu(_,!!b.multiple,b.defaultValue,!0):vu(_,!!b.multiple,b.multiple?[]:"",!1))}_[Zc]=b}catch($e){ur(n,n.return,$e)}}break;case 6:if(is(o,n),As(n),m&4){if(n.stateNode===null)throw Error(Ze(162));_=n.stateNode,b=n.memoizedProps;try{_.nodeValue=b}catch($e){ur(n,n.return,$e)}}break;case 3:if(is(o,n),As(n),m&4&&u!==null&&u.memoizedState.isDehydrated)try{Uc(o.containerInfo)}catch($e){ur(n,n.return,$e)}break;case 4:is(o,n),As(n);break;case 13:is(o,n),As(n),_=n.child,_.flags&8192&&(b=_.memoizedState!==null,_.stateNode.isHidden=b,!b||_.alternate!==null&&_.alternate.memoizedState!==null||(Wm=yr())),m&4&&T_(n);break;case 22:if(we=u!==null&&u.memoizedState!==null,n.mode&1?(Ci=(J=Ci)||we,is(o,n),Ci=J):is(o,n),As(n),m&8192){if(J=n.memoizedState!==null,(n.stateNode.isHidden=J)&&!we&&n.mode&1)for(xt=n,we=n.child;we!==null;){for(fe=xt=we;xt!==null;){switch(H=xt,tt=H.child,H.tag){case 0:case 11:case 14:case 15:Ac(4,H,H.return);break;case 1:yu(H,H.return);var Xe=H.stateNode;if(typeof Xe.componentWillUnmount=="function"){m=H,u=H.return;try{o=m,Xe.props=o.memoizedProps,Xe.state=o.memoizedState,Xe.componentWillUnmount()}catch($e){ur(m,u,$e)}}break;case 5:yu(H,H.return);break;case 22:if(H.memoizedState!==null){k_(fe);continue}}tt!==null?(tt.return=H,xt=tt):k_(fe)}we=we.sibling}e:for(we=null,fe=n;;){if(fe.tag===5){if(we===null){we=fe;try{_=fe.stateNode,J?(b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(l=fe.stateNode,G=fe.memoizedProps.style,P=G!=null&&G.hasOwnProperty("display")?G.display:null,l.style.display=av("display",P))}catch($e){ur(n,n.return,$e)}}}else if(fe.tag===6){if(we===null)try{fe.stateNode.nodeValue=J?"":fe.memoizedProps}catch($e){ur(n,n.return,$e)}}else if((fe.tag!==22&&fe.tag!==23||fe.memoizedState===null||fe===n)&&fe.child!==null){fe.child.return=fe,fe=fe.child;continue}if(fe===n)break e;for(;fe.sibling===null;){if(fe.return===null||fe.return===n)break e;we===fe&&(we=null),fe=fe.return}we===fe&&(we=null),fe.sibling.return=fe.return,fe=fe.sibling}}break;case 19:is(o,n),As(n),m&4&&T_(n);break;case 21:break;default:is(o,n),As(n)}}function As(n){var o=n.flags;if(o&2){try{e:{for(var u=n.return;u!==null;){if(D0(u)){var m=u;break e}u=u.return}throw Error(Ze(160))}switch(m.tag){case 5:var _=m.stateNode;m.flags&32&&(Fc(_,""),m.flags&=-33);var b=E_(n);tm(n,b,_);break;case 3:case 4:var P=m.stateNode.containerInfo,l=E_(n);em(n,l,P);break;default:throw Error(Ze(161))}}catch(G){ur(n,n.return,G)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function Qb(n,o,u){xt=n,B0(n)}function B0(n,o,u){for(var m=(n.mode&1)!==0;xt!==null;){var _=xt,b=_.child;if(_.tag===22&&m){var P=_.memoizedState!==null||Hh;if(!P){var l=_.alternate,G=l!==null&&l.memoizedState!==null||Ci;l=Hh;var J=Ci;if(Hh=P,(Ci=G)&&!J)for(xt=_;xt!==null;)P=xt,G=P.child,P.tag===22&&P.memoizedState!==null?I_(_):G!==null?(G.return=P,xt=G):I_(_);for(;b!==null;)xt=b,B0(b),b=b.sibling;xt=_,Hh=l,Ci=J}C_(n)}else _.subtreeFlags&8772&&b!==null?(b.return=_,xt=b):C_(n)}}function C_(n){for(;xt!==null;){var o=xt;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Ci||$d(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!Ci)if(u===null)m.componentDidMount();else{var _=o.elementType===o.type?u.memoizedProps:os(o.type,u.memoizedProps);m.componentDidUpdate(_,u.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var b=o.updateQueue;b!==null&&u_(o,b,m);break;case 3:var P=o.updateQueue;if(P!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}u_(o,P,u)}break;case 5:var l=o.stateNode;if(u===null&&o.flags&4){u=l;var G=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&u.focus();break;case"img":G.src&&(u.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var J=o.alternate;if(J!==null){var we=J.memoizedState;if(we!==null){var fe=we.dehydrated;fe!==null&&Uc(fe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ze(163))}Ci||o.flags&512&&Qf(o)}catch(H){ur(o,o.return,H)}}if(o===n){xt=null;break}if(u=o.sibling,u!==null){u.return=o.return,xt=u;break}xt=o.return}}function k_(n){for(;xt!==null;){var o=xt;if(o===n){xt=null;break}var u=o.sibling;if(u!==null){u.return=o.return,xt=u;break}xt=o.return}}function I_(n){for(;xt!==null;){var o=xt;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{$d(4,o)}catch(G){ur(o,u,G)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var _=o.return;try{m.componentDidMount()}catch(G){ur(o,_,G)}}var b=o.return;try{Qf(o)}catch(G){ur(o,b,G)}break;case 5:var P=o.return;try{Qf(o)}catch(G){ur(o,P,G)}}}catch(G){ur(o,o.return,G)}if(o===n){xt=null;break}var l=o.sibling;if(l!==null){l.return=o.return,xt=l;break}xt=o.return}}var e2=Math.ceil,Md=ha.ReactCurrentDispatcher,Zm=ha.ReactCurrentOwner,Go=ha.ReactCurrentBatchConfig,vn=0,Qr=null,Mr=null,di=0,wo=0,_u=Ja(0),Nr=0,Jc=null,Rl=0,Gd=0,qm=0,zc=null,Qi=null,Wm=0,Au=1/0,na=null,Pd=!1,nm=null,Za=null,Kh=!1,Na=null,Ad=0,Lc=0,rm=null,ad=-1,ld=0;function Oi(){return vn&6?yr():ad!==-1?ad:ad=yr()}function qa(n){return n.mode&1?vn&2&&di!==0?di&-di:Bb.transition!==null?(ld===0&&(ld=xv()),ld):(n=Mn,n!==0||(n=window.event,n=n===void 0?16:kv(n.type)),n):1}function us(n,o,u,m){if(50<Lc)throw Lc=0,rm=null,Error(Ze(185));Qc(n,u,m),(!(vn&2)||n!==Qr)&&(n===Qr&&(!(vn&2)&&(Gd|=u),Nr===4&&Fa(n,di)),ro(n,m),u===1&&vn===0&&!(o.mode&1)&&(Au=yr()+500,Ud&&Ya()))}function ro(n,o){var u=n.callbackNode;Bw(n,o);var m=fd(n,n===Qr?di:0);if(m===0)u!==null&&By(u),n.callbackNode=null,n.callbackPriority=0;else if(o=m&-m,n.callbackPriority!==o){if(u!=null&&By(u),o===1)n.tag===0?Fb(M_.bind(null,n)):qv(M_.bind(null,n)),zb(function(){!(vn&6)&&Ya()}),u=null;else{switch(wv(m)){case 1:u=vm;break;case 4:u=_v;break;case 16:u=pd;break;case 536870912:u=vv;break;default:u=pd}u=Z0(u,O0.bind(null,n))}n.callbackPriority=o,n.callbackNode=u}}function O0(n,o){if(ad=-1,ld=0,vn&6)throw Error(Ze(327));var u=n.callbackNode;if(Eu()&&n.callbackNode!==u)return null;var m=fd(n,n===Qr?di:0);if(m===0)return null;if(m&30||m&n.expiredLanes||o)o=zd(n,m);else{o=m;var _=vn;vn|=2;var b=U0();(Qr!==n||di!==o)&&(na=null,Au=yr()+500,Pl(n,o));do try{r2();break}catch(l){N0(n,l)}while(1);zm(),Md.current=b,vn=_,Mr!==null?o=0:(Qr=null,di=0,o=Nr)}if(o!==0){if(o===2&&(_=Pf(n),_!==0&&(m=_,o=im(n,_))),o===1)throw u=Jc,Pl(n,0),Fa(n,m),ro(n,yr()),u;if(o===6)Fa(n,m);else{if(_=n.current.alternate,!(m&30)&&!t2(_)&&(o=zd(n,m),o===2&&(b=Pf(n),b!==0&&(m=b,o=im(n,b))),o===1))throw u=Jc,Pl(n,0),Fa(n,m),ro(n,yr()),u;switch(n.finishedWork=_,n.finishedLanes=m,o){case 0:case 1:throw Error(Ze(345));case 2:Cl(n,Qi,na);break;case 3:if(Fa(n,m),(m&130023424)===m&&(o=Wm+500-yr(),10<o)){if(fd(n,0)!==0)break;if(_=n.suspendedLanes,(_&m)!==m){Oi(),n.pingedLanes|=n.suspendedLanes&_;break}n.timeoutHandle=Of(Cl.bind(null,n,Qi,na),o);break}Cl(n,Qi,na);break;case 4:if(Fa(n,m),(m&4194240)===m)break;for(o=n.eventTimes,_=-1;0<m;){var P=31-ls(m);b=1<<P,P=o[P],P>_&&(_=P),m&=~b}if(m=_,m=yr()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*e2(m/1960))-m,10<m){n.timeoutHandle=Of(Cl.bind(null,n,Qi,na),m);break}Cl(n,Qi,na);break;case 5:Cl(n,Qi,na);break;default:throw Error(Ze(329))}}}return ro(n,yr()),n.callbackNode===u?O0.bind(null,n):null}function im(n,o){var u=zc;return n.current.memoizedState.isDehydrated&&(Pl(n,o).flags|=256),n=zd(n,o),n!==2&&(o=Qi,Qi=u,o!==null&&om(o)),n}function om(n){Qi===null?Qi=n:Qi.push.apply(Qi,n)}function t2(n){for(var o=n;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var m=0;m<u.length;m++){var _=u[m],b=_.getSnapshot;_=_.value;try{if(!cs(b(),_))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Fa(n,o){for(o&=~qm,o&=~Gd,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var u=31-ls(o),m=1<<u;n[u]=-1,o&=~m}}function M_(n){if(vn&6)throw Error(Ze(327));Eu();var o=fd(n,0);if(!(o&1))return ro(n,yr()),null;var u=zd(n,o);if(n.tag!==0&&u===2){var m=Pf(n);m!==0&&(o=m,u=im(n,m))}if(u===1)throw u=Jc,Pl(n,0),Fa(n,o),ro(n,yr()),u;if(u===6)throw Error(Ze(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,Cl(n,Qi,na),ro(n,yr()),null}function Xm(n,o){var u=vn;vn|=1;try{return n(o)}finally{vn=u,vn===0&&(Au=yr()+500,Ud&&Ya())}}function Fl(n){Na!==null&&Na.tag===0&&!(vn&6)&&Eu();var o=vn;vn|=1;var u=Go.transition,m=Mn;try{if(Go.transition=null,Mn=1,n)return n()}finally{Mn=m,Go.transition=u,vn=o,!(vn&6)&&Ya()}}function Hm(){wo=_u.current,qn(_u)}function Pl(n,o){n.finishedWork=null,n.finishedLanes=0;var u=n.timeoutHandle;if(u!==-1&&(n.timeoutHandle=-1,Ab(u)),Mr!==null)for(u=Mr.return;u!==null;){var m=u;switch(Mm(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&vd();break;case 3:Mu(),qn(to),qn(ki),Om();break;case 5:Bm(m);break;case 4:Mu();break;case 13:qn(nr);break;case 19:qn(nr);break;case 10:Lm(m.type._context);break;case 22:case 23:Hm()}u=u.return}if(Qr=n,Mr=n=Wa(n.current,null),di=wo=o,Nr=0,Jc=null,qm=Gd=Rl=0,Qi=zc=null,Il!==null){for(o=0;o<Il.length;o++)if(u=Il[o],m=u.interleaved,m!==null){u.interleaved=null;var _=m.next,b=u.pending;if(b!==null){var P=b.next;b.next=_,m.next=P}u.pending=m}Il=null}return n}function N0(n,o){do{var u=Mr;try{if(zm(),id.current=Id,kd){for(var m=rr.memoizedState;m!==null;){var _=m.queue;_!==null&&(_.pending=null),m=m.next}kd=!1}if(Dl=0,Yr=Or=rr=null,Pc=!1,Xc=0,Zm.current=null,u===null||u.return===null){Nr=1,Jc=o,Mr=null;break}e:{var b=n,P=u.return,l=u,G=o;if(o=di,l.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var J=G,we=l,fe=we.tag;if(!(we.mode&1)&&(fe===0||fe===11||fe===15)){var H=we.alternate;H?(we.updateQueue=H.updateQueue,we.memoizedState=H.memoizedState,we.lanes=H.lanes):(we.updateQueue=null,we.memoizedState=null)}var tt=g_(P);if(tt!==null){tt.flags&=-257,y_(tt,P,l,b,o),tt.mode&1&&m_(b,J,o),o=tt,G=J;var Xe=o.updateQueue;if(Xe===null){var $e=new Set;$e.add(G),o.updateQueue=$e}else Xe.add(G);break e}else{if(!(o&1)){m_(b,J,o),Km();break e}G=Error(Ze(426))}}else if(Yn&&l.mode&1){var fn=g_(P);if(fn!==null){!(fn.flags&65536)&&(fn.flags|=256),y_(fn,P,l,b,o),Pm(Pu(G,l));break e}}b=G=Pu(G,l),Nr!==4&&(Nr=2),zc===null?zc=[b]:zc.push(b),b=P;do{switch(b.tag){case 3:b.flags|=65536,o&=-o,b.lanes|=o;var pe=b0(b,G,o);l_(b,pe);break e;case 1:l=G;var ie=b.type,he=b.stateNode;if(!(b.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||he!==null&&typeof he.componentDidCatch=="function"&&(Za===null||!Za.has(he)))){b.flags|=65536,o&=-o,b.lanes|=o;var Ne=S0(b,l,o);l_(b,Ne);break e}}b=b.return}while(b!==null)}j0(u)}catch(Ge){o=Ge,Mr===u&&u!==null&&(Mr=u=u.return);continue}break}while(1)}function U0(){var n=Md.current;return Md.current=Id,n===null?Id:n}function Km(){(Nr===0||Nr===3||Nr===2)&&(Nr=4),Qr===null||!(Rl&268435455)&&!(Gd&268435455)||Fa(Qr,di)}function zd(n,o){var u=vn;vn|=2;var m=U0();(Qr!==n||di!==o)&&(na=null,Pl(n,o));do try{n2();break}catch(_){N0(n,_)}while(1);if(zm(),vn=u,Md.current=m,Mr!==null)throw Error(Ze(261));return Qr=null,di=0,Nr}function n2(){for(;Mr!==null;)V0(Mr)}function r2(){for(;Mr!==null&&!Iw();)V0(Mr)}function V0(n){var o=G0(n.alternate,n,wo);n.memoizedProps=n.pendingProps,o===null?j0(n):Mr=o,Zm.current=null}function j0(n){var o=n;do{var u=o.alternate;if(n=o.return,o.flags&32768){if(u=Kb(u,o),u!==null){u.flags&=32767,Mr=u;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Nr=6,Mr=null;return}}else if(u=Hb(u,o,wo),u!==null){Mr=u;return}if(o=o.sibling,o!==null){Mr=o;return}Mr=o=n}while(o!==null);Nr===0&&(Nr=5)}function Cl(n,o,u){var m=Mn,_=Go.transition;try{Go.transition=null,Mn=1,i2(n,o,u,m)}finally{Go.transition=_,Mn=m}return null}function i2(n,o,u,m){do Eu();while(Na!==null);if(vn&6)throw Error(Ze(327));u=n.finishedWork;var _=n.finishedLanes;if(u===null)return null;if(n.finishedWork=null,n.finishedLanes=0,u===n.current)throw Error(Ze(177));n.callbackNode=null,n.callbackPriority=0;var b=u.lanes|u.childLanes;if(Ow(n,b),n===Qr&&(Mr=Qr=null,di=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||Kh||(Kh=!0,Z0(pd,function(){return Eu(),null})),b=(u.flags&15990)!==0,u.subtreeFlags&15990||b){b=Go.transition,Go.transition=null;var P=Mn;Mn=1;var l=vn;vn|=4,Zm.current=null,Yb(n,u),F0(u,n),Eb(Ff),md=!!Rf,Ff=Rf=null,n.current=u,Qb(u),Mw(),vn=l,Mn=P,Go.transition=b}else n.current=u;if(Kh&&(Kh=!1,Na=n,Ad=_),b=n.pendingLanes,b===0&&(Za=null),zw(u.stateNode),ro(n,yr()),o!==null)for(m=n.onRecoverableError,u=0;u<o.length;u++)_=o[u],m(_.value,{componentStack:_.stack,digest:_.digest});if(Pd)throw Pd=!1,n=nm,nm=null,n;return Ad&1&&n.tag!==0&&Eu(),b=n.pendingLanes,b&1?n===rm?Lc++:(Lc=0,rm=n):Lc=0,Ya(),null}function Eu(){if(Na!==null){var n=wv(Ad),o=Go.transition,u=Mn;try{if(Go.transition=null,Mn=16>n?16:n,Na===null)var m=!1;else{if(n=Na,Na=null,Ad=0,vn&6)throw Error(Ze(331));var _=vn;for(vn|=4,xt=n.current;xt!==null;){var b=xt,P=b.child;if(xt.flags&16){var l=b.deletions;if(l!==null){for(var G=0;G<l.length;G++){var J=l[G];for(xt=J;xt!==null;){var we=xt;switch(we.tag){case 0:case 11:case 15:Ac(8,we,b)}var fe=we.child;if(fe!==null)fe.return=we,xt=fe;else for(;xt!==null;){we=xt;var H=we.sibling,tt=we.return;if(L0(we),we===J){xt=null;break}if(H!==null){H.return=tt,xt=H;break}xt=tt}}}var Xe=b.alternate;if(Xe!==null){var $e=Xe.child;if($e!==null){Xe.child=null;do{var fn=$e.sibling;$e.sibling=null,$e=fn}while($e!==null)}}xt=b}}if(b.subtreeFlags&2064&&P!==null)P.return=b,xt=P;else e:for(;xt!==null;){if(b=xt,b.flags&2048)switch(b.tag){case 0:case 11:case 15:Ac(9,b,b.return)}var pe=b.sibling;if(pe!==null){pe.return=b.return,xt=pe;break e}xt=b.return}}var ie=n.current;for(xt=ie;xt!==null;){P=xt;var he=P.child;if(P.subtreeFlags&2064&&he!==null)he.return=P,xt=he;else e:for(P=ie;xt!==null;){if(l=xt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:$d(9,l)}}catch(Ge){ur(l,l.return,Ge)}if(l===P){xt=null;break e}var Ne=l.sibling;if(Ne!==null){Ne.return=l.return,xt=Ne;break e}xt=l.return}}if(vn=_,Ya(),Ds&&typeof Ds.onPostCommitFiberRoot=="function")try{Ds.onPostCommitFiberRoot(Rd,n)}catch{}m=!0}return m}finally{Mn=u,Go.transition=o}}return!1}function P_(n,o,u){o=Pu(u,o),o=b0(n,o,1),n=Ga(n,o,1),o=Oi(),n!==null&&(Qc(n,1,o),ro(n,o))}function ur(n,o,u){if(n.tag===3)P_(n,n,u);else for(;o!==null;){if(o.tag===3){P_(o,n,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Za===null||!Za.has(m))){n=Pu(u,n),n=S0(o,n,1),o=Ga(o,n,1),n=Oi(),o!==null&&(Qc(o,1,n),ro(o,n));break}}o=o.return}}function o2(n,o,u){var m=n.pingCache;m!==null&&m.delete(o),o=Oi(),n.pingedLanes|=n.suspendedLanes&u,Qr===n&&(di&u)===u&&(Nr===4||Nr===3&&(di&130023424)===di&&500>yr()-Wm?Pl(n,0):qm|=u),ro(n,o)}function $0(n,o){o===0&&(n.mode&1?(o=Uh,Uh<<=1,!(Uh&130023424)&&(Uh=4194304)):o=1);var u=Oi();n=ua(n,o),n!==null&&(Qc(n,o,u),ro(n,u))}function s2(n){var o=n.memoizedState,u=0;o!==null&&(u=o.retryLane),$0(n,u)}function a2(n,o){var u=0;switch(n.tag){case 13:var m=n.stateNode,_=n.memoizedState;_!==null&&(u=_.retryLane);break;case 19:m=n.stateNode;break;default:throw Error(Ze(314))}m!==null&&m.delete(o),$0(n,u)}var G0;G0=function(n,o,u){if(n!==null)if(n.memoizedProps!==o.pendingProps||to.current)eo=!0;else{if(!(n.lanes&u)&&!(o.flags&128))return eo=!1,Xb(n,o,u);eo=!!(n.flags&131072)}else eo=!1,Yn&&o.flags&1048576&&Wv(o,bd,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;sd(n,o),n=o.pendingProps;var _=Cu(o,ki.current);Su(o,u),_=Um(null,o,m,n,_,u);var b=Vm();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,no(m)?(b=!0,xd(o)):b=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Rm(o),_.updater=Vd,o.stateNode=_,_._reactInternals=o,Zf(o,m,n,u),o=Xf(null,o,m,!0,b,u)):(o.tag=0,Yn&&b&&Im(o),Bi(null,o,_,u),o=o.child),o;case 16:m=o.elementType;e:{switch(sd(n,o),n=o.pendingProps,_=m._init,m=_(m._payload),o.type=m,_=o.tag=u2(m),n=os(m,n),_){case 0:o=Wf(null,o,m,n,u);break e;case 1:o=x_(null,o,m,n,u);break e;case 11:o=__(null,o,m,n,u);break e;case 14:o=v_(null,o,m,os(m.type,n),u);break e}throw Error(Ze(306,m,""))}return o;case 0:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:os(m,_),Wf(n,o,m,_,u);case 1:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:os(m,_),x_(n,o,m,_,u);case 3:e:{if(k0(o),n===null)throw Error(Ze(387));m=o.pendingProps,b=o.memoizedState,_=b.element,Jv(n,o),Td(o,m,null,u);var P=o.memoizedState;if(m=P.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:P.cache,pendingSuspenseBoundaries:P.pendingSuspenseBoundaries,transitions:P.transitions},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){_=Pu(Error(Ze(423)),o),o=w_(n,o,m,u,_);break e}else if(m!==_){_=Pu(Error(Ze(424)),o),o=w_(n,o,m,u,_);break e}else for(bo=$a(o.stateNode.containerInfo.firstChild),So=o,Yn=!0,as=null,u=t0(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(ku(),m===_){o=ca(n,o,u);break e}Bi(n,o,m,u)}o=o.child}return o;case 5:return n0(o),n===null&&jf(o),m=o.type,_=o.pendingProps,b=n!==null?n.memoizedProps:null,P=_.children,Bf(m,_)?P=null:b!==null&&Bf(m,b)&&(o.flags|=32),C0(n,o),Bi(n,o,P,u),o.child;case 6:return n===null&&jf(o),null;case 13:return I0(n,o,u);case 4:return Fm(o,o.stateNode.containerInfo),m=o.pendingProps,n===null?o.child=Iu(o,null,m,u):Bi(n,o,m,u),o.child;case 11:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:os(m,_),__(n,o,m,_,u);case 7:return Bi(n,o,o.pendingProps,u),o.child;case 8:return Bi(n,o,o.pendingProps.children,u),o.child;case 12:return Bi(n,o,o.pendingProps.children,u),o.child;case 10:e:{if(m=o.type._context,_=o.pendingProps,b=o.memoizedProps,P=_.value,jn(Sd,m._currentValue),m._currentValue=P,b!==null)if(cs(b.value,P)){if(b.children===_.children&&!to.current){o=ca(n,o,u);break e}}else for(b=o.child,b!==null&&(b.return=o);b!==null;){var l=b.dependencies;if(l!==null){P=b.child;for(var G=l.firstContext;G!==null;){if(G.context===m){if(b.tag===1){G=sa(-1,u&-u),G.tag=2;var J=b.updateQueue;if(J!==null){J=J.shared;var we=J.pending;we===null?G.next=G:(G.next=we.next,we.next=G),J.pending=G}}b.lanes|=u,G=b.alternate,G!==null&&(G.lanes|=u),$f(b.return,u,o),l.lanes|=u;break}G=G.next}}else if(b.tag===10)P=b.type===o.type?null:b.child;else if(b.tag===18){if(P=b.return,P===null)throw Error(Ze(341));P.lanes|=u,l=P.alternate,l!==null&&(l.lanes|=u),$f(P,u,o),P=b.sibling}else P=b.child;if(P!==null)P.return=b;else for(P=b;P!==null;){if(P===o){P=null;break}if(b=P.sibling,b!==null){b.return=P.return,P=b;break}P=P.return}b=P}Bi(n,o,_.children,u),o=o.child}return o;case 9:return _=o.type,m=o.pendingProps.children,Su(o,u),_=Zo(_),m=m(_),o.flags|=1,Bi(n,o,m,u),o.child;case 14:return m=o.type,_=os(m,o.pendingProps),_=os(m.type,_),v_(n,o,m,_,u);case 15:return E0(n,o,o.type,o.pendingProps,u);case 17:return m=o.type,_=o.pendingProps,_=o.elementType===m?_:os(m,_),sd(n,o),o.tag=1,no(m)?(n=!0,xd(o)):n=!1,Su(o,u),Qv(o,m,_),Zf(o,m,_,u),Xf(null,o,m,!0,n,u);case 19:return M0(n,o,u);case 22:return T0(n,o,u)}throw Error(Ze(156,o.tag))};function Z0(n,o){return yv(n,o)}function l2(n,o,u,m){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $o(n,o,u,m){return new l2(n,o,u,m)}function Jm(n){return n=n.prototype,!(!n||!n.isReactComponent)}function u2(n){if(typeof n=="function")return Jm(n)?1:0;if(n!=null){if(n=n.$$typeof,n===gm)return 11;if(n===ym)return 14}return 2}function Wa(n,o){var u=n.alternate;return u===null?(u=$o(n.tag,o,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=o,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&14680064,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,o=n.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u}function ud(n,o,u,m,_,b){var P=2;if(m=n,typeof n=="function")Jm(n)&&(P=1);else if(typeof n=="string")P=5;else e:switch(n){case lu:return Al(u.children,_,b,o);case mm:P=8,_|=8;break;case mf:return n=$o(12,u,o,_|2),n.elementType=mf,n.lanes=b,n;case gf:return n=$o(13,u,o,_),n.elementType=gf,n.lanes=b,n;case yf:return n=$o(19,u,o,_),n.elementType=yf,n.lanes=b,n;case ev:return Zd(u,_,b,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Y_:P=10;break e;case Q_:P=9;break e;case gm:P=11;break e;case ym:P=14;break e;case La:P=16,m=null;break e}throw Error(Ze(130,n==null?n:typeof n,""))}return o=$o(P,u,o,_),o.elementType=n,o.type=m,o.lanes=b,o}function Al(n,o,u,m){return n=$o(7,n,m,o),n.lanes=u,n}function Zd(n,o,u,m){return n=$o(22,n,m,o),n.elementType=ev,n.lanes=u,n.stateNode={isHidden:!1},n}function lf(n,o,u){return n=$o(6,n,null,o),n.lanes=u,n}function uf(n,o,u){return o=$o(4,n.children!==null?n.children:[],n.key,o),o.lanes=u,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function c2(n,o,u,m,_){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jp(0),this.expirationTimes=jp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jp(0),this.identifierPrefix=m,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Ym(n,o,u,m,_,b,P,l,G){return n=new c2(n,o,u,l,G),o===1?(o=1,b===!0&&(o|=8)):o=0,b=$o(3,null,null,o),n.current=b,b.stateNode=n,b.memoizedState={element:m,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rm(b),n}function h2(n,o,u){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:au,key:m==null?null:""+m,children:n,containerInfo:o,implementation:u}}function q0(n){if(!n)return Ha;n=n._reactInternals;e:{if(Ol(n)!==n||n.tag!==1)throw Error(Ze(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(no(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Ze(171))}if(n.tag===1){var u=n.type;if(no(u))return Zv(n,u,o)}return o}function W0(n,o,u,m,_,b,P,l,G){return n=Ym(u,m,!0,n,_,b,P,l,G),n.context=q0(null),u=n.current,m=Oi(),_=qa(u),b=sa(m,_),b.callback=o??null,Ga(u,b,_),n.current.lanes=_,Qc(n,_,m),ro(n,m),n}function qd(n,o,u,m){var _=o.current,b=Oi(),P=qa(_);return u=q0(u),o.context===null?o.context=u:o.pendingContext=u,o=sa(b,P),o.payload={element:n},m=m===void 0?null:m,m!==null&&(o.callback=m),n=Ga(_,o,P),n!==null&&(us(n,_,P,b),rd(n,_,P)),P}function Ld(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function A_(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<o?u:o}}function Qm(n,o){A_(n,o),(n=n.alternate)&&A_(n,o)}function d2(){return null}var X0=typeof reportError=="function"?reportError:function(n){console.error(n)};function eg(n){this._internalRoot=n}Wd.prototype.render=eg.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(Ze(409));qd(n,o,null,null)};Wd.prototype.unmount=eg.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;Fl(function(){qd(null,n,null,null)}),o[la]=null}};function Wd(n){this._internalRoot=n}Wd.prototype.unstable_scheduleHydration=function(n){if(n){var o=Ev();n={blockedOn:null,target:n,priority:o};for(var u=0;u<Ra.length&&o!==0&&o<Ra[u].priority;u++);Ra.splice(u,0,n),u===0&&Cv(n)}};function tg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Xd(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function z_(){}function p2(n,o,u,m,_){if(_){if(typeof m=="function"){var b=m;m=function(){var J=Ld(P);b.call(J)}}var P=W0(o,m,n,0,null,!1,!1,"",z_);return n._reactRootContainer=P,n[la]=P.current,$c(n.nodeType===8?n.parentNode:n),Fl(),P}for(;_=n.lastChild;)n.removeChild(_);if(typeof m=="function"){var l=m;m=function(){var J=Ld(G);l.call(J)}}var G=Ym(n,0,!1,null,null,!1,!1,"",z_);return n._reactRootContainer=G,n[la]=G.current,$c(n.nodeType===8?n.parentNode:n),Fl(function(){qd(o,G,u,m)}),G}function Hd(n,o,u,m,_){var b=u._reactRootContainer;if(b){var P=b;if(typeof _=="function"){var l=_;_=function(){var G=Ld(P);l.call(G)}}qd(o,P,n,_)}else P=p2(u,o,n,_,m);return Ld(P)}bv=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var u=bc(o.pendingLanes);u!==0&&(xm(o,u|1),ro(o,yr()),!(vn&6)&&(Au=yr()+500,Ya()))}break;case 13:Fl(function(){var m=ua(n,1);if(m!==null){var _=Oi();us(m,n,1,_)}}),Qm(n,1)}};wm=function(n){if(n.tag===13){var o=ua(n,134217728);if(o!==null){var u=Oi();us(o,n,134217728,u)}Qm(n,134217728)}};Sv=function(n){if(n.tag===13){var o=qa(n),u=ua(n,o);if(u!==null){var m=Oi();us(u,n,o,m)}Qm(n,o)}};Ev=function(){return Mn};Tv=function(n,o){var u=Mn;try{return Mn=n,o()}finally{Mn=u}};kf=function(n,o,u){switch(o){case"input":if(xf(n,u),o=u.name,u.type==="radio"&&o!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==n&&m.form===n.form){var _=Nd(m);if(!_)throw Error(Ze(90));nv(m),xf(m,_)}}}break;case"textarea":iv(n,u);break;case"select":o=u.value,o!=null&&vu(n,!!u.multiple,o,!1)}};hv=Xm;dv=Fl;var f2={usingClientEntryPoint:!1,Events:[th,du,Nd,uv,cv,Xm]},vc={findFiberByHostInstance:kl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},m2={bundleType:vc.bundleType,version:vc.version,rendererPackageName:vc.rendererPackageName,rendererConfig:vc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ha.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=mv(n),n===null?null:n.stateNode},findFiberByHostInstance:vc.findFiberByHostInstance||d2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jh.isDisabled&&Jh.supportsFiber)try{Rd=Jh.inject(m2),Ds=Jh}catch{}}To.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=f2;To.createPortal=function(n,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tg(o))throw Error(Ze(200));return h2(n,o,null,u)};To.createRoot=function(n,o){if(!tg(n))throw Error(Ze(299));var u=!1,m="",_=X0;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=Ym(n,1,!1,null,null,u,!1,m,_),n[la]=o.current,$c(n.nodeType===8?n.parentNode:n),new eg(o)};To.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(Ze(188)):(n=Object.keys(n).join(","),Error(Ze(268,n)));return n=mv(o),n=n===null?null:n.stateNode,n};To.flushSync=function(n){return Fl(n)};To.hydrate=function(n,o,u){if(!Xd(o))throw Error(Ze(200));return Hd(null,n,o,!0,u)};To.hydrateRoot=function(n,o,u){if(!tg(n))throw Error(Ze(405));var m=u!=null&&u.hydratedSources||null,_=!1,b="",P=X0;if(u!=null&&(u.unstable_strictMode===!0&&(_=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onRecoverableError!==void 0&&(P=u.onRecoverableError)),o=W0(o,null,n,1,u??null,_,!1,b,P),n[la]=o.current,$c(n),m)for(n=0;n<m.length;n++)u=m[n],_=u._getVersion,_=_(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,_]:o.mutableSourceEagerHydrationData.push(u,_);return new Wd(o)};To.render=function(n,o,u){if(!Xd(o))throw Error(Ze(200));return Hd(null,n,o,!1,u)};To.unmountComponentAtNode=function(n){if(!Xd(n))throw Error(Ze(40));return n._reactRootContainer?(Fl(function(){Hd(null,null,n,!1,function(){n._reactRootContainer=null,n[la]=null})}),!0):!1};To.unstable_batchedUpdates=Xm;To.unstable_renderSubtreeIntoContainer=function(n,o,u,m){if(!Xd(u))throw Error(Ze(200));if(n==null||n._reactInternals===void 0)throw Error(Ze(38));return Hd(n,o,u,!1,m)};To.version="18.2.0-next-9e3b772b8-20220608";(function(n){function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(u){console.error(u)}}o(),n.exports=To})(dw);var L_=Dc;df.createRoot=L_.createRoot,df.hydrateRoot=L_.hydrateRoot;const g2="modulepreload",y2=function(n){return"/"+n},D_={},_2=function(o,u,m){if(!u||u.length===0)return o();const _=document.getElementsByTagName("link");return Promise.all(u.map(b=>{if(b=y2(b),b in D_)return;D_[b]=!0;const P=b.endsWith(".css"),l=P?'[rel="stylesheet"]':"";if(!!m)for(let we=_.length-1;we>=0;we--){const fe=_[we];if(fe.href===b&&(!P||fe.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${l}`))return;const J=document.createElement("link");if(J.rel=P?"stylesheet":g2,P||(J.as="script",J.crossOrigin=""),J.href=b,document.head.appendChild(J),P)return new Promise((we,fe)=>{J.addEventListener("load",we),J.addEventListener("error",()=>fe(new Error(`Unable to preload CSS for ${b}`)))})})).then(()=>o())},v2=Rt.createContext(null);function x2(n){const o=n.clone();return o.pixelsToGLUnits=n.pixelsToGLUnits,o}function R_(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function F_(n,o){const u=o.viewState||o;let m=!1;if("longitude"in u&&"latitude"in u){const _=n.center;n.center=new _.constructor(u.longitude,u.latitude),m=m||_!==n.center}if("zoom"in u){const _=n.zoom;n.zoom=u.zoom,m=m||_!==n.zoom}if("bearing"in u){const _=n.bearing;n.bearing=u.bearing,m=m||_!==n.bearing}if("pitch"in u){const _=n.pitch;n.pitch=u.pitch,m=m||_!==n.pitch}return u.padding&&!n.isPaddingEqual(u.padding)&&(m=!0,n.padding=u.padding),m}const w2=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function B_(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const o={};for(const m of n.layers)o[m.id]=m;const u=n.layers.map(m=>{const _=o[m.ref];let b=null;if("interactive"in m&&(b={...m},delete b.interactive),_){b=b||{...m},delete b.ref;for(const P of w2)P in _&&(b[P]=_[P])}return b||m});return{...n,layers:u}}function b2(n,o){const u=Array.isArray(n)?n[0]:n?n.x:0,m=Array.isArray(n)?n[1]:n?n.y:0,_=Array.isArray(o)?o[0]:o?o.x:0,b=Array.isArray(o)?o[1]:o?o.y:0;return u===_&&m===b}function Ba(n,o){if(n===o)return!0;if(!n||!o)return!1;if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(let u=0;u<n.length;u++)if(!Ba(n[u],o[u]))return!1;return!0}else if(Array.isArray(o))return!1;if(typeof n=="object"&&typeof o=="object"){const u=Object.keys(n),m=Object.keys(o);if(u.length!==m.length)return!1;for(const _ of u)if(!o.hasOwnProperty(_)||!Ba(n[_],o[_]))return!1;return!0}return!1}const O_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},cf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},N_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},S2=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],E2=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class zu{constructor(o,u,m){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=_=>{const b=this.props[N_[_.type]];b&&b(_)},this._onPointerEvent=_=>{(_.type==="mousemove"||_.type==="mouseout")&&this._updateHover(_);const b=this.props[O_[_.type]];if(b){if(this.props.interactiveLayerIds&&_.type!=="mouseover"&&_.type!=="mouseout"){const P=this._hoveredFeatures||this._map.queryRenderedFeatures(_.point,{layers:this.props.interactiveLayerIds});_.features=P}b(_),delete _.features}},this._onCameraEvent=_=>{if(!this._internalUpdate){const b=this.props[cf[_.type]];b&&b(_)}_.type in this._deferredEvents&&(this._deferredEvents[_.type]=!1)},this._MapClass=o,this.props=u,this._initialize(m)}get map(){return this._map}get transform(){return this._renderTransform}setProps(o){const u=this.props;this.props=o;const m=this._updateSettings(o,u);m&&this._createShadowTransform(this._map);const _=this._updateSize(o),b=this._updateViewState(o,!0);this._updateStyle(o,u),this._updateStyleComponents(o,u),this._updateHandlers(o,u),(m||_||b&&!this._map.isMoving())&&this.redraw()}static reuse(o,u){const m=zu.savedMaps.pop();if(!m)return null;const _=m.map,b=_.getContainer();for(u.className=b.className;b.childNodes.length>0;)u.appendChild(b.childNodes[0]);_._container=u,m.setProps({...o,styleDiffing:!1}),_.resize();const{initialViewState:P}=o;return P&&(P.bounds?_.fitBounds(P.bounds,{...P.fitBoundsOptions,duration:0}):m._updateViewState(P,!1)),_.isStyleLoaded()?_.fire("load"):_.once("styledata",()=>_.fire("load")),m}_initialize(o){const{props:u}=this,m={...u,...u.initialViewState,accessToken:u.mapboxAccessToken||T2()||null,container:o,style:B_(u.mapStyle)},_=m.initialViewState||m.viewState||m;if(Object.assign(m,{center:[_.longitude||0,_.latitude||0],zoom:_.zoom||0,pitch:_.pitch||0,bearing:_.bearing||0}),u.gl){const J=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=J,u.gl)}const b=new this._MapClass(m);_.padding&&b.setPadding(_.padding),u.cursor&&(b.getCanvas().style.cursor=u.cursor),this._createShadowTransform(b);const P=b._render;b._render=J=>{this._inRender=!0,P.call(b,J),this._inRender=!1};const l=b._renderTaskQueue.run;b._renderTaskQueue.run=J=>{l.call(b._renderTaskQueue,J),this._onBeforeRepaint()},b.on("render",()=>this._onAfterRepaint());const G=b.fire;b.fire=this._fireEvent.bind(this,G),b.on("resize",()=>{this._renderTransform.resize(b.transform.width,b.transform.height)}),b.on("styledata",()=>this._updateStyleComponents(this.props,{})),b.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const J in O_)b.on(J,this._onPointerEvent);for(const J in cf)b.on(J,this._onCameraEvent);for(const J in N_)b.on(J,this._onEvent);this._map=b}recycle(){const u=this.map.getContainer().querySelector("[mapboxgl-children]");u==null||u.remove(),zu.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const o=this._map;!this._inRender&&o.style&&(o._frame&&(o._frame.cancel(),o._frame=null),o._render())}_createShadowTransform(o){const u=x2(o.transform);o.painter.transform=u,this._renderTransform=u}_updateSize(o){const{viewState:u}=o;if(u){const m=this._map;if(u.width!==m.transform.width||u.height!==m.transform.height)return m.resize(),!0}return!1}_updateViewState(o,u){if(this._internalUpdate)return!1;const m=this._map,_=this._renderTransform,{zoom:b,pitch:P,bearing:l}=_,G=m.isMoving();G&&(_.cameraElevationReference="sea");const J=F_(_,{...R_(m.transform),...o});if(G&&(_.cameraElevationReference="ground"),J&&u){const we=this._deferredEvents;we.move=!0,we.zoom||(we.zoom=b!==_.zoom),we.rotate||(we.rotate=l!==_.bearing),we.pitch||(we.pitch=P!==_.pitch)}return G||F_(m.transform,o),J}_updateSettings(o,u){const m=this._map;let _=!1;for(const b of S2)b in o&&!Ba(o[b],u[b])&&(_=!0,m[`set${b[0].toUpperCase()}${b.slice(1)}`](o[b]));return _}_updateStyle(o,u){if(o.cursor!==u.cursor&&(this._map.getCanvas().style.cursor=o.cursor),o.mapStyle!==u.mapStyle){const m={diff:o.styleDiffing};return"localIdeographFontFamily"in o&&(m.localIdeographFontFamily=o.localIdeographFontFamily),this._map.setStyle(B_(o.mapStyle),m),!0}return!1}_updateStyleComponents(o,u){const m=this._map;let _=!1;return m.style.loaded()&&("light"in o&&!Ba(o.light,u.light)&&(_=!0,m.setLight(o.light)),"fog"in o&&!Ba(o.fog,u.fog)&&(_=!0,m.setFog(o.fog)),"terrain"in o&&!Ba(o.terrain,u.terrain)&&(!o.terrain||m.getSource(o.terrain.source))&&(_=!0,m.setTerrain(o.terrain))),_}_updateHandlers(o,u){const m=this._map;let _=!1;for(const b of E2){const P=o[b];Ba(P,u[b])||(_=!0,P?m[b].enable(P):m[b].disable())}return _}_updateHover(o){var u;const{props:m}=this;if(m.interactiveLayerIds&&(m.onMouseMove||m.onMouseEnter||m.onMouseLeave)){const b=o.type,P=((u=this._hoveredFeatures)===null||u===void 0?void 0:u.length)>0;let l;if(b==="mousemove")try{l=this._map.queryRenderedFeatures(o.point,{layers:m.interactiveLayerIds})}catch{l=[]}else l=[];const G=l.length>0;!G&&P&&(o.type="mouseleave",this._onPointerEvent(o)),this._hoveredFeatures=l,G&&!P&&(o.type="mouseenter",this._onPointerEvent(o)),o.type=b}else this._hoveredFeatures=null}_fireEvent(o,u,m){const _=this._map,b=_.transform,P=typeof u=="string"?u:u.type;return P==="move"&&this._updateViewState(this.props,!1),P in cf&&(typeof u=="object"&&(u.viewState=R_(b)),this._map.isMoving())?(_.transform=this._renderTransform,o.call(_,u,m),_.transform=b,_):(o.call(_,u,m),_)}_onBeforeRepaint(){const o=this._map;this._internalUpdate=!0;for(const m in this._deferredEvents)this._deferredEvents[m]&&o.fire(m);this._internalUpdate=!1;const u=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=u}}}zu.savedMaps=[];function T2(){let n=null;if(typeof location<"u"){const o=/access_token=([^&\/]*)/.exec(location.search);n=o&&o[1]}try{n=n||{}.MapboxAccessToken}catch{}try{n=n||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return n}const C2=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function k2(n,o){if(!n)return null;const u=n.map,m={getMap:()=>u,getCenter:()=>n.transform.center,getZoom:()=>n.transform.zoom,getBearing:()=>n.transform.bearing,getPitch:()=>n.transform.pitch,getPadding:()=>n.transform.padding,getBounds:()=>n.transform.getBounds(),project:_=>n.transform.locationPoint(o.LngLat.convert(_)),unproject:_=>n.transform.pointLocation(o.Point.convert(_)),queryTerrainElevation:(_,b)=>{const P=u.transform;u.transform=n.transform;const l=u.queryTerrainElevation(_,b);return u.transform=P,l}};for(const _ of I2(u))!(_ in m)&&!C2.includes(_)&&(m[_]=u[_].bind(u));return m}function I2(n){const o=new Set;let u=n;for(;u;){for(const m of Object.getOwnPropertyNames(u))m[0]!=="_"&&typeof n[m]=="function"&&m!=="fire"&&m!=="setEventedParent"&&o.add(m);u=Object.getPrototypeOf(u)}return Array.from(o)}const M2=typeof document<"u"?Rt.useLayoutEffect:Rt.useEffect,P2=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function A2(n,o){for(const u of P2)u in o&&(n[u]=o[u]);o.RTLTextPlugin&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"&&n.setRTLTextPlugin(o.RTLTextPlugin,u=>{u&&console.error(u)},!1)}const Kd=Rt.createContext(null),z2={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:n=>console.error(n.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},ng=Rt.forwardRef((n,o)=>{const u=Rt.useContext(v2),[m,_]=Rt.useState(null),b=Rt.useRef(),{current:P}=Rt.useRef({mapLib:null,map:null});Rt.useEffect(()=>{const G=n.mapLib;let J=!0,we;return Promise.resolve(G||_2(()=>import("./mapbox-gl-a4741de8.js").then(fe=>fe.m),[])).then(fe=>{if(J){if(fe.Map||(fe=fe.default),!fe||!fe.Map)throw new Error("Invalid mapLib");if(fe.supported(n))A2(fe,n),n.reuseMaps&&(we=zu.reuse(n,b.current)),we||(we=new zu(fe.Map,n,b.current)),P.map=k2(we,fe),P.mapLib=fe,_(we),u==null||u.onMapMount(P.map,n.id);else throw new Error("Map is not supported by this browser")}}).catch(fe=>{n.onError({type:"error",target:null,originalEvent:null,error:fe})}),()=>{J=!1,we&&(u==null||u.onMapUnmount(n.id),n.reuseMaps?we.recycle():we.destroy())}},[]),M2(()=>{m&&m.setProps(n)}),Rt.useImperativeHandle(o,()=>P.map,[m]);const l=Rt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]);return Rt.createElement("div",{id:n.id,ref:b,style:l},m&&Rt.createElement(Kd.Provider,{value:P},Rt.createElement("div",{"mapboxgl-children":""},n.children)))});ng.displayName="Map";ng.defaultProps=z2;const L2=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Nl(n,o){if(!n||!o)return;const u=n.style;for(const m in o){const _=o[m];Number.isFinite(_)&&!L2.test(m)?u[m]=`${_}px`:u[m]=_}}const D2={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function H0(n){const{map:o,mapLib:u}=Rt.useContext(Kd),m=Rt.useRef({props:n});m.current.props=n;const _=Rt.useMemo(()=>{let b=!1;Rt.Children.forEach(n.children,G=>{G&&(b=!0)});const P={...n,element:b?document.createElement("div"):null},l=new u.Marker(P).setLngLat([n.longitude,n.latitude]);return l.getElement().addEventListener("click",G=>{var J,we;(we=(J=m.current.props).onClick)===null||we===void 0||we.call(J,{type:"click",target:l,originalEvent:G})}),l.on("dragstart",G=>{var J,we;const fe=G;fe.lngLat=_.getLngLat(),(we=(J=m.current.props).onDragStart)===null||we===void 0||we.call(J,fe)}),l.on("drag",G=>{var J,we;const fe=G;fe.lngLat=_.getLngLat(),(we=(J=m.current.props).onDrag)===null||we===void 0||we.call(J,fe)}),l.on("dragend",G=>{var J,we;const fe=G;fe.lngLat=_.getLngLat(),(we=(J=m.current.props).onDragEnd)===null||we===void 0||we.call(J,fe)}),l},[]);return Rt.useEffect(()=>(_.addTo(o.getMap()),()=>{_.remove()}),[]),Rt.useEffect(()=>{Nl(_.getElement(),n.style)},[n.style]),(_.getLngLat().lng!==n.longitude||_.getLngLat().lat!==n.latitude)&&_.setLngLat([n.longitude,n.latitude]),n.offset&&!b2(_.getOffset(),n.offset)&&_.setOffset(n.offset),_.isDraggable()!==n.draggable&&_.setDraggable(n.draggable),_.getRotation()!==n.rotation&&_.setRotation(n.rotation),_.getRotationAlignment()!==n.rotationAlignment&&_.setRotationAlignment(n.rotationAlignment),_.getPitchAlignment()!==n.pitchAlignment&&_.setPitchAlignment(n.pitchAlignment),_.getPopup()!==n.popup&&_.setPopup(n.popup),Dc.createPortal(n.children,_.getElement())}H0.defaultProps=D2;Rt.memo(H0);function U_(n){return new Set(n?n.trim().split(/\s+/):[])}function R2(n){const{map:o,mapLib:u}=Rt.useContext(Kd),m=Rt.useMemo(()=>document.createElement("div"),[]),_=Rt.useRef({props:n});_.current.props=n;const b=Rt.useMemo(()=>{const P={...n},l=new u.Popup(P).setLngLat([n.longitude,n.latitude]);return l.once("open",G=>{var J,we;(we=(J=_.current.props).onOpen)===null||we===void 0||we.call(J,G)}),l},[]);if(Rt.useEffect(()=>{const P=l=>{var G,J;(J=(G=_.current.props).onClose)===null||J===void 0||J.call(G,l)};return b.on("close",P),b.setDOMContent(m).addTo(o.getMap()),()=>{b.off("close",P),b.isOpen()&&b.remove()}},[]),Rt.useEffect(()=>{Nl(b.getElement(),n.style)},[n.style]),b.isOpen()&&((b.getLngLat().lng!==n.longitude||b.getLngLat().lat!==n.latitude)&&b.setLngLat([n.longitude,n.latitude]),n.offset&&!Ba(b.options.offset,n.offset)&&b.setOffset(n.offset),(b.options.anchor!==n.anchor||b.options.maxWidth!==n.maxWidth)&&(b.options.anchor=n.anchor,b.setMaxWidth(n.maxWidth)),b.options.className!==n.className)){const P=U_(b.options.className),l=U_(n.className);for(const G of P)l.has(G)||b.removeClassName(G);for(const G of l)P.has(G)||b.addClassName(G);b.options.className=n.className}return Dc.createPortal(n.children,m)}Rt.memo(R2);function Fu(n,o,u,m){const _=Rt.useContext(Kd),b=Rt.useMemo(()=>n(_),[]);return Rt.useEffect(()=>{const P=m||u||o,l=typeof o=="function"&&typeof u=="function"?o:null,G=typeof u=="function"?u:typeof o=="function"?o:null,{map:J}=_;return J.hasControl(b)||(J.addControl(b,P==null?void 0:P.position),l&&l(_)),()=>{G&&G(_),J.hasControl(b)&&J.removeControl(b)}},[]),b}function F2(n){const o=Fu(({mapLib:u})=>new u.AttributionControl(n),{position:n.position});return Rt.useEffect(()=>{Nl(o._container,n.style)},[n.style]),null}Rt.memo(F2);function B2(n){const o=Fu(({mapLib:u})=>new u.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return Rt.useEffect(()=>{Nl(o._controlContainer,n.style)},[n.style]),null}Rt.memo(B2);const K0=Rt.forwardRef((n,o)=>{const u=Rt.useRef({props:n}),m=Fu(({mapLib:_})=>{const b=new _.GeolocateControl(n),P=b._setupUI;return b._setupUI=l=>{b._container.hasChildNodes()||P(l)},b.on("geolocate",l=>{var G,J;(J=(G=u.current.props).onGeolocate)===null||J===void 0||J.call(G,l)}),b.on("error",l=>{var G,J;(J=(G=u.current.props).onError)===null||J===void 0||J.call(G,l)}),b.on("outofmaxbounds",l=>{var G,J;(J=(G=u.current.props).onOutOfMaxBounds)===null||J===void 0||J.call(G,l)}),b.on("trackuserlocationstart",l=>{var G,J;(J=(G=u.current.props).onTrackUserLocationStart)===null||J===void 0||J.call(G,l)}),b.on("trackuserlocationend",l=>{var G,J;(J=(G=u.current.props).onTrackUserLocationEnd)===null||J===void 0||J.call(G,l)}),b},{position:n.position});return u.current.props=n,Rt.useImperativeHandle(o,()=>({trigger:()=>m.trigger()}),[]),Rt.useEffect(()=>{Nl(m._container,n.style)},[n.style]),null});K0.displayName="GeolocateControl";Rt.memo(K0);function O2(n){const o=Fu(({mapLib:u})=>new u.NavigationControl(n),{position:n.position});return Rt.useEffect(()=>{Nl(o._container,n.style)},[n.style]),null}Rt.memo(O2);const N2={unit:"metric",maxWidth:100};function J0(n){const o=Fu(({mapLib:u})=>new u.ScaleControl(n),{position:n.position});return(o.options.unit!==n.unit||o.options.maxWidth!==n.maxWidth)&&(o.options.maxWidth=n.maxWidth,o.setUnit(n.unit)),Rt.useEffect(()=>{Nl(o._container,n.style)},[n.style]),null}J0.defaultProps=N2;Rt.memo(J0);var sm={},U2={get exports(){return sm},set exports(n){sm=n}};(function(n,o){(function(u,m){n.exports=m()})(su,function(){var u,m,_;function b(l,G){if(!u)u=G;else if(!m)m=G;else{var J="var sharedChunk = {}; ("+u+")(sharedChunk); ("+m+")(sharedChunk);",we={};u(we),_=G(we),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([J],{type:"text/javascript"})))}}b(["exports"],function(l){var G=J;function J(r,e,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=i,this.p2y=a}function we(r,e,i,a){const d=new G(r,e,i,a);return function(f){return d.solve(f)}}J.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var d=this.sampleCurveX(i)-r;if(Math.abs(d)<e)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=d/f}var y=0,w=1;for(i=r,a=0;a<20&&(d=this.sampleCurveX(i),!(Math.abs(d-r)<e));a++)r>d?y=i:w=i,i=.5*(w-y)+y;return i},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};const fe=we(.25,.1,.25,1);function H(r,e,i){return Math.min(i,Math.max(e,r))}function tt(r,e,i){const a=i-e,d=((r-e)%a+a)%a+e;return d===e?i:d}function Xe(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}let $e=1;function fn(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function pe(r,e,i){const a={};for(const d in r)a[d]=e.call(i||this,r[d],d,r);return a}function ie(r,e,i){const a={};for(const d in r)e.call(i||this,r[d],d,r)&&(a[d]=r[d]);return a}function he(r){return Array.isArray(r)?r.map(he):typeof r=="object"&&r?pe(r,he):r}const Ne={};function Ge(r){Ne[r]||(typeof console<"u"&&console.warn(r),Ne[r]=!0)}function lt(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function yt(r){let e=0;for(let i,a,d=0,f=r.length,y=f-1;d<f;y=d++)i=r[d],a=r[y],e+=(a.x-i.x)*(i.y+a.y);return e}function ft(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xn(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,d,f)=>{const y=d||f;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let kt,rn,Nn=null;function cr(r){if(Nn==null){const e=r.navigator?r.navigator.userAgent:null;Nn=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Nn}function zn(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const hr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const i=window.document.createElement("canvas"),a=i.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return i.width=r.width,i.height=r.height,a.drawImage(r,0,0,r.width,r.height),a.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(kt||(kt=document.createElement("a")),kt.href=r,kt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(rn==null&&(rn=matchMedia("(prefers-reduced-motion: reduce)")),rn.matches)}};var It=ei;function ei(r,e){this.x=r,this.y=e}ei.prototype={clone:function(){return new ei(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(r,e){var i=Math.cos(r),a=Math.sin(r),d=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ei.convert=function(r){return r instanceof ei?r:Array.isArray(r)?new ei(r[0],r[1]):r};const ut={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Pt="mapbox-tiles";let He,un,Tn=500,fi=50;function Ur(){typeof caches>"u"||He||(He=caches.open(Pt))}let Vr=1/0;const _r={supported:!1,testSupport:function(r){!jr&&ko&&(hs?Fs(r):ti=r)}};let ti,ko,jr=!1,hs=!1;function Fs(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ko),r.isContextLost())return;_r.supported=!0}catch{}r.deleteTexture(e),jr=!0}typeof document<"u"&&(ko=document.createElement("img"),ko.onload=function(){ti&&Fs(ti),ti=null,hs=!0},ko.onerror=function(){jr=!0,ti=null},ko.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Pr);class Ar extends Error{constructor(e,i,a,d){super(`AJAXError: ${i} (${e}): ${a}`),this.status=e,this.statusText=i,this.url=a,this.body=d}}const io=ft()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function vr(r,e){const i=new AbortController,a=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:io(),signal:i.signal});let d=!1,f=!1;return r.type==="json"&&a.headers.set("Accept","application/json"),((y,w,S)=>{if(f)return;const k=Date.now();fetch(a).then(A=>A.ok?((L,F,N)=>{(r.type==="arrayBuffer"?L.arrayBuffer():r.type==="json"?L.json():L.text()).then(U=>{f||(F&&N&&function(ee,K,de){if(Ur(),!He)return;const Se={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((xe,Le)=>Se.headers.set(Le,xe));const ue=xn(K.headers.get("Cache-Control")||"");ue["no-store"]||(ue["max-age"]&&Se.headers.set("Expires",new Date(de+1e3*ue["max-age"]).toUTCString()),new Date(Se.headers.get("Expires")).getTime()-de<42e4||function(xe,Le){if(un===void 0)try{new Response(new ReadableStream),un=!0}catch{un=!1}un?Le(xe.body):xe.blob().then(Le)}(K,xe=>{const Le=new Response(xe,Se);Ur(),He&&He.then(ze=>ze.put(function(ht){const gt=ht.indexOf("?");return gt<0?ht:ht.slice(0,gt)}(ee.url),Le)).catch(ze=>Ge(ze.message))}))}(a,F,N),d=!0,e(null,U,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(U=>{f||e(new Error(U.message))})})(A,null,k):A.blob().then(L=>e(new Ar(A.status,A.statusText,r.url,L)))).catch(A=>{A.code!==20&&e(new Error(A.message))})})(),{cancel:()=>{f=!0,d||i.abort()}}}const ni=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!ft()){const a=r.url.substring(0,r.url.indexOf("://"));return(ut.REGISTERED_PROTOCOLS[a]||vr)(r,e)}}if(!(/^file:/.test(i=r.url)||/^file:/.test(io())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return vr(r,e);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(a,d){const f=new XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const y in a.headers)f.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{d(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let y=f.response;if(a.type==="json")try{y=JSON.parse(f.response)}catch(w){return d(w)}d(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else{const y=new Blob([f.response],{type:f.getResponseHeader("Content-Type")});d(new Ar(f.status,f.statusText,a.url,y))}},f.send(a.body),{cancel:()=>f.abort()}}(r,e)},ds=function(r,e){return ni(Xe(r,{type:"arrayBuffer"}),e)};function ps(r){const e=window.document.createElement("a");return e.href=r,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wn,Io;Wn=[],Io=0;const mi=function(r,e){if(_r.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Io>=ut.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Wn.push(f),f}Io++;let i=!1;const a=()=>{if(!i)for(i=!0,Io--;Wn.length&&Io<ut.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Wn.shift(),{requestParameters:y,callback:w,cancelled:S}=f;S||(f.cancel=mi(y,w).cancel)}},d=ds(r,(f,y,w,S)=>{a(),f?e(f):y&&function(k,A){typeof createImageBitmap=="function"?function(L,F){const N=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(N).then(U=>{F(null,U)}).catch(U=>{F(new Error(`Could not load image because of ${U.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(k,A):function(L,F){const N=new Image;N.onload=()=>{F(null,N),URL.revokeObjectURL(N.src),N.onload=null,window.requestAnimationFrame(()=>{N.src=Jt})},N.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new Blob([new Uint8Array(L)],{type:"image/png"});N.src=L.byteLength?URL.createObjectURL(U):Jt}(k,A)}(y,(k,A)=>{k!=null?e(k):A!=null&&e(null,A,{cacheControl:w,expires:S})})});return{cancel:()=>{d.cancel(),a()}}};function fs(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Ii(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class Vi{constructor(e,i={}){Xe(this,i),this.type=e}}class Wo extends Vi{constructor(e,i={}){super("error",Xe({error:e},i))}}class ji{on(e,i){return this._listeners=this._listeners||{},fs(e,i,this._listeners),this}off(e,i){return Ii(e,i,this._listeners),Ii(e,i,this._oneTimeListeners),this}once(e,i){return this._oneTimeListeners=this._oneTimeListeners||{},fs(e,i,this._oneTimeListeners),this}fire(e,i){typeof e=="string"&&(e=new Vi(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const d=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const w of d)w.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const w of f)Ii(a,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(Xe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Wo&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class We{constructor(e,i,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),i!=null&&i.__line__&&(this.line=i.__line__)}}function $n(r){const e=r.value;return e?[new We(r.key,e,"constants have been deprecated as of v8")]:[]}function dr(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}function Nt(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ln(r){if(Array.isArray(r))return r.map(Ln);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Ln(r[i]);return e}return Nt(r)}class ri extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class xr{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,d]of i)this.bindings[a]=d}concat(e){return new xr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Gn={kind:"null"},Ae={kind:"number"},Ut={kind:"string"},Ft={kind:"boolean"},pr={kind:"color"},Mi={kind:"object"},Dt={kind:"value"},on={kind:"collator"},Qn={kind:"formatted"},ii={kind:"padding"},Xn={kind:"resolvedImage"};function zr(r,e){return{kind:"array",itemType:r,N:e}}function dn(r){if(r.kind==="array"){const e=dn(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Mo=[Gn,Ae,Ut,Ft,pr,Qn,Mi,zr(Dt),ii,Xn];function Lr(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Lr(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Mo)if(!Lr(i,e))return null}}return`Expected ${dn(r)} but found ${dn(e)} instead.`}function Po(r,e){return e.some(i=>i.kind===r.kind)}function oo(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}var so,ao={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function $(r){return(r=Math.round(r))<0?0:r>255?255:r}function M(r){return $(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function D(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function V(r,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?r+(e-r)*i*6:2*i<1?e:3*i<2?r+(e-r)*(2/3-i)*6:r}try{so={}.parseCSSColor=function(r){var e,i=r.replace(/ /g,"").toLowerCase();if(i in ao)return ao[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=i.indexOf("("),d=i.indexOf(")");if(a!==-1&&d+1===i.length){var f=i.substr(0,a),y=i.substr(a+1,d-(a+1)).split(","),w=1;switch(f){case"rgba":if(y.length!==4)return null;w=D(y.pop());case"rgb":return y.length!==3?null:[M(y[0]),M(y[1]),M(y[2]),w];case"hsla":if(y.length!==4)return null;w=D(y.pop());case"hsl":if(y.length!==3)return null;var S=(parseFloat(y[0])%360+360)%360/360,k=D(y[1]),A=D(y[2]),L=A<=.5?A*(k+1):A+k-A*k,F=2*A-L;return[$(255*V(F,L,S+1/3)),$(255*V(F,L,S)),$(255*V(F,L,S-1/3)),w];default:return null}}return null}}catch{}class j{constructor(e,i,a,d=1){this.r=e,this.g=i,this.b=a,this.a=d}static parse(e){if(!e)return;if(e instanceof j)return e;if(typeof e!="string")return;const i=so(e);return i?new j(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${d})`}toArray(){const{r:e,g:i,b:a,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*i/d,255*a/d,d]}}j.black=new j(0,0,0,1),j.white=new j(1,1,1,1),j.transparent=new j(0,0,0,0),j.red=new j(1,0,0,1);class Y{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oe{constructor(e,i,a,d,f){this.text=e,this.image=i,this.scale=a,this.fontStack=d,this.textColor=f}}class te{constructor(e){this.sections=e}static fromString(e){return new te([new oe(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof te?e:te.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Q{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Q)return e;if(typeof e=="number")return new Q([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Q(e)}}toString(){return JSON.stringify(this.values)}}class se{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new se({name:e,available:!1}):null}}function Te(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Re(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof j||r instanceof Y||r instanceof te||r instanceof Q||r instanceof se)return!0;if(Array.isArray(r)){for(const e of r)if(!Re(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Re(r[e]))return!1;return!0}return!1}function Ee(r){if(r===null)return Gn;if(typeof r=="string")return Ut;if(typeof r=="boolean")return Ft;if(typeof r=="number")return Ae;if(r instanceof j)return pr;if(r instanceof Y)return on;if(r instanceof te)return Qn;if(r instanceof Q)return ii;if(r instanceof se)return Xn;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const d=Ee(a);if(i){if(i===d)continue;i=Dt;break}i=d}return zr(i||Dt,e)}return Mi}function dt(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof j||r instanceof te||r instanceof Q||r instanceof se?r.toString():JSON.stringify(r)}class mt{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Re(e[1]))return i.error("invalid value");const a=e[1];let d=Ee(a);const f=i.expectedType;return d.kind!=="array"||d.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(d=f),new mt(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class je{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Tt={string:Ut,number:Ae,boolean:Ft,object:Mi};class At{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,d=1;const f=e[0];if(f==="array"){let w,S;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in Tt)||k==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Tt[k],d++}else w=Dt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],d++}a=zr(w,S)}else{if(!Tt[f])throw new Error(`Types doesn't contain name = ${f}`);a=Tt[f]}const y=[];for(;d<e.length;d++){const w=i.parse(e[d],d,Dt);if(!w)return null;y.push(w)}return new At(a,y)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Lr(this.type,Ee(a)))return a;if(i===this.args.length-1)throw new je(`Expected value to be of type ${dn(this.type)}, but found ${dn(Ee(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Wt={"to-boolean":Ft,"to-color":pr,"to-number":Ae,"to-string":Ut};class Lt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0];if(!Wt[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");const d=Wt[a],f=[];for(let y=1;y<e.length;y++){const w=i.parse(e[y],y,Dt);if(!w)return null;f.push(w)}return new Lt(d,f)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,a;for(const d of this.args){if(i=d.evaluate(e),a=null,i instanceof j)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Te(i[0],i[1],i[2],i[3]),!a))return new j(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new je(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}if(this.type.kind==="padding"){let i;for(const a of this.args){i=a.evaluate(e);const d=Q.parse(i);if(d)return d}throw new je(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const d=Number(i);if(!isNaN(d))return d}throw new je(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?te.fromString(dt(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?se.fromString(dt(this.args[0].evaluate(e))):dt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Vt=["Unknown","Point","LineString","Polygon"];class Kt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=j.parse(e)),i}}class Bt{constructor(e,i,a,d){this.name=e,this.type=i,this._evaluate=a,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const a=e[0],d=Bt.definitions[a];if(!d)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=y.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let S=null;for(const[k,A]of w){S=new ae(i.registry,i.path,null,i.scope);const L=[];let F=!1;for(let N=1;N<e.length;N++){const U=e[N],ee=Array.isArray(k)?k[N-1]:k.type,K=S.parse(U,1+L.length,ee);if(!K){F=!0;break}L.push(K)}if(!F)if(Array.isArray(k)&&k.length!==L.length)S.error(`Expected ${k.length} arguments, but found ${L.length} instead.`);else{for(let N=0;N<L.length;N++){const U=Array.isArray(k)?k[N]:k.type,ee=L[N];S.concat(N+1).checkSubtype(U,ee.type)}if(S.errors.length===0)return new Bt(a,f,A,L)}}if(w.length===1)i.errors.push(...S.errors);else{const k=(w.length?w:y).map(([L])=>{return F=L,Array.isArray(F)?`(${F.map(dn).join(", ")})`:`(${dn(F.type)}...)`;var F}).join(" | "),A=[];for(let L=1;L<e.length;L++){const F=i.parse(e[L],1+A.length);if(!F)return null;A.push(dn(F.type))}i.error(`Expected arguments of type ${k}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Bt.definitions=i;for(const a in i)e[a]=Bt}}class er{constructor(e,i,a){this.type=on,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const d=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ft);if(!d)return null;const f=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ft);if(!f)return null;let y=null;return a.locale&&(y=i.parse(a.locale,1,Ut),!y)?null:new er(d,f,y)}evaluate(e){return new Y(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Cn=8192;function Dn(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Dr(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Xo(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(i*d*Cn),Math.round(a*d*Cn)]}function en(r,e,i){const a=r[0]-e[0],d=r[1]-e[1],f=r[0]-i[0],y=r[1]-i[1];return a*y-f*d==0&&a*f<=0&&d*y<=0}function lo(r,e){let i=!1;for(let y=0,w=e.length;y<w;y++){const S=e[y];for(let k=0,A=S.length;k<A-1;k++){if(en(r,S[k],S[k+1]))return!1;(d=S[k])[1]>(a=r)[1]!=(f=S[k+1])[1]>a[1]&&a[0]<(f[0]-d[0])*(a[1]-d[1])/(f[1]-d[1])+d[0]&&(i=!i)}}var a,d,f;return i}function da(r,e){for(let i=0;i<e.length;i++)if(lo(r,e[i]))return!0;return!1}function Ul(r,e,i,a){const d=a[0]-i[0],f=a[1]-i[1],y=(r[0]-i[0])*f-d*(r[1]-i[1]),w=(e[0]-i[0])*f-d*(e[1]-i[1]);return y>0&&w<0||y<0&&w>0}function Vl(r,e,i){for(const k of i)for(let A=0;A<k.length-1;++A)if((w=[(y=k[A+1])[0]-(f=k[A])[0],y[1]-f[1]])[0]*(S=[(d=e)[0]-(a=r)[0],d[1]-a[1]])[1]-w[1]*S[0]!=0&&Ul(a,d,f,y)&&Ul(f,y,a,d))return!0;var a,d,f,y,w,S;return!1}function Qa(r,e){for(let i=0;i<r.length;++i)if(!lo(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Vl(r[i],r[i+1],e))return!1;return!0}function jl(r,e){for(let i=0;i<e.length;i++)if(Qa(r,e[i]))return!0;return!1}function pa(r,e,i){const a=[];for(let d=0;d<r.length;d++){const f=[];for(let y=0;y<r[d].length;y++){const w=Xo(r[d][y],i);Dn(e,w),f.push(w)}a.push(f)}return a}function el(r,e,i){const a=[];for(let d=0;d<r.length;d++){const f=pa(r[d],e,i);a.push(f)}return a}function $l(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const d=.5*a;let f=r[0]-i[0]>d?-a:i[0]-r[0]>d?a:0;f===0&&(f=r[0]-i[2]>d?-a:i[2]-r[0]>d?a:0),r[0]+=f}Dn(e,r)}function Gl(r,e,i,a){const d=Math.pow(2,a.z)*Cn,f=[a.x*Cn,a.y*Cn],y=[];for(const w of r)for(const S of w){const k=[S.x+f[0],S.y+f[1]];$l(k,e,i,d),y.push(k)}return y}function tl(r,e,i,a){const d=Math.pow(2,a.z)*Cn,f=[a.x*Cn,a.y*Cn],y=[];for(const S of r){const k=[];for(const A of S){const L=[A.x+f[0],A.y+f[1]];Dn(e,L),k.push(L)}y.push(k)}if(e[2]-e[0]<=d/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of y)for(const k of S)$l(k,e,i,d)}var w;return y}class v{constructor(e,i){this.type=Ft,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Re(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let d=0;d<a.features.length;++d){const f=a.features[d].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new v(a,a.features[d].geometry)}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new v(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new v(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const d=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const w=pa(a.coordinates,f,y),S=Gl(i.geometry(),d,f,y);if(!Dr(d,f))return!1;for(const k of S)if(!lo(k,w))return!1}if(a.type==="MultiPolygon"){const w=el(a.coordinates,f,y),S=Gl(i.geometry(),d,f,y);if(!Dr(d,f))return!1;for(const k of S)if(!da(k,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const d=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const w=pa(a.coordinates,f,y),S=tl(i.geometry(),d,f,y);if(!Dr(d,f))return!1;for(const k of S)if(!Qa(k,w))return!1}if(a.type==="MultiPolygon"){const w=el(a.coordinates,f,y),S=tl(i.geometry(),d,f,y);if(!Dr(d,f))return!1;for(const k of S)if(!jl(k,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function C(r){if(r instanceof Bt&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof v)return!1;let e=!0;return r.eachChild(i=>{e&&!C(i)&&(e=!1)}),e}function B(r){if(r instanceof Bt&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!B(i)&&(e=!1)}),e}function ne(r,e){if(r instanceof Bt&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(a=>{i&&!ne(a,e)&&(i=!1)}),i}class ye{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new ye(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ae{constructor(e,i=[],a,d=new xr,f=[]){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=f,this.expectedType=a}parse(e,i,a,d,f={}){return i?this.concat(i,a,d)._parse(e,f):this._parse(e,f)}_parse(e,i){function a(d,f,y){return y==="assert"?new At(f,[d]):y==="coerce"?new Lt(f,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[d];if(f){let y=f.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,S=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||S.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(w.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array"){if(this.checkSubtype(w,S))return null}else y=a(y,w,i.typeAnnotation||"coerce");else y=a(y,w,i.typeAnnotation||"coerce");else y=a(y,w,i.typeAnnotation||"assert")}if(!(y instanceof mt)&&y.type.kind!=="resolvedImage"&&me(y)){const w=new Kt;try{y=new mt(y.type,y.evaluate(w))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const d=typeof e=="number"?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new ae(this.registry,d,i||null,f,this.errors)}error(e,...i){const a=`${this.key}${i.map(d=>`[${d}]`).join("")}`;this.errors.push(new ri(a,e))}checkSubtype(e,i){const a=Lr(e,i);return a&&this.error(a),a}}function me(r){if(r instanceof ye)return me(r.boundExpression);if(r instanceof Bt&&r.name==="error"||r instanceof er||r instanceof v)return!1;const e=r instanceof Lt||r instanceof At;let i=!0;return r.eachChild(a=>{i=e?i&&me(a):i&&a instanceof mt}),!!i&&C(r)&&ne(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Oe(r,e){const i=r.length-1;let a,d,f=0,y=i,w=0;for(;f<=y;)if(w=Math.floor((f+y)/2),a=r[w],d=r[w+1],a<=e){if(w===i||e<d)return w;f=w+1}else{if(!(a>e))throw new je("Input is not a number.");y=w-1}return 0}class Fe{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[d,f]of a)this.labels.push(d),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Ae);if(!a)return null;const d=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],S=e[y+1],k=y,A=y+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(d.length&&d[d.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const L=i.parse(S,A,f);if(!L)return null;f=f||L.type,d.push([w,L])}return new Fe(f,a,d)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return a[0].evaluate(e);const f=i.length;return d>=i[f-1]?a[f-1].evaluate(e):a[Oe(i,d)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ue(r,e,i){return r*(1-i)+e*i}var ve=Object.freeze({__proto__:null,number:Ue,color:function(r,e,i){return new j(Ue(r.r,e.r,i),Ue(r.g,e.g,i),Ue(r.b,e.b,i),Ue(r.a,e.a,i))},array:function(r,e,i){return r.map((a,d)=>Ue(a,e[d],i))},padding:function(r,e,i){const a=r.values,d=e.values;return new Q([Ue(a[0],d[0],i),Ue(a[1],d[1],i),Ue(a[2],d[2],i),Ue(a[3],d[3],i)])}});const Ke=.95047,at=1.08883,wt=4/29,zt=6/29,Un=3*zt*zt,De=Math.PI/180,pt=180/Math.PI;function cn(r){return r>.008856451679035631?Math.pow(r,1/3):r/Un+wt}function an(r){return r>zt?r*r*r:Un*(r-wt)}function kn(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function bt(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Gt(r){const e=bt(r.r),i=bt(r.g),a=bt(r.b),d=cn((.4124564*e+.3575761*i+.1804375*a)/Ke),f=cn((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*f-16,a:500*(d-f),b:200*(f-cn((.0193339*e+.119192*i+.9503041*a)/at)),alpha:r.a}}function uo(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*an(e),i=Ke*an(i),a=at*an(a),new j(kn(3.2404542*i-1.5371385*e-.4985314*a),kn(-.969266*i+1.8760108*e+.041556*a),kn(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function sn(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Rr={forward:Gt,reverse:uo,interpolate:function(r,e,i){return{l:Ue(r.l,e.l,i),a:Ue(r.a,e.a,i),b:Ue(r.b,e.b,i),alpha:Ue(r.alpha,e.alpha,i)}}},or={forward:function(r){const{l:e,a:i,b:a}=Gt(r),d=Math.atan2(a,i)*pt;return{h:d<0?d+360:d,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*De,i=r.c;return uo({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:sn(r.h,e.h,i),c:Ue(r.c,e.c,i),l:Ue(r.l,e.l,i),alpha:Ue(r.alpha,e.alpha,i)}}};var fa=Object.freeze({__proto__:null,lab:Rr,hcl:or});class $r{constructor(e,i,a,d,f){this.type=e,this.operator=i,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(const[y,w]of f)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,i,a,d){let f=0;if(e.name==="exponential")f=gi(i,e.base,a,d);else if(e.name==="linear")f=gi(i,1,a,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;f=new G(y[0],y[1],y[2],y[3]).solve(gi(i,1,a,d))}return f}static parse(e,i){let[a,d,f,...y]=e;if(!Array.isArray(d)||d.length===0)return i.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const k=d[1];if(typeof k!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:k}}else{if(d[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const k=d.slice(1);if(k.length!==4||k.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Ae),!f)return null;const w=[];let S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=pr:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType);for(let k=0;k<y.length;k+=2){const A=y[k],L=y[k+1],F=k+3,N=k+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const U=i.parse(L,N,S);if(!U)return null;S=S||U.type,w.push([A,U])}return S.kind==="number"||S.kind==="color"||S.kind==="padding"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new $r(S,a,d,f,w):i.error(`Type ${dn(S)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return a[0].evaluate(e);const f=i.length;if(d>=i[f-1])return a[f-1].evaluate(e);const y=Oe(i,d),w=$r.interpolationFactor(this.interpolation,d,i[y],i[y+1]),S=a[y].evaluate(e),k=a[y+1].evaluate(e);return this.operator==="interpolate"?ve[this.type.kind.toLowerCase()](S,k,w):this.operator==="interpolate-hcl"?or.reverse(or.interpolate(or.forward(S),or.forward(k),w)):Rr.reverse(Rr.interpolate(Rr.forward(S),Rr.forward(k),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function gi(r,e,i,a){const d=a-i,f=r-i;return d===0?0:e===1?f/d:(Math.pow(e,f)-1)/(Math.pow(e,d)-1)}class Bs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const d=i.expectedType;d&&d.kind!=="value"&&(a=d);const f=[];for(const w of e.slice(1)){const S=i.parse(w,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,f.push(S)}if(!a)throw new Error("No output type");const y=d&&f.some(w=>Lr(d,w.type));return new Bs(y?Dt:a,f)}evaluate(e){let i,a=null,d=0;for(const f of this.args)if(d++,a=f.evaluate(e),a&&a instanceof se&&!a.available&&(i||(i=a.name),a=null,d===this.args.length&&(a=i)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Os{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const y=e[f];if(typeof y!="string")return i.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const w=i.parse(e[f+1],f+1);if(!w)return null;a.push([y,w])}const d=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return d?new Os(a,d):null}outputDefined(){return this.result.outputDefined()}}class nl{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ae),d=i.parse(e[2],2,zr(i.expectedType||Dt));return a&&d?new nl(d.type.itemType,a,d):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new je(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new je(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new je(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ma{constructor(e,i){this.type=Ft,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Dt),d=i.parse(e[2],2,Dt);return a&&d?Po(a.type,[Ft,Ut,Ae,Gn,Dt])?new ma(a,d):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${dn(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!oo(i,["boolean","string","number","null"]))throw new je(`Expected first argument to be of type boolean, string, number or null, but found ${dn(Ee(i))} instead.`);if(!oo(a,["string","array"]))throw new je(`Expected second argument to be of type array or string, but found ${dn(Ee(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ho{constructor(e,i,a){this.type=Ae,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Dt),d=i.parse(e[2],2,Dt);if(!a||!d)return null;if(!Po(a.type,[Ft,Ut,Ae,Gn,Dt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${dn(a.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Ae);return f?new Ho(a,d,f):null}return new Ho(a,d)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!oo(i,["boolean","string","number","null"]))throw new je(`Expected first argument to be of type boolean, string, number or null, but found ${dn(Ee(i))} instead.`);if(!oo(a,["string","array"]))throw new je(`Expected second argument to be of type array or string, but found ${dn(Ee(a))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return a.indexOf(i,d)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ga{constructor(e,i,a,d,f,y){this.inputType=e,this.type=i,this.input=a,this.cases=d,this.outputs=f,this.otherwise=y}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,d;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);const f={},y=[];for(let k=2;k<e.length-1;k+=2){let A=e[k];const L=e[k+1];Array.isArray(A)||(A=[A]);const F=i.concat(k);if(A.length===0)return F.error("Expected at least one branch label.");for(const U of A){if(typeof U!="number"&&typeof U!="string")return F.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,Ee(U)))return null}else a=Ee(U);if(f[String(U)]!==void 0)return F.error("Branch labels must be unique.");f[String(U)]=y.length}const N=i.parse(L,k,d);if(!N)return null;d=d||N.type,y.push(N)}const w=i.parse(e[1],1,Dt);if(!w)return null;const S=i.parse(e[e.length-1],e.length-1,d);return S?w.type.kind!=="value"&&i.concat(1).checkSubtype(a,w.type)?null:new ga(a,d,w,f,y,S):null}evaluate(e){const i=this.input.evaluate(e);return(Ee(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class ya{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const w=i.parse(e[y],y,Ft);if(!w)return null;const S=i.parse(e[y+1],y+1,a);if(!S)return null;d.push([w,S]),a=a||S.type}const f=i.parse(e[e.length-1],e.length-1,a);if(!f)return null;if(!a)throw new Error("Can't infer output type");return new ya(a,d,f)}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class _a{constructor(e,i,a,d){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=d}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Dt),d=i.parse(e[2],2,Ae);if(!a||!d)return null;if(!Po(a.type,[zr(Dt),Ut,Dt]))return i.error(`Expected first argument to be of type array or string, but found ${dn(a.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Ae);return f?new _a(a.type,a,d,f):null}return new _a(a.type,a,d)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!oo(i,["string","array"]))throw new je(`Expected first argument to be of type array or string, but found ${dn(Ee(i))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return i.slice(a,d)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Ao(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function rl(r,e,i,a){return a.compare(e,i)===0}function ms(r,e,i){const a=r!=="=="&&r!=="!=";return class Y0{constructor(f,y,w){this.type=Ft,this.lhs=f,this.rhs=y,this.collator=w,this.hasUntypedArgument=f.type.kind==="value"||y.type.kind==="value"}static parse(f,y){if(f.length!==3&&f.length!==4)return y.error("Expected two or three arguments.");const w=f[0];let S=y.parse(f[1],1,Dt);if(!S)return null;if(!Ao(w,S.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${dn(S.type)}'.`);let k=y.parse(f[2],2,Dt);if(!k)return null;if(!Ao(w,k.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${dn(k.type)}'.`);if(S.type.kind!==k.type.kind&&S.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${dn(S.type)}' and '${dn(k.type)}'.`);a&&(S.type.kind==="value"&&k.type.kind!=="value"?S=new At(k.type,[S]):S.type.kind!=="value"&&k.type.kind==="value"&&(k=new At(S.type,[k])));let A=null;if(f.length===4){if(S.type.kind!=="string"&&k.type.kind!=="string"&&S.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(A=y.parse(f[3],3,on),!A)return null}return new Y0(S,k,A)}evaluate(f){const y=this.lhs.evaluate(f),w=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const S=Ee(y),k=Ee(w);if(S.kind!==k.kind||S.kind!=="string"&&S.kind!=="number")throw new je(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${k.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=Ee(y),k=Ee(w);if(S.kind!=="string"||k.kind!=="string")return e(f,y,w)}return this.collator?i(f,y,w,this.collator.evaluate(f)):e(f,y,w)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Bu=ms("==",function(r,e,i){return e===i},rl),il=ms("!=",function(r,e,i){return e!==i},function(r,e,i,a){return!rl(0,e,i,a)}),Ns=ms("<",function(r,e,i){return e<i},function(r,e,i,a){return a.compare(e,i)<0}),ol=ms(">",function(r,e,i){return e>i},function(r,e,i,a){return a.compare(e,i)>0}),sl=ms("<=",function(r,e,i){return e<=i},function(r,e,i,a){return a.compare(e,i)<=0}),al=ms(">=",function(r,e,i){return e>=i},function(r,e,i,a){return a.compare(e,i)>=0});class Ko{constructor(e,i,a,d,f){this.type=Ut,this.number=e,this.locale=i,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Ae);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return i.error("NumberFormat options argument must be an object.");let f=null;if(d.locale&&(f=i.parse(d.locale,1,Ut),!f))return null;let y=null;if(d.currency&&(y=i.parse(d.currency,1,Ut),!y))return null;let w=null;if(d["min-fraction-digits"]&&(w=i.parse(d["min-fraction-digits"],1,Ae),!w))return null;let S=null;return d["max-fraction-digits"]&&(S=i.parse(d["max-fraction-digits"],1,Ae),!S)?null:new Ko(a,f,y,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class va{constructor(e){this.type=Qn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const d=[];let f=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(f&&typeof w=="object"&&!Array.isArray(w)){f=!1;let S=null;if(w["font-scale"]&&(S=i.parse(w["font-scale"],1,Ae),!S))return null;let k=null;if(w["text-font"]&&(k=i.parse(w["text-font"],1,zr(Ut)),!k))return null;let A=null;if(w["text-color"]&&(A=i.parse(w["text-color"],1,pr),!A))return null;const L=d[d.length-1];L.scale=S,L.font=k,L.textColor=A}else{const S=i.parse(e[y],1,Dt);if(!S)return null;const k=S.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new va(d)}evaluate(e){return new te(this.sections.map(i=>{const a=i.content.evaluate(e);return Ee(a)===Xn?new oe("",a,null,null,null):new oe(dt(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}}class ll{constructor(e){this.type=Xn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Ut);return a?new ll(a):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),a=se.fromString(i);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(i)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class ul{constructor(e){this.type=Ae,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${dn(a.type)} instead.`):new ul(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new je(`Expected value to be of type string or array, but found ${dn(Ee(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const gs={"==":Bu,"!=":il,">":ol,"<":Ns,">=":al,"<=":sl,array:At,at:nl,boolean:At,case:ya,coalesce:Bs,collator:er,format:va,image:ll,in:ma,"index-of":Ho,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:ul,let:Os,literal:mt,match:ga,number:At,"number-format":Ko,object:At,slice:_a,step:Fe,string:At,"to-boolean":Lt,"to-color":Lt,"to-number":Lt,"to-string":Lt,var:ye,within:v};function Zl(r,[e,i,a,d]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const f=d?d.evaluate(r):1,y=Te(e,i,a,f);if(y)throw new je(y);return new j(e/255*f,i/255*f,a/255*f,f)}function cl(r,e){return r in e}function ys(r,e){const i=e[r];return i===void 0?null:i}function oi(r){return{type:r}}function $i(r){return{result:"success",value:r}}function yi(r){return{result:"error",value:r}}function mn(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function co(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Zt(r){return!!r.expression&&r.expression.interpolated}function Yt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function hn(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function En(r){return r}function _s(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",d=a||!(a||r.property!==void 0),f=r.type||(Zt(e)?"exponential":"interval");if(i||e.type==="padding"){const k=i?j.parse:Q.parse;(r=dr({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],k(A[1])])),r.default=k(r.default?r.default:e.default)}if(r.colorSpace&&r.colorSpace!=="rgb"&&!fa[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let y,w,S;if(f==="exponential")y=hl;else if(f==="interval")y=ql;else if(f==="categorical"){y=Ou,w=Object.create(null);for(const k of r.stops)w[k[0]]=k[1];S=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=xa}if(a){const k={},A=[];for(let N=0;N<r.stops.length;N++){const U=r.stops[N],ee=U[0].zoom;k[ee]===void 0&&(k[ee]={zoom:ee,type:r.type,property:r.property,default:r.default,stops:[]},A.push(ee)),k[ee].stops.push([U[0].value,U[1]])}const L=[];for(const N of A)L.push([k[N].zoom,_s(k[N],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:$r.interpolationFactor.bind(void 0,F),zoomStops:L.map(N=>N[0]),evaluate:({zoom:N},U)=>hl({stops:L,base:r.base},e,N).evaluate(N,U)}}if(d){const k=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:$r.interpolationFactor.bind(void 0,k),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>y(r,e,A,w,S)}}return{kind:"source",evaluate(k,A){const L=A&&A.properties?A.properties[r.property]:void 0;return L===void 0?vs(r.default,e.default):y(r,e,L,w,S)}}}function vs(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Ou(r,e,i,a,d){return vs(typeof i===d?a[i]:void 0,r.default,e.default)}function ql(r,e,i){if(Yt(i)!=="number")return vs(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const d=Oe(r.stops.map(f=>f[0]),i);return r.stops[d][1]}function hl(r,e,i){const a=r.base!==void 0?r.base:1;if(Yt(i)!=="number")return vs(r.default,e.default);const d=r.stops.length;if(d===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[d-1][0])return r.stops[d-1][1];const f=Oe(r.stops.map(A=>A[0]),i),y=function(A,L,F,N){const U=N-F,ee=A-F;return U===0?0:L===1?ee/U:(Math.pow(L,ee)-1)/(Math.pow(L,U)-1)}(i,a,r.stops[f][0],r.stops[f+1][0]),w=r.stops[f][1],S=r.stops[f+1][1];let k=ve[e.type]||En;if(r.colorSpace&&r.colorSpace!=="rgb"){const A=fa[r.colorSpace];k=(L,F)=>A.reverse(A.interpolate(A.forward(L),A.forward(F),y))}return typeof w.evaluate=="function"?{evaluate(...A){const L=w.evaluate.apply(void 0,A),F=S.evaluate.apply(void 0,A);if(L!==void 0&&F!==void 0)return k(L,F,y)}}:k(w,S,y)}function xa(r,e,i){switch(e.type){case"color":i=j.parse(i);break;case"formatted":i=te.fromString(i.toString());break;case"resolvedImage":i=se.fromString(i.toString());break;case"padding":i=Q.parse(i);break;default:Yt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return vs(i,r.default,e.default)}Bt.register(gs,{error:[{kind:"error"},[Ut],(r,[e])=>{throw new je(e.evaluate(r))}],typeof:[Ut,[Dt],(r,[e])=>dn(Ee(e.evaluate(r)))],"to-rgba":[zr(Ae,4),[pr],(r,[e])=>e.evaluate(r).toArray()],rgb:[pr,[Ae,Ae,Ae],Zl],rgba:[pr,[Ae,Ae,Ae,Ae],Zl],has:{type:Ft,overloads:[[[Ut],(r,[e])=>cl(e.evaluate(r),r.properties())],[[Ut,Mi],(r,[e,i])=>cl(e.evaluate(r),i.evaluate(r))]]},get:{type:Dt,overloads:[[[Ut],(r,[e])=>ys(e.evaluate(r),r.properties())],[[Ut,Mi],(r,[e,i])=>ys(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Dt,[Ut],(r,[e])=>ys(e.evaluate(r),r.featureState||{})],properties:[Mi,[],r=>r.properties()],"geometry-type":[Ut,[],r=>r.geometryType()],id:[Dt,[],r=>r.id()],zoom:[Ae,[],r=>r.globals.zoom],"heatmap-density":[Ae,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ae,[],r=>r.globals.lineProgress||0],accumulated:[Dt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ae,oi(Ae),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[Ae,oi(Ae),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:Ae,overloads:[[[Ae,Ae],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Ae],(r,[e])=>-e.evaluate(r)]]},"/":[Ae,[Ae,Ae],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Ae,[Ae,Ae],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Ae,[],()=>Math.LN2],pi:[Ae,[],()=>Math.PI],e:[Ae,[],()=>Math.E],"^":[Ae,[Ae,Ae],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Ae,[Ae],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ae,[Ae],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ae,[Ae],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ae,[Ae],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Ae,[Ae],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ae,[Ae],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ae,[Ae],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ae,[Ae],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ae,[Ae],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ae,[Ae],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ae,oi(Ae),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Ae,oi(Ae),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Ae,[Ae],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ae,[Ae],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ae,[Ae],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ae,[Ae],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Ft,[Ut,Dt],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Ft,[Dt],(r,[e])=>r.id()===e.value],"filter-type-==":[Ft,[Ut],(r,[e])=>r.geometryType()===e.value],"filter-<":[Ft,[Ut,Dt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a<d}],"filter-id-<":[Ft,[Dt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Ft,[Ut,Dt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a>d}],"filter-id->":[Ft,[Dt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Ft,[Ut,Dt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[Ft,[Dt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Ft,[Ut,Dt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[Ft,[Dt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Ft,[Dt],(r,[e])=>e.value in r.properties()],"filter-has-id":[Ft,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ft,[zr(Ut)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ft,[zr(Dt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Ft,[Ut,zr(Dt)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Ft,[Ut,zr(Dt)],(r,[e,i])=>function(a,d,f,y){for(;f<=y;){const w=f+y>>1;if(d[w]===a)return!0;d[w]>a?y=w-1:f=w+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[oi(Ft),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[oi(Ft),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Ft,[Ft],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Ft,[Ut],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Ut,[Ut],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Ut,[Ut],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Ut,oi(Dt),(r,e)=>e.map(i=>dt(i.evaluate(r))).join("")],"resolved-locale":[Ut,[on],(r,[e])=>e.evaluate(r).resolvedLocale()]});class ho{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Kt,this._defaultValue=i?function(a){return a.type==="color"&&hn(a.default)?new j(0,0,0,0):a.type==="color"?j.parse(a.default)||null:a.type==="padding"?Q.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,a,d,f,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,d,f,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new je(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Us(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in gs}function _i(r,e){const i=new ae(gs,[],e?function(d){const f={color:pr,string:Ut,number:Ae,enum:Ut,boolean:Ft,formatted:Qn,padding:ii,resolvedImage:Xn};return d.type==="array"?zr(f[d.value]||Dt,d.length):f[d.type]}(e):void 0),a=i.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?$i(new ho(a,e)):yi(i.errors)}class Vs{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!B(i.expression)}evaluateWithoutErrorHandling(e,i,a,d,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,d,f,y)}evaluate(e,i,a,d,f,y){return this._styleExpression.evaluate(e,i,a,d,f,y)}}class po{constructor(e,i,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!B(i.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,i,a,d,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,d,f,y)}evaluate(e,i,a,d,f,y){return this._styleExpression.evaluate(e,i,a,d,f,y)}interpolationFactor(e,i,a){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,i,a):0}}function dl(r,e){const i=_i(r,e);if(i.result==="error")return i;const a=i.value.expression,d=C(a);if(!d&&!mn(e))return yi([new ri("","data expressions not supported")]);const f=ne(a,["zoom"]);if(!f&&!co(e))return yi([new ri("","zoom expressions not supported")]);const y=Jo(a);return y||f?y instanceof ri?yi([y]):y instanceof $r&&!Zt(e)?yi([new ri("",'"interpolate" expressions cannot be used with this property')]):$i(y?new po(d?"camera":"composite",i.value,y.labels,y instanceof $r?y.interpolation:void 0):new Vs(d?"constant":"source",i.value)):yi([new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wa{constructor(e,i){this._parameters=e,this._specification=i,dr(this,_s(this._parameters,this._specification))}static deserialize(e){return new wa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Jo(r){let e=null;if(r instanceof Os)e=Jo(r.result);else if(r instanceof Bs){for(const i of r.args)if(e=Jo(i),e)break}else(r instanceof Fe||r instanceof $r)&&r.input instanceof Bt&&r.input.name==="zoom"&&(e=r);return e instanceof ri||r.eachChild(i=>{const a=Jo(i);a instanceof ri?e=a:!e&&a?e=new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function si(r){const e=r.key,i=r.value,a=r.valueSpec||{},d=r.objectElementValidators||{},f=r.style,y=r.styleSpec;let w=[];const S=Yt(i);if(S!=="object")return[new We(e,i,`object expected, ${S} found`)];for(const k in i){const A=k.split(".")[0],L=a[A]||a["*"];let F;if(d[A])F=d[A];else if(a[A])F=ai;else if(d["*"])F=d["*"];else{if(!a["*"]){w.push(new We(e,i[k],`unknown property "${k}"`));continue}F=ai}w=w.concat(F({key:(e&&`${e}.`)+k,value:i[k],valueSpec:L,style:f,styleSpec:y,object:i,objectKey:k},i))}for(const k in a)d[k]||a[k].required&&a[k].default===void 0&&i[k]===void 0&&w.push(new We(e,i,`missing required property "${k}"`));return w}function pl(r){const e=r.value,i=r.valueSpec,a=r.style,d=r.styleSpec,f=r.key,y=r.arrayElementValidator||ai;if(Yt(e)!=="array")return[new We(f,e,`array expected, ${Yt(e)} found`)];if(i.length&&e.length!==i.length)return[new We(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new We(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let w={type:i.value,values:i.values};d.$version<7&&(w.function=i.function),Yt(i.value)==="object"&&(w=i.value);let S=[];for(let k=0;k<e.length;k++)S=S.concat(y({array:e,arrayIndex:k,value:e[k],valueSpec:w,style:a,styleSpec:d,key:`${f}[${k}]`}));return S}function ba(r){const e=r.key,i=r.value,a=r.valueSpec;let d=Yt(i);return d==="number"&&i!=i&&(d="NaN"),d!=="number"?[new We(e,i,`number expected, ${d} found`)]:"minimum"in a&&i<a.minimum?[new We(e,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new We(e,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function fl(r){const e=r.valueSpec,i=Nt(r.value.type);let a,d,f,y={};const w=i!=="categorical"&&r.value.property===void 0,S=!w,k=Yt(r.value.stops)==="array"&&Yt(r.value.stops[0])==="array"&&Yt(r.value.stops[0][0])==="object",A=si({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(N){if(i==="identity")return[new We(N.key,N.value,'identity function may not have a "stops" property')];let U=[];const ee=N.value;return U=U.concat(pl({key:N.key,value:ee,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:L})),Yt(ee)==="array"&&ee.length===0&&U.push(new We(N.key,ee,"array must have at least one stop")),U},default:function(N){return ai({key:N.key,value:N.value,valueSpec:e,style:N.style,styleSpec:N.styleSpec})}}});return i==="identity"&&w&&A.push(new We(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||A.push(new We(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!Zt(r.valueSpec)&&A.push(new We(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!mn(r.valueSpec)?A.push(new We(r.key,r.value,"property functions not supported")):w&&!co(r.valueSpec)&&A.push(new We(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!k||r.value.property!==void 0||A.push(new We(r.key,r.value,'"property" property is required')),A;function L(N){let U=[];const ee=N.value,K=N.key;if(Yt(ee)!=="array")return[new We(K,ee,`array expected, ${Yt(ee)} found`)];if(ee.length!==2)return[new We(K,ee,`array length 2 expected, length ${ee.length} found`)];if(k){if(Yt(ee[0])!=="object")return[new We(K,ee,`object expected, ${Yt(ee[0])} found`)];if(ee[0].zoom===void 0)return[new We(K,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new We(K,ee,"object stop key must have value")];if(f&&f>Nt(ee[0].zoom))return[new We(K,ee[0].zoom,"stop zoom values must appear in ascending order")];Nt(ee[0].zoom)!==f&&(f=Nt(ee[0].zoom),d=void 0,y={}),U=U.concat(si({key:`${K}[0]`,value:ee[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:ba,value:F}}))}else U=U.concat(F({key:`${K}[0]`,value:ee[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},ee));return Us(Ln(ee[1]))?U.concat([new We(`${K}[1]`,ee[1],"expressions are not allowed in function stops.")]):U.concat(ai({key:`${K}[1]`,value:ee[1],valueSpec:e,style:N.style,styleSpec:N.styleSpec}))}function F(N,U){const ee=Yt(N.value),K=Nt(N.value),de=N.value!==null?N.value:U;if(a){if(ee!==a)return[new We(N.key,de,`${ee} stop domain type must match previous stop domain type ${a}`)]}else a=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new We(N.key,de,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&i!=="categorical"){let Se=`number expected, ${ee} found`;return mn(e)&&i===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(N.key,de,Se)]}return i!=="categorical"||ee!=="number"||isFinite(K)&&Math.floor(K)===K?i!=="categorical"&&ee==="number"&&d!==void 0&&K<d?[new We(N.key,de,"stop domain values must appear in ascending order")]:(d=K,i==="categorical"&&K in y?[new We(N.key,de,"stop domain values must be unique")]:(y[K]=!0,[])):[new We(N.key,de,`integer expected, found ${K}`)]}}function Pi(r){const e=(r.expressionContext==="property"?dl:_i)(Ln(r.value),r.valueSpec);if(e.result==="error")return e.value.map(a=>new We(`${r.key}${a.key}`,r.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new We(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!B(i))return[new We(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!B(i))return[new We(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ne(i,["zoom","feature-state"]))return[new We(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!C(i))return[new We(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xs(r){const e=r.key,i=r.value,a=r.valueSpec,d=[];return Array.isArray(a.values)?a.values.indexOf(Nt(i))===-1&&d.push(new We(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Nt(i))===-1&&d.push(new We(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),d}function ws(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ws(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ce={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ke(r){if(r==null)return{filter:()=>!0,needGeometry:!1};ws(r)||(r=gn(r));const e=_i(r,ce);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,d)=>e.value.evaluate(i,a,{},d),needGeometry:Ct(r)}}function et(r,e){return r<e?-1:r>e?1:0}function Ct(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Ct(r[e]))return!0;return!1}function gn(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Xt(r[1],r[2],"=="):e==="!="?wr(Xt(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xt(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(gn))):e==="all"?["all"].concat(r.slice(1).map(gn)):e==="none"?["all"].concat(r.slice(1).map(gn).map(wr)):e==="in"?In(r[1],r.slice(2)):e==="!in"?wr(In(r[1],r.slice(2))):e==="has"?Pn(r[1]):e==="!has"?wr(Pn(r[1])):e!=="within"||r;var i}function Xt(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function In(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(et)]]:["filter-in-small",r,["literal",e]]}}function Pn(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function wr(r){return["!",r]}function Rn(r){return ws(Ln(r.value))?Pi(dr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Hn(r)}function Hn(r){const e=r.value,i=r.key;if(Yt(e)!=="array")return[new We(i,e,`array expected, ${Yt(e)} found`)];const a=r.styleSpec;let d,f=[];if(e.length<1)return[new We(i,e,"filter array must have at least 1 element")];switch(f=f.concat(xs({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Nt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Nt(e[1])==="$type"&&f.push(new We(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new We(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Yt(e[1]),d!=="string"&&f.push(new We(`${i}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=Yt(e[y]),Nt(e[1])==="$type"?f=f.concat(xs({key:`${i}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&f.push(new We(`${i}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)f=f.concat(Hn({key:`${i}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":d=Yt(e[1]),e.length!==2?f.push(new We(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&f.push(new We(`${i}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=Yt(e[1]),e.length!==2?f.push(new We(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&f.push(new We(`${i}[1]`,e[1],`object expected, ${d} found`))}return f}function Gr(r,e){const i=r.key,a=r.style,d=r.styleSpec,f=r.value,y=r.objectKey,w=d[`${e}_${r.layerType}`];if(!w)return[];const S=y.match(/^(.*)-transition$/);if(e==="paint"&&S&&w[S[1]]&&w[S[1]].transition)return ai({key:i,value:f,valueSpec:d.transition,style:a,styleSpec:d});const k=r.valueSpec||w[y];if(!k)return[new We(i,f,`unknown property "${y}"`)];let A;if(Yt(f)==="string"&&mn(k)&&!k.tokens&&(A=/^{([^}]+)}$/.exec(f)))return[new We(i,f,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const L=[];return r.layerType==="symbol"&&(y==="text-field"&&a&&!a.glyphs&&L.push(new We(i,f,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&hn(Ln(f))&&Nt(f.type)==="identity"&&L.push(new We(i,f,'"text-font" does not support identity functions'))),L.concat(ai({key:r.key,value:f,valueSpec:k,style:a,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function Gi(r){return Gr(r,"paint")}function br(r){return Gr(r,"layout")}function Zi(r){let e=[];const i=r.value,a=r.key,d=r.style,f=r.styleSpec;i.type||i.ref||e.push(new We(a,i,'either "type" or "ref" is required'));let y=Nt(i.type);const w=Nt(i.ref);if(i.id){const S=Nt(i.id);for(let k=0;k<r.arrayIndex;k++){const A=d.layers[k];Nt(A.id)===S&&e.push(new We(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let S;["type","source","source-layer","filter","layout"].forEach(k=>{k in i&&e.push(new We(a,i[k],`"${k}" is prohibited for ref layers`))}),d.layers.forEach(k=>{Nt(k.id)===w&&(S=k)}),S?S.ref?e.push(new We(a,i.ref,"ref cannot reference another ref layer")):y=Nt(S.type):e.push(new We(a,i.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(i.source){const S=d.sources&&d.sources[i.source],k=S&&Nt(S.type);S?k==="vector"&&y==="raster"?e.push(new We(a,i.source,`layer "${i.id}" requires a raster source`)):k==="raster"&&y!=="raster"?e.push(new We(a,i.source,`layer "${i.id}" requires a vector source`)):k!=="vector"||i["source-layer"]?k==="raster-dem"&&y!=="hillshade"?e.push(new We(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!i.paint||!i.paint["line-gradient"]||k==="geojson"&&S.lineMetrics||e.push(new We(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new We(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new We(a,i.source,`source "${i.source}" not found`))}else e.push(new We(a,i,'missing required property "source"'));return e=e.concat(si({key:a,value:i,valueSpec:f.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ai({key:`${a}.type`,value:i.type,valueSpec:f.layer.type,style:r.style,styleSpec:r.styleSpec,object:i,objectKey:"type"}),filter:Rn,layout:S=>si({layer:i,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":k=>br(dr({layerType:y},k))}}),paint:S=>si({layer:i,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":k=>Gi(dr({layerType:y},k))}})}})),e}function Ai(r){const e=r.value,i=r.key,a=Yt(e);return a!=="string"?[new We(i,e,`string expected, ${a} found`)]:[]}const js={promoteId:function({key:r,value:e}){if(Yt(e)==="string")return Ai({key:r,value:e});{const i=[];for(const a in e)i.push(...Ai({key:`${r}.${a}`,value:e[a]}));return i}}};function qi(r){const e=r.value,i=r.key,a=r.styleSpec,d=r.style;if(!e.type)return[new We(i,e,'"type" is required')];const f=Nt(e.type);let y;switch(f){case"vector":case"raster":case"raster-dem":return y=si({key:i,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:js}),y;case"geojson":if(y=si({key:i,value:e,valueSpec:a.source_geojson,style:d,styleSpec:a,objectElementValidators:js}),e.cluster)for(const w in e.clusterProperties){const[S,k]=e.clusterProperties[w],A=typeof S=="string"?[S,["accumulated"],["get",w]]:S;y.push(...Pi({key:`${i}.${w}.map`,value:k,expressionContext:"cluster-map"})),y.push(...Pi({key:`${i}.${w}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return y;case"video":return si({key:i,value:e,valueSpec:a.source_video,style:d,styleSpec:a});case"image":return si({key:i,value:e,valueSpec:a.source_image,style:d,styleSpec:a});case"canvas":return[new We(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xs({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:a})}}function fo(r){const e=r.value,i=r.styleSpec,a=i.light,d=r.style;let f=[];const y=Yt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new We("light",e,`object expected, ${y} found`)]),f;for(const w in e){const S=w.match(/^(.*)-transition$/);f=f.concat(S&&a[S[1]]&&a[S[1]].transition?ai({key:w,value:e[w],valueSpec:i.transition,style:d,styleSpec:i}):a[w]?ai({key:w,value:e[w],valueSpec:a[w],style:d,styleSpec:i}):[new We(w,e[w],`unknown property "${w}"`)])}return f}function Zr(r){const e=r.value,i=r.styleSpec,a=i.terrain,d=r.style;let f=[];const y=Yt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new We("terrain",e,`object expected, ${y} found`)]),f;for(const w in e)f=f.concat(a[w]?ai({key:w,value:e[w],valueSpec:a[w],style:d,styleSpec:i}):[new We(w,e[w],`unknown property "${w}"`)]);return f}const $s={"*":()=>[],array:pl,boolean:function(r){const e=r.value,i=r.key,a=Yt(e);return a!=="boolean"?[new We(i,e,`boolean expected, ${a} found`)]:[]},number:ba,color:function(r){const e=r.key,i=r.value,a=Yt(i);return a!=="string"?[new We(e,i,`color expected, ${a} found`)]:so(i)===null?[new We(e,i,`color expected, "${i}" found`)]:[]},constants:$n,enum:xs,filter:Rn,function:fl,layer:Zi,object:si,source:qi,light:fo,terrain:Zr,string:Ai,formatted:function(r){return Ai(r).length===0?[]:Pi(r)},resolvedImage:function(r){return Ai(r).length===0?[]:Pi(r)},padding:function(r){const e=r.key,i=r.value;if(Yt(i)==="array"){if(i.length<1||i.length>4)return[new We(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let d=[];for(let f=0;f<i.length;f++)d=d.concat(ai({key:`${e}[${f}]`,value:i[f],valueSpec:a}));return d}return ba({key:e,value:i,valueSpec:{}})}};function ai(r){const e=r.value,i=r.valueSpec,a=r.styleSpec;return i.expression&&hn(Nt(e))?fl(r):i.expression&&Us(Ln(e))?Pi(r):i.type&&$s[i.type]?$s[i.type](r):si(dr({},r,{valueSpec:i.type?a[i.type]:i}))}function bn(r){const e=r.value,i=r.key,a=Ai(r);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new We(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new We(i,e,'"glyphs" url must include a "{range}" token'))),a}function Qt(r,e=Ie){let i=[];return i=i.concat(ai({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:bn,"*":()=>[]}})),r.constants&&(i=i.concat($n({key:"constants",value:r.constants,style:r,styleSpec:e}))),Gs(i)}function Gs(r){return[].concat(r).sort((e,i)=>e.line-i.line)}function Sr(r){return function(...e){return Gs(r.apply(this,e))}}Qt.source=Sr(qi),Qt.light=Sr(fo),Qt.terrain=Sr(Zr),Qt.layer=Sr(Zi),Qt.filter=Sr(Rn),Qt.paintProperty=Sr(Gi),Qt.layoutProperty=Sr(br);const Yo=Qt,qr=Yo.light,mo=Yo.paintProperty,zo=Yo.layoutProperty;function Lo(r,e){let i=!1;if(e&&e.length)for(const a of e)r.fire(new Wo(new Error(a.message))),i=!0;return i}class Do{constructor(e,i,a){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(i=y[1])+2*(a=y[2]);for(let S=0;S<this.d*this.d;S++){const k=y[3+S],A=y[3+S+1];d.push(k===A?null:y.subarray(k,A))}const w=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=a,this.scale=i/e,this.uid=0;const f=a/i*e;this.min=-f,this.max=e+f}insert(e,i,a,d,f){this._forEachCell(i,a,d,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,a,d,f,y){this.cells[f].push(y)}query(e,i,a,d,f){const y=this.min,w=this.max;if(e<=y&&i<=y&&w<=a&&w<=d&&!f)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,i,a,d,this._queryCell,S,{},f),S}}_queryCell(e,i,a,d,f,y,w,S){const k=this.cells[f];if(k!==null){const A=this.keys,L=this.bboxes;for(let F=0;F<k.length;F++){const N=k[F];if(w[N]===void 0){const U=4*N;(S?S(L[U+0],L[U+1],L[U+2],L[U+3]):e<=L[U+2]&&i<=L[U+3]&&a>=L[U+0]&&d>=L[U+1])?(w[N]=!0,y.push(A[N])):w[N]=!1}}}}_forEachCell(e,i,a,d,f,y,w,S){const k=this._convertToCellCoord(e),A=this._convertToCellCoord(i),L=this._convertToCellCoord(a),F=this._convertToCellCoord(d);for(let N=k;N<=L;N++)for(let U=A;U<=F;U++){const ee=this.d*U+N;if((!S||S(this._convertFromCellCoord(N),this._convertFromCellCoord(U),this._convertFromCellCoord(N+1),this._convertFromCellCoord(U+1)))&&f.call(this,e,i,a,d,ee,y,w,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const d=new Int32Array(i+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let f=i;for(let y=0;y<e.length;y++){const w=e[y];d[3+y]=f,d.set(w,f),f+=w.length}return d[3+e.length]=f,d.set(this.keys,f),f+=this.keys.length,d[3+e.length+1]=f,d.set(this.bboxes,f),f+=this.bboxes.length,d.buffer}static serialize(e,i){const a=e.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(e){return new Do(e.buffer)}}const Wr={};function rt(r,e,i={}){if(Wr[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Wr[r]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}rt("Object",Object),rt("TransferableGridIndex",Do),rt("Color",j),rt("Error",Error),rt("AJAXError",Ar),rt("ResolvedImage",se),rt("StylePropertyFunction",wa),rt("StyleExpression",ho,{omit:["_evaluator"]}),rt("ZoomDependentExpression",po),rt("ZoomConstantExpression",Vs),rt("CompoundExpression",Bt,{omit:["_evaluate"]});for(const r in gs)gs[r]._classRegistryKey||rt(`Expression_${r}`,gs[r]);function ml(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Wi(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(ml(r)||zn(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.push(i.buffer),i}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(Wi(a,e));return i}if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!Wr[a])throw new Error(`${a} is not registered.`);const d=i.serialize?i.serialize(r,e):{};if(i.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in r){if(!r.hasOwnProperty(f)||Wr[a].omit.indexOf(f)>=0)continue;const y=r[f];d[f]=Wr[a].shallow.indexOf(f)>=0?y:Wi(y,e)}r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}throw new Error("can't serialize object of type "+typeof r)}function Xi(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||ml(r)||zn(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Xi);if(typeof r=="object"){const e=r.$name||"Object";if(!Wr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Wr[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const d of Object.keys(r)){if(d==="$name")continue;const f=r[d];a[d]=Wr[e].shallow.indexOf(d)>=0?f:Xi(f)}return a}throw new Error("can't deserialize object of type "+typeof r)}class bs{constructor(){this.first=!0}update(e,i){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Je={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Zs(r){for(const e of r)if(Nu(e.charCodeAt(0)))return!0;return!1}function Sa(r){for(const e of r)if(!Ss(e.charCodeAt(0)))return!1;return!0}function Ss(r){return!(Je.Arabic(r)||Je["Arabic Supplement"](r)||Je["Arabic Extended-A"](r)||Je["Arabic Presentation Forms-A"](r)||Je["Arabic Presentation Forms-B"](r))}function Nu(r){return!(r!==746&&r!==747&&(r<4352||!(Je["Bopomofo Extended"](r)||Je.Bopomofo(r)||Je["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Je["CJK Compatibility Ideographs"](r)||Je["CJK Compatibility"](r)||Je["CJK Radicals Supplement"](r)||Je["CJK Strokes"](r)||!(!Je["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Je["CJK Unified Ideographs Extension A"](r)||Je["CJK Unified Ideographs"](r)||Je["Enclosed CJK Letters and Months"](r)||Je["Hangul Compatibility Jamo"](r)||Je["Hangul Jamo Extended-A"](r)||Je["Hangul Jamo Extended-B"](r)||Je["Hangul Jamo"](r)||Je["Hangul Syllables"](r)||Je.Hiragana(r)||Je["Ideographic Description Characters"](r)||Je.Kanbun(r)||Je["Kangxi Radicals"](r)||Je["Katakana Phonetic Extensions"](r)||Je.Katakana(r)&&r!==12540||!(!Je["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Je["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Je["Unified Canadian Aboriginal Syllabics"](r)||Je["Unified Canadian Aboriginal Syllabics Extended"](r)||Je["Vertical Forms"](r)||Je["Yijing Hexagram Symbols"](r)||Je["Yi Syllables"](r)||Je["Yi Radicals"](r))))}function rh(r){return!(Nu(r)||function(e){return!!(Je["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Je["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Je["Letterlike Symbols"](e)||Je["Number Forms"](e)||Je["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Je["Control Pictures"](e)&&e!==9251||Je["Optical Character Recognition"](e)||Je["Enclosed Alphanumerics"](e)||Je["Geometric Shapes"](e)||Je["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Je["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Je["CJK Symbols and Punctuation"](e)||Je.Katakana(e)||Je["Private Use Area"](e)||Je["CJK Compatibility Forms"](e)||Je["Small Form Variants"](e)||Je["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function ih(r){return r>=1424&&r<=2303||Je["Arabic Presentation Forms-A"](r)||Je["Arabic Presentation Forms-B"](r)}function Jd(r,e){return!(!e&&ih(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Je.Khmer(r))}function oh(r){for(const e of r)if(ih(e.charCodeAt(0)))return!0;return!1}const Uu="deferred",Vu="loading",ju="loaded";let $u=null,vi="unavailable",Es=null;const sh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(vi="error"),$u&&$u(r)};function Ea(){Gu.fire(new Vi("pluginStateChange",{pluginStatus:vi,pluginURL:Es}))}const Gu=new ji,gl=function(){return vi},ah=function(){if(vi!==Uu||!Es)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vi=Vu,Ea(),Es&&ds({url:Es},r=>{r?sh(r):(vi=ju,Ea())})},Hi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vi===ju||Hi.applyArabicShaping!=null,isLoading:()=>vi===Vu,setState(r){if(!ft())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");vi=r.pluginStatus,Es=r.pluginURL},isParsed(){if(!ft())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Hi.applyArabicShaping!=null&&Hi.processBidirectionalText!=null&&Hi.processStyledBidirectionalText!=null},getPluginURL(){if(!ft())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Es}};class Fn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bs,this.transition={})}isSupportedScript(e){return function(i,a){for(const d of i)if(!Jd(d.charCodeAt(0),a))return!1;return!0}(e,Hi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class yl{constructor(e,i){this.property=e,this.value=i,this.expression=function(a,d){if(hn(a))return new wa(a,d);if(Us(a)){const f=dl(a,d);if(f.result==="error")throw new Error(f.value.map(y=>`${y.key}: ${y.message}`).join(", "));return f.value}{let f=a;return d.type==="color"&&typeof a=="string"?f=j.parse(a):d.type!=="padding"||typeof a!="number"&&!Array.isArray(a)||(f=Q.parse(a)),{kind:"constant",evaluate:()=>f}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Wl{constructor(e){this.property=e,this.value=new yl(e,void 0)}transitioned(e,i){return new uh(this.property,this.value,i,Xe({},e.transition,this.transition),e.now)}untransitioned(){return new uh(this.property,this.value,null,{},0)}}class lh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return he(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Wl(this._values[e].property)),this._values[e].value=new yl(this._values[e].property,i===null?void 0:he(i))}getTransition(e){return he(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Wl(this._values[e].property)),this._values[e].transition=he(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const d=this.getTransition(i);d!==void 0&&(e[`${i}-transition`]=d)}return e}transitioned(e,i){const a=new ch(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].transitioned(e,i._values[d]);return a}untransitioned(){const e=new ch(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class uh{constructor(e,i,a,d,f){this.property=e,this.value=i,this.begin=f+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const d=e.now||0,f=this.value.possiblyEvaluate(e,i,a),y=this.prior;if(y){if(d>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(d<this.begin)return y.possiblyEvaluate(e,i,a);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,i,a),f,function(S){if(S<=0)return 0;if(S>=1)return 1;const k=S*S,A=k*S;return 4*(S<.5?A:3*(S-k)+A-.75)}(w))}}return f}}class ch{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const d=new _l(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].possiblyEvaluate(e,i,a);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Yd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return he(this._values[e].value)}setValue(e,i){this._values[e]=new yl(this._values[e].property,i===null?void 0:he(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const d=new _l(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].possiblyEvaluate(e,i,a);return d}}class Ro{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,d){return this.property.evaluate(this.value,this.parameters,e,i,a,d)}}class _l{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class _t{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,a){const d=ve[this.specification.type];return d?d(e,i,a):e}}class Mt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,d){return new Ro(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,d)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ro(this,{kind:"constant",value:void 0},e.parameters);const d=ve[this.specification.type];return d?new Ro(this,{kind:"constant",value:d(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,d,f,y){return e.kind==="constant"?e.value:e.evaluate(i,a,d,f,y)}}class Ta extends Mt{possiblyEvaluate(e,i,a,d){if(e.value===void 0)return new Ro(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},a,d),y=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,w=this._calculate(y,y,y,i);return new Ro(this,{kind:"constant",value:w},i)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Ro(this,{kind:"constant",value:f},i)}return new Ro(this,e.expression,i)}evaluate(e,i,a,d,f,y){if(e.kind==="source"){const w=e.evaluate(i,a,d,f,y);return this._calculate(w,w,w,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},a,d),e.evaluate({zoom:Math.floor(i.zoom)},a,d),e.evaluate({zoom:Math.floor(i.zoom)+1},a,d),i):e.value}_calculate(e,i,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:a,to:i}}interpolate(e){return e}}class Zu{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},a,d);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new Fn(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Fn(Math.floor(i.zoom),i)),e.expression.evaluate(new Fn(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:a,to:i}}interpolate(e){return e}}class Ts{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,d){return!!e.expression.evaluate(i,null,{},a,d)}interpolate(){return!1}}class Fr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const a=e[i];a.specification.overridable&&this.overridableProperties.push(i);const d=this.defaultPropertyValues[i]=new yl(a,void 0),f=this.defaultTransitionablePropertyValues[i]=new Wl(a);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=d.possiblyEvaluate({})}}}rt("DataDrivenProperty",Mt),rt("DataConstantProperty",_t),rt("CrossFadedDataDrivenProperty",Ta),rt("CrossFadedProperty",Zu),rt("ColorRampProperty",Ts);const Cs="-transition";class Fo extends ji{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Yd(i.layout)),i.paint)){this._transitionablePaint=new lh(i.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _l(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){i!=null&&this._validate(zo,`layers.${this.id}.layout.${e}`,e,i,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(Cs)?this._transitionablePaint.getTransition(e.slice(0,-Cs.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(i!=null&&this._validate(mo,`layers.${this.id}.paint.${e}`,e,i,a))return!1;if(e.endsWith(Cs))return this._transitionablePaint.setTransition(e.slice(0,-Cs.length),i||void 0),!1;{const d=this._transitionablePaint._values[e],f=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),w=d.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||y||f||this._handleOverridablePaintPropertyUpdate(e,w,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ie(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(e,i,a,d,f={}){return(!f||f.validate!==!1)&&Lo(this,e.call(Yo,{key:i,layerType:this.type,objectKey:a,value:d,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ro&&mn(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const hh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ks{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function sr(r,e=1){let i=0,a=0;return{members:r.map(d=>{const f=hh[d.type].BYTES_PER_ELEMENT,y=i=qu(i,Math.max(e,f)),w=d.components||1;return a=Math.max(a,f),i+=f*w,{name:d.name,type:d.type,components:w,offset:y}}),size:qu(i,Math.max(a,e)),alignment:e}}function qu(r,e){return Math.ceil(r/e)*e}class qs extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const d=2*e;return this.int16[d+0]=i,this.int16[d+1]=a,e}}qs.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",qs);class h extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,d)}emplace(e,i,a,d,f){const y=4*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=d,this.int16[y+3]=f,e}}h.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",h);class t extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,d,f,y)}emplace(e,i,a,d,f,y,w){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.int16[S+2]=d,this.int16[S+3]=f,this.int16[S+4]=y,this.int16[S+5]=w,e}}t.prototype.bytesPerElement=12,rt("StructArrayLayout2i4i12",t);class s extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,d,f,y)}emplace(e,i,a,d,f,y,w){const S=4*e,k=8*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.uint8[k+4]=d,this.uint8[k+5]=f,this.uint8[k+6]=y,this.uint8[k+7]=w,e}}s.prototype.bytesPerElement=8,rt("StructArrayLayout2i4ub8",s);class c extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const d=2*e;return this.float32[d+0]=i,this.float32[d+1]=a,e}}c.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",c);class p extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y,w,S,k,A){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,a,d,f,y,w,S,k,A)}emplace(e,i,a,d,f,y,w,S,k,A,L){const F=10*e;return this.uint16[F+0]=i,this.uint16[F+1]=a,this.uint16[F+2]=d,this.uint16[F+3]=f,this.uint16[F+4]=y,this.uint16[F+5]=w,this.uint16[F+6]=S,this.uint16[F+7]=k,this.uint16[F+8]=A,this.uint16[F+9]=L,e}}p.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",p);class g extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y,w,S,k,A,L,F){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,a,d,f,y,w,S,k,A,L,F)}emplace(e,i,a,d,f,y,w,S,k,A,L,F,N){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=a,this.int16[U+2]=d,this.int16[U+3]=f,this.uint16[U+4]=y,this.uint16[U+5]=w,this.uint16[U+6]=S,this.uint16[U+7]=k,this.int16[U+8]=A,this.int16[U+9]=L,this.int16[U+10]=F,this.int16[U+11]=N,e}}g.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",g);class x extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=d,e}}x.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",x);class E extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}E.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",E);class T extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y,w,S,k){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,a,d,f,y,w,S,k)}emplace(e,i,a,d,f,y,w,S,k,A){const L=10*e,F=5*e;return this.int16[L+0]=i,this.int16[L+1]=a,this.int16[L+2]=d,this.int16[L+3]=f,this.int16[L+4]=y,this.int16[L+5]=w,this.uint32[F+3]=S,this.uint16[L+8]=k,this.uint16[L+9]=A,e}}T.prototype.bytesPerElement=20,rt("StructArrayLayout6i1ul2ui20",T);class I extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,d,f,y)}emplace(e,i,a,d,f,y,w){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.int16[S+2]=d,this.int16[S+3]=f,this.int16[S+4]=y,this.int16[S+5]=w,e}}I.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",I);class z extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,d,f)}emplace(e,i,a,d,f,y){const w=4*e,S=8*e;return this.float32[w+0]=i,this.float32[w+1]=a,this.float32[w+2]=d,this.int16[S+6]=f,this.int16[S+7]=y,e}}z.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",z);class R extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,d)}emplace(e,i,a,d,f){const y=12*e,w=3*e;return this.uint8[y+0]=i,this.uint8[y+1]=a,this.float32[w+1]=d,this.float32[w+2]=f,e}}R.prototype.bytesPerElement=12,rt("StructArrayLayout2ub2f12",R);class O extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=d,e}}O.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",O);class W extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee,K,de){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee,K,de)}emplace(e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee,K,de,Se){const ue=24*e,xe=12*e,Le=48*e;return this.int16[ue+0]=i,this.int16[ue+1]=a,this.uint16[ue+2]=d,this.uint16[ue+3]=f,this.uint32[xe+2]=y,this.uint32[xe+3]=w,this.uint32[xe+4]=S,this.uint16[ue+10]=k,this.uint16[ue+11]=A,this.uint16[ue+12]=L,this.float32[xe+7]=F,this.float32[xe+8]=N,this.uint8[Le+36]=U,this.uint8[Le+37]=ee,this.uint8[Le+38]=K,this.uint32[xe+10]=de,this.int16[ue+22]=Se,e}}W.prototype.bytesPerElement=48,rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",W);class Z extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee,K,de,Se,ue,xe,Le,ze,ht,gt,it,Qe,qe,ot){const nt=this.length;return this.resize(nt+1),this.emplace(nt,e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee,K,de,Se,ue,xe,Le,ze,ht,gt,it,Qe,qe,ot)}emplace(e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee,K,de,Se,ue,xe,Le,ze,ht,gt,it,Qe,qe,ot,nt){const Ve=34*e,Et=17*e;return this.int16[Ve+0]=i,this.int16[Ve+1]=a,this.int16[Ve+2]=d,this.int16[Ve+3]=f,this.int16[Ve+4]=y,this.int16[Ve+5]=w,this.int16[Ve+6]=S,this.int16[Ve+7]=k,this.uint16[Ve+8]=A,this.uint16[Ve+9]=L,this.uint16[Ve+10]=F,this.uint16[Ve+11]=N,this.uint16[Ve+12]=U,this.uint16[Ve+13]=ee,this.uint16[Ve+14]=K,this.uint16[Ve+15]=de,this.uint16[Ve+16]=Se,this.uint16[Ve+17]=ue,this.uint16[Ve+18]=xe,this.uint16[Ve+19]=Le,this.uint16[Ve+20]=ze,this.uint16[Ve+21]=ht,this.uint16[Ve+22]=gt,this.uint32[Et+12]=it,this.float32[Et+13]=Qe,this.float32[Et+14]=qe,this.float32[Et+15]=ot,this.float32[Et+16]=nt,e}}Z.prototype.bytesPerElement=68,rt("StructArrayLayout8i15ui1ul4f68",Z);class q extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}q.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",q);class re extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=d,e}}re.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",re);class le extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const f=4*e;return this.uint32[2*e+0]=i,this.uint16[f+2]=a,this.uint16[f+3]=d,e}}le.prototype.bytesPerElement=8,rt("StructArrayLayout1ul2ui8",le);class ge extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const d=2*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,e}}ge.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",ge);class X extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}X.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",X);class be extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,d)}emplace(e,i,a,d,f){const y=4*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=d,this.float32[y+3]=f,e}}be.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",be);class _e extends ks{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new It(this.anchorPointX,this.anchorPointY)}}_e.prototype.size=20;class Me extends T{get(e){return new _e(this,e)}}rt("CollisionBoxArray",Me);class Pe extends ks{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Pe.prototype.size=48;class Be extends W{get(e){return new Pe(this,e)}}rt("PlacedSymbolArray",Be);class Ce extends ks{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ce.prototype.size=68;class st extends Z{get(e){return new Ce(this,e)}}rt("SymbolInstanceArray",st);class Ye extends q{getoffsetX(e){return this.float32[1*e+0]}}rt("GlyphOffsetArray",Ye);class ct extends re{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}rt("SymbolLineVertexArray",ct);class Ot extends ks{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ot.prototype.size=8;class jt extends le{get(e){return new Ot(this,e)}}rt("FeatureIndexArray",jt);class St extends qs{}class yn extends qs{}class _n extends qs{}class tn extends t{}class nn extends s{}class wn extends c{}class Er extends p{}class Bo extends g{}class go extends x{}class Oo extends E{}class Is extends I{}class Ki extends R{}class xi extends O{}class Qo extends ge{}const Xl=sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:fr}=Xl;class qt{constructor(e=[]){this.segments=e}prepareSegment(e,i,a,d){let f=this.segments[this.segments.length-1];return e>qt.MAX_VERTEX_ARRAY_LENGTH&&Ge(`Max vertices per segment is ${qt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>qt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==d)&&(f={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(f.sortKey=d),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,d){return new qt([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])}}function pn(r,e){return 256*(r=H(Math.floor(r),0,255))+H(Math.floor(e),0,255)}qt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",qt);const Tr=sr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Cr={exports:{}},Bn={exports:{}};Bn.exports=function(r,e){var i,a,d,f,y,w,S,k;for(a=r.length-(i=3&r.length),d=e,y=3432918353,w=461845907,k=0;k<a;)S=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,d=27492+(65535&(f=5*(65535&(d=(d^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(S=0,i){case 3:S^=(255&r.charCodeAt(k+2))<<16;case 2:S^=(255&r.charCodeAt(k+1))<<8;case 1:d^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(k)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295}return d^=r.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Ji={exports:{}};Ji.exports=function(r,e){for(var i,a=r.length,d=e^a,f=0;a>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(f)|(255&r.charCodeAt(++f))<<8|(255&r.charCodeAt(++f))<<16|(255&r.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:d^=(255&r.charCodeAt(f+2))<<16;case 2:d^=(255&r.charCodeAt(f+1))<<8;case 1:d=1540483477*(65535&(d^=255&r.charCodeAt(f)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Ws=Bn.exports,Wu=Ji.exports;Cr.exports=Ws,Cr.exports.murmur3=Ws,Cr.exports.murmur2=Wu;class Ca{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,a,d){this.ids.push(dh(e)),this.positions.push(i,a,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=dh(e);let a=0,d=this.ids.length-1;for(;a<d;){const y=a+d>>1;this.ids[y]>=i?d=y:a=y+1}const f=[];for(;this.ids[a]===i;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,i){const a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Xu(a,d,0,a.length-1),i&&i.push(a.buffer,d.buffer),{ids:a,positions:d}}static deserialize(e){const i=new Ca;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function dh(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Cr.exports(String(r))}function Xu(r,e,i,a){for(;i<a;){const d=r[i+a>>1];let f=i-1,y=a+1;for(;;){do f++;while(r[f]<d);do y--;while(r[y]>d);if(f>=y)break;Ms(r,f,y),Ms(e,3*f,3*y),Ms(e,3*f+1,3*y+1),Ms(e,3*f+2,3*y+2)}y-i<a-y?(Xu(r,e,i,y),i=y+1):(Xu(r,e,y+1,a),a=y)}}function Ms(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}rt("FeaturePositionMap",Ca);class Xs{constructor(e,i){this.gl=e.gl,this.location=i}}class Hs extends Xs{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Hl extends Xs{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class rg extends Xs{constructor(e,i){super(e,i),this.current=j.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Q0=new Float32Array(16);function Qd(r){return[pn(255*r.r,255*r.g),pn(255*r.b,255*r.a)]}class Hu{constructor(e,i,a){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=a}setUniform(e,i,a){e.set(a.constantOr(this.value))}getBinding(e,i,a){return this.type==="color"?new rg(e,i):new Hs(e,i)}}class Kl{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setUniform(e,i,a,d){const f=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,i,a){return a.substr(0,9)==="u_pattern"?new Hl(e,i):new Hs(e,i)}}class Ks{constructor(e,i,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,a,d,f){const y=this.paintVertexArray.length,w=this.expression.evaluate(new Fn(0),i,{},d,[],f);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w)}updatePaintArray(e,i,a,d){const f=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,i,f)}_setPaintValue(e,i,a){if(this.type==="color"){const d=Qd(a);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class es{constructor(e,i,a,d,f,y){this.expression=e,this.uniformNames=i.map(w=>`u_${w}_t`),this.type=a,this.useIntegerZoom=d,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(w=>({name:`a_${w}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,i,a,d,f){const y=this.expression.evaluate(new Fn(this.zoom),i,{},d,[],f),w=this.expression.evaluate(new Fn(this.zoom+1),i,{},d,[],f),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,y,w)}updatePaintArray(e,i,a,d){const f=this.expression.evaluate({zoom:this.zoom},a,d),y=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,i,f,y)}_setPaintValue(e,i,a,d){if(this.type==="color"){const f=Qd(a),y=Qd(d);for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,f[0],f[1],y[0],y[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,d=H(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,i,a){return new Hs(e,i)}}class ka{constructor(e,i,a,d,f,y){this.expression=e,this.type=i,this.useIntegerZoom=a,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,a){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,d,f){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,i,a,d){if(!d||!a)return;const{min:f,mid:y,max:w}=a,S=d[f],k=d[y],A=d[w];if(S&&k&&A)for(let L=e;L<i;L++)this.zoomInPaintVertexArray.emplace(L,k.tl[0],k.tl[1],k.br[0],k.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],k.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,k.tl[0],k.tl[1],k.br[0],k.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],k.pixelRatio,A.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Tr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Tr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ig{constructor(e,i,a){this.binders={},this._buffers=[];const d=[];for(const f in e.paint._values){if(!a(f))continue;const y=e.paint.get(f);if(!(y instanceof Ro&&mn(y.property.specification)))continue;const w=ex(f,e.type),S=y.value,k=y.property.specification.type,A=y.property.useIntegerZoom,L=y.property.specification["property-type"],F=L==="cross-faded"||L==="cross-faded-data-driven";if(S.kind==="constant")this.binders[f]=F?new Kl(S.value,w):new Hu(S.value,w,k),d.push(`/u_${f}`);else if(S.kind==="source"||F){const N=og(f,k,"source");this.binders[f]=F?new ka(S,k,A,i,N,e.id):new Ks(S,w,k,N),d.push(`/a_${f}`)}else{const N=og(f,k,"composite");this.binders[f]=new es(S,w,k,A,i,N),d.push(`/z_${f}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ks||i instanceof es?i.maxValue:0}populatePaintArrays(e,i,a,d,f){for(const y in this.binders){const w=this.binders[y];(w instanceof Ks||w instanceof es||w instanceof ka)&&w.populatePaintArray(e,i,a,d,f)}}setConstantPatternPositions(e,i){for(const a in this.binders){const d=this.binders[a];d instanceof Kl&&d.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,a,d,f){let y=!1;for(const w in e){const S=i.getPositions(w);for(const k of S){const A=a.feature(k.index);for(const L in this.binders){const F=this.binders[L];if((F instanceof Ks||F instanceof es||F instanceof ka)&&F.expression.isStateDependent===!0){const N=d.paint.get(L);F.expression=N.value,F.updatePaintArray(k.start,k.end,A,e[w],f),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Hu||a instanceof Kl)&&e.push(...a.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Ks||a instanceof es)for(let d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof ka)for(let d=0;d<Tr.members.length;d++)e.push(Tr.members[d].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Hu||a instanceof Kl||a instanceof es)for(const d of a.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const a=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof Hu||f instanceof Kl||f instanceof es){for(const y of f.uniformNames)if(i[y]){const w=f.getBinding(e,i[y],y);a.push({name:y,property:d,binding:w})}}}return a}setUniforms(e,i,a,d){for(const{name:f,property:y,binding:w}of i)this.binders[y].setUniform(w,d,a.get(y),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(e&&a instanceof ka){const d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof Ks||a instanceof es)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof Ks||a instanceof es||a instanceof ka)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ks||i instanceof es||i instanceof ka)&&i.destroy()}}}class vl{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new ig(d,i,a);this.needsUpload=!1,this._featureMap=new Ca,this._bufferOffset=0}populatePaintArrays(e,i,a,d,f,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,d,f,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,d){for(const f of a)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ex(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function og(r,e,i){const a={color:{source:c,composite:be},number:{source:q,composite:c}},d=function(f){return{"line-pattern":{source:Er,composite:Er},"fill-pattern":{source:Er,composite:Er},"fill-extrusion-pattern":{source:Er,composite:Er}}[f]}(r);return d&&d[i]||a[e][i]}rt("ConstantBinder",Hu),rt("CrossFadedConstantBinder",Kl),rt("SourceExpressionBinder",Ks),rt("CrossFadedCompositeBinder",ka),rt("CompositeExpressionBinder",es),rt("ProgramConfiguration",ig,{omit:["_buffers"]}),rt("ProgramConfigurationSet",vl);var mr=8192;const ep=Math.pow(2,14)-1,sg=-ep-1;function xl(r){const e=mr/r.extent,i=r.loadGeometry();for(let a=0;a<i.length;a++){const d=i[a];for(let f=0;f<d.length;f++){const y=d[f],w=Math.round(y.x*e),S=Math.round(y.y*e);y.x=H(w,sg,ep),y.y=H(S,sg,ep),(w<y.x||w>y.x+1||S<y.y||S>y.y+1)&&Ge("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function wl(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?xl(r):[]}}function ph(r,e,i,a,d){r.emplaceBack(2*e+(a+1)/2,2*i+(d+1)/2)}class tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new yn,this.indexArray=new xi,this.segments=new qt,this.programConfigurations=new vl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){const d=this.layers[0],f=[];let y=null,w=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),w=!y.isConstant());for(const{feature:S,id:k,index:A,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,N=wl(S,F);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),N,a))continue;const U=w?y.evaluate(N,{},a):void 0,ee={id:k,properties:S.properties,type:S.type,sourceLayerIndex:L,index:A,geometry:F?N.geometry:xl(S),patterns:{},sortKey:U};f.push(ee)}w&&f.sort((S,k)=>S.sortKey-k.sortKey);for(const S of f){const{geometry:k,index:A,sourceLayerIndex:L}=S,F=e[A].feature;this.addFeature(S,k,A,a),i.featureIndex.insert(F,k,A,L,this.index)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,d){for(const f of i)for(const y of f){const w=y.x,S=y.y;if(w<0||w>=mr||S<0||S>=mr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=k.vertexLength;ph(this.layoutVertexArray,w,S,-1,-1),ph(this.layoutVertexArray,w,S,1,-1),ph(this.layoutVertexArray,w,S,1,1),ph(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)}}function ag(r,e){for(let i=0;i<r.length;i++)if(Jl(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Jl(r,e[i]))return!0;return!!np(r,e)}function tx(r,e,i){return!!Jl(r,e)||!!rp(e,r,i)}function lg(r,e){if(r.length===1)return cg(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let d=0;d<a.length;d++)if(Jl(r,a[d]))return!0}for(let i=0;i<r.length;i++)if(cg(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(np(r,e[i]))return!0;return!1}function nx(r,e,i){if(r.length>1){if(np(r,e))return!0;for(let a=0;a<e.length;a++)if(rp(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if(rp(r[a],e,i))return!0;return!1}function np(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],d=r[i+1];for(let f=0;f<e.length-1;f++)if(rx(a,d,e[f],e[f+1]))return!0}return!1}function rx(r,e,i,a){return lt(r,i,a)!==lt(e,i,a)&&lt(r,e,i)!==lt(r,e,a)}function rp(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let d=1;d<e.length;d++)if(ug(r,e[d-1],e[d])<a)return!0;return!1}function ug(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const d=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(d<0?e:d>1?i:i.sub(e)._mult(d)._add(e))}function cg(r,e){let i,a,d,f=!1;for(let y=0;y<r.length;y++){i=r[y];for(let w=0,S=i.length-1;w<i.length;S=w++)a=i[w],d=i[S],a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(f=!f)}return f}function Jl(r,e){let i=!1;for(let a=0,d=r.length-1;a<r.length;d=a++){const f=r[a],y=r[d];f.y>e.y!=y.y>e.y&&e.x<(y.x-f.x)*(e.y-f.y)/(y.y-f.y)+f.x&&(i=!i)}return i}function ix(r,e,i){const a=i[0],d=i[2];if(r.x<a.x&&e.x<a.x||r.x>d.x&&e.x>d.x||r.y<a.y&&e.y<a.y||r.y>d.y&&e.y>d.y)return!1;const f=lt(r,e,i[0]);return f!==lt(r,e,i[1])||f!==lt(r,e,i[2])||f!==lt(r,e,i[3])}function Ku(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function fh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function mh(r,e,i,a,d){if(!e[0]&&!e[1])return r;const f=It.convert(e)._mult(d);i==="viewport"&&f._rotate(-a);const y=[];for(let w=0;w<r.length;w++)y.push(r[w].sub(f));return y}rt("CircleBucket",tp,{omit:["layers"]});const ox=new Fr({"circle-sort-key":new Mt(Ie.layout_circle["circle-sort-key"])});var sx={paint:new Fr({"circle-radius":new Mt(Ie.paint_circle["circle-radius"]),"circle-color":new Mt(Ie.paint_circle["circle-color"]),"circle-blur":new Mt(Ie.paint_circle["circle-blur"]),"circle-opacity":new Mt(Ie.paint_circle["circle-opacity"]),"circle-translate":new _t(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mt(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mt(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mt(Ie.paint_circle["circle-stroke-opacity"])}),layout:ox},wi=1e-6,bi=typeof Float32Array<"u"?Float32Array:Array;function hg(){var r=new bi(9);return bi!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ip(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function dg(r,e,i){var a=e[0],d=e[1],f=e[2],y=e[3],w=e[4],S=e[5],k=e[6],A=e[7],L=e[8],F=e[9],N=e[10],U=e[11],ee=e[12],K=e[13],de=e[14],Se=e[15],ue=i[0],xe=i[1],Le=i[2],ze=i[3];return r[0]=ue*a+xe*w+Le*L+ze*ee,r[1]=ue*d+xe*S+Le*F+ze*K,r[2]=ue*f+xe*k+Le*N+ze*de,r[3]=ue*y+xe*A+Le*U+ze*Se,r[4]=(ue=i[4])*a+(xe=i[5])*w+(Le=i[6])*L+(ze=i[7])*ee,r[5]=ue*d+xe*S+Le*F+ze*K,r[6]=ue*f+xe*k+Le*N+ze*de,r[7]=ue*y+xe*A+Le*U+ze*Se,r[8]=(ue=i[8])*a+(xe=i[9])*w+(Le=i[10])*L+(ze=i[11])*ee,r[9]=ue*d+xe*S+Le*F+ze*K,r[10]=ue*f+xe*k+Le*N+ze*de,r[11]=ue*y+xe*A+Le*U+ze*Se,r[12]=(ue=i[12])*a+(xe=i[13])*w+(Le=i[14])*L+(ze=i[15])*ee,r[13]=ue*d+xe*S+Le*F+ze*K,r[14]=ue*f+xe*k+Le*N+ze*de,r[15]=ue*y+xe*A+Le*U+ze*Se,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Ju,ax=dg;function pg(){var r=new bi(3);return bi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function fg(r,e,i){var a=new bi(3);return a[0]=r,a[1]=e,a[2]=i,a}function gh(r,e,i){var a=e[0],d=e[1],f=e[2],y=e[3];return r[0]=i[0]*a+i[4]*d+i[8]*f+i[12]*y,r[1]=i[1]*a+i[5]*d+i[9]*f+i[13]*y,r[2]=i[2]*a+i[6]*d+i[10]*f+i[14]*y,r[3]=i[3]*a+i[7]*d+i[11]*f+i[15]*y,r}function mg(){var r=new bi(4);return bi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function gg(r,e){const i=gh([],[r.x,r.y,0,1],e);return new It(i[0]/i[3],i[1]/i[3])}pg(),Ju=new bi(4),bi!=Float32Array&&(Ju[0]=0,Ju[1]=0,Ju[2]=0,Ju[3]=0),pg(),fg(1,0,0),fg(0,1,0),mg(),mg(),hg(),function(){var r;r=new bi(2),bi!=Float32Array&&(r[0]=0,r[1]=0)}();class yg extends tp{}rt("HeatmapBucket",yg,{omit:["layers"]});var lx={paint:new Fr({"heatmap-radius":new Mt(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mt(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ts(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(Ie.paint_heatmap["heatmap-opacity"])})};function op(r,{width:e,height:i},a,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*i*a)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*i*a}`)}else d=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=d,r}function _g(r,{width:e,height:i},a){if(e===r.width&&i===r.height)return;const d=op({},{width:e,height:i},a);sp(r,d,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,i)},a),r.width=e,r.height=i,r.data=d.data}function sp(r,e,i,a,d,f){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||i.x>r.width-d.width||i.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<d.height;S++){const k=((i.y+S)*r.width+i.x)*f,A=((a.y+S)*e.width+a.x)*f;for(let L=0;L<d.width*f;L++)w[A+L]=y[k+L]}return e}class Yu{constructor(e,i){op(this,e,1,i)}resize(e){_g(this,e,1)}clone(){return new Yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,d,f){sp(e,i,a,d,f,1)}}class yo{constructor(e,i){op(this,e,4,i)}resize(e){_g(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new yo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,d,f){sp(e,i,a,d,f,4)}}function vg(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,d=r.image||new yo({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(y,w,S)=>{e[r.evaluationKey]=S;const k=r.expression.evaluate(e);d.data[y+w+0]=Math.floor(255*k.r/k.a),d.data[y+w+1]=Math.floor(255*k.g/k.a),d.data[y+w+2]=Math.floor(255*k.b/k.a),d.data[y+w+3]=Math.floor(255*k.a)};if(r.clips)for(let y=0,w=0;y<a;++y,w+=4*i)for(let S=0,k=0;S<i;S++,k+=4){const A=S/(i-1),{start:L,end:F}=r.clips[y];f(w,k,L*(1-A)+F*A)}else for(let y=0,w=0;y<i;y++,w+=4)f(0,w,y/(i-1));return d}rt("AlphaImage",Yu),rt("RGBAImage",yo);var ux={paint:new Fr({"hillshade-illumination-direction":new _t(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _t(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(Ie.paint_hillshade["hillshade-accent-color"])})};const cx=sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:hx}=cx;var yh={exports:{}};function _h(r,e,i){i=i||2;var a,d,f,y,w,S,k,A=e&&e.length,L=A?e[0]*i:r.length,F=xg(r,0,L,i,!0),N=[];if(!F||F.next===F.prev)return N;if(A&&(F=function(ee,K,de,Se){var ue,xe,Le,ze=[];for(ue=0,xe=K.length;ue<xe;ue++)(Le=xg(ee,K[ue]*Se,ue<xe-1?K[ue+1]*Se:ee.length,Se,!1))===Le.next&&(Le.steiner=!0),ze.push(vx(Le));for(ze.sort(gx),ue=0;ue<ze.length;ue++)de=yx(ze[ue],de);return de}(r,e,F,i)),r.length>80*i){a=f=r[0],d=y=r[1];for(var U=i;U<L;U+=i)(w=r[U])<a&&(a=w),(S=r[U+1])<d&&(d=S),w>f&&(f=w),S>y&&(y=S);k=(k=Math.max(f-a,y-d))!==0?32767/k:0}return Qu(F,N,i,a,d,k,0),N}function xg(r,e,i,a,d){var f,y;if(d===up(r,e,i,a)>0)for(f=e;f<i;f+=a)y=Sg(f,r[f],r[f+1],y);else for(f=i-a;f>=e;f-=a)y=Sg(f,r[f],r[f+1],y);return y&&vh(y,y.next)&&(tc(y),y=y.next),y}function bl(r,e){if(!r)return r;e||(e=r);var i,a=r;do if(i=!1,a.steiner||!vh(a,a.next)&&tr(a.prev,a,a.next)!==0)a=a.next;else{if(tc(a),(a=e=a.prev)===a.next)break;i=!0}while(i||a!==e);return e}function Qu(r,e,i,a,d,f,y){if(r){!y&&f&&function(A,L,F,N){var U=A;do U.z===0&&(U.z=ap(U.x,U.y,L,F,N)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==A);U.prevZ.nextZ=null,U.prevZ=null,function(ee){var K,de,Se,ue,xe,Le,ze,ht,gt=1;do{for(de=ee,ee=null,xe=null,Le=0;de;){for(Le++,Se=de,ze=0,K=0;K<gt&&(ze++,Se=Se.nextZ);K++);for(ht=gt;ze>0||ht>0&&Se;)ze!==0&&(ht===0||!Se||de.z<=Se.z)?(ue=de,de=de.nextZ,ze--):(ue=Se,Se=Se.nextZ,ht--),xe?xe.nextZ=ue:ee=ue,ue.prevZ=xe,xe=ue;de=Se}xe.nextZ=null,gt*=2}while(Le>1)}(U)}(r,a,d,f);for(var w,S,k=r;r.prev!==r.next;)if(w=r.prev,S=r.next,f?px(r,a,d,f):dx(r))e.push(w.i/i|0),e.push(r.i/i|0),e.push(S.i/i|0),tc(r),r=S.next,k=S.next;else if((r=S)===k){y?y===1?Qu(r=fx(bl(r),e,i),e,i,a,d,f,2):y===2&&mx(r,e,i,a,d,f):Qu(bl(r),e,i,a,d,f,1);break}}}function dx(r){var e=r.prev,i=r,a=r.next;if(tr(e,i,a)>=0)return!1;for(var d=e.x,f=i.x,y=a.x,w=e.y,S=i.y,k=a.y,A=d<f?d<y?d:y:f<y?f:y,L=w<S?w<k?w:k:S<k?S:k,F=d>f?d>y?d:y:f>y?f:y,N=w>S?w>k?w:k:S>k?S:k,U=a.next;U!==e;){if(U.x>=A&&U.x<=F&&U.y>=L&&U.y<=N&&Yl(d,w,f,S,y,k,U.x,U.y)&&tr(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function px(r,e,i,a){var d=r.prev,f=r,y=r.next;if(tr(d,f,y)>=0)return!1;for(var w=d.x,S=f.x,k=y.x,A=d.y,L=f.y,F=y.y,N=w<S?w<k?w:k:S<k?S:k,U=A<L?A<F?A:F:L<F?L:F,ee=w>S?w>k?w:k:S>k?S:k,K=A>L?A>F?A:F:L>F?L:F,de=ap(N,U,e,i,a),Se=ap(ee,K,e,i,a),ue=r.prevZ,xe=r.nextZ;ue&&ue.z>=de&&xe&&xe.z<=Se;){if(ue.x>=N&&ue.x<=ee&&ue.y>=U&&ue.y<=K&&ue!==d&&ue!==y&&Yl(w,A,S,L,k,F,ue.x,ue.y)&&tr(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,xe.x>=N&&xe.x<=ee&&xe.y>=U&&xe.y<=K&&xe!==d&&xe!==y&&Yl(w,A,S,L,k,F,xe.x,xe.y)&&tr(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;ue&&ue.z>=de;){if(ue.x>=N&&ue.x<=ee&&ue.y>=U&&ue.y<=K&&ue!==d&&ue!==y&&Yl(w,A,S,L,k,F,ue.x,ue.y)&&tr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;xe&&xe.z<=Se;){if(xe.x>=N&&xe.x<=ee&&xe.y>=U&&xe.y<=K&&xe!==d&&xe!==y&&Yl(w,A,S,L,k,F,xe.x,xe.y)&&tr(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function fx(r,e,i){var a=r;do{var d=a.prev,f=a.next.next;!vh(d,f)&&wg(d,a,a.next,f)&&ec(d,f)&&ec(f,d)&&(e.push(d.i/i|0),e.push(a.i/i|0),e.push(f.i/i|0),tc(a),tc(a.next),a=r=f),a=a.next}while(a!==r);return bl(a)}function mx(r,e,i,a,d,f){var y=r;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&xx(y,w)){var S=bg(y,w);return y=bl(y,y.next),S=bl(S,S.next),Qu(y,e,i,a,d,f,0),void Qu(S,e,i,a,d,f,0)}w=w.next}y=y.next}while(y!==r)}function gx(r,e){return r.x-e.x}function yx(r,e){var i=function(d,f){var y,w=f,S=d.x,k=d.y,A=-1/0;do{if(k<=w.y&&k>=w.next.y&&w.next.y!==w.y){var L=w.x+(k-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(L<=S&&L>A&&(A=L,y=w.x<w.next.x?w:w.next,L===S))return y}w=w.next}while(w!==f);if(!y)return null;var F,N=y,U=y.x,ee=y.y,K=1/0;w=y;do S>=w.x&&w.x>=U&&S!==w.x&&Yl(k<ee?S:A,k,U,ee,k<ee?A:S,k,w.x,w.y)&&(F=Math.abs(k-w.y)/(S-w.x),ec(w,d)&&(F<K||F===K&&(w.x>y.x||w.x===y.x&&_x(y,w)))&&(y=w,K=F)),w=w.next;while(w!==N);return y}(r,e);if(!i)return e;var a=bg(i,r);return bl(a,a.next),bl(i,i.next)}function _x(r,e){return tr(r.prev,r,e.prev)<0&&tr(e.next,r,r.next)<0}function ap(r,e,i,a,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vx(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Yl(r,e,i,a,d,f,y,w){return(d-y)*(e-w)>=(r-y)*(f-w)&&(r-y)*(a-w)>=(i-y)*(e-w)&&(i-y)*(f-w)>=(d-y)*(a-w)}function xx(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,a){var d=i;do{if(d.i!==i.i&&d.next.i!==i.i&&d.i!==a.i&&d.next.i!==a.i&&wg(d,d.next,i,a))return!0;d=d.next}while(d!==i);return!1}(r,e)&&(ec(r,e)&&ec(e,r)&&function(i,a){var d=i,f=!1,y=(i.x+a.x)/2,w=(i.y+a.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&y<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(f=!f),d=d.next;while(d!==i);return f}(r,e)&&(tr(r.prev,r,e.prev)||tr(r,e.prev,e))||vh(r,e)&&tr(r.prev,r,r.next)>0&&tr(e.prev,e,e.next)>0)}function tr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function vh(r,e){return r.x===e.x&&r.y===e.y}function wg(r,e,i,a){var d=wh(tr(r,e,i)),f=wh(tr(r,e,a)),y=wh(tr(i,a,r)),w=wh(tr(i,a,e));return d!==f&&y!==w||!(d!==0||!xh(r,i,e))||!(f!==0||!xh(r,a,e))||!(y!==0||!xh(i,r,a))||!(w!==0||!xh(i,e,a))}function xh(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function wh(r){return r>0?1:r<0?-1:0}function ec(r,e){return tr(r.prev,r,r.next)<0?tr(r,e,r.next)>=0&&tr(r,r.prev,e)>=0:tr(r,e,r.prev)<0||tr(r,r.next,e)<0}function bg(r,e){var i=new lp(r.i,r.x,r.y),a=new lp(e.i,e.x,e.y),d=r.next,f=e.prev;return r.next=e,e.prev=r,i.next=d,d.prev=i,a.next=i,i.prev=a,f.next=a,a.prev=f,a}function Sg(r,e,i,a){var d=new lp(r,e,i);return a?(d.next=a.next,d.prev=a,a.next.prev=d,a.next=d):(d.prev=d,d.next=d),d}function tc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function lp(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function up(r,e,i,a){for(var d=0,f=e,y=i-a;f<i;f+=a)d+=(r[y]-r[f])*(r[f+1]+r[y+1]),y=f;return d}function wx(r,e,i,a,d){Eg(r,e,i||0,a||r.length-1,d||bx)}function Eg(r,e,i,a,d){for(;a>i;){if(a-i>600){var f=a-i+1,y=e-i+1,w=Math.log(f),S=.5*Math.exp(2*w/3),k=.5*Math.sqrt(w*S*(f-S)/f)*(y-f/2<0?-1:1);Eg(r,e,Math.max(i,Math.floor(e-y*S/f+k)),Math.min(a,Math.floor(e+(f-y)*S/f+k)),d)}var A=r[e],L=i,F=a;for(nc(r,i,e),d(r[a],A)>0&&nc(r,i,a);L<F;){for(nc(r,L,F),L++,F--;d(r[L],A)<0;)L++;for(;d(r[F],A)>0;)F--}d(r[i],A)===0?nc(r,i,F):nc(r,++F,a),F<=e&&(i=F+1),e<=F&&(a=F-1)}}function nc(r,e,i){var a=r[e];r[e]=r[i],r[i]=a}function bx(r,e){return r<e?-1:r>e?1:0}function cp(r,e){const i=r.length;if(i<=1)return[r];const a=[];let d,f;for(let y=0;y<i;y++){const w=yt(r[y]);w!==0&&(r[y].area=Math.abs(w),f===void 0&&(f=w<0),f===w<0?(d&&a.push(d),d=[r[y]]):d.push(r[y]))}if(d&&a.push(d),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(wx(a[y],e,1,a[y].length-1,Sx),a[y]=a[y].slice(0,e));return a}function Sx(r,e){return e.area-r.area}function hp(r,e,i){const a=i.patternDependencies;let d=!1;for(const f of e){const y=f.paint.get(`${r}-pattern`);y.isConstant()||(d=!0);const w=y.constantOr(null);w&&(d=!0,a[w.to]=!0,a[w.from]=!0)}return d}function dp(r,e,i,a,d){const f=d.patternDependencies;for(const y of e){const w=y.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let S=w.evaluate({zoom:a-1},i,{},d.availableImages),k=w.evaluate({zoom:a},i,{},d.availableImages),A=w.evaluate({zoom:a+1},i,{},d.availableImages);S=S&&S.name?S.name:S,k=k&&k.name?k.name:k,A=A&&A.name?A.name:A,f[S]=!0,f[k]=!0,f[A]=!0,i.patterns[y.id]={min:S,mid:k,max:A}}}return i}yh.exports=_h,yh.exports.default=_h,_h.deviation=function(r,e,i,a){var d=e&&e.length,f=Math.abs(up(r,0,d?e[0]*i:r.length,i));if(d)for(var y=0,w=e.length;y<w;y++)f-=Math.abs(up(r,e[y]*i,y<w-1?e[y+1]*i:r.length,i));var S=0;for(y=0;y<a.length;y+=3){var k=a[y]*i,A=a[y+1]*i,L=a[y+2]*i;S+=Math.abs((r[k]-r[L])*(r[A+1]-r[k+1])-(r[k]-r[A])*(r[L+1]-r[k+1]))}return f===0&&S===0?0:Math.abs((S-f)/f)},_h.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,d=0;d<r.length;d++){for(var f=0;f<r[d].length;f++)for(var y=0;y<e;y++)i.vertices.push(r[d][f][y]);d>0&&i.holes.push(a+=r[d-1].length)}return i};class pp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _n,this.indexArray=new xi,this.indexArray2=new Qo,this.programConfigurations=new vl(e.layers,e.zoom),this.segments=new qt,this.segments2=new qt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){this.hasPattern=hp("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),f=!d.isConstant(),y=[];for(const{feature:w,id:S,index:k,sourceLayerIndex:A}of e){const L=this.layers[0]._featureFilter.needGeometry,F=wl(w,L);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),F,a))continue;const N=f?d.evaluate(F,{},a,i.availableImages):void 0,U={id:S,properties:w.properties,type:w.type,sourceLayerIndex:A,index:k,geometry:L?F.geometry:xl(w),patterns:{},sortKey:N};y.push(U)}f&&y.sort((w,S)=>w.sortKey-S.sortKey);for(const w of y){const{geometry:S,index:k,sourceLayerIndex:A}=w;if(this.hasPattern){const L=dp("fill",this.layers,w,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(w,S,k,a,{});i.featureIndex.insert(e[k].feature,S,k,A,this.index)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}addFeatures(e,i,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,d,f){for(const y of cp(i,500)){let w=0;for(const N of y)w+=N.length;const S=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),k=S.vertexLength,A=[],L=[];for(const N of y){if(N.length===0)continue;N!==y[0]&&L.push(A.length/2);const U=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),ee=U.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(ee+N.length-1,ee),A.push(N[0].x),A.push(N[0].y);for(let K=1;K<N.length;K++)this.layoutVertexArray.emplaceBack(N[K].x,N[K].y),this.indexArray2.emplaceBack(ee+K-1,ee+K),A.push(N[K].x),A.push(N[K].y);U.vertexLength+=N.length,U.primitiveLength+=N.length}const F=yh.exports(A,L);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(k+F[N],k+F[N+1],k+F[N+2]);S.vertexLength+=w,S.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,d)}}rt("FillBucket",pp,{omit:["layers","patternFeatures"]});const Ex=new Fr({"fill-sort-key":new Mt(Ie.layout_fill["fill-sort-key"])});var Tx={paint:new Fr({"fill-antialias":new _t(Ie.paint_fill["fill-antialias"]),"fill-opacity":new Mt(Ie.paint_fill["fill-opacity"]),"fill-color":new Mt(Ie.paint_fill["fill-color"]),"fill-outline-color":new Mt(Ie.paint_fill["fill-outline-color"]),"fill-translate":new _t(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ta(Ie.paint_fill["fill-pattern"])}),layout:Ex};const Cx=sr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),kx=sr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ix}=Cx;var Ia={},Mx=It,Tg=Ql;function Ql(r,e,i,a,d){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=d,r.readFields(Px,this,e)}function Px(r,e,i){r==1?e.id=i.readVarint():r==2?function(a,d){for(var f=a.readVarint()+a.pos;a.pos<f;){var y=d._keys[a.readVarint()],w=d._values[a.readVarint()];d.properties[y]=w}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function Ax(r){for(var e,i,a=0,d=0,f=r.length,y=f-1;d<f;y=d++)a+=((i=r[y]).x-(e=r[d]).x)*(e.y+i.y);return a}Ql.types=["Unknown","Point","LineString","Polygon"],Ql.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,a=1,d=0,f=0,y=0,w=[];r.pos<i;){if(d<=0){var S=r.readVarint();a=7&S,d=S>>3}if(d--,a===1||a===2)f+=r.readSVarint(),y+=r.readSVarint(),a===1&&(e&&w.push(e),e=[]),e.push(new Mx(f,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&w.push(e),w},Ql.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,a=0,d=0,f=0,y=1/0,w=-1/0,S=1/0,k=-1/0;r.pos<e;){if(a<=0){var A=r.readVarint();i=7&A,a=A>>3}if(a--,i===1||i===2)(d+=r.readSVarint())<y&&(y=d),d>w&&(w=d),(f+=r.readSVarint())<S&&(S=f),f>k&&(k=f);else if(i!==7)throw new Error("unknown command "+i)}return[y,S,w,k]},Ql.prototype.toGeoJSON=function(r,e,i){var a,d,f=this.extent*Math.pow(2,i),y=this.extent*r,w=this.extent*e,S=this.loadGeometry(),k=Ql.types[this.type];function A(N){for(var U=0;U<N.length;U++){var ee=N[U];N[U]=[360*(ee.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+w)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(a=0;a<S.length;a++)L[a]=S[a][0];A(S=L);break;case 2:for(a=0;a<S.length;a++)A(S[a]);break;case 3:for(S=function(N){var U=N.length;if(U<=1)return[N];for(var ee,K,de=[],Se=0;Se<U;Se++){var ue=Ax(N[Se]);ue!==0&&(K===void 0&&(K=ue<0),K===ue<0?(ee&&de.push(ee),ee=[N[Se]]):ee.push(N[Se]))}return ee&&de.push(ee),de}(S),a=0;a<S.length;a++)for(d=0;d<S[a].length;d++)A(S[a][d])}S.length===1?S=S[0]:k="Multi"+k;var F={type:"Feature",geometry:{type:k,coordinates:S},properties:this.properties};return"id"in this&&(F.id=this.id),F};var zx=Tg,Cg=kg;function kg(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Lx,this,e),this.length=this._features.length}function Lx(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(a){for(var d=null,f=a.readVarint()+a.pos;a.pos<f;){var y=a.readVarint()>>3;d=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return d}(i))}kg.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new zx(this._pbf,e,this.extent,this._keys,this._values)};var Dx=Cg;function Rx(r,e,i){if(r===3){var a=new Dx(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}Ia.VectorTile=function(r,e){this.layers=r.readFields(Rx,{},e)},Ia.VectorTileFeature=Tg,Ia.VectorTileLayer=Cg;const Fx=Ia.VectorTileFeature.types,fp=Math.pow(2,13);function rc(r,e,i,a,d,f,y,w){r.emplaceBack(e,i,2*Math.floor(a*fp)+y,d*fp*2,f*fp*2,Math.round(w))}class mp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new tn,this.centroidVertexArray=new St,this.indexArray=new xi,this.programConfigurations=new vl(e.layers,e.zoom),this.segments=new qt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){this.features=[],this.hasPattern=hp("fill-extrusion",this.layers,i);for(const{feature:d,id:f,index:y,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,k=wl(d,S);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),k,a))continue;const A={id:f,sourceLayerIndex:w,index:y,geometry:S?k.geometry:xl(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(dp("fill-extrusion",this.layers,A,this.zoom,i)):this.addFeature(A,A.geometry,y,a,{}),i.featureIndex.insert(d,A.geometry,y,w,this.index,!0)}}addFeatures(e,i,a){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,i,a)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ix),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,kx.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,a,d,f){const y={x:0,y:0,vertexCount:0};for(const w of cp(i,500)){let S=0;for(const U of w)S+=U.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of w){if(U.length===0||Ox(U))continue;let ee=0;for(let K=0;K<U.length;K++){const de=U[K];if(K>=1){const Se=U[K-1];if(!Bx(de,Se)){k.vertexLength+4>qt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ue=de.sub(Se)._perp()._unit(),xe=Se.dist(de);ee+xe>32768&&(ee=0),rc(this.layoutVertexArray,de.x,de.y,ue.x,ue.y,0,0,ee),rc(this.layoutVertexArray,de.x,de.y,ue.x,ue.y,0,1,ee),y.x+=2*de.x,y.y+=2*de.y,y.vertexCount+=2,ee+=xe,rc(this.layoutVertexArray,Se.x,Se.y,ue.x,ue.y,0,0,ee),rc(this.layoutVertexArray,Se.x,Se.y,ue.x,ue.y,0,1,ee),y.x+=2*Se.x,y.y+=2*Se.y,y.vertexCount+=2;const Le=k.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+S>qt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),Fx[e.type]!=="Polygon")continue;const A=[],L=[],F=k.vertexLength;for(const U of w)if(U.length!==0){U!==w[0]&&L.push(A.length/2);for(let ee=0;ee<U.length;ee++){const K=U[ee];rc(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),y.x+=K.x,y.y+=K.y,y.vertexCount+=1,A.push(K.x),A.push(K.y)}}const N=yh.exports(A,L);for(let U=0;U<N.length;U+=3)this.indexArray.emplaceBack(F+N[U],F+N[U+2],F+N[U+1]);k.primitiveLength+=N.length/3,k.vertexLength+=S}for(let w=0;w<y.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,d)}}function Bx(r,e){return r.x===e.x&&(r.x<0||r.x>mr)||r.y===e.y&&(r.y<0||r.y>mr)}function Ox(r){return r.every(e=>e.x<0)||r.every(e=>e.x>mr)||r.every(e=>e.y<0)||r.every(e=>e.y>mr)}rt("FillExtrusionBucket",mp,{omit:["layers","features"]});var Nx={paint:new Fr({"fill-extrusion-opacity":new _t(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mt(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ta(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mt(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mt(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ic(r,e){return r.x*e.x+r.y*e.y}function Ig(r,e){if(r.length===1){let i=0;const a=e[i++];let d;for(;!d||a.equals(d);)if(d=e[i++],!d)return 1/0;for(;i<e.length;i++){const f=e[i],y=r[0],w=d.sub(a),S=f.sub(a),k=y.sub(a),A=ic(w,w),L=ic(w,S),F=ic(S,S),N=ic(k,w),U=ic(k,S),ee=A*F-L*L,K=(F*N-L*U)/ee,de=(A*U-L*N)/ee,Se=a.z*(1-K-de)+d.z*K+f.z*de;if(isFinite(Se))return Se}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}const Ux=sr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Vx}=Ux,jx=sr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$x}=jx,Gx=Ia.VectorTileFeature.types,Zx=Math.cos(Math.PI/180*37.5),Mg=Math.pow(2,14)/.5;class gp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nn,this.layoutVertexArray2=new wn,this.indexArray=new xi,this.programConfigurations=new vl(e.layers,e.zoom),this.segments=new qt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){this.hasPattern=hp("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),f=!d.isConstant(),y=[];for(const{feature:w,id:S,index:k,sourceLayerIndex:A}of e){const L=this.layers[0]._featureFilter.needGeometry,F=wl(w,L);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),F,a))continue;const N=f?d.evaluate(F,{},a):void 0,U={id:S,properties:w.properties,type:w.type,sourceLayerIndex:A,index:k,geometry:L?F.geometry:xl(w),patterns:{},sortKey:N};y.push(U)}f&&y.sort((w,S)=>w.sortKey-S.sortKey);for(const w of y){const{geometry:S,index:k,sourceLayerIndex:A}=w;if(this.hasPattern){const L=dp("line",this.layers,w,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(w,S,k,a,{});i.featureIndex.insert(e[k].feature,S,k,A,this.index)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}addFeatures(e,i,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,$x)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,d,f){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),S=y.get("line-cap"),k=y.get("line-miter-limit"),A=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of i)this.addLine(L,e,w,S,k,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,d)}addLine(e,i,a,d,f,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<e.length-1;de++)this.totalDistance+=e[de].dist(e[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=Gx[i.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let k=0;for(;k<S-1&&e[k].equals(e[k+1]);)k++;if(S<(w?3:2))return;a==="bevel"&&(f=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let F,N,U,ee,K;this.e1=this.e2=-1,w&&(F=e[S-2],K=e[k].sub(F)._unit()._perp());for(let de=k;de<S;de++){if(U=de===S-1?w?e[k+1]:void 0:e[de+1],U&&e[de].equals(U))continue;K&&(ee=K),F&&(N=F),F=e[de],K=U?U.sub(F)._unit()._perp():ee,ee=ee||K;let Se=ee.add(K);Se.x===0&&Se.y===0||Se._unit();const ue=ee.x*K.x+ee.y*K.y,xe=Se.x*K.x+Se.y*K.y,Le=xe!==0?1/xe:1/0,ze=2*Math.sqrt(2-2*xe),ht=xe<Zx&&N&&U,gt=ee.x*K.y-ee.y*K.x>0;if(ht&&de>k){const qe=F.dist(N);if(qe>2*A){const ot=F.sub(F.sub(N)._mult(A/qe)._round());this.updateDistance(N,ot),this.addCurrentVertex(ot,ee,0,0,L),N=ot}}const it=N&&U;let Qe=it?a:w?"butt":d;if(it&&Qe==="round"&&(Le<y?Qe="miter":Le<=2&&(Qe="fakeround")),Qe==="miter"&&Le>f&&(Qe="bevel"),Qe==="bevel"&&(Le>2&&(Qe="flipbevel"),Le<f&&(Qe="miter")),N&&this.updateDistance(N,F),Qe==="miter")Se._mult(Le),this.addCurrentVertex(F,Se,0,0,L);else if(Qe==="flipbevel"){if(Le>100)Se=K.mult(-1);else{const qe=Le*ee.add(K).mag()/ee.sub(K).mag();Se._perp()._mult(qe*(gt?-1:1))}this.addCurrentVertex(F,Se,0,0,L),this.addCurrentVertex(F,Se.mult(-1),0,0,L)}else if(Qe==="bevel"||Qe==="fakeround"){const qe=-Math.sqrt(Le*Le-1),ot=gt?qe:0,nt=gt?0:qe;if(N&&this.addCurrentVertex(F,ee,ot,nt,L),Qe==="fakeround"){const Ve=Math.round(180*ze/Math.PI/20);for(let Et=1;Et<Ve;Et++){let vt=Et/Ve;if(vt!==.5){const An=vt-.5;vt+=vt*An*(vt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*An*An+(.848013+ue*(.215638*ue-1.06021)))}const $t=K.sub(ee)._mult(vt)._add(ee)._unit()._mult(gt?-1:1);this.addHalfVertex(F,$t.x,$t.y,!1,gt,0,L)}}U&&this.addCurrentVertex(F,K,-ot,-nt,L)}else if(Qe==="butt")this.addCurrentVertex(F,Se,0,0,L);else if(Qe==="square"){const qe=N?1:-1;this.addCurrentVertex(F,Se,qe,qe,L)}else Qe==="round"&&(N&&(this.addCurrentVertex(F,ee,0,0,L),this.addCurrentVertex(F,ee,1,1,L,!0)),U&&(this.addCurrentVertex(F,K,-1,-1,L,!0),this.addCurrentVertex(F,K,0,0,L)));if(ht&&de<S-1){const qe=F.dist(U);if(qe>2*A){const ot=F.add(U.sub(F)._mult(A/qe)._round());this.updateDistance(F,ot),this.addCurrentVertex(ot,K,0,0,L),F=ot}}}}addCurrentVertex(e,i,a,d,f,y=!1){const w=i.y*d-i.x,S=-i.y-i.x*d;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,y,!1,a,f),this.addHalfVertex(e,w,S,y,!0,-d,f),this.distance>Mg/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,i,a,d,f,y))}addHalfVertex({x:e,y:i},a,d,f,y,w,S){const k=.5*(this.lineClips?this.scaledDistance*(Mg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),S.primitiveLength++),y?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}rt("LineBucket",gp,{omit:["layers","patternFeatures"]});const qx=new Fr({"line-cap":new _t(Ie.layout_line["line-cap"]),"line-join":new Mt(Ie.layout_line["line-join"]),"line-miter-limit":new _t(Ie.layout_line["line-miter-limit"]),"line-round-limit":new _t(Ie.layout_line["line-round-limit"]),"line-sort-key":new Mt(Ie.layout_line["line-sort-key"])});var Pg={paint:new Fr({"line-opacity":new Mt(Ie.paint_line["line-opacity"]),"line-color":new Mt(Ie.paint_line["line-color"]),"line-translate":new _t(Ie.paint_line["line-translate"]),"line-translate-anchor":new _t(Ie.paint_line["line-translate-anchor"]),"line-width":new Mt(Ie.paint_line["line-width"]),"line-gap-width":new Mt(Ie.paint_line["line-gap-width"]),"line-offset":new Mt(Ie.paint_line["line-offset"]),"line-blur":new Mt(Ie.paint_line["line-blur"]),"line-dasharray":new Zu(Ie.paint_line["line-dasharray"]),"line-pattern":new Ta(Ie.paint_line["line-pattern"]),"line-gradient":new Ts(Ie.paint_line["line-gradient"])}),layout:qx};const Ag=new class extends Mt{possiblyEvaluate(r,e){return e=new Fn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,i,a){return e=Xe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,i,a)}}(Pg.paint.properties["line-width"].specification);function zg(r,e){return e>0?e+2*r:r}Ag.useIntegerZoom=!0;const Wx=sr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xx=sr([{name:"a_projected_pos",components:3,type:"Float32"}],4);sr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hx=sr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);sr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Lg=sr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Kx=sr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Jx(r,e,i){return r.sections.forEach(a=>{a.text=function(d,f,y){const w=f.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),Hi.applyArabicShaping&&(d=Hi.applyArabicShaping(d)),d}(a.text,e,i)}),r}sr([{name:"triangle",components:3,type:"Uint16"}]),sr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),sr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),sr([{type:"Float32",name:"offsetX"}]),sr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const oc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Br=24,yp=Sn,Dg=function(r,e,i,a,d){var f,y,w=8*d-a-1,S=(1<<w)-1,k=S>>1,A=-7,L=i?d-1:0,F=i?-1:1,N=r[e+L];for(L+=F,f=N&(1<<-A)-1,N>>=-A,A+=w;A>0;f=256*f+r[e+L],L+=F,A-=8);for(y=f&(1<<-A)-1,f>>=-A,A+=a;A>0;y=256*y+r[e+L],L+=F,A-=8);if(f===0)f=1-k;else{if(f===S)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,a),f-=k}return(N?-1:1)*y*Math.pow(2,f-a)},Rg=function(r,e,i,a,d,f){var y,w,S,k=8*f-d-1,A=(1<<k)-1,L=A>>1,F=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=a?0:f-1,U=a?1:-1,ee=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,y=A):(y=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-y))<1&&(y--,S*=2),(e+=y+L>=1?F/S:F*Math.pow(2,1-L))*S>=2&&(y++,S/=2),y+L>=A?(w=0,y=A):y+L>=1?(w=(e*S-1)*Math.pow(2,d),y+=L):(w=e*Math.pow(2,L-1)*Math.pow(2,d),y=0));d>=8;r[i+N]=255&w,N+=U,w/=256,d-=8);for(y=y<<d|w,k+=d;k>0;r[i+N]=255&y,N+=U,y/=256,k-=8);r[i+N-U]|=128*ee};function Sn(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Sn.Varint=0,Sn.Fixed64=1,Sn.Bytes=2,Sn.Fixed32=5;var Ma,_p=4294967296,Fg=1/_p,Bg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Js(r){return r.type===Sn.Bytes?r.readVarint()+r.pos:r.pos+1}function eu(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Og(r,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var d=i.pos-1;d>=r;d--)i.buf[d+a]=i.buf[d]}function Yx(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function Qx(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function e1(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function t1(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function n1(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function r1(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function i1(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function o1(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function s1(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function bh(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function tu(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function Ng(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function a1(r,e,i){r===1&&i.readMessage(l1,e)}function l1(r,e,i){if(r===3){const{id:a,bitmap:d,width:f,height:y,left:w,top:S,advance:k}=i.readMessage(u1,{});e.push({id:a,bitmap:new Yu({width:f+6,height:y+6},d),metrics:{width:f,height:y,left:w,top:S,advance:k}})}}function u1(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}function Ug(r){let e=0,i=0;for(const y of r)e+=y.w*y.h,i=Math.max(i,y.w);r.sort((y,w)=>w.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let d=0,f=0;for(const y of r)for(let w=a.length-1;w>=0;w--){const S=a[w];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,f=Math.max(f,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===S.w&&y.h===S.h){const k=a.pop();w<a.length&&(a[w]=k)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:d,h:f,fill:e/(d*f)||0}}Sn.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),d=a>>3,f=this.pos;this.type=7&a,r(d,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=bh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Ng(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=bh(this.buf,this.pos)+bh(this.buf,this.pos+4)*_p;return this.pos+=8,r},readSFixed64:function(){var r=bh(this.buf,this.pos)+Ng(this.buf,this.pos+4)*_p;return this.pos+=8,r},readFloat:function(){var r=Dg(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Dg(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(d,f,y){var w,S,k=y.buf;if(w=(112&(S=k[y.pos++]))>>4,S<128||(w|=(127&(S=k[y.pos++]))<<3,S<128)||(w|=(127&(S=k[y.pos++]))<<10,S<128)||(w|=(127&(S=k[y.pos++]))<<17,S<128)||(w|=(127&(S=k[y.pos++]))<<24,S<128)||(w|=(1&(S=k[y.pos++]))<<31,S<128))return eu(d,w,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Bg?function(i,a,d){return Bg.decode(i.subarray(a,d))}(this.buf,e,r):function(i,a,d){for(var f="",y=a;y<d;){var w,S,k,A=i[y],L=null,F=A>239?4:A>223?3:A>191?2:1;if(y+F>d)break;F===1?A<128&&(L=A):F===2?(192&(w=i[y+1]))==128&&(L=(31&A)<<6|63&w)<=127&&(L=null):F===3?(S=i[y+2],(192&(w=i[y+1]))==128&&(192&S)==128&&((L=(15&A)<<12|(63&w)<<6|63&S)<=2047||L>=55296&&L<=57343)&&(L=null)):F===4&&(S=i[y+2],k=i[y+3],(192&(w=i[y+1]))==128&&(192&S)==128&&(192&k)==128&&((L=(15&A)<<18|(63&w)<<12|(63&S)<<6|63&k)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,F=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),y+=F}return f}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Sn.Bytes)return r.push(this.readVarint(e));var i=Js(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Sn.Bytes)return r.push(this.readSVarint());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Sn.Bytes)return r.push(this.readBoolean());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Sn.Bytes)return r.push(this.readFloat());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Sn.Bytes)return r.push(this.readDouble());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Sn.Bytes)return r.push(this.readFixed32());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Sn.Bytes)return r.push(this.readSFixed32());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Sn.Bytes)return r.push(this.readFixed64());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Sn.Bytes)return r.push(this.readSFixed64());var e=Js(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Sn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Sn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Sn.Fixed32)this.pos+=4;else{if(e!==Sn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),tu(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),tu(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),tu(this.buf,-1&r,this.pos),tu(this.buf,Math.floor(r*Fg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),tu(this.buf,-1&r,this.pos),tu(this.buf,Math.floor(r*Fg),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var a,d;if(e>=0?(a=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,y,w){w.buf[w.pos++]=127&f|128,f>>>=7,w.buf[w.pos++]=127&f|128,f>>>=7,w.buf[w.pos++]=127&f|128,f>>>=7,w.buf[w.pos++]=127&f|128,w.buf[w.pos]=127&(f>>>=7)}(a,0,i),function(f,y){var w=(7&f)<<4;y.buf[y.pos++]|=w|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))}(d,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,d,f){for(var y,w,S=0;S<d.length;S++){if((y=d.charCodeAt(S))>55295&&y<57344){if(!w){y>56319||S+1===d.length?(a[f++]=239,a[f++]=191,a[f++]=189):w=y;continue}if(y<56320){a[f++]=239,a[f++]=191,a[f++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(a[f++]=239,a[f++]=191,a[f++]=189,w=null);y<128?a[f++]=y:(y<2048?a[f++]=y>>6|192:(y<65536?a[f++]=y>>12|224:(a[f++]=y>>18|240,a[f++]=y>>12&63|128),a[f++]=y>>6&63|128),a[f++]=63&y|128)}return f}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&Og(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),Rg(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Rg(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var a=this.pos-i;a>=128&&Og(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,i){this.writeTag(r,Sn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Yx,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Qx,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,n1,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,e1,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,t1,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,r1,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,i1,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,o1,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,s1,e)},writeBytesField:function(r,e){this.writeTag(r,Sn.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Sn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Sn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Sn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Sn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Sn.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Sn.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Sn.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Sn.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Sn.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class vp{constructor(e,{pixelRatio:i,version:a,stretchX:d,stretchY:f,content:y}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=d,this.stretchY=f,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Vg{constructor(e,i){const a={},d={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(i,d,f);const{w:y,h:w}=Ug(f),S=new yo({width:y||1,height:w||1});for(const k in e){const A=e[k],L=a[k].paddedRect;yo.copy(A.data,S,{x:0,y:0},{x:L.x+1,y:L.y+1},A.data)}for(const k in i){const A=i[k],L=d[k].paddedRect,F=L.x+1,N=L.y+1,U=A.data.width,ee=A.data.height;yo.copy(A.data,S,{x:0,y:0},{x:F,y:N},A.data),yo.copy(A.data,S,{x:0,y:ee-1},{x:F,y:N-1},{width:U,height:1}),yo.copy(A.data,S,{x:0,y:0},{x:F,y:N+ee},{width:U,height:1}),yo.copy(A.data,S,{x:U-1,y:0},{x:F-1,y:N},{width:1,height:ee}),yo.copy(A.data,S,{x:0,y:0},{x:F+U,y:N},{width:1,height:ee})}this.image=S,this.iconPositions=a,this.patternPositions=d}addImages(e,i,a){for(const d in e){const f=e[d],y={x:0,y:0,w:f.data.width+2,h:f.data.height+2};a.push(y),i[d]=new vp(y,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[d,f]=e.tl;a.update(i.data,void 0,{x:d,y:f})}}rt("ImagePosition",vp),rt("ImageAtlas",Vg),l.WritingMode=void 0,(Ma=l.WritingMode||(l.WritingMode={}))[Ma.none=0]="none",Ma[Ma.horizontal=1]="horizontal",Ma[Ma.vertical=2]="vertical",Ma[Ma.horizontalOnly=3]="horizontalOnly";const Sh=-17;class sc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new sc;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new sc;return i.imageName=e,i}}class nu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new nu;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?a.addImageSection(f):a.addTextSection(f,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let i="";for(let a=0;a<e.length;a++){const d=e.charCodeAt(a+1)||null,f=e.charCodeAt(a-1)||null;i+=d&&rh(d)&&!oc[e[a+1]]||f&&rh(f)&&!oc[e[a-1]]||!oc[e[a]]?e[a]:oc[e[a]]}return i}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&Th[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Th[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new nu;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(sc.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Ge("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(sc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ge("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Eh(r,e,i,a,d,f,y,w,S,k,A,L,F,N,U,ee){const K=nu.fromFeature(r,d);let de;L===l.WritingMode.vertical&&K.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:ue}=Hi;if(Se&&K.sections.length===1){de=[];const ze=Se(K.toString(),xp(K,k,f,e,a,N,U));for(const ht of ze){const gt=new nu;gt.text=ht,gt.sections=K.sections;for(let it=0;it<ht.length;it++)gt.sectionIndex.push(0);de.push(gt)}}else if(ue){de=[];const ze=ue(K.text,K.sectionIndex,xp(K,k,f,e,a,N,U));for(const ht of ze){const gt=new nu;gt.text=ht[0],gt.sectionIndex=ht[1],gt.sections=K.sections,de.push(gt)}}else de=function(ze,ht){const gt=[],it=ze.text;let Qe=0;for(const qe of ht)gt.push(ze.substring(Qe,qe)),Qe=qe;return Qe<it.length&&gt.push(ze.substring(Qe,it.length)),gt}(K,xp(K,k,f,e,a,N,U));const xe=[],Le={positionedLines:xe,text:K.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(ze,ht,gt,it,Qe,qe,ot,nt,Ve,Et,vt,$t){let An=0,On=Sh,gr=0,vo=0;const Xr=nt==="right"?1:nt==="left"?0:.5;let ar=0;for(const lr of Qe){lr.trim();const Kr=lr.getMaxScale(),ui=(Kr-1)*Br,Si={positionedGlyphs:[],lineOffset:0};ze.positionedLines[ar]=Si;const Li=Si.positionedGlyphs;let Di=0;if(!lr.length()){On+=qe,++ar;continue}for(let Ir=0;Ir<lr.length();Ir++){const Ht=lr.getSection(Ir),Yi=lr.getSectionIndex(Ir),Jr=lr.getCharCode(Ir);let ci=0,No=null,ts=null,ns=null,Qs=Br;const Uo=!(Ve===l.WritingMode.horizontal||!vt&&!Nu(Jr)||vt&&(Th[Jr]||(kr=Jr,Je.Arabic(kr)||Je["Arabic Supplement"](kr)||Je["Arabic Extended-A"](kr)||Je["Arabic Presentation Forms-A"](kr)||Je["Arabic Presentation Forms-B"](kr))));if(Ht.imageName){const xo=it[Ht.imageName];if(!xo)continue;ns=Ht.imageName,ze.iconsInText=ze.iconsInText||!0,ts=xo.paddedRect;const Ri=xo.displaySize;Ht.scale=Ht.scale*Br/$t,No={width:Ri[0],height:Ri[1],left:1,top:-3,advance:Uo?Ri[1]:Ri[0]},ci=ui+(Br-Ri[1]*Ht.scale),Qs=No.advance;const ea=Uo?Ri[0]*Ht.scale-Br*Kr:Ri[1]*Ht.scale-Br*Kr;ea>0&&ea>Di&&(Di=ea)}else{const xo=gt[Ht.fontStack],Ri=xo&&xo[Jr];if(Ri&&Ri.rect)ts=Ri.rect,No=Ri.metrics;else{const ea=ht[Ht.fontStack],uc=ea&&ea[Jr];if(!uc)continue;No=uc.metrics}ci=(Kr-Ht.scale)*Br}Uo?(ze.verticalizable=!0,Li.push({glyph:Jr,imageName:ns,x:An,y:On+ci,vertical:Uo,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:Yi,metrics:No,rect:ts}),An+=Qs*Ht.scale+Et):(Li.push({glyph:Jr,imageName:ns,x:An,y:On+ci,vertical:Uo,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:Yi,metrics:No,rect:ts}),An+=No.advance*Ht.scale+Et)}Li.length!==0&&(gr=Math.max(An-Et,gr),d1(Li,0,Li.length-1,Xr,Di)),An=0;const Vn=qe*Kr+Di;Si.lineOffset=Math.max(Di,ui),On+=Vn,vo=Math.max(Vn,vo),++ar}var kr;const Hr=On-Sh,{horizontalAlign:li,verticalAlign:zi}=wp(ot);(function(lr,Kr,ui,Si,Li,Di,Vn,Ir,Ht){const Yi=(Kr-ui)*Li;let Jr=0;Jr=Di!==Vn?-Ir*Si-Sh:(-Si*Ht+.5)*Vn;for(const ci of lr)for(const No of ci.positionedGlyphs)No.x+=Yi,No.y+=Jr})(ze.positionedLines,Xr,li,zi,gr,vo,qe,Hr,Qe.length),ze.top+=-zi*Hr,ze.bottom=ze.top+Hr,ze.left+=-li*gr,ze.right=ze.left+gr}(Le,e,i,a,de,y,w,S,L,k,F,ee),!function(ze){for(const ht of ze)if(ht.positionedGlyphs.length!==0)return!1;return!0}(xe)&&Le}const Th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},c1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jg(r,e,i,a,d,f){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*Br/f+d:0}{const y=i[e.fontStack],w=y&&y[r];return w?w.metrics.advance*e.scale+d:0}}function $g(r,e,i,a){const d=Math.pow(r-e,2);return a?r<e?d/2:2*d:d+Math.abs(i)*i}function h1(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Gg(r,e,i,a,d,f){let y=null,w=$g(e,i,d,f);for(const S of a){const k=$g(e-S.x,i,d,f)+S.badness;k<=w&&(y=S,w=k)}return{index:r,x:e,priorBreak:y,badness:w}}function Zg(r){return r?Zg(r.priorBreak).concat(r.index):[]}function xp(r,e,i,a,d,f,y){if(f!=="point")return[];if(!r)return[];const w=[],S=function(F,N,U,ee,K,de){let Se=0;for(let ue=0;ue<F.length();ue++){const xe=F.getSection(ue);Se+=jg(F.getCharCode(ue),xe,ee,K,N,de)}return Se/Math.max(1,Math.ceil(Se/U))}(r,e,i,a,d,y),k=r.text.indexOf("​")>=0;let A=0;for(let F=0;F<r.length();F++){const N=r.getSection(F),U=r.getCharCode(F);if(Th[U]||(A+=jg(U,N,a,d,e,y)),F<r.length()-1){const ee=!((L=U)<11904||!(Je["Bopomofo Extended"](L)||Je.Bopomofo(L)||Je["CJK Compatibility Forms"](L)||Je["CJK Compatibility Ideographs"](L)||Je["CJK Compatibility"](L)||Je["CJK Radicals Supplement"](L)||Je["CJK Strokes"](L)||Je["CJK Symbols and Punctuation"](L)||Je["CJK Unified Ideographs Extension A"](L)||Je["CJK Unified Ideographs"](L)||Je["Enclosed CJK Letters and Months"](L)||Je["Halfwidth and Fullwidth Forms"](L)||Je.Hiragana(L)||Je["Ideographic Description Characters"](L)||Je["Kangxi Radicals"](L)||Je["Katakana Phonetic Extensions"](L)||Je.Katakana(L)||Je["Vertical Forms"](L)||Je["Yi Radicals"](L)||Je["Yi Syllables"](L)));(c1[U]||ee||N.imageName)&&w.push(Gg(F+1,A,S,w,h1(U,r.getCharCode(F+1),ee&&k),!1))}}var L;return Zg(Gg(r.length(),A,S,w,0,!0))}function wp(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function d1(r,e,i,a,d){if(!a&&!d)return;const f=r[i],y=(r[i].x+f.metrics.advance*f.scale)*a;for(let w=e;w<=i;w++)r[w].x-=y,r[w].y+=d}function p1(r,e,i){const{horizontalAlign:a,verticalAlign:d}=wp(i),f=e[0]-r.displaySize[0]*a,y=e[1]-r.displaySize[1]*d;return{image:r,top:y,bottom:y+r.displaySize[1],left:f,right:f+r.displaySize[0]}}function qg(r,e,i,a,d,f){const y=r.image;let w;if(y.content){const K=y.content,de=y.pixelRatio||1;w=[K[0]/de,K[1]/de,y.displaySize[0]-K[2]/de,y.displaySize[1]-K[3]/de]}const S=e.left*f,k=e.right*f;let A,L,F,N;i==="width"||i==="both"?(N=d[0]+S-a[3],L=d[0]+k+a[1]):(N=d[0]+(S+k-y.displaySize[0])/2,L=N+y.displaySize[0]);const U=e.top*f,ee=e.bottom*f;return i==="height"||i==="both"?(A=d[1]+U-a[0],F=d[1]+ee+a[2]):(A=d[1]+(U+ee-y.displaySize[1])/2,F=A+y.displaySize[1]),{image:y,top:A,right:L,bottom:F,left:N,collisionPadding:w}}const Ys=128;function Wg(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Fn(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:d}=i;let f=0;for(;f<a.length&&a[f]<=r;)f++;f=Math.max(0,f-1);let y=f;for(;y<a.length&&a[y]<r+1;)y++;y=Math.min(a.length-1,y);const w=a[f],S=a[y];return i.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:S,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:S,minSize:i.evaluate(new Fn(w)),maxSize:i.evaluate(new Fn(S)),interpolationType:d}}}class Pa extends It{constructor(e,i,a,d){super(e,i),this.angle=a,d!==void 0&&(this.segment=d)}clone(){return new Pa(this.x,this.y,this.angle,this.segment)}}function Xg(r,e,i,a,d){if(e.segment===void 0)return!0;let f=e,y=e.segment+1,w=0;for(;w>-i/2;){if(y--,y<0)return!1;w-=r[y].dist(f),f=r[y]}w+=r[y].dist(r[y+1]),y++;const S=[];let k=0;for(;w<i/2;){const A=r[y],L=r[y+1];if(!L)return!1;let F=r[y-1].angleTo(A)-A.angleTo(L);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:F}),k+=F;w-S[0].distance>a;)k-=S.shift().angleDelta;if(k>d)return!1;y++,w+=A.dist(L)}return!0}function Hg(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function Kg(r,e,i){return r?.6*e*i:0}function Jg(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function f1(r,e,i,a,d,f){const y=Kg(i,d,f),w=Jg(i,a)*f;let S=0;const k=Hg(r)/2;for(let A=0;A<r.length-1;A++){const L=r[A],F=r[A+1],N=L.dist(F);if(S+N>k){const U=(k-S)/N,ee=Ue(L.x,F.x,U),K=Ue(L.y,F.y,U),de=new Pa(ee,K,F.angleTo(L),A);return de._round(),!y||Xg(r,de,w,y,e)?de:void 0}S+=N}}function m1(r,e,i,a,d,f,y,w,S){const k=Kg(a,f,y),A=Jg(a,d),L=A*y,F=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return e-L<e/4&&(e=L+e/4),Yg(r,F?e/2*w%e:(A/2+2*f)*y*w%e,e,k,i,L,F,!1,S)}function Yg(r,e,i,a,d,f,y,w,S){const k=f/2,A=Hg(r);let L=0,F=e-i,N=[];for(let U=0;U<r.length-1;U++){const ee=r[U],K=r[U+1],de=ee.dist(K),Se=K.angleTo(ee);for(;F+i<L+de;){F+=i;const ue=(F-L)/de,xe=Ue(ee.x,K.x,ue),Le=Ue(ee.y,K.y,ue);if(xe>=0&&xe<S&&Le>=0&&Le<S&&F-k>=0&&F+k<=A){const ze=new Pa(xe,Le,Se,U);ze._round(),a&&!Xg(r,ze,f,a,d)||N.push(ze)}}L+=de}return w||N.length||y||(N=Yg(r,L/2,i,a,d,f,y,!0,S)),N}function Qg(r,e,i,a,d){const f=[];for(let y=0;y<r.length;y++){const w=r[y];let S;for(let k=0;k<w.length-1;k++){let A=w[k],L=w[k+1];A.x<e&&L.x<e||(A.x<e?A=new It(e,A.y+(e-A.x)/(L.x-A.x)*(L.y-A.y))._round():L.x<e&&(L=new It(e,A.y+(e-A.x)/(L.x-A.x)*(L.y-A.y))._round()),A.y<i&&L.y<i||(A.y<i?A=new It(A.x+(i-A.y)/(L.y-A.y)*(L.x-A.x),i)._round():L.y<i&&(L=new It(A.x+(i-A.y)/(L.y-A.y)*(L.x-A.x),i)._round()),A.x>=a&&L.x>=a||(A.x>=a?A=new It(a,A.y+(a-A.x)/(L.x-A.x)*(L.y-A.y))._round():L.x>=a&&(L=new It(a,A.y+(a-A.x)/(L.x-A.x)*(L.y-A.y))._round()),A.y>=d&&L.y>=d||(A.y>=d?A=new It(A.x+(d-A.y)/(L.y-A.y)*(L.x-A.x),d)._round():L.y>=d&&(L=new It(A.x+(d-A.y)/(L.y-A.y)*(L.x-A.x),d)._round()),S&&A.equals(S[S.length-1])||(S=[A],f.push(S)),S.push(L)))))}}return f}function ey(r,e,i,a){const d=[],f=r.image,y=f.pixelRatio,w=f.paddedRect.w-2,S=f.paddedRect.h-2,k=r.right-r.left,A=r.bottom-r.top,L=f.stretchX||[[0,w]],F=f.stretchY||[[0,S]],N=(qe,ot)=>qe+ot[1]-ot[0],U=L.reduce(N,0),ee=F.reduce(N,0),K=w-U,de=S-ee;let Se=0,ue=U,xe=0,Le=ee,ze=0,ht=K,gt=0,it=de;if(f.content&&a){const qe=f.content;Se=Ch(L,0,qe[0]),xe=Ch(F,0,qe[1]),ue=Ch(L,qe[0],qe[2]),Le=Ch(F,qe[1],qe[3]),ze=qe[0]-Se,gt=qe[1]-xe,ht=qe[2]-qe[0]-ue,it=qe[3]-qe[1]-Le}const Qe=(qe,ot,nt,Ve)=>{const Et=kh(qe.stretch-Se,ue,k,r.left),vt=Ih(qe.fixed-ze,ht,qe.stretch,U),$t=kh(ot.stretch-xe,Le,A,r.top),An=Ih(ot.fixed-gt,it,ot.stretch,ee),On=kh(nt.stretch-Se,ue,k,r.left),gr=Ih(nt.fixed-ze,ht,nt.stretch,U),vo=kh(Ve.stretch-xe,Le,A,r.top),Xr=Ih(Ve.fixed-gt,it,Ve.stretch,ee),ar=new It(Et,$t),kr=new It(On,$t),Hr=new It(On,vo),li=new It(Et,vo),zi=new It(vt/y,An/y),lr=new It(gr/y,Xr/y),Kr=e*Math.PI/180;if(Kr){const Li=Math.sin(Kr),Di=Math.cos(Kr),Vn=[Di,-Li,Li,Di];ar._matMult(Vn),kr._matMult(Vn),li._matMult(Vn),Hr._matMult(Vn)}const ui=qe.stretch+qe.fixed,Si=ot.stretch+ot.fixed;return{tl:ar,tr:kr,bl:li,br:Hr,tex:{x:f.paddedRect.x+1+ui,y:f.paddedRect.y+1+Si,w:nt.stretch+nt.fixed-ui,h:Ve.stretch+Ve.fixed-Si},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zi,pixelOffsetBR:lr,minFontScaleX:ht/y/k,minFontScaleY:it/y/A,isSDF:i}};if(a&&(f.stretchX||f.stretchY)){const qe=ty(L,K,U),ot=ty(F,de,ee);for(let nt=0;nt<qe.length-1;nt++){const Ve=qe[nt],Et=qe[nt+1];for(let vt=0;vt<ot.length-1;vt++)d.push(Qe(Ve,ot[vt],Et,ot[vt+1]))}}else d.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:S+1}));return d}function Ch(r,e,i){let a=0;for(const d of r)a+=Math.max(e,Math.min(i,d[1]))-Math.max(e,Math.min(i,d[0]));return a}function ty(r,e,i){const a=[{fixed:-1,stretch:0}];for(const[d,f]of r){const y=a[a.length-1];a.push({fixed:d-y.stretch,stretch:y.stretch}),a.push({fixed:d-y.stretch,stretch:y.stretch+(f-d)})}return a.push({fixed:e+1,stretch:i}),a}function kh(r,e,i,a){return r/e*i+a}function Ih(r,e,i,a){return r-e*i/a}rt("Anchor",Pa);class Mh{constructor(e,i,a,d,f,y,w,S,k,A){if(this.boxStartIndex=e.length,k){let L=y.top,F=y.bottom;const N=y.collisionPadding;N&&(L-=N[1],F+=N[3]);let U=F-L;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let L=y.top*w-S[0],F=y.bottom*w+S[2],N=y.left*w-S[3],U=y.right*w+S[1];const ee=y.collisionPadding;if(ee&&(N-=ee[0]*w,L-=ee[1]*w,U+=ee[2]*w,F+=ee[3]*w),A){const K=new It(N,L),de=new It(U,L),Se=new It(N,F),ue=new It(U,F),xe=A*Math.PI/180;K._rotate(xe),de._rotate(xe),Se._rotate(xe),ue._rotate(xe),N=Math.min(K.x,de.x,Se.x,ue.x),U=Math.max(K.x,de.x,Se.x,ue.x),L=Math.min(K.y,de.y,Se.y,ue.y),F=Math.max(K.y,de.y,Se.y,ue.y)}e.emplaceBack(i.x,i.y,N,L,U,F,a,d,f)}this.boxEndIndex=e.length}}class g1{constructor(e=[],i=y1){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,d=i[e];for(;e>0;){const f=e-1>>1,y=i[f];if(a(d,y)>=0)break;i[e]=y,e=f}i[e]=d}_down(e){const{data:i,compare:a}=this,d=this.length>>1,f=i[e];for(;e<d;){let y=1+(e<<1),w=i[y];const S=y+1;if(S<this.length&&a(i[S],w)<0&&(y=S,w=i[S]),a(w,f)>=0)break;i[e]=w,e=y}i[e]=f}}function y1(r,e){return r<e?-1:r>e?1:0}function _1(r,e=1,i=!1){let a=1/0,d=1/0,f=-1/0,y=-1/0;const w=r[0];for(let N=0;N<w.length;N++){const U=w[N];(!N||U.x<a)&&(a=U.x),(!N||U.y<d)&&(d=U.y),(!N||U.x>f)&&(f=U.x),(!N||U.y>y)&&(y=U.y)}const S=Math.min(f-a,y-d);let k=S/2;const A=new g1([],v1);if(S===0)return new It(a,d);for(let N=a;N<f;N+=S)for(let U=d;U<y;U+=S)A.push(new ru(N+k,U+k,k,r));let L=function(N){let U=0,ee=0,K=0;const de=N[0];for(let Se=0,ue=de.length,xe=ue-1;Se<ue;xe=Se++){const Le=de[Se],ze=de[xe],ht=Le.x*ze.y-ze.x*Le.y;ee+=(Le.x+ze.x)*ht,K+=(Le.y+ze.y)*ht,U+=3*ht}return new ru(ee/U,K/U,0,N)}(r),F=A.length;for(;A.length;){const N=A.pop();(N.d>L.d||!L.d)&&(L=N,i&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,F)),N.max-L.d<=e||(k=N.h/2,A.push(new ru(N.p.x-k,N.p.y-k,k,r)),A.push(new ru(N.p.x+k,N.p.y-k,k,r)),A.push(new ru(N.p.x-k,N.p.y+k,k,r)),A.push(new ru(N.p.x+k,N.p.y+k,k,r)),F+=4)}return i&&(console.log(`num probes: ${F}`),console.log(`best distance: ${L.d}`)),L.p}function v1(r,e){return e.max-r.max}function ru(r,e,i,a){this.p=new It(r,e),this.h=i,this.d=function(d,f){let y=!1,w=1/0;for(let S=0;S<f.length;S++){const k=f[S];for(let A=0,L=k.length,F=L-1;A<L;F=A++){const N=k[A],U=k[F];N.y>d.y!=U.y>d.y&&d.x<(U.x-N.x)*(d.y-N.y)/(U.y-N.y)+N.x&&(y=!y),w=Math.min(w,ug(d,N,U))}}return(y?1:-1)*Math.sqrt(w)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const bp=Number.POSITIVE_INFINITY;function ny(r,e){return e[1]!==bp?function(i,a,d){let f=0,y=0;switch(a=Math.abs(a),d=Math.abs(d),i){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(i){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,y]}(r,e[0],e[1]):function(i,a){let d=0,f=0;a<0&&(a=0);const y=a/Math.sqrt(2);switch(i){case"top-right":case"top-left":f=y-7;break;case"bottom-right":case"bottom-left":f=7-y;break;case"bottom":f=7-a;break;case"top":f=a-7}switch(i){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=a;break;case"right":d=-a}return[d,f]}(r,e[0])}function Sp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function x1(r,e,i,a,d,f,y,w,S,k,A){let L=f.textMaxSize.evaluate(e,{});L===void 0&&(L=y);const F=r.layers[0].layout,N=F.get("icon-offset").evaluate(e,{},A),U=iy(i.horizontal),ee=y/24,K=r.tilePixelRatio*ee,de=r.tilePixelRatio*L/24,Se=r.tilePixelRatio*w,ue=r.tilePixelRatio*F.get("symbol-spacing"),xe=F.get("text-padding")*r.tilePixelRatio,Le=function(Ve,Et,vt,$t=1){const An=Ve.get("icon-padding").evaluate(Et,{},vt),On=An&&An.values;return[On[0]*$t,On[1]*$t,On[2]*$t,On[3]*$t]}(F,e,A,r.tilePixelRatio),ze=F.get("text-max-angle")/180*Math.PI,ht=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",gt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",it=F.get("symbol-placement"),Qe=ue/2,qe=F.get("icon-text-fit");let ot;a&&qe!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(ot=qg(a,i.vertical,qe,F.get("icon-text-fit-padding"),N,ee)),U&&(a=qg(a,U,qe,F.get("icon-text-fit-padding"),N,ee)));const nt=(Ve,Et)=>{Et.x<0||Et.x>=mr||Et.y<0||Et.y>=mr||function(vt,$t,An,On,gr,vo,Xr,ar,kr,Hr,li,zi,lr,Kr,ui,Si,Li,Di,Vn,Ir,Ht,Yi,Jr,ci,No){const ts=vt.addToLineVertexArray($t,An);let ns,Qs,Uo,xo,Ri=0,ea=0,uc=0,xy=0,Lp=-1,Dp=-1;const ta={};let wy=Cr.exports(""),Rp=0,Fp=0;if(ar._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Rp,Fp]=ar.layout.get("text-offset").evaluate(Ht,{},ci).map(Fi=>Fi*Br):(Rp=ar.layout.get("text-radial-offset").evaluate(Ht,{},ci)*Br,Fp=bp),vt.allowVerticalPlacement&&On.vertical){const Fi=ar.layout.get("text-rotate").evaluate(Ht,{},ci)+90;Uo=new Mh(kr,$t,Hr,li,zi,On.vertical,lr,Kr,ui,Fi),Xr&&(xo=new Mh(kr,$t,Hr,li,zi,Xr,Li,Di,ui,Fi))}if(gr){const Fi=ar.layout.get("icon-rotate").evaluate(Ht,{}),Ps=ar.layout.get("icon-text-fit")!=="none",cc=ey(gr,Fi,Jr,Ps),hc=Xr?ey(Xr,Fi,Jr,Ps):void 0;Qs=new Mh(kr,$t,Hr,li,zi,gr,Li,Di,!1,Fi),Ri=4*cc.length;const Ey=vt.iconSizeData;let El=null;Ey.kind==="source"?(El=[Ys*ar.layout.get("icon-size").evaluate(Ht,{})],El[0]>Aa&&Ge(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ey.kind==="composite"&&(El=[Ys*Yi.compositeIconSizes[0].evaluate(Ht,{},ci),Ys*Yi.compositeIconSizes[1].evaluate(Ht,{},ci)],(El[0]>Aa||El[1]>Aa)&&Ge(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,cc,El,Ir,Vn,Ht,l.WritingMode.none,$t,ts.lineStartIndex,ts.lineLength,-1,ci),Lp=vt.icon.placedSymbolArray.length-1,hc&&(ea=4*hc.length,vt.addSymbols(vt.icon,hc,El,Ir,Vn,Ht,l.WritingMode.vertical,$t,ts.lineStartIndex,ts.lineLength,-1,ci),Dp=vt.icon.placedSymbolArray.length-1)}const by=Object.keys(On.horizontal);for(const Fi of by){const Ps=On.horizontal[Fi];if(!ns){wy=Cr.exports(Ps.text);const hc=ar.layout.get("text-rotate").evaluate(Ht,{},ci);ns=new Mh(kr,$t,Hr,li,zi,Ps,lr,Kr,ui,hc)}const cc=Ps.positionedLines.length===1;if(uc+=ry(vt,$t,Ps,vo,ar,ui,Ht,Si,ts,On.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,cc?by:[Fi],ta,Lp,Yi,ci),cc)break}On.vertical&&(xy+=ry(vt,$t,On.vertical,vo,ar,ui,Ht,Si,ts,l.WritingMode.vertical,["vertical"],ta,Dp,Yi,ci));const L1=ns?ns.boxStartIndex:vt.collisionBoxArray.length,D1=ns?ns.boxEndIndex:vt.collisionBoxArray.length,R1=Uo?Uo.boxStartIndex:vt.collisionBoxArray.length,F1=Uo?Uo.boxEndIndex:vt.collisionBoxArray.length,B1=Qs?Qs.boxStartIndex:vt.collisionBoxArray.length,O1=Qs?Qs.boxEndIndex:vt.collisionBoxArray.length,N1=xo?xo.boxStartIndex:vt.collisionBoxArray.length,U1=xo?xo.boxEndIndex:vt.collisionBoxArray.length;let rs=-1;const Dh=(Fi,Ps)=>Fi&&Fi.circleDiameter?Math.max(Fi.circleDiameter,Ps):Ps;rs=Dh(ns,rs),rs=Dh(Uo,rs),rs=Dh(Qs,rs),rs=Dh(xo,rs);const Sy=rs>-1?1:0;Sy&&(rs*=No/Br),vt.glyphOffsetArray.length>=iu.MAX_GLYPHS&&Ge("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ht.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,Ht.sortKey),vt.symbolInstances.emplaceBack($t.x,$t.y,ta.right>=0?ta.right:-1,ta.center>=0?ta.center:-1,ta.left>=0?ta.left:-1,ta.vertical||-1,Lp,Dp,wy,L1,D1,R1,F1,B1,O1,N1,U1,Hr,uc,xy,Ri,ea,Sy,0,lr,Rp,Fp,rs)}(r,Et,Ve,i,a,d,ot,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,K,[xe,xe,xe,xe],ht,S,Se,Le,gt,N,e,f,k,A,y)};if(it==="line")for(const Ve of Qg(e.geometry,0,0,mr,mr)){const Et=m1(Ve,ue,ze,i.vertical||U,a,24,de,r.overscaling,mr);for(const vt of Et){const $t=U;$t&&w1(r,$t.text,Qe,vt)||nt(Ve,vt)}}else if(it==="line-center"){for(const Ve of e.geometry)if(Ve.length>1){const Et=f1(Ve,ze,i.vertical||U,a,24,de);Et&&nt(Ve,Et)}}else if(e.type==="Polygon")for(const Ve of cp(e.geometry,0)){const Et=_1(Ve,16);nt(Ve[0],new Pa(Et.x,Et.y,0))}else if(e.type==="LineString")for(const Ve of e.geometry)nt(Ve,new Pa(Ve[0].x,Ve[0].y,0));else if(e.type==="Point")for(const Ve of e.geometry)for(const Et of Ve)nt([Et],new Pa(Et.x,Et.y,0))}const Aa=32640;function ry(r,e,i,a,d,f,y,w,S,k,A,L,F,N,U){const ee=function(Se,ue,xe,Le,ze,ht,gt,it){const Qe=Le.layout.get("text-rotate").evaluate(ht,{})*Math.PI/180,qe=[];for(const ot of ue.positionedLines)for(const nt of ot.positionedGlyphs){if(!nt.rect)continue;const Ve=nt.rect||{};let Et=4,vt=!0,$t=1,An=0;const On=(ze||it)&&nt.vertical,gr=nt.metrics.advance*nt.scale/2;if(it&&ue.verticalizable){const Vn=(nt.scale-1)*Br,Ir=(Br-nt.metrics.width*nt.scale)/2;An=ot.lineOffset/2-(nt.imageName?-Ir:Vn)}if(nt.imageName){const Vn=gt[nt.imageName];vt=Vn.sdf,$t=Vn.pixelRatio,Et=1/$t}const vo=ze?[nt.x+gr,nt.y]:[0,0];let Xr=ze?[0,0]:[nt.x+gr+xe[0],nt.y+xe[1]-An],ar=[0,0];On&&(ar=Xr,Xr=[0,0]);const kr=(nt.metrics.left-Et)*nt.scale-gr+Xr[0],Hr=(-nt.metrics.top-Et)*nt.scale+Xr[1],li=kr+Ve.w*nt.scale/$t,zi=Hr+Ve.h*nt.scale/$t,lr=new It(kr,Hr),Kr=new It(li,Hr),ui=new It(kr,zi),Si=new It(li,zi);if(On){const Vn=new It(-gr,gr-Sh),Ir=-Math.PI/2,Ht=12-gr,Yi=new It(22-Ht,-(nt.imageName?Ht:0)),Jr=new It(...ar);lr._rotateAround(Ir,Vn)._add(Yi)._add(Jr),Kr._rotateAround(Ir,Vn)._add(Yi)._add(Jr),ui._rotateAround(Ir,Vn)._add(Yi)._add(Jr),Si._rotateAround(Ir,Vn)._add(Yi)._add(Jr)}if(Qe){const Vn=Math.sin(Qe),Ir=Math.cos(Qe),Ht=[Ir,-Vn,Vn,Ir];lr._matMult(Ht),Kr._matMult(Ht),ui._matMult(Ht),Si._matMult(Ht)}const Li=new It(0,0),Di=new It(0,0);qe.push({tl:lr,tr:Kr,bl:ui,br:Si,tex:Ve,writingMode:ue.writingMode,glyphOffset:vo,sectionIndex:nt.sectionIndex,isSDF:vt,pixelOffsetTL:Li,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}return qe}(0,i,w,d,f,y,a,r.allowVerticalPlacement),K=r.textSizeData;let de=null;K.kind==="source"?(de=[Ys*d.layout.get("text-size").evaluate(y,{})],de[0]>Aa&&Ge(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(de=[Ys*N.compositeTextSizes[0].evaluate(y,{},U),Ys*N.compositeTextSizes[1].evaluate(y,{},U)],(de[0]>Aa||de[1]>Aa)&&Ge(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,ee,de,w,f,y,k,e,S.lineStartIndex,S.lineLength,F,U);for(const Se of A)L[Se]=r.text.placedSymbolArray.length-1;return 4*ee.length}function iy(r){for(const e in r)return r[e];return null}function w1(r,e,i,a){const d=r.compareText;if(e in d){const f=d[e];for(let y=f.length-1;y>=0;y--)if(a.dist(f[y])<i)return!0}else d[e]=[];return d[e].push(a),!1}const b1=Ia.VectorTileFeature.types,S1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ph(r,e,i,a,d,f,y,w,S,k,A,L,F){const N=w?Math.min(Aa,Math.round(w[0])):0,U=w?Math.min(Aa,Math.round(w[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*d),f,y,(N<<1)+(S?1:0),U,16*k,16*A,256*L,256*F)}function Ep(r,e,i){r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i)}function E1(r){for(const e of r.sections)if(oh(e.text))return!0;return!1}class Tp{constructor(e){this.layoutVertexArray=new Bo,this.indexArray=new xi,this.programConfigurations=e,this.segments=new qt,this.dynamicLayoutVertexArray=new go,this.opacityVertexArray=new Oo,this.placedSymbolArray=new Be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Xx.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,S1,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Tp);class Cp{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new qt,this.collisionVertexArray=new Ki}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Hx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}rt("CollisionBuffers",Cp);class iu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ip([]),this.placementViewportMatrix=ip([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wg(this.zoom,i["text-size"]),this.iconSizeData=Wg(this.zoom,i["icon-size"]);const a=this.layers[0].layout,d=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=Ip(a,"text-overlap","text-allow-overlap")!=="never"||Ip(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>l.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Tp(new vl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Tp(new vl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ye,this.lineVertexArray=new ct,this.symbolInstances=new st}calculateGlyphDependencies(e,i,a,d,f){for(let y=0;y<e.length;y++)if(i[e.charCodeAt(y)]=!0,(a||d)&&f){const w=oc[e.charAt(y)];w&&(i[w.charCodeAt(0)]=!0)}}populate(e,i,a){const d=this.layers[0],f=d.layout,y=f.get("text-font"),w=f.get("text-field"),S=f.get("icon-image"),k=(w.value.kind!=="constant"||w.value.value instanceof te&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),A=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,L=f.get("symbol-sort-key");if(this.features=[],!k&&!A)return;const F=i.iconDependencies,N=i.glyphDependencies,U=i.availableImages,ee=new Fn(this.zoom);for(const{feature:K,id:de,index:Se,sourceLayerIndex:ue}of e){const xe=d._featureFilter.needGeometry,Le=wl(K,xe);if(!d._featureFilter.filter(ee,Le,a))continue;let ze,ht;if(xe||(Le.geometry=xl(K)),k){const it=d.getValueAndResolveTokens("text-field",Le,a,U),Qe=te.factory(it);E1(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||gl()==="unavailable"||this.hasRTLText&&Hi.isParsed())&&(ze=Jx(Qe,d,Le))}if(A){const it=d.getValueAndResolveTokens("icon-image",Le,a,U);ht=it instanceof se?it:se.fromString(it)}if(!ze&&!ht)continue;const gt=this.sortFeaturesByKey?L.evaluate(Le,{},a):void 0;if(this.features.push({id:de,text:ze,icon:ht,index:Se,sourceLayerIndex:ue,geometry:Le.geometry,properties:K.properties,type:b1[K.type],sortKey:gt}),ht&&(F[ht.name]=!0),ze){const it=y.evaluate(Le,{},a).join(","),Qe=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const qe of ze.sections)if(qe.image)F[qe.image.name]=!0;else{const ot=Zs(ze.toString()),nt=qe.fontStack||it,Ve=N[nt]=N[nt]||{};this.calculateGlyphDependencies(qe.text,Ve,Qe,this.allowVerticalPlacement,ot)}}}f.get("symbol-placement")==="line"&&(this.features=function(K){const de={},Se={},ue=[];let xe=0;function Le(it){ue.push(K[it]),xe++}function ze(it,Qe,qe){const ot=Se[it];return delete Se[it],Se[Qe]=ot,ue[ot].geometry[0].pop(),ue[ot].geometry[0]=ue[ot].geometry[0].concat(qe[0]),ot}function ht(it,Qe,qe){const ot=de[Qe];return delete de[Qe],de[it]=ot,ue[ot].geometry[0].shift(),ue[ot].geometry[0]=qe[0].concat(ue[ot].geometry[0]),ot}function gt(it,Qe,qe){const ot=qe?Qe[0][Qe[0].length-1]:Qe[0][0];return`${it}:${ot.x}:${ot.y}`}for(let it=0;it<K.length;it++){const Qe=K[it],qe=Qe.geometry,ot=Qe.text?Qe.text.toString():null;if(!ot){Le(it);continue}const nt=gt(ot,qe),Ve=gt(ot,qe,!0);if(nt in Se&&Ve in de&&Se[nt]!==de[Ve]){const Et=ht(nt,Ve,qe),vt=ze(nt,Ve,ue[Et].geometry);delete de[nt],delete Se[Ve],Se[gt(ot,ue[vt].geometry,!0)]=vt,ue[Et].geometry=null}else nt in Se?ze(nt,Ve,qe):Ve in de?ht(nt,Ve,qe):(Le(it),de[nt]=xe-1,Se[Ve]=xe-1)}return ue.filter(it=>it.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,de)=>K.sortKey-de.sortKey)}update(e,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const y={};for(let w=e.segment+1;w<i.length;w++)y[w]={x:i[w].x,y:i[w].y,tileUnitDistanceFromAnchor:d},w<i.length-1&&(d+=i[w+1].dist(i[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:i[w].x,y:i[w].y,tileUnitDistanceFromAnchor:f},w>0&&(f+=i[w-1].dist(i[w]));for(let w=0;w<i.length;w++){const S=y[w];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,d,f,y,w,S,k,A,L,F){const N=e.indexArray,U=e.layoutVertexArray,ee=e.segments.prepareSegment(4*i.length,U,N,this.canOverlap?y.sortKey:void 0),K=this.glyphOffsetArray.length,de=ee.vertexLength,Se=this.allowVerticalPlacement&&w===l.WritingMode.vertical?Math.PI/2:0,ue=y.text&&y.text.sections;for(let xe=0;xe<i.length;xe++){const{tl:Le,tr:ze,bl:ht,br:gt,tex:it,pixelOffsetTL:Qe,pixelOffsetBR:qe,minFontScaleX:ot,minFontScaleY:nt,glyphOffset:Ve,isSDF:Et,sectionIndex:vt}=i[xe],$t=ee.vertexLength,An=Ve[1];Ph(U,S.x,S.y,Le.x,An+Le.y,it.x,it.y,a,Et,Qe.x,Qe.y,ot,nt),Ph(U,S.x,S.y,ze.x,An+ze.y,it.x+it.w,it.y,a,Et,qe.x,Qe.y,ot,nt),Ph(U,S.x,S.y,ht.x,An+ht.y,it.x,it.y+it.h,a,Et,Qe.x,qe.y,ot,nt),Ph(U,S.x,S.y,gt.x,An+gt.y,it.x+it.w,it.y+it.h,a,Et,qe.x,qe.y,ot,nt),Ep(e.dynamicLayoutVertexArray,S,Se),N.emplaceBack($t,$t+1,$t+2),N.emplaceBack($t+1,$t+2,$t+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),xe!==i.length-1&&vt===i[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,y,y.index,{},F,ue&&ue[vt])}e.placedSymbolArray.emplaceBack(S.x,S.y,K,this.glyphOffsetArray.length-K,de,k,A,S.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],w,0,!1,0,L)}_addCollisionDebugVertex(e,i,a,d,f,y){return i.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,f,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,i,a,d,f,y,w){const S=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),k=S.vertexLength,A=f.layoutVertexArray,L=f.collisionVertexArray,F=w.anchorX,N=w.anchorY;this._addCollisionDebugVertex(A,L,y,F,N,new It(e,i)),this._addCollisionDebugVertex(A,L,y,F,N,new It(a,i)),this._addCollisionDebugVertex(A,L,y,F,N,new It(a,d)),this._addCollisionDebugVertex(A,L,y,F,N,new It(e,d)),S.vertexLength+=4;const U=f.indexArray;U.emplaceBack(k,k+1),U.emplaceBack(k+1,k+2),U.emplaceBack(k+2,k+3),U.emplaceBack(k+3,k),S.primitiveLength+=4}addDebugCollisionBoxes(e,i,a,d){for(let f=e;f<i;f++){const y=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cp(Is,Lg.members,Qo),this.iconCollisionBox=new Cp(Is,Lg.members,Qo);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,a,d,f,y,w,S,k){const A={};for(let L=i;L<a;L++){const F=e.get(L);A.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.textFeatureIndex=F.featureIndex;break}for(let L=d;L<f;L++){const F=e.get(L);A.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.verticalTextFeatureIndex=F.featureIndex;break}for(let L=y;L<w;L++){const F=e.get(L);A.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.iconFeatureIndex=F.featureIndex;break}for(let L=S;L<k;L++){const F=e.get(L);A.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},A.verticalIconFeatureIndex=F.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),d=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<d;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),d=[],f=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const S=this.symbolInstances.get(w);d.push(0|Math.round(i*S.anchorX+a*S.anchorY)),f.push(S.featureIndex)}return y.sort((w,S)=>d[w]-d[S]||f[S]-f[w]),y}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((d,f,y)=>{d>=0&&y.indexOf(d)===f&&this.addIndicesForPlacedSymbol(this.text,d)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rt("SymbolBucket",iu,{omit:["layers","collisionBoxArray","features","compareText"]}),iu.MAX_GLYPHS=65535,iu.addDynamicAttributes=Ep;const T1=new Fr({"symbol-placement":new _t(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mt(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(Ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(Ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(Ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mt(Ie.layout_symbol["icon-size"]),"icon-text-fit":new _t(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mt(Ie.layout_symbol["icon-image"]),"icon-rotate":new Mt(Ie.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Mt(Ie.layout_symbol["icon-offset"]),"icon-anchor":new Mt(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new Mt(Ie.layout_symbol["text-field"]),"text-font":new Mt(Ie.layout_symbol["text-font"]),"text-size":new Mt(Ie.layout_symbol["text-size"]),"text-max-width":new Mt(Ie.layout_symbol["text-max-width"]),"text-line-height":new _t(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Mt(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new Mt(Ie.layout_symbol["text-justify"]),"text-radial-offset":new Mt(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new Mt(Ie.layout_symbol["text-anchor"]),"text-max-angle":new _t(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new Mt(Ie.layout_symbol["text-rotate"]),"text-padding":new _t(Ie.layout_symbol["text-padding"]),"text-keep-upright":new _t(Ie.layout_symbol["text-keep-upright"]),"text-transform":new Mt(Ie.layout_symbol["text-transform"]),"text-offset":new Mt(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new _t(Ie.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(Ie.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new _t(Ie.layout_symbol["text-optional"])});var kp={paint:new Fr({"icon-opacity":new Mt(Ie.paint_symbol["icon-opacity"]),"icon-color":new Mt(Ie.paint_symbol["icon-color"]),"icon-halo-color":new Mt(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mt(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mt(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(Ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mt(Ie.paint_symbol["text-opacity"]),"text-color":new Mt(Ie.paint_symbol["text-color"],{runtimeType:pr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Mt(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new Mt(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Mt(Ie.paint_symbol["text-halo-blur"]),"text-translate":new _t(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new _t(Ie.paint_symbol["text-translate-anchor"])}),layout:T1};class oy{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Gn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",oy,{omit:["defaultValue"]});class Ah extends Fo{constructor(e){super(e,kp)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const d=[];for(const f of a)d.indexOf(f)<0&&d.push(f);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,d){const f=this.layout.get(e).evaluate(i,{},a,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Us(y.value)||!f?f:function(w,S){return S.replace(/{([^{}]+)}/g,(k,A)=>A in w?String(w[A]):"")}(i.properties,f)}createBucket(e){return new iu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of kp.paint.overridableProperties){if(!Ah.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new oy(i),d=new ho(a,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Vs("source",d):new po("composite",d,i.value.zoomStops),this.paint._values[e]=new Ro(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Ah.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),d=kp.paint.properties[i];let f=!1;const y=w=>{for(const S of w)if(d.overrides&&d.overrides.hasOverride(S))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof te)y(a.value.value.sections);else if(a.value.kind==="source"){const w=k=>{f||(k instanceof mt&&Ee(k.value)===Qn?y(k.value.sections):k instanceof va?y(k.sections):k.eachChild(w))},S=a.value;S._styleExpression&&w(S._styleExpression.expression)}return f}}function Ip(r,e,i){let a="never";const d=r.get(e);return d?a=d:r.get(i)&&(a="always"),a}var C1={paint:new Fr({"background-color":new _t(Ie.paint_background["background-color"]),"background-pattern":new Zu(Ie.paint_background["background-pattern"]),"background-opacity":new _t(Ie.paint_background["background-opacity"])})},k1={paint:new Fr({"raster-opacity":new _t(Ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(Ie.paint_raster["raster-saturation"]),"raster-contrast":new _t(Ie.paint_raster["raster-contrast"]),"raster-resampling":new _t(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(Ie.paint_raster["raster-fade-duration"])})};class I1 extends Fo{constructor(e){super(e,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const M1={circle:class extends Fo{constructor(r){super(r,sx)}createBucket(r){return new tp(r)}queryRadius(r){const e=r;return Ku("circle-radius",this,e)+Ku("circle-stroke-width",this,e)+fh(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,d,f,y,w){const S=mh(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,y),k=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),A=this.paint.get("circle-pitch-alignment")==="map",L=A?S:function(N,U){return N.map(ee=>gg(ee,U))}(S,w),F=A?k*y:k;for(const N of a)for(const U of N){const ee=A?U:gg(U,w);let K=F;const de=gh([],[U.x,U.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?K*=de[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(K*=f.cameraToCenterDistance/de[3]),tx(L,ee,K))return!0}return!1}},heatmap:class extends Fo{constructor(r){super(r,lx),this._updateColorRamp()}createBucket(r){return new yg(r)}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Fo{constructor(r){super(r,ux)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Fo{constructor(r){super(r,Tx)}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new pp(r)}queryRadius(){return fh(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,d,f,y){return lg(mh(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,y),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Fo{constructor(r){super(r,Nx)}createBucket(r){return new mp(r)}queryRadius(){return fh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,e,i,a,d,f,y,w){const S=mh(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,y),k=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),L=function(N,U,ee,K){const de=[];for(const Se of N){const ue=[Se.x,Se.y,0,1];gh(ue,ue,U),de.push(new It(ue[0]/ue[3],ue[1]/ue[3]))}return de}(S,w),F=function(N,U,ee,K){const de=[],Se=[],ue=K[8]*U,xe=K[9]*U,Le=K[10]*U,ze=K[11]*U,ht=K[8]*ee,gt=K[9]*ee,it=K[10]*ee,Qe=K[11]*ee;for(const qe of N){const ot=[],nt=[];for(const Ve of qe){const Et=Ve.x,vt=Ve.y,$t=K[0]*Et+K[4]*vt+K[12],An=K[1]*Et+K[5]*vt+K[13],On=K[2]*Et+K[6]*vt+K[14],gr=K[3]*Et+K[7]*vt+K[15],vo=On+Le,Xr=gr+ze,ar=$t+ht,kr=An+gt,Hr=On+it,li=gr+Qe,zi=new It(($t+ue)/Xr,(An+xe)/Xr);zi.z=vo/Xr,ot.push(zi);const lr=new It(ar/li,kr/li);lr.z=Hr/li,nt.push(lr)}de.push(ot),Se.push(nt)}return[de,Se]}(a,A,k,w);return function(N,U,ee){let K=1/0;lg(ee,U)&&(K=Ig(ee,U[0]));for(let de=0;de<U.length;de++){const Se=U[de],ue=N[de];for(let xe=0;xe<Se.length-1;xe++){const Le=Se[xe],ze=[Le,Se[xe+1],ue[xe+1],ue[xe],Le];ag(ee,ze)&&(K=Math.min(K,Ig(ee,ze)))}}return K!==1/0&&K}(F[0],F[1],L)}},line:class extends Fo{constructor(r){super(r,Pg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Fe,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=Ag.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new gp(r)}queryRadius(r){const e=r,i=zg(Ku("line-width",this,e),Ku("line-gap-width",this,e)),a=Ku("line-offset",this,e);return i/2+Math.abs(a)+fh(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,d,f,y){const w=mh(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,y),S=y/2*zg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),k=this.paint.get("line-offset").evaluate(e,i);return k&&(a=function(A,L){const F=[];for(let N=0;N<A.length;N++){const U=A[N],ee=[];for(let K=0;K<U.length;K++){const de=U[K-1],Se=U[K],ue=U[K+1],xe=K===0?new It(0,0):Se.sub(de)._unit()._perp(),Le=K===U.length-1?new It(0,0):ue.sub(Se)._unit()._perp(),ze=xe._add(Le)._unit(),ht=ze.x*Le.x+ze.y*Le.y;ht!==0&&ze._mult(1/ht),ee.push(ze._mult(L)._add(Se))}F.push(ee)}return F}(a,k*y)),function(A,L,F){for(let N=0;N<L.length;N++){const U=L[N];if(A.length>=3){for(let ee=0;ee<U.length;ee++)if(Jl(A,U[ee]))return!0}if(nx(A,U,F))return!0}return!1}(w,a,S)}isTileClipped(){return!0}},symbol:Ah,background:class extends Fo{constructor(r){super(r,C1)}},raster:class extends Fo{constructor(r){super(r,k1)}}};class P1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const sy=63710088e-1;class Jn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jn(tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,d=e.lat*i,f=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*i);return sy*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Sl(new Jn(this.lng-a,this.lat-i),new Jn(this.lng+a,this.lat+i))}static convert(e){if(e instanceof Jn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Jn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Jn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Sl{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Jn?new Jn(e.lng,e.lat):Jn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Jn?new Jn(e.lng,e.lat):Jn.convert(e),this}extend(e){const i=this._sw,a=this._ne;let d,f;if(e instanceof Jn)d=e,f=e;else{if(!(e instanceof Sl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Sl.convert(e)):this.extend(Jn.convert(e)):this;if(d=e._sw,f=e._ne,!d||!f)return this}return i||a?(i.lng=Math.min(d.lng,i.lng),i.lat=Math.min(d.lat,i.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new Jn(d.lng,d.lat),this._ne=new Jn(f.lng,f.lat)),this}getCenter(){return new Jn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Jn(this.getWest(),this.getNorth())}getSouthEast(){return new Jn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=Jn.convert(e);let d=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&d}static convert(e){return e instanceof Sl?e:e&&new Sl(e)}}const ay=2*Math.PI*sy;function ly(r){return ay*Math.cos(r*Math.PI/180)}function uy(r){return(180+r)/360}function cy(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function hy(r,e){return r/ly(e)}function Mp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class zh{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=Jn.convert(e);return new zh(uy(a.lng),cy(a.lat),hy(i,a.lat))}toLngLat(){return new Jn(360*this.x-180,Mp(this.y))}toAltitude(){return this.z*ly(Mp(this.y))}meterInMercatorCoordinateUnits(){return 1/ay*(e=Mp(this.y),1/Math.cos(e*Math.PI/180));var e}}function dy(r,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Pp{constructor(e,i,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||i<0||i>=Math.pow(2,e))throw new Error(`x=${i}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=a,this.key=ac(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,a){const d=(y=this.y,w=this.z,S=dy(256*(f=this.x),256*(y=Math.pow(2,w)-y-1),w),k=dy(256*(f+1),256*(y+1),w),S[0]+","+S[1]+","+k[0]+","+k[1]);var f,y,w,S,k;const A=function(L,F,N){let U,ee="";for(let K=L;K>0;K--)U=1<<K-1,ee+=(F&U?1:0)+(N&U?2:0);return ee}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new It((e.x*i-this.x)*mr,(e.y*i-this.y)*mr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class py{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ac(e,i.z,i.z,i.x,i.y)}}class _o{constructor(e,i,a,d,f){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=i,this.canonical=new Pp(a,+d,+f),this.key=ac(i,e,a,d,f)}clone(){return new _o(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new _o(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _o(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?ac(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):ac(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new _o(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new _o(i,this.wrap,i,a,d),new _o(i,this.wrap,i,a+1,d),new _o(i,this.wrap,i,a,d+1),new _o(i,this.wrap,i,a+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _o(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _o(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new py(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new zh(e.x-this.wrap,e.y))}}function ac(r,e,i,a,d){(r*=2)<0&&(r=-1*r-1);const f=1<<i;return(f*f*r+f*d+a).toString(36)+i.toString(36)+e.toString(36)}rt("CanonicalTileID",Pp),rt("OverscaledTileID",_o,{omit:["posMatrix"]});class fy{constructor(e,i,a){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Ge(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2;this.data=new Uint32Array(i.data.buffer),this.encoding=a||"mapbox";for(let f=0;f<d;f++)this.data[this._idx(-1,f)]=this.data[this._idx(0,f)],this.data[this._idx(d,f)]=this.data[this._idx(d-1,f)],this.data[this._idx(f,-1)]=this.data[this._idx(f,0)],this.data[this._idx(f,d)]=this.data[this._idx(f,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let f=0;f<d;f++)for(let y=0;y<d;y++){const w=this.get(f,y);w>this.max&&(this.max=w),w<this.min&&(this.min=w)}}get(e,i){const a=new Uint8Array(this.data.buffer),d=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[d],a[d+1],a[d+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,a){return(256*e*256+256*i+a)/10-1e4}_unpackTerrarium(e,i,a){return 256*e+i+a/256-32768}getPixels(){return new yo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=i*this.dim,f=i*this.dim+this.dim,y=a*this.dim,w=a*this.dim+this.dim;switch(i){case-1:d=f-1;break;case 1:f=d+1}switch(a){case-1:y=w-1;break;case 1:w=y+1}const S=-i*this.dim,k=-a*this.dim;for(let A=y;A<w;A++)for(let L=d;L<f;L++)this.data[this._idx(L,A)]=e.data[this._idx(L+S,A+k)]}}rt("DEMData",fy);class my{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class gy{constructor(e,i,a,d,f){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=a,e._y=d,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(e[i]=this[i]);return e}}class yy{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Do(mr,16,0),this.grid3D=new Do(mr,16,0),this.featureIndexArray=new jt,this.promoteId=i}insert(e,i,a,d,f,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,f);const S=y?this.grid3D:this.grid;for(let k=0;k<i.length;k++){const A=i[k],L=[1/0,1/0,-1/0,-1/0];for(let F=0;F<A.length;F++){const N=A[F];L[0]=Math.min(L[0],N.x),L[1]=Math.min(L[1],N.y),L[2]=Math.max(L[2],N.x),L[3]=Math.max(L[3],N.y)}L[0]<mr&&L[1]<mr&&L[2]>=0&&L[3]>=0&&S.insert(w,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ia.VectorTile(new yp(this.rawTileData)).layers,this.sourceLayerCoder=new my(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,i,a,d){this.loadVTLayers();const f=e.params||{},y=mr/e.tileSize/e.scale,w=ke(f.filter),S=e.queryGeometry,k=e.queryPadding*y,A=vy(S),L=this.grid.query(A.minX-k,A.minY-k,A.maxX+k,A.maxY+k),F=vy(e.cameraQueryGeometry),N=this.grid3D.query(F.minX-k,F.minY-k,F.maxX+k,F.maxY+k,(K,de,Se,ue)=>function(xe,Le,ze,ht,gt){for(const Qe of xe)if(Le<=Qe.x&&ze<=Qe.y&&ht>=Qe.x&&gt>=Qe.y)return!0;const it=[new It(Le,ze),new It(Le,gt),new It(ht,gt),new It(ht,ze)];if(xe.length>2){for(const Qe of it)if(Jl(xe,Qe))return!0}for(let Qe=0;Qe<xe.length-1;Qe++)if(ix(xe[Qe],xe[Qe+1],it))return!0;return!1}(e.cameraQueryGeometry,K-k,de-k,Se+k,ue+k));for(const K of N)L.push(K);L.sort(A1);const U={};let ee;for(let K=0;K<L.length;K++){const de=L[K];if(de===ee)continue;ee=de;const Se=this.featureIndexArray.get(de);let ue=null;this.loadMatchingFeature(U,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,w,f.layers,f.availableImages,i,a,d,(xe,Le,ze)=>(ue||(ue=xl(xe)),Le.queryIntersectsFeature(S,xe,ze,ue,this.z,e.transform,y,e.pixelPosMatrix)))}return U}loadMatchingFeature(e,i,a,d,f,y,w,S,k,A,L){const F=this.bucketLayerIDs[i];if(y&&!function(K,de){for(let Se=0;Se<K.length;Se++)if(de.indexOf(K[Se])>=0)return!0;return!1}(y,F))return;const N=this.sourceLayerCoder.decode(a),U=this.vtLayers[N].feature(d);if(f.needGeometry){const K=wl(U,!0);if(!f.filter(new Fn(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!f.filter(new Fn(this.tileID.overscaledZ),U))return;const ee=this.getId(U,N);for(let K=0;K<F.length;K++){const de=F[K];if(y&&y.indexOf(de)<0)continue;const Se=S[de];if(!Se)continue;let ue={};ee&&A&&(ue=A.getState(Se.sourceLayer||"_geojsonTileLayer",ee));const xe=Xe({},k[de]);xe.paint=_y(xe.paint,Se.paint,U,ue,w),xe.layout=_y(xe.layout,Se.layout,U,ue,w);const Le=!L||L(U,Se,ue);if(!Le)continue;const ze=new gy(U,this.z,this.x,this.y,ee);ze.layer=xe;let ht=e[de];ht===void 0&&(ht=e[de]=[]),ht.push({featureIndex:d,feature:ze,intersectionZ:Le})}}lookupSymbolFeatures(e,i,a,d,f,y,w,S){const k={};this.loadVTLayers();const A=ke(f);for(const L of e)this.loadMatchingFeature(k,a,d,L,A,y,w,S,i);return k}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof a=="boolean"&&(a=Number(a))),a}}function _y(r,e,i,a,d){return pe(r,(f,y)=>{const w=e instanceof _l?e.get(y):null;return w&&w.evaluate?w.evaluate(i,a,d):w})}function vy(r){let e=1/0,i=1/0,a=-1/0,d=-1/0;for(const f of r)e=Math.min(e,f.x),i=Math.min(i,f.y),a=Math.max(a,f.x),d=Math.max(d,f.y);return{minX:e,minY:i,maxX:a,maxY:d}}function A1(r,e){return e-r}var Ap;rt("FeatureIndex",yy,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Ap=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Ap.load="load",Ap.fullLoad="fullLoad";let Lh=null,lc=[];const zp=1e3/30,z1={mark(r){performance.mark(r)},frame(r){const e=r;Lh!=null&&lc.push(e-Lh),Lh=e},clearMetrics(){Lh=null,lc=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const r in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[r])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const r=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,i=lc.length,a=1/(lc.reduce((f,y)=>f+y,0)/i/1e3),d=lc.filter(f=>f>zp).reduce((f,y)=>f+(y-zp)/zp,0);return{loadTime:r,fullLoadTime:e,fps:a,percentDroppedFrames:d/(i+d)*100}}};l.AJAXError=Ar,l.ARRAY_TYPE=bi,l.Actor=class{constructor(r,e,i){this.target=r,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},fn(["receive","process"],this),this.invoker=new P1(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ft()?r:window}send(r,e,i,a,d=!1){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[f]=i);const y=cr(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:r,hasCallback:!!i,targetMapId:a,mustQueue:d,sourceMapId:this.mapId,data:Wi(e,y)},y),{cancel:()=>{i&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(r){const e=r.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[i];const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a()}else ft()||e.mustQueue?(this.tasks[i]=e,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,e)}process(){if(!this.taskQueue.length)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){if(e.type==="<response>"){const i=this.callbacks[r];delete this.callbacks[r],i&&(e.error?i(Xi(e.error)):i(null,Xi(e.data)))}else{let i=!1;const a=cr(this.globalScope)?void 0:[],d=e.hasCallback?(w,S)=>{i=!0,delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:w?Wi(w):null,data:Wi(S,a)},a)}:w=>{i=!0};let f=null;const y=Xi(e.data);if(this.parent[e.type])f=this.parent[e.type](e.sourceMapId,y,d);else if(this.parent.getWorkerSource){const w=e.type.split(".");f=this.parent.getWorkerSource(e.sourceMapId,w[0],y.source)[w[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!i&&f&&f.cancel&&(this.cancelCallbacks[r]=f.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Yu,l.CanonicalTileID=Pp,l.CollisionBoxArray=Me,l.CollisionCircleLayoutArray=class extends z{},l.Color=j,l.DEMData=fy,l.DataConstantProperty=_t,l.DictionaryCoder=my,l.EXTENT=mr,l.ErrorEvent=Wo,l.EvaluationParameters=Fn,l.Event=Vi,l.Evented=ji,l.FeatureIndex=yy,l.FillBucket=pp,l.FillExtrusionBucket=mp,l.GeoJSONFeature=gy,l.ImageAtlas=Vg,l.ImagePosition=vp,l.LineBucket=gp,l.LineStripIndexArray=class extends X{},l.LngLat=Jn,l.LngLatBounds=Sl,l.MercatorCoordinate=zh,l.ONE_EM=Br,l.OverscaledTileID=_o,l.PerformanceUtils=z1,l.PosArray=St,l.Properties=Fr,l.QuadTriangleArray=class extends O{},l.RGBAImage=yo,l.RasterBoundsArray=class extends h{},l.RequestPerformance=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},l.ResourceType=Pr,l.SegmentVector=qt,l.SymbolBucket=iu,l.Transitionable=lh,l.TriangleIndexArray=xi,l.Uniform1f=Hs,l.Uniform1i=class extends Xs{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},l.Uniform2f=class extends Xs{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},l.Uniform3f=class extends Xs{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},l.Uniform4f=Hl,l.UniformColor=rg,l.UniformMatrix4f=class extends Xs{constructor(r,e){super(r,e),this.current=Q0}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},l.UnwrappedTileID=py,l.ValidationError=We,l.ZoomHistory=bs,l.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r},l.addDynamicAttributes=Ep,l.asyncAll=function(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const d=new Array(r.length);let f=null;r.forEach((y,w)=>{e(y,(S,k)=>{S&&(f=S),d[w]=k,--a==0&&i(f,d)})})},l.bezier=we,l.bindAll=fn,l.cacheEntryPossiblyAdded=function(r){Vr++,Vr>fi&&(r.getActor().send("enforceCacheSizeLimit",Tn),Vr=0)},l.clamp=H,l.clearTileCache=function(r){const e=caches.delete(Pt);r&&e.catch(r).then(()=>r())},l.clipLine=Qg,l.clone=function(r){var e=new bi(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},l.clone$1=he,l.clone$2=function(r){var e=new bi(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},l.collisionCircleLayout=Kx,l.config=ut,l.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},l.create=function(){var r=new bi(16);return bi!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},l.create$1=hg,l.createExpression=_i,l.createFilter=ke,l.createLayout=sr,l.createStyleLayer=function(r){return r.type==="custom"?new I1(r):new M1[r.type](r)},l.cross=function(r,e,i){var a=e[0],d=e[1],f=e[2],y=i[0],w=i[1],S=i[2];return r[0]=d*S-f*w,r[1]=f*y-a*S,r[2]=a*w-d*y,r},l.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},l.dot$1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},l.ease=fe,l.emitValidationErrors=Lo,l.enforceCacheSizeLimit=function(r){Ur(),He&&He.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a])})})},l.equals=function(r,e){var i=r[0],a=r[1],d=r[2],f=r[3],y=r[4],w=r[5],S=r[6],k=r[7],A=r[8],L=r[9],F=r[10],N=r[11],U=r[12],ee=r[13],K=r[14],de=r[15],Se=e[0],ue=e[1],xe=e[2],Le=e[3],ze=e[4],ht=e[5],gt=e[6],it=e[7],Qe=e[8],qe=e[9],ot=e[10],nt=e[11],Ve=e[12],Et=e[13],vt=e[14],$t=e[15];return Math.abs(i-Se)<=wi*Math.max(1,Math.abs(i),Math.abs(Se))&&Math.abs(a-ue)<=wi*Math.max(1,Math.abs(a),Math.abs(ue))&&Math.abs(d-xe)<=wi*Math.max(1,Math.abs(d),Math.abs(xe))&&Math.abs(f-Le)<=wi*Math.max(1,Math.abs(f),Math.abs(Le))&&Math.abs(y-ze)<=wi*Math.max(1,Math.abs(y),Math.abs(ze))&&Math.abs(w-ht)<=wi*Math.max(1,Math.abs(w),Math.abs(ht))&&Math.abs(S-gt)<=wi*Math.max(1,Math.abs(S),Math.abs(gt))&&Math.abs(k-it)<=wi*Math.max(1,Math.abs(k),Math.abs(it))&&Math.abs(A-Qe)<=wi*Math.max(1,Math.abs(A),Math.abs(Qe))&&Math.abs(L-qe)<=wi*Math.max(1,Math.abs(L),Math.abs(qe))&&Math.abs(F-ot)<=wi*Math.max(1,Math.abs(F),Math.abs(ot))&&Math.abs(N-nt)<=wi*Math.max(1,Math.abs(N),Math.abs(nt))&&Math.abs(U-Ve)<=wi*Math.max(1,Math.abs(U),Math.abs(Ve))&&Math.abs(ee-Et)<=wi*Math.max(1,Math.abs(ee),Math.abs(Et))&&Math.abs(K-vt)<=wi*Math.max(1,Math.abs(K),Math.abs(vt))&&Math.abs(de-$t)<=wi*Math.max(1,Math.abs(de),Math.abs($t))},l.evaluateSizeForFeature=function(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:d}){return r.kind==="source"?a/Ys:r.kind==="composite"?Ue(a/Ys,d/Ys,i):e},l.evaluateSizeForZoom=function(r,e){let i=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:y}=r,w=d?H($r.interpolationFactor(d,e,f,y),0,1):0;r.kind==="camera"?a=Ue(r.minSize,r.maxSize,w):i=w}return{uSizeT:i,uSize:a}},l.evaluateVariableOffset=ny,l.evented=Gu,l.exported=hr,l.exported$1=_r,l.extend=Xe,l.filterObject=ie,l.fromRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},l.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.getAnchorAlignment=wp,l.getAnchorJustification=Sp,l.getArrayBuffer=ds,l.getImage=mi,l.getJSON=function(r,e){return ni(Xe(r,{type:"json"}),e)},l.getOverlapMode=Ip,l.getRTLTextPluginStatus=gl,l.getReferrer=io,l.getVideo=function(r,e){const i=window.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const d=window.document.createElement("source");ps(r[a])||(i.crossOrigin="Anonymous"),d.src=r[a],i.appendChild(d)}return{cancel:()=>{}}},l.identity=ip,l.invert=function(r,e){var i=e[0],a=e[1],d=e[2],f=e[3],y=e[4],w=e[5],S=e[6],k=e[7],A=e[8],L=e[9],F=e[10],N=e[11],U=e[12],ee=e[13],K=e[14],de=e[15],Se=i*w-a*y,ue=i*S-d*y,xe=i*k-f*y,Le=a*S-d*w,ze=a*k-f*w,ht=d*k-f*S,gt=A*ee-L*U,it=A*K-F*U,Qe=A*de-N*U,qe=L*K-F*ee,ot=L*de-N*ee,nt=F*de-N*K,Ve=Se*nt-ue*ot+xe*qe+Le*Qe-ze*it+ht*gt;return Ve?(r[0]=(w*nt-S*ot+k*qe)*(Ve=1/Ve),r[1]=(d*ot-a*nt-f*qe)*Ve,r[2]=(ee*ht-K*ze+de*Le)*Ve,r[3]=(F*ze-L*ht-N*Le)*Ve,r[4]=(S*Qe-y*nt-k*it)*Ve,r[5]=(i*nt-d*Qe+f*it)*Ve,r[6]=(K*xe-U*ht-de*ue)*Ve,r[7]=(A*ht-F*xe+N*ue)*Ve,r[8]=(y*ot-w*Qe+k*gt)*Ve,r[9]=(a*Qe-i*ot-f*gt)*Ve,r[10]=(U*ze-ee*xe+de*Se)*Ve,r[11]=(L*xe-A*ze-N*Se)*Ve,r[12]=(w*it-y*qe-S*gt)*Ve,r[13]=(i*qe-a*it+d*gt)*Ve,r[14]=(ee*ue-U*Le-K*Se)*Ve,r[15]=(A*Le-L*ue+F*Se)*Ve,r):null},l.isImageBitmap=zn,l.isSafari=cr,l.isWorker=ft,l.keysDifference=function(r,e){const i=[];for(const a in r)a in e||i.push(a);return i},l.lazyLoadRTLTextPlugin=function(){Hi.isLoading()||Hi.isLoaded()||gl()!=="deferred"||ah()},l.makeRequest=ni,l.mapObject=pe,l.mercatorXfromLng=uy,l.mercatorYfromLat=cy,l.mercatorZfromAltitude=hy,l.mul=ax,l.mul$1=function(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r},l.multiply=dg,l.nextPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},l.normalize=function(r,e){var i=e[0],a=e[1],d=e[2],f=i*i+a*a+d*d;return f>0&&(f=1/Math.sqrt(f)),r[0]=e[0]*f,r[1]=e[1]*f,r[2]=e[2]*f,r},l.number=Ue,l.ortho=function(r,e,i,a,d,f,y){var w=1/(e-i),S=1/(a-d),k=1/(f-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+i)*w,r[13]=(d+a)*S,r[14]=(y+f)*k,r[15]=1,r},l.parseCacheControl=xn,l.parseGlyphPbf=function(r){return new yp(r).readFields(a1,[])},l.pbf=yp,l.performSymbolLayout=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=mr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0].layout,i=r.bucket.layers[0]._unevaluatedLayout._values,a={layoutIconSize:i["icon-size"].possiblyEvaluate(new Fn(r.bucket.zoom+1),r.canonical),layoutTextSize:i["text-size"].possiblyEvaluate(new Fn(r.bucket.zoom+1),r.canonical),textMaxSize:i["text-size"].possiblyEvaluate(new Fn(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:k}=r.bucket.textSizeData;a.compositeTextSizes=[i["text-size"].possiblyEvaluate(new Fn(S),r.canonical),i["text-size"].possiblyEvaluate(new Fn(k),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:k}=r.bucket.iconSizeData;a.compositeIconSizes=[i["icon-size"].possiblyEvaluate(new Fn(S),r.canonical),i["icon-size"].possiblyEvaluate(new Fn(k),r.canonical)]}const d=e.get("text-line-height")*Br,f=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",y=e.get("text-keep-upright"),w=e.get("text-size");for(const S of r.bucket.features){const k=e.get("text-font").evaluate(S,{},r.canonical).join(","),A=w.evaluate(S,{},r.canonical),L=a.layoutTextSize.evaluate(S,{},r.canonical),F=a.layoutIconSize.evaluate(S,{},r.canonical),N={horizontal:{},vertical:void 0},U=S.text;let ee,K=[0,0];if(U){const ue=U.toString(),xe=e.get("text-letter-spacing").evaluate(S,{},r.canonical)*Br,Le=Sa(ue)?xe:0,ze=e.get("text-anchor").evaluate(S,{},r.canonical),ht=e.get("text-variable-anchor");if(!ht){const ot=e.get("text-radial-offset").evaluate(S,{},r.canonical);K=ot?ny(ze,[ot*Br,bp]):e.get("text-offset").evaluate(S,{},r.canonical).map(nt=>nt*Br)}let gt=f?"center":e.get("text-justify").evaluate(S,{},r.canonical);const it=e.get("symbol-placement"),Qe=it==="point"?e.get("text-max-width").evaluate(S,{},r.canonical)*Br:0,qe=()=>{r.bucket.allowVerticalPlacement&&Zs(ue)&&(N.vertical=Eh(U,r.glyphMap,r.glyphPositions,r.imagePositions,k,Qe,d,ze,"left",Le,K,l.WritingMode.vertical,!0,it,L,A))};if(!f&&ht){const ot=gt==="auto"?ht.map(Ve=>Sp(Ve)):[gt];let nt=!1;for(let Ve=0;Ve<ot.length;Ve++){const Et=ot[Ve];if(!N.horizontal[Et])if(nt)N.horizontal[Et]=N.horizontal[0];else{const vt=Eh(U,r.glyphMap,r.glyphPositions,r.imagePositions,k,Qe,d,"center",Et,Le,K,l.WritingMode.horizontal,!1,it,L,A);vt&&(N.horizontal[Et]=vt,nt=vt.positionedLines.length===1)}}qe()}else{gt==="auto"&&(gt=Sp(ze));const ot=Eh(U,r.glyphMap,r.glyphPositions,r.imagePositions,k,Qe,d,ze,gt,Le,K,l.WritingMode.horizontal,!1,it,L,A);ot&&(N.horizontal[gt]=ot),qe(),Zs(ue)&&f&&y&&(N.vertical=Eh(U,r.glyphMap,r.glyphPositions,r.imagePositions,k,Qe,d,ze,gt,Le,K,l.WritingMode.vertical,!1,it,L,A))}}let de=!1;if(S.icon&&S.icon.name){const ue=r.imageMap[S.icon.name];ue&&(ee=p1(r.imagePositions[S.icon.name],e.get("icon-offset").evaluate(S,{},r.canonical),e.get("icon-anchor").evaluate(S,{},r.canonical)),de=!!ue.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=de:r.bucket.sdfIcons!==de&&Ge("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==r.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const Se=iy(N.horizontal)||N.vertical;r.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||ee)&&x1(r.bucket,S,N,ee,r.imageMap,a,L,F,K,de,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},l.perspective=function(r,e,i,a,d){var f,y=1/Math.tan(e/2);return r[0]=y/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0?(r[10]=(d+a)*(f=1/(a-d)),r[14]=2*d*a*f):(r[10]=-1,r[14]=-2*a),r},l.pick=function(r,e){const i={};for(let a=0;a<e.length;a++){const d=e[a];d in r&&(i[d]=r[d])}return i},l.plugin=Hi,l.pointGeometry=It,l.polygonIntersectsPolygon=ag,l.potpack=Ug,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=rt,l.registerForPluginStateChange=function(r){return r({pluginStatus:vi,pluginURL:Es}),Gu.on("pluginStateChange",r),r},l.renderColorRamp=vg,l.rotateX=function(r,e,i){var a=Math.sin(i),d=Math.cos(i),f=e[4],y=e[5],w=e[6],S=e[7],k=e[8],A=e[9],L=e[10],F=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*d+k*a,r[5]=y*d+A*a,r[6]=w*d+L*a,r[7]=S*d+F*a,r[8]=k*d-f*a,r[9]=A*d-y*a,r[10]=L*d-w*a,r[11]=F*d-S*a,r},l.rotateZ=function(r,e,i){var a=Math.sin(i),d=Math.cos(i),f=e[0],y=e[1],w=e[2],S=e[3],k=e[4],A=e[5],L=e[6],F=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*d+k*a,r[1]=y*d+A*a,r[2]=w*d+L*a,r[3]=S*d+F*a,r[4]=k*d-f*a,r[5]=A*d-y*a,r[6]=L*d-w*a,r[7]=F*d-S*a,r},l.scale=function(r,e,i){var a=i[0],d=i[1],f=i[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},l.scale$1=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r},l.setCacheLimits=function(r,e){Tn=r,fi=e},l.setRTLTextPlugin=function(r,e,i=!1){if(vi===Uu||vi===Vu||vi===ju)throw new Error("setRTLTextPlugin cannot be called multiple times.");Es=hr.resolveURL(r),vi=Uu,$u=e,Ea(),i||ah()},l.spec=Ie,l.sphericalToCartesian=function([r,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(i),y:r*Math.sin(e)*Math.sin(i),z:r*Math.cos(i)}},l.sqrLen=function(r){var e=r[0],i=r[1];return e*e+i*i},l.sub=function(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r},l.toEvaluationFeature=wl,l.transformMat3=function(r,e,i){var a=e[0],d=e[1],f=e[2];return r[0]=a*i[0]+d*i[3]+f*i[6],r[1]=a*i[1]+d*i[4]+f*i[7],r[2]=a*i[2]+d*i[5]+f*i[8],r},l.transformMat4=gh,l.transformMat4$1=function(r,e,i){var a=e[0],d=e[1];return r[0]=i[0]*a+i[4]*d+i[12],r[1]=i[1]*a+i[5]*d+i[13],r},l.translate=function(r,e,i){var a,d,f,y,w,S,k,A,L,F,N,U,ee=i[0],K=i[1],de=i[2];return e===r?(r[12]=e[0]*ee+e[4]*K+e[8]*de+e[12],r[13]=e[1]*ee+e[5]*K+e[9]*de+e[13],r[14]=e[2]*ee+e[6]*K+e[10]*de+e[14],r[15]=e[3]*ee+e[7]*K+e[11]*de+e[15]):(d=e[1],f=e[2],y=e[3],w=e[4],S=e[5],k=e[6],A=e[7],L=e[8],F=e[9],N=e[10],U=e[11],r[0]=a=e[0],r[1]=d,r[2]=f,r[3]=y,r[4]=w,r[5]=S,r[6]=k,r[7]=A,r[8]=L,r[9]=F,r[10]=N,r[11]=U,r[12]=a*ee+w*K+L*de+e[12],r[13]=d*ee+S*K+F*de+e[13],r[14]=f*ee+k*K+N*de+e[14],r[15]=y*ee+A*K+U*de+e[15]),r},l.triggerPluginCompletionEvent=sh,l.unicodeBlockLookup=Je,l.uniqueId=function(){return $e++},l.validateCustomStyleLayer=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateLight=qr,l.validateStyle=Yo,l.vectorTile=Ia,l.warnOnce=Ge,l.wrap=tt}),b(["./shared"],function(l){function G($){const M=typeof $;if(M==="number"||M==="boolean"||M==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){let j="[";for(const Y of $)j+=`${G(Y)},`;return`${j}]`}const D=Object.keys($).sort();let V="{";for(let j=0;j<D.length;j++)V+=`${JSON.stringify(D[j])}:${G($[D[j]])},`;return`${V}}`}function J($){let M="";for(const D of l.refProperties)M+=`/${G($[D])}`;return M}class we{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,D){for(const j of M){this._layerConfigs[j.id]=j;const Y=this._layers[j.id]=l.createStyleLayer(j);Y._featureFilter=l.createFilter(Y.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(const j of D)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};const V=function(j,Y){const oe={};for(let Q=0;Q<j.length;Q++){const se=Y&&Y[j[Q].id]||J(j[Q]);Y&&(Y[j[Q].id]=se);let Te=oe[se];Te||(Te=oe[se]=[]),Te.push(j[Q])}const te=[];for(const Q in oe)te.push(oe[Q]);return te}(Object.values(this._layerConfigs),this.keyCache);for(const j of V){const Y=j.map(Re=>this._layers[Re.id]),oe=Y[0];if(oe.visibility==="none")continue;const te=oe.source||"";let Q=this.familiesBySource[te];Q||(Q=this.familiesBySource[te]={});const se=oe.sourceLayer||"_geojsonTileLayer";let Te=Q[se];Te||(Te=Q[se]=[]),Te.push(Y)}}}class fe{constructor(M){const D={},V=[];for(const te in M){const Q=M[te],se=D[te]={};for(const Te in Q){const Re=Q[+Te];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Ee={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};V.push(Ee),se[Te]={rect:Ee,metrics:Re.metrics}}}const{w:j,h:Y}=l.potpack(V),oe=new l.AlphaImage({width:j||1,height:Y||1});for(const te in M){const Q=M[te];for(const se in Q){const Te=Q[+se];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;const Re=D[te][se].rect;l.AlphaImage.copy(Te.bitmap,oe,{x:0,y:0},{x:Re.x+1,y:Re.y+1},Te.bitmap)}}this.image=oe,this.positions=D}}l.register("GlyphAtlas",fe);class H{constructor(M){this.tileID=new l.OverscaledTileID(M.tileID.overscaledZ,M.tileID.wrap,M.tileID.canonical.z,M.tileID.canonical.x,M.tileID.canonical.y),this.uid=M.uid,this.zoom=M.zoom,this.pixelRatio=M.pixelRatio,this.tileSize=M.tileSize,this.source=M.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=M.showCollisionBoxes,this.collectResourceTiming=!!M.collectResourceTiming,this.returnDependencies=!!M.returnDependencies,this.promoteId=M.promoteId}parse(M,D,V,j,Y){this.status="parsing",this.data=M,this.collisionBoxArray=new l.CollisionBoxArray;const oe=new l.DictionaryCoder(Object.keys(M.layers).sort()),te=new l.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];const Q={},se={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},Te=D.familiesBySource[this.source];for(const Lt in Te){const Vt=M.layers[Lt];if(!Vt)continue;Vt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Kt=oe.encode(Lt),Bt=[];for(let er=0;er<Vt.length;er++){const Cn=Vt.feature(er),Dn=te.getId(Cn,Lt);Bt.push({feature:Cn,id:Dn,index:er,sourceLayerIndex:Kt})}for(const er of Te[Lt]){const Cn=er[0];Cn.source!==this.source&&l.warnOnce(`layer.source = ${Cn.source} does not equal this.source = ${this.source}`),Cn.minzoom&&this.zoom<Math.floor(Cn.minzoom)||Cn.maxzoom&&this.zoom>=Cn.maxzoom||Cn.visibility!=="none"&&(tt(er,this.zoom,V),(Q[Cn.id]=Cn.createBucket({index:te.bucketLayerIDs.length,layers:er,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kt,sourceID:this.source})).populate(Bt,se,this.tileID.canonical),te.bucketLayerIDs.push(er.map(Dn=>Dn.id)))}}let Re,Ee,dt,mt;const je=l.mapObject(se.glyphDependencies,Lt=>Object.keys(Lt).map(Number));Object.keys(je).length?j.send("getGlyphs",{uid:this.uid,stacks:je},(Lt,Vt)=>{Re||(Re=Lt,Ee=Vt,Wt.call(this))}):Ee={};const Tt=Object.keys(se.iconDependencies);Tt.length?j.send("getImages",{icons:Tt,source:this.source,tileID:this.tileID,type:"icons"},(Lt,Vt)=>{Re||(Re=Lt,dt=Vt,Wt.call(this))}):dt={};const At=Object.keys(se.patternDependencies);function Wt(){if(Re)return Y(Re);if(Ee&&dt&&mt){const Lt=new fe(Ee),Vt=new l.ImageAtlas(dt,mt);for(const Kt in Q){const Bt=Q[Kt];Bt instanceof l.SymbolBucket?(tt(Bt.layers,this.zoom,V),l.performSymbolLayout({bucket:Bt,glyphMap:Ee,glyphPositions:Lt.positions,imageMap:dt,imagePositions:Vt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Bt.hasPattern&&(Bt instanceof l.LineBucket||Bt instanceof l.FillBucket||Bt instanceof l.FillExtrusionBucket)&&(tt(Bt.layers,this.zoom,V),Bt.addFeatures(se,this.tileID.canonical,Vt.patternPositions))}this.status="done",Y(null,{buckets:Object.values(Q).filter(Kt=>!Kt.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Lt.image,imageAtlas:Vt,glyphMap:this.returnDependencies?Ee:null,iconMap:this.returnDependencies?dt:null,glyphPositions:this.returnDependencies?Lt.positions:null})}}At.length?j.send("getImages",{icons:At,source:this.source,tileID:this.tileID,type:"patterns"},(Lt,Vt)=>{Re||(Re=Lt,mt=Vt,Wt.call(this))}):mt={},Wt.call(this)}}function tt($,M,D){const V=new l.EvaluationParameters(M);for(const j of $)j.recalculate(V,D)}function Xe($,M){const D=l.getArrayBuffer($.request,(V,j,Y,oe)=>{V?M(V):j&&M(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(j)),rawData:j,cacheControl:Y,expires:oe})});return()=>{D.cancel(),M()}}class $e{constructor(M,D,V,j){this.actor=M,this.layerIndex=D,this.availableImages=V,this.loadVectorData=j||Xe,this.loading={},this.loaded={}}loadTile(M,D){const V=M.uid;this.loading||(this.loading={});const j=!!(M&&M.request&&M.request.collectResourceTiming)&&new l.RequestPerformance(M.request),Y=this.loading[V]=new H(M);Y.abort=this.loadVectorData(M,(oe,te)=>{if(delete this.loading[V],oe||!te)return Y.status="done",this.loaded[V]=Y,D(oe);const Q=te.rawData,se={};te.expires&&(se.expires=te.expires),te.cacheControl&&(se.cacheControl=te.cacheControl);const Te={};if(j){const Re=j.finish();Re&&(Te.resourceTiming=JSON.parse(JSON.stringify(Re)))}Y.vectorTile=te.vectorTile,Y.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(Re,Ee)=>{if(Re||!Ee)return D(Re);D(null,l.extend({rawTileData:Q.slice(0)},Ee,se,Te))}),this.loaded=this.loaded||{},this.loaded[V]=Y})}reloadTile(M,D){const V=this.loaded,j=M.uid,Y=this;if(V&&V[j]){const oe=V[j];oe.showCollisionBoxes=M.showCollisionBoxes;const te=(Q,se)=>{const Te=oe.reloadCallback;Te&&(delete oe.reloadCallback,oe.parse(oe.vectorTile,Y.layerIndex,this.availableImages,Y.actor,Te)),D(Q,se)};oe.status==="parsing"?oe.reloadCallback=te:oe.status==="done"&&(oe.vectorTile?oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}}abortTile(M,D){const V=this.loading,j=M.uid;V&&V[j]&&V[j].abort&&(V[j].abort(),delete V[j]),D()}removeTile(M,D){const V=this.loaded,j=M.uid;V&&V[j]&&delete V[j],D()}}class fn{constructor(){this.loaded={}}loadTile(M,D){const{uid:V,encoding:j,rawImageData:Y}=M,oe=l.isImageBitmap(Y)?this.getImageData(Y):Y,te=new l.DEMData(V,oe,j);this.loaded=this.loaded||{},this.loaded[V]=te,D(null,te)}getImageData(M){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(M.width,M.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=M.width,this.offscreenCanvas.height=M.height,this.offscreenCanvasContext.drawImage(M,0,0,M.width,M.height);const D=this.offscreenCanvasContext.getImageData(-1,-1,M.width+2,M.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:D.width,height:D.height},D.data)}removeTile(M){const D=this.loaded,V=M.uid;D&&D[V]&&delete D[V]}}var pe=function $(M,D){var V,j=M&&M.type;if(j==="FeatureCollection")for(V=0;V<M.features.length;V++)$(M.features[V],D);else if(j==="GeometryCollection")for(V=0;V<M.geometries.length;V++)$(M.geometries[V],D);else if(j==="Feature")$(M.geometry,D);else if(j==="Polygon")ie(M.coordinates,D);else if(j==="MultiPolygon")for(V=0;V<M.coordinates.length;V++)ie(M.coordinates[V],D);return M};function ie($,M){if($.length!==0){he($[0],M);for(var D=1;D<$.length;D++)he($[D],!M)}}function he($,M){for(var D=0,V=0,j=0,Y=$.length,oe=Y-1;j<Y;oe=j++){var te=($[j][0]-$[oe][0])*($[oe][1]+$[j][1]),Q=D+te;V+=Math.abs(D)>=Math.abs(te)?D-Q+te:te-Q+D,D=Q}D+V>=0!=!!M&&$.reverse()}const Ne=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ge{constructor(M){this._feature=M,this.extent=l.EXTENT,this.type=M.type,this.properties=M.tags,"id"in M&&!isNaN(M.id)&&(this.id=parseInt(M.id,10))}loadGeometry(){if(this._feature.type===1){const M=[];for(const D of this._feature.geometry)M.push([new l.pointGeometry(D[0],D[1])]);return M}{const M=[];for(const D of this._feature.geometry){const V=[];for(const j of D)V.push(new l.pointGeometry(j[0],j[1]));M.push(V)}return M}}toGeoJSON(M,D,V){return Ne.call(this,M,D,V)}}class lt{constructor(M){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=M.length,this._features=M}feature(M){return new Ge(this._features[M])}}var yt={exports:{}},ft=l.pointGeometry,xn=l.vectorTile.VectorTileFeature,kt=rn;function rn($,M){this.options=M||{},this.features=$,this.length=$.length}function Nn($,M){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=M||4096}rn.prototype.feature=function($){return new Nn(this.features[$],this.options.extent)},Nn.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var M=0;M<$.length;M++){for(var D=$[M],V=[],j=0;j<D.length;j++)V.push(new ft(D[j][0],D[j][1]));this.geometry.push(V)}return this.geometry},Nn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,M=1/0,D=-1/0,V=1/0,j=-1/0,Y=0;Y<$.length;Y++)for(var oe=$[Y],te=0;te<oe.length;te++){var Q=oe[te];M=Math.min(M,Q.x),D=Math.max(D,Q.x),V=Math.min(V,Q.y),j=Math.max(j,Q.y)}return[M,V,D,j]},Nn.prototype.toGeoJSON=xn.prototype.toGeoJSON;var cr=l.pbf,zn=kt;function hr($){var M=new cr;return function(D,V){for(var j in D.layers)V.writeMessage(3,It,D.layers[j])}($,M),M.finish()}function It($,M){var D;M.writeVarintField(15,$.version||1),M.writeStringField(1,$.name||""),M.writeVarintField(5,$.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<$.length;D++)V.feature=$.feature(D),M.writeMessage(2,ei,V);var j=V.keys;for(D=0;D<j.length;D++)M.writeStringField(3,j[D]);var Y=V.values;for(D=0;D<Y.length;D++)M.writeMessage(4,Tn,Y[D])}function ei($,M){var D=$.feature;D.id!==void 0&&M.writeVarintField(1,D.id),M.writeMessage(2,ut,$),M.writeVarintField(3,D.type),M.writeMessage(4,un,D)}function ut($,M){var D=$.feature,V=$.keys,j=$.values,Y=$.keycache,oe=$.valuecache;for(var te in D.properties){var Q=D.properties[te],se=Y[te];if(Q!==null){se===void 0&&(V.push(te),Y[te]=se=V.length-1),M.writeVarint(se);var Te=typeof Q;Te!=="string"&&Te!=="boolean"&&Te!=="number"&&(Q=JSON.stringify(Q));var Re=Te+":"+Q,Ee=oe[Re];Ee===void 0&&(j.push(Q),oe[Re]=Ee=j.length-1),M.writeVarint(Ee)}}}function Pt($,M){return(M<<3)+(7&$)}function He($){return $<<1^$>>31}function un($,M){for(var D=$.loadGeometry(),V=$.type,j=0,Y=0,oe=D.length,te=0;te<oe;te++){var Q=D[te],se=1;V===1&&(se=Q.length),M.writeVarint(Pt(1,se));for(var Te=V===3?Q.length-1:Q.length,Re=0;Re<Te;Re++){Re===1&&V!==1&&M.writeVarint(Pt(2,Te-1));var Ee=Q[Re].x-j,dt=Q[Re].y-Y;M.writeVarint(He(Ee)),M.writeVarint(He(dt)),j+=Ee,Y+=dt}V===3&&M.writeVarint(Pt(7,1))}}function Tn($,M){var D=typeof $;D==="string"?M.writeStringField(1,$):D==="boolean"?M.writeBooleanField(7,$):D==="number"&&($%1!=0?M.writeDoubleField(3,$):$<0?M.writeSVarintField(6,$):M.writeVarintField(5,$))}function fi($,M,D,V,j,Y){if(j-V<=D)return;const oe=V+j>>1;Ur($,M,oe,V,j,Y%2),fi($,M,D,V,oe-1,Y+1),fi($,M,D,oe+1,j,Y+1)}function Ur($,M,D,V,j,Y){for(;j>V;){if(j-V>600){const se=j-V+1,Te=D-V+1,Re=Math.log(se),Ee=.5*Math.exp(2*Re/3),dt=.5*Math.sqrt(Re*Ee*(se-Ee)/se)*(Te-se/2<0?-1:1);Ur($,M,D,Math.max(V,Math.floor(D-Te*Ee/se+dt)),Math.min(j,Math.floor(D+(se-Te)*Ee/se+dt)),Y)}const oe=M[2*D+Y];let te=V,Q=j;for(Vr($,M,V,D),M[2*j+Y]>oe&&Vr($,M,V,j);te<Q;){for(Vr($,M,te,Q),te++,Q--;M[2*te+Y]<oe;)te++;for(;M[2*Q+Y]>oe;)Q--}M[2*V+Y]===oe?Vr($,M,V,Q):(Q++,Vr($,M,Q,j)),Q<=D&&(V=Q+1),D<=Q&&(j=Q-1)}}function Vr($,M,D,V){_r($,D,V),_r(M,2*D,2*V),_r(M,2*D+1,2*V+1)}function _r($,M,D){const V=$[M];$[M]=$[D],$[D]=V}function ti($,M,D,V){const j=$-D,Y=M-V;return j*j+Y*Y}yt.exports=hr,yt.exports.fromVectorTileJs=hr,yt.exports.fromGeojsonVt=function($,M){M=M||{};var D={};for(var V in $)D[V]=new zn($[V].features,M),D[V].name=V,D[V].version=M.version,D[V].extent=M.extent;return hr({layers:D})},yt.exports.GeoJSONWrapper=zn;const ko=$=>$[0],jr=$=>$[1];class hs{constructor(M,D=ko,V=jr,j=64,Y=Float64Array){this.nodeSize=j,this.points=M;const oe=M.length<65536?Uint16Array:Uint32Array,te=this.ids=new oe(M.length),Q=this.coords=new Y(2*M.length);for(let se=0;se<M.length;se++)te[se]=se,Q[2*se]=D(M[se]),Q[2*se+1]=V(M[se]);fi(te,Q,j,0,te.length-1,0)}range(M,D,V,j){return function(Y,oe,te,Q,se,Te,Re){const Ee=[0,Y.length-1,0],dt=[];let mt,je;for(;Ee.length;){const Tt=Ee.pop(),At=Ee.pop(),Wt=Ee.pop();if(At-Wt<=Re){for(let Kt=Wt;Kt<=At;Kt++)mt=oe[2*Kt],je=oe[2*Kt+1],mt>=te&&mt<=se&&je>=Q&&je<=Te&&dt.push(Y[Kt]);continue}const Lt=Math.floor((Wt+At)/2);mt=oe[2*Lt],je=oe[2*Lt+1],mt>=te&&mt<=se&&je>=Q&&je<=Te&&dt.push(Y[Lt]);const Vt=(Tt+1)%2;(Tt===0?te<=mt:Q<=je)&&(Ee.push(Wt),Ee.push(Lt-1),Ee.push(Vt)),(Tt===0?se>=mt:Te>=je)&&(Ee.push(Lt+1),Ee.push(At),Ee.push(Vt))}return dt}(this.ids,this.coords,M,D,V,j,this.nodeSize)}within(M,D,V){return function(j,Y,oe,te,Q,se){const Te=[0,j.length-1,0],Re=[],Ee=Q*Q;for(;Te.length;){const dt=Te.pop(),mt=Te.pop(),je=Te.pop();if(mt-je<=se){for(let Vt=je;Vt<=mt;Vt++)ti(Y[2*Vt],Y[2*Vt+1],oe,te)<=Ee&&Re.push(j[Vt]);continue}const Tt=Math.floor((je+mt)/2),At=Y[2*Tt],Wt=Y[2*Tt+1];ti(At,Wt,oe,te)<=Ee&&Re.push(j[Tt]);const Lt=(dt+1)%2;(dt===0?oe-Q<=At:te-Q<=Wt)&&(Te.push(je),Te.push(Tt-1),Te.push(Lt)),(dt===0?oe+Q>=At:te+Q>=Wt)&&(Te.push(Tt+1),Te.push(mt),Te.push(Lt))}return Re}(this.ids,this.coords,M,D,V,this.nodeSize)}}const Fs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},Pr=Math.fround||(Ar=new Float32Array(1),$=>(Ar[0]=+$,Ar[0]));var Ar;class io{constructor(M){this.options=mi(Object.create(Fs),M),this.trees=new Array(this.options.maxZoom+1)}load(M){const{log:D,minZoom:V,maxZoom:j,nodeSize:Y}=this.options;D&&console.time("total time");const oe=`prepare ${M.length} points`;D&&console.time(oe),this.points=M;let te=[];for(let Q=0;Q<M.length;Q++)M[Q].geometry&&te.push(ni(M[Q],Q));this.trees[j+1]=new hs(te,fs,Ii,Y,Float32Array),D&&console.timeEnd(oe);for(let Q=j;Q>=V;Q--){const se=+Date.now();te=this._cluster(te,Q),this.trees[Q]=new hs(te,fs,Ii,Y,Float32Array),D&&console.log("z%d: %d clusters in %dms",Q,te.length,+Date.now()-se)}return D&&console.timeEnd("total time"),this}getClusters(M,D){let V=((M[0]+180)%360+360)%360-180;const j=Math.max(-90,Math.min(90,M[1]));let Y=M[2]===180?180:((M[2]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)V=-180,Y=180;else if(V>Y){const Te=this.getClusters([V,j,180,oe],D),Re=this.getClusters([-180,j,Y,oe],D);return Te.concat(Re)}const te=this.trees[this._limitZoom(D)],Q=te.range(Jt(V),Wn(oe),Jt(Y),Wn(j)),se=[];for(const Te of Q){const Re=te.points[Te];se.push(Re.numPoints?ds(Re):this.points[Re.index])}return se}getChildren(M){const D=this._getOriginId(M),V=this._getOriginZoom(M),j="No cluster with the specified id.",Y=this.trees[V];if(!Y)throw new Error(j);const oe=Y.points[D];if(!oe)throw new Error(j);const te=this.options.radius/(this.options.extent*Math.pow(2,V-1)),Q=Y.within(oe.x,oe.y,te),se=[];for(const Te of Q){const Re=Y.points[Te];Re.parentId===M&&se.push(Re.numPoints?ds(Re):this.points[Re.index])}if(se.length===0)throw new Error(j);return se}getLeaves(M,D,V){const j=[];return this._appendLeaves(j,M,D=D||10,V=V||0,0),j}getTile(M,D,V){const j=this.trees[this._limitZoom(M)],Y=Math.pow(2,M),{extent:oe,radius:te}=this.options,Q=te/oe,se=(V-Q)/Y,Te=(V+1+Q)/Y,Re={features:[]};return this._addTileFeatures(j.range((D-Q)/Y,se,(D+1+Q)/Y,Te),j.points,D,V,Y,Re),D===0&&this._addTileFeatures(j.range(1-Q/Y,se,1,Te),j.points,Y,V,Y,Re),D===Y-1&&this._addTileFeatures(j.range(0,se,Q/Y,Te),j.points,-1,V,Y,Re),Re.features.length?Re:null}getClusterExpansionZoom(M){let D=this._getOriginZoom(M)-1;for(;D<=this.options.maxZoom;){const V=this.getChildren(M);if(D++,V.length!==1)break;M=V[0].properties.cluster_id}return D}_appendLeaves(M,D,V,j,Y){const oe=this.getChildren(D);for(const te of oe){const Q=te.properties;if(Q&&Q.cluster?Y+Q.point_count<=j?Y+=Q.point_count:Y=this._appendLeaves(M,Q.cluster_id,V,j,Y):Y<j?Y++:M.push(te),M.length===V)break}return Y}_addTileFeatures(M,D,V,j,Y,oe){for(const te of M){const Q=D[te],se=Q.numPoints;let Te,Re,Ee;if(se)Te=ps(Q),Re=Q.x,Ee=Q.y;else{const je=this.points[Q.index];Te=je.properties,Re=Jt(je.geometry.coordinates[0]),Ee=Wn(je.geometry.coordinates[1])}const dt={type:1,geometry:[[Math.round(this.options.extent*(Re*Y-V)),Math.round(this.options.extent*(Ee*Y-j))]],tags:Te};let mt;se?mt=Q.id:this.options.generateId?mt=Q.index:this.points[Q.index].id&&(mt=this.points[Q.index].id),mt!==void 0&&(dt.id=mt),oe.features.push(dt)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(Math.floor(+M),this.options.maxZoom+1))}_cluster(M,D){const V=[],{radius:j,extent:Y,reduce:oe,minPoints:te}=this.options,Q=j/(Y*Math.pow(2,D));for(let se=0;se<M.length;se++){const Te=M[se];if(Te.zoom<=D)continue;Te.zoom=D;const Re=this.trees[D+1],Ee=Re.within(Te.x,Te.y,Q),dt=Te.numPoints||1;let mt=dt;for(const je of Ee){const Tt=Re.points[je];Tt.zoom>D&&(mt+=Tt.numPoints||1)}if(mt>dt&&mt>=te){let je=Te.x*dt,Tt=Te.y*dt,At=oe&&dt>1?this._map(Te,!0):null;const Wt=(se<<5)+(D+1)+this.points.length;for(const Lt of Ee){const Vt=Re.points[Lt];if(Vt.zoom<=D)continue;Vt.zoom=D;const Kt=Vt.numPoints||1;je+=Vt.x*Kt,Tt+=Vt.y*Kt,Vt.parentId=Wt,oe&&(At||(At=this._map(Te,!0)),oe(At,this._map(Vt)))}Te.parentId=Wt,V.push(vr(je/mt,Tt/mt,Wt,mt,At))}else if(V.push(Te),mt>1)for(const je of Ee){const Tt=Re.points[je];Tt.zoom<=D||(Tt.zoom=D,V.push(Tt))}}return V}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,D){if(M.numPoints)return D?mi({},M.properties):M.properties;const V=this.points[M.index].properties,j=this.options.map(V);return D&&j===V?mi({},j):j}}function vr($,M,D,V,j){return{x:Pr($),y:Pr(M),zoom:1/0,id:D,parentId:-1,numPoints:V,properties:j}}function ni($,M){const[D,V]=$.geometry.coordinates;return{x:Pr(Jt(D)),y:Pr(Wn(V)),zoom:1/0,index:M,parentId:-1}}function ds($){return{type:"Feature",id:$.id,properties:ps($),geometry:{type:"Point",coordinates:[(M=$.x,360*(M-.5)),Io($.y)]}};var M}function ps($){const M=$.numPoints,D=M>=1e4?`${Math.round(M/1e3)}k`:M>=1e3?Math.round(M/100)/10+"k":M;return mi(mi({},$.properties),{cluster:!0,cluster_id:$.id,point_count:M,point_count_abbreviated:D})}function Jt($){return $/360+.5}function Wn($){const M=Math.sin($*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function Io($){const M=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function mi($,M){for(const D in M)$[D]=M[D];return $}function fs($){return $.x}function Ii($){return $.y}function Vi($,M,D,V){for(var j,Y=V,oe=D-M>>1,te=D-M,Q=$[M],se=$[M+1],Te=$[D],Re=$[D+1],Ee=M+3;Ee<D;Ee+=3){var dt=Wo($[Ee],$[Ee+1],Q,se,Te,Re);if(dt>Y)j=Ee,Y=dt;else if(dt===Y){var mt=Math.abs(Ee-oe);mt<te&&(j=Ee,te=mt)}}Y>V&&(j-M>3&&Vi($,M,j,V),$[j+2]=Y,D-j>3&&Vi($,j,D,V))}function Wo($,M,D,V,j,Y){var oe=j-D,te=Y-V;if(oe!==0||te!==0){var Q=(($-D)*oe+(M-V)*te)/(oe*oe+te*te);Q>1?(D=j,V=Y):Q>0&&(D+=oe*Q,V+=te*Q)}return(oe=$-D)*oe+(te=M-V)*te}function ji($,M,D,V){var j={id:$===void 0?null:$,type:M,geometry:D,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Y){var oe=Y.geometry,te=Y.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")Ie(Y,oe);else if(te==="Polygon"||te==="MultiLineString")for(var Q=0;Q<oe.length;Q++)Ie(Y,oe[Q]);else if(te==="MultiPolygon")for(Q=0;Q<oe.length;Q++)for(var se=0;se<oe[Q].length;se++)Ie(Y,oe[Q][se])}(j),j}function Ie($,M){for(var D=0;D<M.length;D+=3)$.minX=Math.min($.minX,M[D]),$.minY=Math.min($.minY,M[D+1]),$.maxX=Math.max($.maxX,M[D]),$.maxY=Math.max($.maxY,M[D+1])}function We($,M,D,V){if(M.geometry){var j=M.geometry.coordinates,Y=M.geometry.type,oe=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),te=[],Q=M.id;if(D.promoteId?Q=M.properties[D.promoteId]:D.generateId&&(Q=V||0),Y==="Point")$n(j,te);else if(Y==="MultiPoint")for(var se=0;se<j.length;se++)$n(j[se],te);else if(Y==="LineString")dr(j,te,oe,!1);else if(Y==="MultiLineString"){if(D.lineMetrics){for(se=0;se<j.length;se++)dr(j[se],te=[],oe,!1),$.push(ji(Q,"LineString",te,M.properties));return}Nt(j,te,oe,!1)}else if(Y==="Polygon")Nt(j,te,oe,!0);else{if(Y!=="MultiPolygon"){if(Y==="GeometryCollection"){for(se=0;se<M.geometry.geometries.length;se++)We($,{id:Q,geometry:M.geometry.geometries[se],properties:M.properties},D,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<j.length;se++){var Te=[];Nt(j[se],Te,oe,!0),te.push(Te)}}$.push(ji(Q,Y,te,M.properties))}}function $n($,M){M.push(Ln($[0])),M.push(ri($[1])),M.push(0)}function dr($,M,D,V){for(var j,Y,oe=0,te=0;te<$.length;te++){var Q=Ln($[te][0]),se=ri($[te][1]);M.push(Q),M.push(se),M.push(0),te>0&&(oe+=V?(j*se-Q*Y)/2:Math.sqrt(Math.pow(Q-j,2)+Math.pow(se-Y,2))),j=Q,Y=se}var Te=M.length-3;M[2]=1,Vi(M,0,Te,D),M[Te+2]=1,M.size=Math.abs(oe),M.start=0,M.end=M.size}function Nt($,M,D,V){for(var j=0;j<$.length;j++){var Y=[];dr($[j],Y,D,V),M.push(Y)}}function Ln($){return $/360+.5}function ri($){var M=Math.sin($*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function xr($,M,D,V,j,Y,oe,te){if(V/=M,Y>=(D/=M)&&oe<V)return $;if(oe<D||Y>=V)return null;for(var Q=[],se=0;se<$.length;se++){var Te=$[se],Re=Te.geometry,Ee=Te.type,dt=j===0?Te.minX:Te.minY,mt=j===0?Te.maxX:Te.maxY;if(dt>=D&&mt<V)Q.push(Te);else if(!(mt<D||dt>=V)){var je=[];if(Ee==="Point"||Ee==="MultiPoint")Gn(Re,je,D,V,j);else if(Ee==="LineString")Ae(Re,je,D,V,j,!1,te.lineMetrics);else if(Ee==="MultiLineString")Ft(Re,je,D,V,j,!1);else if(Ee==="Polygon")Ft(Re,je,D,V,j,!0);else if(Ee==="MultiPolygon")for(var Tt=0;Tt<Re.length;Tt++){var At=[];Ft(Re[Tt],At,D,V,j,!0),At.length&&je.push(At)}if(je.length){if(te.lineMetrics&&Ee==="LineString"){for(Tt=0;Tt<je.length;Tt++)Q.push(ji(Te.id,Ee,je[Tt],Te.tags));continue}Ee!=="LineString"&&Ee!=="MultiLineString"||(je.length===1?(Ee="LineString",je=je[0]):Ee="MultiLineString"),Ee!=="Point"&&Ee!=="MultiPoint"||(Ee=je.length===3?"Point":"MultiPoint"),Q.push(ji(Te.id,Ee,je,Te.tags))}}}return Q.length?Q:null}function Gn($,M,D,V,j){for(var Y=0;Y<$.length;Y+=3){var oe=$[Y+j];oe>=D&&oe<=V&&(M.push($[Y]),M.push($[Y+1]),M.push($[Y+2]))}}function Ae($,M,D,V,j,Y,oe){for(var te,Q,se=Ut($),Te=j===0?Mi:Dt,Re=$.start,Ee=0;Ee<$.length-3;Ee+=3){var dt=$[Ee],mt=$[Ee+1],je=$[Ee+2],Tt=$[Ee+3],At=$[Ee+4],Wt=j===0?dt:mt,Lt=j===0?Tt:At,Vt=!1;oe&&(te=Math.sqrt(Math.pow(dt-Tt,2)+Math.pow(mt-At,2))),Wt<D?Lt>D&&(Q=Te(se,dt,mt,Tt,At,D),oe&&(se.start=Re+te*Q)):Wt>V?Lt<V&&(Q=Te(se,dt,mt,Tt,At,V),oe&&(se.start=Re+te*Q)):pr(se,dt,mt,je),Lt<D&&Wt>=D&&(Q=Te(se,dt,mt,Tt,At,D),Vt=!0),Lt>V&&Wt<=V&&(Q=Te(se,dt,mt,Tt,At,V),Vt=!0),!Y&&Vt&&(oe&&(se.end=Re+te*Q),M.push(se),se=Ut($)),oe&&(Re+=te)}var Kt=$.length-3;dt=$[Kt],mt=$[Kt+1],je=$[Kt+2],(Wt=j===0?dt:mt)>=D&&Wt<=V&&pr(se,dt,mt,je),Kt=se.length-3,Y&&Kt>=3&&(se[Kt]!==se[0]||se[Kt+1]!==se[1])&&pr(se,se[0],se[1],se[2]),se.length&&M.push(se)}function Ut($){var M=[];return M.size=$.size,M.start=$.start,M.end=$.end,M}function Ft($,M,D,V,j,Y){for(var oe=0;oe<$.length;oe++)Ae($[oe],M,D,V,j,Y,!1)}function pr($,M,D,V){$.push(M),$.push(D),$.push(V)}function Mi($,M,D,V,j,Y){var oe=(Y-M)/(V-M);return $.push(Y),$.push(D+(j-D)*oe),$.push(1),oe}function Dt($,M,D,V,j,Y){var oe=(Y-D)/(j-D);return $.push(M+(V-M)*oe),$.push(Y),$.push(1),oe}function on($,M){for(var D=[],V=0;V<$.length;V++){var j,Y=$[V],oe=Y.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")j=Qn(Y.geometry,M);else if(oe==="MultiLineString"||oe==="Polygon"){j=[];for(var te=0;te<Y.geometry.length;te++)j.push(Qn(Y.geometry[te],M))}else if(oe==="MultiPolygon")for(j=[],te=0;te<Y.geometry.length;te++){for(var Q=[],se=0;se<Y.geometry[te].length;se++)Q.push(Qn(Y.geometry[te][se],M));j.push(Q)}D.push(ji(Y.id,oe,j,Y.tags))}return D}function Qn($,M){var D=[];D.size=$.size,$.start!==void 0&&(D.start=$.start,D.end=$.end);for(var V=0;V<$.length;V+=3)D.push($[V]+M,$[V+1],$[V+2]);return D}function ii($,M){if($.transformed)return $;var D,V,j,Y=1<<$.z,oe=$.x,te=$.y;for(D=0;D<$.features.length;D++){var Q=$.features[D],se=Q.geometry,Te=Q.type;if(Q.geometry=[],Te===1)for(V=0;V<se.length;V+=2)Q.geometry.push(Xn(se[V],se[V+1],M,Y,oe,te));else for(V=0;V<se.length;V++){var Re=[];for(j=0;j<se[V].length;j+=2)Re.push(Xn(se[V][j],se[V][j+1],M,Y,oe,te));Q.geometry.push(Re)}}return $.transformed=!0,$}function Xn($,M,D,V,j,Y){return[Math.round(D*($*V-j)),Math.round(D*(M*V-Y))]}function zr($,M,D,V,j){for(var Y=M===j.maxZoom?0:j.tolerance/((1<<M)*j.extent),oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:V,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<$.length;te++){oe.numFeatures++,dn(oe,$[te],Y,j);var Q=$[te].minX,se=$[te].minY,Te=$[te].maxX,Re=$[te].maxY;Q<oe.minX&&(oe.minX=Q),se<oe.minY&&(oe.minY=se),Te>oe.maxX&&(oe.maxX=Te),Re>oe.maxY&&(oe.maxY=Re)}return oe}function dn($,M,D,V){var j=M.geometry,Y=M.type,oe=[];if(Y==="Point"||Y==="MultiPoint")for(var te=0;te<j.length;te+=3)oe.push(j[te]),oe.push(j[te+1]),$.numPoints++,$.numSimplified++;else if(Y==="LineString")Mo(oe,j,$,D,!1,!1);else if(Y==="MultiLineString"||Y==="Polygon")for(te=0;te<j.length;te++)Mo(oe,j[te],$,D,Y==="Polygon",te===0);else if(Y==="MultiPolygon")for(var Q=0;Q<j.length;Q++){var se=j[Q];for(te=0;te<se.length;te++)Mo(oe,se[te],$,D,!0,te===0)}if(oe.length){var Te=M.tags||null;if(Y==="LineString"&&V.lineMetrics){for(var Re in Te={},M.tags)Te[Re]=M.tags[Re];Te.mapbox_clip_start=j.start/j.size,Te.mapbox_clip_end=j.end/j.size}var Ee={geometry:oe,type:Y==="Polygon"||Y==="MultiPolygon"?3:Y==="LineString"||Y==="MultiLineString"?2:1,tags:Te};M.id!==null&&(Ee.id=M.id),$.features.push(Ee)}}function Mo($,M,D,V,j,Y){var oe=V*V;if(V>0&&M.size<(j?oe:V))D.numPoints+=M.length/3;else{for(var te=[],Q=0;Q<M.length;Q+=3)(V===0||M[Q+2]>oe)&&(D.numSimplified++,te.push(M[Q]),te.push(M[Q+1])),D.numPoints++;j&&function(se,Te){for(var Re=0,Ee=0,dt=se.length,mt=dt-2;Ee<dt;mt=Ee,Ee+=2)Re+=(se[Ee]-se[mt])*(se[Ee+1]+se[mt+1]);if(Re>0===Te)for(Ee=0,dt=se.length;Ee<dt/2;Ee+=2){var je=se[Ee],Tt=se[Ee+1];se[Ee]=se[dt-2-Ee],se[Ee+1]=se[dt-1-Ee],se[dt-2-Ee]=je,se[dt-1-Ee]=Tt}}(te,Y),$.push(te)}}function Lr($,M){var D=(M=this.options=function(j,Y){for(var oe in Y)j[oe]=Y[oe];return j}(Object.create(this.options),M)).debug;if(D&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(j,Y){var oe=[];if(j.type==="FeatureCollection")for(var te=0;te<j.features.length;te++)We(oe,j.features[te],Y,te);else We(oe,j.type==="Feature"?j:{geometry:j},Y);return oe}($,M);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(j,Y){var oe=Y.buffer/Y.extent,te=j,Q=xr(j,1,-1-oe,oe,0,-1,2,Y),se=xr(j,1,1-oe,2+oe,0,-1,2,Y);return(Q||se)&&(te=xr(j,1,-oe,1+oe,0,-1,2,Y)||[],Q&&(te=on(Q,1).concat(te)),se&&(te=te.concat(on(se,-1)))),te}(V,M),V.length&&this.splitTile(V,0,0,0),D&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Po($,M,D){return 32*((1<<$)*D+M)+$}function oo($,M){const D=$.tileID.canonical;if(!this._geoJSONIndex)return M(null,null);const V=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!V)return M(null,null);const j=new lt(V.features);let Y=yt.exports(j);Y.byteOffset===0&&Y.byteLength===Y.buffer.byteLength||(Y=new Uint8Array(Y)),M(null,{vectorTile:j,rawData:Y.buffer})}Lr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lr.prototype.splitTile=function($,M,D,V,j,Y,oe){for(var te=[$,M,D,V],Q=this.options,se=Q.debug;te.length;){V=te.pop(),D=te.pop(),M=te.pop(),$=te.pop();var Te=1<<M,Re=Po(M,D,V),Ee=this.tiles[Re];if(!Ee&&(se>1&&console.time("creation"),Ee=this.tiles[Re]=zr($,M,D,V,Q),this.tileCoords.push({z:M,x:D,y:V}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,D,V,Ee.numFeatures,Ee.numPoints,Ee.numSimplified),console.timeEnd("creation"));var dt="z"+M;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(Ee.source=$,j){if(M===Q.maxZoom||M===j)continue;var mt=1<<j-M;if(D!==Math.floor(Y/mt)||V!==Math.floor(oe/mt))continue}else if(M===Q.indexMaxZoom||Ee.numPoints<=Q.indexMaxPoints)continue;if(Ee.source=null,$.length!==0){se>1&&console.time("clipping");var je,Tt,At,Wt,Lt,Vt,Kt=.5*Q.buffer/Q.extent,Bt=.5-Kt,er=.5+Kt,Cn=1+Kt;je=Tt=At=Wt=null,Lt=xr($,Te,D-Kt,D+er,0,Ee.minX,Ee.maxX,Q),Vt=xr($,Te,D+Bt,D+Cn,0,Ee.minX,Ee.maxX,Q),$=null,Lt&&(je=xr(Lt,Te,V-Kt,V+er,1,Ee.minY,Ee.maxY,Q),Tt=xr(Lt,Te,V+Bt,V+Cn,1,Ee.minY,Ee.maxY,Q),Lt=null),Vt&&(At=xr(Vt,Te,V-Kt,V+er,1,Ee.minY,Ee.maxY,Q),Wt=xr(Vt,Te,V+Bt,V+Cn,1,Ee.minY,Ee.maxY,Q),Vt=null),se>1&&console.timeEnd("clipping"),te.push(je||[],M+1,2*D,2*V),te.push(Tt||[],M+1,2*D,2*V+1),te.push(At||[],M+1,2*D+1,2*V),te.push(Wt||[],M+1,2*D+1,2*V+1)}}},Lr.prototype.getTile=function($,M,D){var V=this.options,j=V.extent,Y=V.debug;if($<0||$>24)return null;var oe=1<<$,te=Po($,M=(M%oe+oe)%oe,D);if(this.tiles[te])return ii(this.tiles[te],j);Y>1&&console.log("drilling down to z%d-%d-%d",$,M,D);for(var Q,se=$,Te=M,Re=D;!Q&&se>0;)se--,Te=Math.floor(Te/2),Re=Math.floor(Re/2),Q=this.tiles[Po(se,Te,Re)];return Q&&Q.source?(Y>1&&console.log("found parent tile z%d-%d-%d",se,Te,Re),Y>1&&console.time("drilling down"),this.splitTile(Q.source,se,Te,Re,$,M,D),Y>1&&console.timeEnd("drilling down"),this.tiles[te]?ii(this.tiles[te],j):null):null};class so extends $e{constructor(M,D,V,j){super(M,D,V,oo),j&&(this.loadGeoJSON=j)}loadData(M,D){var V;(V=this._pendingRequest)===null||V===void 0||V.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const j=!!(M&&M.request&&M.request.collectResourceTiming)&&new l.RequestPerformance(M.request);this._pendingCallback=D,this._pendingRequest=this.loadGeoJSON(M,(Y,oe)=>{if(delete this._pendingCallback,delete this._pendingRequest,Y||!oe)return D(Y);if(typeof oe!="object")return D(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));{pe(oe,!0);try{if(M.filter){const Q=l.createExpression(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(Te=>`${Te.key}: ${Te.message}`).join(", "));oe={type:"FeatureCollection",features:oe.features.filter(Te=>Q.value.evaluate({zoom:0},Te))}}this._geoJSONIndex=M.cluster?new io(function({superclusterOptions:Q,clusterProperties:se}){if(!se||!Q)return Q;const Te={},Re={},Ee={accumulated:null,zoom:0},dt={properties:null},mt=Object.keys(se);for(const je of mt){const[Tt,At]=se[je],Wt=l.createExpression(At),Lt=l.createExpression(typeof Tt=="string"?[Tt,["accumulated"],["get",je]]:Tt);Te[je]=Wt.value,Re[je]=Lt.value}return Q.map=je=>{dt.properties=je;const Tt={};for(const At of mt)Tt[At]=Te[At].evaluate(Ee,dt);return Tt},Q.reduce=(je,Tt)=>{dt.properties=Tt;for(const At of mt)Ee.accumulated=je[At],je[At]=Re[At].evaluate(Ee,dt)},Q}(M)).load(oe.features):function(Q,se){return new Lr(Q,se)}(oe,M.geojsonVtOptions)}catch(Q){return D(Q)}this.loaded={};const te={};if(j){const Q=j.finish();Q&&(te.resourceTiming={},te.resourceTiming[M.source]=JSON.parse(JSON.stringify(Q)))}D(null,te)}})}reloadTile(M,D){const V=this.loaded;return V&&V[M.uid]?super.reloadTile(M,D):this.loadTile(M,D)}loadGeoJSON(M,D){if(M.request)return l.getJSON(M.request,D);if(typeof M.data=="string")try{D(null,JSON.parse(M.data))}catch{D(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`))}else D(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(M,D){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),D()}getClusterExpansionZoom(M,D){try{D(null,this._geoJSONIndex.getClusterExpansionZoom(M.clusterId))}catch(V){D(V)}}getClusterChildren(M,D){try{D(null,this._geoJSONIndex.getChildren(M.clusterId))}catch(V){D(V)}}getClusterLeaves(M,D){try{D(null,this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset))}catch(V){D(V)}}}class ao{constructor(M){this.self=M,this.actor=new l.Actor(M,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:$e,geojson:so},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(D,V)=>{if(this.workerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.workerSourceTypes[D]=V},this.self.registerRTLTextPlugin=D=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=D.applyArabicShaping,l.plugin.processBidirectionalText=D.processBidirectionalText,l.plugin.processStyledBidirectionalText=D.processStyledBidirectionalText}}setReferrer(M,D){this.referrer=D}setImages(M,D,V){this.availableImages[M]=D;for(const j in this.workerSources[M]){const Y=this.workerSources[M][j];for(const oe in Y)Y[oe].availableImages=D}V()}setLayers(M,D,V){this.getLayerIndex(M).replace(D),V()}updateLayers(M,D,V){this.getLayerIndex(M).update(D.layers,D.removedIds),V()}loadTile(M,D,V){this.getWorkerSource(M,D.type,D.source).loadTile(D,V)}loadDEMTile(M,D,V){this.getDEMWorkerSource(M,D.source).loadTile(D,V)}reloadTile(M,D,V){this.getWorkerSource(M,D.type,D.source).reloadTile(D,V)}abortTile(M,D,V){this.getWorkerSource(M,D.type,D.source).abortTile(D,V)}removeTile(M,D,V){this.getWorkerSource(M,D.type,D.source).removeTile(D,V)}removeDEMTile(M,D){this.getDEMWorkerSource(M,D.source).removeTile(D)}removeSource(M,D,V){if(!this.workerSources[M]||!this.workerSources[M][D.type]||!this.workerSources[M][D.type][D.source])return;const j=this.workerSources[M][D.type][D.source];delete this.workerSources[M][D.type][D.source],j.removeSource!==void 0?j.removeSource(D,V):V()}loadWorkerSource(M,D,V){try{this.self.importScripts(D.url),V()}catch(j){V(j.toString())}}syncRTLPluginState(M,D,V){try{l.plugin.setState(D);const j=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&j!=null){this.self.importScripts(j);const Y=l.plugin.isParsed();V(Y?void 0:new Error(`RTL Text Plugin failed to import scripts from ${j}`),Y)}}catch(j){V(j.toString())}}getAvailableImages(M){let D=this.availableImages[M];return D||(D=[]),D}getLayerIndex(M){let D=this.layerIndexes[M];return D||(D=this.layerIndexes[M]=new we),D}getWorkerSource(M,D,V){if(this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][D]||(this.workerSources[M][D]={}),!this.workerSources[M][D][V]){const j={send:(Y,oe,te)=>{this.actor.send(Y,oe,te,M)}};this.workerSources[M][D][V]=new this.workerSourceTypes[D](j,this.getLayerIndex(M),this.getAvailableImages(M))}return this.workerSources[M][D][V]}getDEMWorkerSource(M,D){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][D]||(this.demWorkerSources[M][D]=new fn),this.demWorkerSources[M][D]}enforceCacheSizeLimit(M,D){l.enforceCacheSizeLimit(D)}}return l.isWorker()&&(self.worker=new ao(self)),ao}),b(["./shared"],function(l){var G=J;function J(h){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var c,p,g=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(g);try{p=new Worker(x),c=!0}catch{c=!1}return p&&p.terminate(),URL.revokeObjectURL(x),c}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var c=document.createElement("canvas");c.width=c.height=1;var p=c.getContext("2d");if(!p)return!1;var g=p.getImageData(0,0,1,1);return g&&g.width===c.width}()?(we[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(we[s]=function(c){var p,g=function(x){var E=document.createElement("canvas"),T=Object.create(J.webGLContextAttributes);return T.failIfMajorPerformanceCaveat=x,E.getContext("webgl",T)||E.getContext("experimental-webgl",T)}(c);if(!g)return!1;try{p=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!p||g.isContextLost())&&(g.shaderSource(p,"void main() {}"),g.compileShader(p),g.getShaderParameter(p,g.COMPILE_STATUS)===!0)}(s)),we[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(h)}var we={};function fe(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let s=0;s<h.length;s++)if(!fe(h[s],t[s]))return!1;return!0}if(typeof h=="object"&&h!==null&&t!==null){if(typeof t!="object"||Object.keys(h).length!==Object.keys(t).length)return!1;for(const s in h)if(!fe(h[s],t[s]))return!1;return!0}return h===t}J.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class H{static testProp(t){if(!H.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in H.docStyle)return t[s];return t[0]}static create(t,s,c){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),c&&c.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(t,s){t.style[H.transformProp]=s}static addEventListener(t,s,c,p={}){t.addEventListener(s,c,"passive"in p?p:p.capture)}static removeEventListener(t,s,c,p={}){t.removeEventListener(s,c,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",H.suppressClickInternal,!0)},0)}static mousePos(t,s){const c=t.getBoundingClientRect();return new l.pointGeometry(s.clientX-c.left-t.clientLeft,s.clientY-c.top-t.clientTop)}static touchPos(t,s){const c=t.getBoundingClientRect(),p=[];for(let g=0;g<s.length;g++)p.push(new l.pointGeometry(s[g].clientX-c.left-t.clientLeft,s[g].clientY-c.top-t.clientTop));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);class tt{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,c){const p=function(g){const x=g.match(Xe);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return p.path+=`${s}${c}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(p)}setTransformRequest(t){this._transformRequestFn=t}}const Xe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class $e{constructor(t,s,c,p){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,p)}update(t,s,c){const{width:p,height:g}=t,x=!(this.size&&this.size[0]===p&&this.size[1]===g||c),{context:E}=this,{gl:T}=E;if(this.useMipmap=Boolean(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[p,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.isImageBitmap(t)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,p,g,0,this.format,T.UNSIGNED_BYTE,t.data);else{const{x:I,y:z}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.isImageBitmap(t)?T.texSubImage2D(T.TEXTURE_2D,0,I,z,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,I,z,p,g,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(t,s,c){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),c!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c||t),this.filter=t),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function fn(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class pe extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:c}of this.requestors)this._notify(s,c);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let c=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||s<p[1])return!1;c=p[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const c=this.images[t];if(c.data.width!==s.data.width||c.data.height!==s.data.height)throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let c=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const c={};for(const p of t){this.images[p]||this.fire(new l.Event("styleimagemissing",{id:p}));const g=this.images[p];g?c[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:l.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,c)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],c=this.getImage(t);if(!c)return null;if(s&&s.position.version===c.version)return s.position;if(s)s.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},g=new l.ImagePosition(p,c);this.patterns[t]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new $e(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:c}=l.potpack(t),p=this.atlasImage;p.resize({width:s||1,height:c||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],E=x.x+1,T=x.y+1,I=this.images[g].data,z=I.width,R=I.height;l.RGBAImage.copy(I,p,{x:0,y:0},{x:E,y:T},{width:z,height:R}),l.RGBAImage.copy(I,p,{x:0,y:R-1},{x:E,y:T-1},{width:z,height:1}),l.RGBAImage.copy(I,p,{x:0,y:0},{x:E,y:T+R},{width:z,height:1}),l.RGBAImage.copy(I,p,{x:z-1,y:0},{x:E-1,y:T},{width:1,height:R}),l.RGBAImage.copy(I,p,{x:0,y:0},{x:E+z,y:T},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const c=this.images[s];c||l.warnOnce(`Image with ID: "${s}" was not found`),fn(c)&&this.updateImage(s,c)}}}const ie=1e20;function he(h,t,s,c,p,g,x,E,T){for(let I=t;I<t+c;I++)Ne(h,s*g+I,g,p,x,E,T);for(let I=s;I<s+p;I++)Ne(h,I*g+t,1,c,x,E,T)}function Ne(h,t,s,c,p,g,x){g[0]=0,x[0]=-ie,x[1]=ie,p[0]=h[t];for(let E=1,T=0,I=0;E<c;E++){p[E]=h[t+E*s];const z=E*E;do{const R=g[T];I=(p[E]-p[R]+z-R*R)/(E-R)/2}while(I<=x[T]&&--T>-1);T++,g[T]=E,x[T]=I,x[T+1]=ie}for(let E=0,T=0;E<c;E++){for(;x[T+1]<E;)T++;const I=g[T],z=E-I;h[t+E*s]=p[I]+z*z}}class Ge{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const p in t)for(const g of t[p])c.push({stack:p,id:g});l.asyncAll(c,({stack:p,id:g},x)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{}});let T=E.glyphs[g];if(T!==void 0)return void x(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(E,p,g),T)return E.glyphs[g]=T,void x(null,{stack:p,id:g,glyph:T});const I=Math.floor(g/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(E.ranges[I])return void x(null,{stack:p,id:g,glyph:T});let z=E.requests[I];z||(z=E.requests[I]=[],Ge.loadGlyphRange(p,I,this.url,this.requestManager,(R,O)=>{if(O){for(const W in O)this._doesCharSupportLocalGlyph(+W)||(E.glyphs[+W]=O[+W]);E.ranges[I]=!0}for(const W of z)W(R,O);delete E.requests[I]})),z.push((R,O)=>{R?x(R):O&&x(null,{stack:p,id:g,glyph:O[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const x={};for(const{stack:E,id:T,glyph:I}of g)(x[E]||(x[E]={}))[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};s(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](t)||l.unicodeBlockLookup["Hangul Syllables"](t)||l.unicodeBlockLookup.Hiragana(t)||l.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,c){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let E="400";/bold/i.test(s)?E="900":/medium/i.test(s)?E="500":/light/i.test(s)&&(E="200"),g=t.tinySDF=new Ge.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:p,fontWeight:E})}const x=g.draw(String.fromCharCode(c));return{id:c,bitmap:new l.AlphaImage({width:x.width||30,height:x.height||30},x.data),metrics:{width:x.glyphWidth||24,height:x.glyphHeight||24,left:x.glyphLeft||0,top:x.glyphTop-27||-8,advance:x.glyphAdvance||24}}}}Ge.loadGlyphRange=function(h,t,s,c,p){const g=256*t,x=g+255,E=c.transformRequest(s.replace("{fontstack}",h).replace("{range}",`${g}-${x}`),l.ResourceType.Glyphs);l.getArrayBuffer(E,(T,I)=>{if(T)p(T);else if(I){const z={};for(const R of l.parseGlyphPbf(I))z[R.id]=R;p(null,z)}})},Ge.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const E=this.size=h+4*t,T=this._createCanvas(E),I=this.ctx=T.getContext("2d",{willReadFrequently:!0});I.font=`${x} ${g} ${h}px ${p}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(h),x=Math.ceil(s),E=Math.min(this.size-this.buffer,Math.ceil(g-p)),T=Math.min(this.size-this.buffer,x+Math.ceil(c)),I=E+2*this.buffer,z=T+2*this.buffer,R=Math.max(I*z,0),O=new Uint8ClampedArray(R),W={data:O,width:I,height:z,glyphWidth:E,glyphHeight:T,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(E===0||T===0)return W;const{ctx:Z,buffer:q,gridInner:re,gridOuter:le}=this;Z.clearRect(q,q,E,T),Z.fillText(h,q,q+x);const ge=Z.getImageData(q,q,E,T);le.fill(ie,0,R),re.fill(0,0,R);for(let X=0;X<T;X++)for(let be=0;be<E;be++){const _e=ge.data[4*(X*E+be)+3]/255;if(_e===0)continue;const Me=(X+q)*I+be+q;if(_e===1)le[Me]=0,re[Me]=ie;else{const Pe=.5-_e;le[Me]=Pe>0?Pe*Pe:0,re[Me]=Pe<0?Pe*Pe:0}}he(le,0,0,I,z,I,this.f,this.v,this.z),he(re,q,q,E,T,I,this.f,this.v,this.z);for(let X=0;X<R;X++){const be=Math.sqrt(le[X])-Math.sqrt(re[X]);O[X]=Math.round(255-255*(be/this.radius+this.cutoff))}return W}};const lt=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(h,t){return l.sphericalToCartesian(h.expression.evaluate(t))}interpolate(h,t,s){return{x:l.number(h.x,t.x,s),y:l.number(h.y,t.y,s),z:l.number(h.z,t.z,s)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),yt="-transition";class ft extends l.Evented{constructor(t){super(),this._transitionable=new l.Transitionable(lt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(l.validateLight,t,s))for(const c in t){const p=t[c];c.endsWith(yt)?this._transitionable.setTransition(c.slice(0,-yt.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class xn{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const c=t.join(",")+String(s);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,s)),this.dashEntry[c]}getDashRanges(t,s,c){const p=[];let g=t.length%2==1?-t[t.length-1]*c:0,x=t[0]*c,E=!0;p.push({left:g,right:x,isDash:E,zeroLength:t[0]===0});let T=t[0];for(let I=1;I<t.length;I++){E=!E;const z=t[I];g=T*c,T+=z,x=T*c,p.push({left:g,right:x,isDash:E,zeroLength:z===0})}return p}addRoundDash(t,s,c){const p=s/2;for(let g=-c;g<=c;g++){const x=this.width*(this.nextRow+c+g);let E=0,T=t[E];for(let I=0;I<this.width;I++){I/T.right>1&&(T=t[++E]);const z=Math.abs(I-T.left),R=Math.abs(I-T.right),O=Math.min(z,R);let W;const Z=g/c*(p+1);if(T.isDash){const q=p-Math.abs(Z);W=Math.sqrt(O*O+q*q)}else W=p-Math.sqrt(O*O+Z*Z);this.data[x+I]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const T=t[E],I=t[E+1];T.zeroLength?t.splice(E,1):I&&I.isDash===T.isDash&&(I.left=T.left,t.splice(E,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,x=t[g];for(let E=0;E<this.width;E++){E/x.right>1&&(x=t[++g]);const T=Math.abs(E-x.left),I=Math.abs(E-x.right),z=Math.min(T,I);this.data[p+E]=Math.max(0,Math.min(255,(x.isDash?z:-z)+128))}}addDash(t,s){const c=s?7:0,p=2*c+1;if(this.nextRow+p>this.height)return l.warnOnce("LineAtlas out of space"),null;let g=0;for(let E=0;E<t.length;E++)g+=t[E];if(g!==0){const E=this.width/g,T=this.getDashRanges(t,this.width,E);s?this.addRoundDash(T,E,c):this.addRegularDash(T)}const x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class kt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const g=new kt.Actor(c[p],s,this.id);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,c){l.asyncAll(this.actors,(p,g)=>{p.send(t,s,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function rn(h,t,s){const c=function(p,g){if(p)return s(p);if(g){const x=l.pick(l.extend(g,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(E=>E.id)),s(null,x)}};return h.url?l.getJSON(t.transformRequest(h.url,l.ResourceType.Source),c):l.exported.frame(()=>c(null,h))}kt.Actor=l.Actor;class Nn{constructor(t,s,c){this.bounds=l.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),c=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*s),g=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=c&&t.x<g&&t.y>=p&&t.y<x}}class cr extends l.Evented{constructor(t,s,c,p){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rn(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new l.ErrorEvent(t)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new Nn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,l.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,E){return delete t.request,t.aborted?s(null):x&&x.status!==404?s(x):(E&&E.resourceTiming&&(t.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&t.setExpiryData(E),t.loadVectorData(E,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",p,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",p,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class zn extends l.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},s),l.extend(this,l.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rn(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new Nn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),(p,g,x)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(p)t.state="errored",s(p);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(x);const E=this.map.painter.context,T=E.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new $e(E,g,T.RGBA,{useMipmap:!0}),t.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&T.texParameterf(T.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),t.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let hr;class It extends zn{constructor(t,s,c,p){super(t,s,c,p),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function p(g,x){g&&(t.state="errored",s(g)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(g,x){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(g)t.state="errored",s(g);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(x),delete x.cacheControl,delete x.expires;const E=l.isImageBitmap(x)&&(hr==null&&(hr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),hr)?x:l.exported.getImageData(x,1),T={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:E,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",T,p.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,c=Math.pow(2,s.z),p=(s.x-1+c)%c,g=s.x===0?t.wrap-1:t.wrap,x=(s.x+1+c)%c,E=s.x+1===c?t.wrap+1:t.wrap,T={};return T[new l.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y).key]={backfilled:!1},T[new l.OverscaledTileID(t.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(T[new l.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y-1).key]={backfilled:!1},T[new l.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new l.OverscaledTileID(t.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(T[new l.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y+1).key]={backfilled:!1},T[new l.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new l.OverscaledTileID(t.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),T}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class ei extends l.Evented{constructor(t,s,c,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:c},p),this}_updateWorkerData(t){const s=l.extend({},this.workerOptions),c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(l.exported.resolveURL(c),l.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:t}));let x=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x=g.resourceTiming[this.id].slice(0)),p)return void this.fire(new l.ErrorEvent(p));const E={dataType:"source",sourceDataType:t};this._collectResourceTiming&&x&&x.length>0&&l.extend(E,{resourceTiming:x}),this.fire(new l.Event("data",E))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const c=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(c,p,(g,x)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):g?s(g):(t.loadVectorData(x,this.map.painter,c==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ut=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Pt extends l.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(t,s){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(c,p)=>{this._loaded=!0,c?this.fire(new l.ErrorEvent(c)):p&&(this.image=p,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(p){let g=1/0,x=1/0,E=-1/0,T=-1/0;for(const O of p)g=Math.min(g,O.x),x=Math.min(x,O.y),E=Math.max(E,O.x),T=Math.max(T,O.y);const I=Math.max(E-g,T-x),z=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),R=Math.pow(2,z);return new l.CanonicalTileID(z,Math.floor((g+E)/2*R),Math.floor((x+T)/2*R))}(s),this.minzoom=this.maxzoom=this.tileID.z;const c=s.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new $e(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class He extends Pt{constructor(t,s,c,p){super(t,s,c,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,l.ResourceType.Source).url);l.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new $e(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class un extends Pt{constructor(t,s,c,p){super(t,s,c,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new $e(s,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Tn={vector:cr,raster:zn,"raster-dem":It,geojson:ei,video:He,image:Pt,canvas:un};function fi(h,t){const s=l.create();return l.translate(s,s,[1,1,0]),l.scale(s,s,[.5*h.width,.5*h.height,1]),l.multiply(s,s,h.calculatePosMatrix(t.toUnwrapped()))}function Ur(h,t,s,c,p,g){const x=function(R,O,W){if(R)for(const Z of R){const q=O[Z];if(q&&q.source===W&&q.type==="fill-extrusion")return!0}else for(const Z in O){const q=O[Z];if(q.source===W&&q.type==="fill-extrusion")return!0}return!1}(p&&p.layers,t,h.id),E=g.maxPitchScaleFactor(),T=h.tilesIn(c,E,x);T.sort(Vr);const I=[];for(const R of T)I.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(t,s,h._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,p,g,E,fi(h.transform,R.tileID))});const z=function(R){const O={},W={};for(const Z of R){const q=Z.queryResults,re=Z.wrappedTileID,le=W[re]=W[re]||{};for(const ge in q){const X=q[ge],be=le[ge]=le[ge]||{},_e=O[ge]=O[ge]||[];for(const Me of X)be[Me.featureIndex]||(be[Me.featureIndex]=!0,_e.push(Me))}}return O}(I);for(const R in z)z[R].forEach(O=>{const W=O.feature,Z=h.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=Z});return z}function Vr(h,t){const s=h.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}class _r{constructor(t,s){this.tileID=t,this.uid=l.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<l.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,g){const x={};if(!g)return x;for(const E of p){const T=E.layerIds.map(I=>g.getLayer(I)).filter(Boolean);if(T.length!==0){E.layers=T,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(I=>T.filter(z=>z.id===I)[0]));for(const I of T)x[I.id]=E}}return x}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof l.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $e(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $e(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,p,g,x,E,T,I,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:E,queryPadding:this.queryPadding*I},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const E=l.createFilter(s&&s.filter),{z:T,x:I,y:z}=this.tileID.canonical,R={z:T,x:I,y:z};for(let O=0;O<x.length;O++){const W=x.feature(O);if(E.needGeometry){const re=l.toEvaluationFeature(W,!0);if(!E.filter(new l.EvaluationParameters(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!E.filter(new l.EvaluationParameters(this.tileID.overscaledZ),W))continue;const Z=c.getId(W,g),q=new l.GeoJSONFeature(W,T,I,z,Z);q.tile=R,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=l.parseCacheControl(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",E=c[x],T=t[x];if(!E||!T||Object.keys(T).length===0)continue;g.update(T,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=s&&s.style&&s.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=l.exported.now()+t}setDependencies(t,s){const c={};for(const p of s)c[p]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const p=this.dependencies[c];if(p){for(const g of s)if(p[g])return!0}}return!1}}class ti{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,p=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const p of this.data[c])t(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class ko{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},l.extend(this.stateChanges[t][p],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])c[g]||(this.deletedStates[t][p][g]=null)}else for(const g in c)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(c in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][c]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),p=l.extend({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const x in g)delete p[x]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),l.extend(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const E of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][E];g[x]=this.state[p][x]}c[p]=c[p]||{},l.extend(c[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in t)t[p].setFeatureState(c,s)}}class jr extends l.Evented{constructor(t,s,c){super(),this.id=t,this.dispatcher=c,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(p,g,x,E){const T=new Tn[g.type](p,g,x,E);if(T.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${T.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],T),T}(t,s,c,this),this._tiles={},this._cache=new ti(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ko}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new l.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(hs).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&s.push(this._tiles[c]);return t?s.sort((c,p)=>{const g=c.tileID,x=p.tileID,E=new l.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new l.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||T.y-E.y||T.x-E.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(hs).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,p){if(p)return t.state="errored",void(p.status!==404?this._source.fire(new l.ErrorEvent(p,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=l.exported.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);c(t,x),c(x,t)}}function c(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const E=g.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),I=g.tileID.key;x===0&&E===0||Math.abs(E)>1||(Math.abs(x)>1&&(Math.abs(x+T)===1?x+=T:Math.abs(x-T)===1&&(x-=T)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,E),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>c)continue;let E=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const I=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[I.key],x&&x.hasData()&&(E=I)}let T=E;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]){p[E.key]=E;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const p=t.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*c*5),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new l.OverscaledTileID(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(c=c.filter(I=>this._source.hasTile(I)))):c=[];const p=t.coveringZoomLevel(this._source),g=Math.max(p-jr.maxOverzooming,this._source.minzoom),x=Math.max(p+jr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const z of c)if(z.canonical.z>this._source.minzoom){const R=z.scaledTo(z.canonical.z-1);I[R.key]=R;const O=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));I[O.key]=O}c=c.concat(Object.values(I))}const E=this._updateRetainedTiles(c,p);if(Fs(this._source.type)){const I={},z={},R=Object.keys(E);for(const O of R){const W=E[O],Z=this._tiles[O];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=l.exported.now())continue;const q=this.findLoadedParent(W,g);q&&(this._addTile(q.tileID),I[q.tileID.key]=q.tileID),z[O]=W}this._retainLoadedChildren(z,p,x,E);for(const O in I)E[O]||(this._coveredTiles[O]=!0,E[O]=I[O]);if(s){const O={},W={};for(const Z of c)this._tiles[Z.key].hasData()?O[Z.key]=Z:W[Z.key]=Z;for(const Z in W){const q=W[Z].children(this._source.maxzoom);this._tiles[q[0].key]&&this._tiles[q[1].key]&&this._tiles[q[2].key]&&this._tiles[q[3].key]&&(O[q[0].key]=E[q[0].key]=q[0],O[q[1].key]=E[q[1].key]=q[1],O[q[2].key]=E[q[2].key]=q[2],O[q[3].key]=E[q[3].key]=q[3],delete W[Z])}for(const Z in W){const q=this.findLoadedParent(W[Z],this._source.minzoom);if(q){O[q.tileID.key]=E[q.tileID.key]=q.tileID;for(const re in O)O[re].isChildOf(q.tileID)&&delete O[re]}}for(const Z in this._tiles)O[Z]||(this._coveredTiles[Z]=!0)}}for(const I in E)this._tiles[I].clearFadeHold();const T=l.keysDifference(this._tiles,E);for(const I of T){const z=this._tiles[I];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const c={},p={},g=Math.max(s-jr.maxOverzooming,this._source.minzoom),x=Math.max(s+jr.maxUnderzooming,this._source.minzoom),E={};for(const T of t){const I=this._addTile(T);c[T.key]=T,I.hasData()||s<this._source.maxzoom&&(E[T.key]=T)}this._retainLoadedChildren(E,s,x,c);for(const T of t){let I=this._tiles[T.key];if(I.hasData())continue;if(s+1>this._source.maxzoom){const R=T.children(this._source.maxzoom)[0],O=this.getTile(R);if(O&&O.hasData()){c[R.key]=R;continue}}else{const R=T.children(this._source.maxzoom);if(c[R[0].key]&&c[R[1].key]&&c[R[2].key]&&c[R[3].key])continue}let z=I.wasRequested();for(let R=T.overscaledZ-1;R>=g;--R){const O=T.scaledTo(R);if(p[O.key]||(p[O.key]=!0,I=this.getTile(O),!I&&z&&(I=this._addTile(O)),I&&(c[O.key]=O,z=I.wasRequested(),I.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=s;return s||(s=new _r(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,c||this._source.fire(new l.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,c){const p=[],g=this.transform;if(!g)return p;const x=c?g.getCameraQueryGeometry(t):t,E=t.map(Z=>g.pointCoordinate(Z,this.terrain)),T=x.map(Z=>g.pointCoordinate(Z,this.terrain)),I=this.getIds();let z=1/0,R=1/0,O=-1/0,W=-1/0;for(const Z of T)z=Math.min(z,Z.x),R=Math.min(R,Z.y),O=Math.max(O,Z.x),W=Math.max(W,Z.y);for(let Z=0;Z<I.length;Z++){const q=this._tiles[I[Z]];if(q.holdingForFade())continue;const re=q.tileID,le=Math.pow(2,g.zoom-q.tileID.overscaledZ),ge=s*q.queryPadding*l.EXTENT/q.tileSize/le,X=[re.getTilePoint(new l.MercatorCoordinate(z,R)),re.getTilePoint(new l.MercatorCoordinate(O,W))];if(X[0].x-ge<l.EXTENT&&X[0].y-ge<l.EXTENT&&X[1].x+ge>=0&&X[1].y+ge>=0){const be=E.map(Me=>re.getTilePoint(Me)),_e=T.map(Me=>re.getTilePoint(Me));p.push({tile:q,tileID:re,queryGeometry:be,cameraQueryGeometry:_e,scale:le})}}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Fs(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const p=this._tiles[t];p&&p.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}}function hs(h,t){const s=Math.abs(2*h.wrap)-+(h.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||c-s||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Fs(h){return h==="raster"||h==="image"||h==="video"}jr.maxOverzooming=10,jr.maxUnderzooming=3;const Pr="mapboxgl_preloaded_worker_pool";class Ar{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ar.workerCount;)this.workers.push(new Worker(qs.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pr]}numActive(){return Object.keys(this.active).length}}const io=Math.floor(l.exported.hardwareConcurrency/2);let vr;function ni(){return vr||(vr=new Ar),vr}function ds(h,t){const s={};for(const c in h)c!=="ref"&&(s[c]=h[c]);return l.refProperties.forEach(c=>{c in t&&(s[c]=t[c])}),s}function ps(h){h=h.slice();const t=Object.create(null);for(let s=0;s<h.length;s++)t[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=ds(h[s],t[h[s].ref]));return h}Ar.workerCount=Math.max(Math.min(io,6),1);const Jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Wn(h,t,s){s.push({command:Jt.addSource,args:[h,t[h]]})}function Io(h,t,s){t.push({command:Jt.removeSource,args:[h]}),s[h]=!0}function mi(h,t,s,c){Io(h,s,c),Wn(h,t,s)}function fs(h,t,s){let c;for(c in h[s])if(Object.prototype.hasOwnProperty.call(h[s],c)&&c!=="data"&&!fe(h[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!fe(h[s][c],t[s][c]))return!1;return!0}function Ii(h,t,s,c,p,g){let x;for(x in t=t||{},h=h||{})Object.prototype.hasOwnProperty.call(h,x)&&(fe(h[x],t[x])||s.push({command:g,args:[c,x,t[x],p]}));for(x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(h,x)&&(fe(h[x],t[x])||s.push({command:g,args:[c,x,t[x],p]}))}function Vi(h){return h.id}function Wo(h,t){return h[t.id]=t,h}class ji{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.clamp(t,0,1);let s=1,c=this._distances[s];const p=t*this.paddedLength+this.padding;for(;c<p&&s<this._distances.length;)c=this._distances[++s];const g=s-1,x=this._distances[g],E=c-x,T=E>0?(p-x)/E:0;return this.points[g].mult(1-T).add(this.points[s].mult(T))}}function Ie(h,t){let s=!0;return h==="always"||h!=="never"&&t!=="never"||(s=!1),s}class We{constructor(t,s,c){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,p,g){this._forEachCell(s,c,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,s,c,p){this._forEachCell(s-p,c-p,s+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,s,c,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,c,p,g,x){this.circleCells[g].push(x)}_query(t,s,c,p,g,x,E){if(c<0||t>this.width||p<0||s>this.height)return[];const T=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=p){if(g)return[{key:null,x1:t,y1:s,x2:c,y2:p}];for(let I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const z=this.circles[3*I],R=this.circles[3*I+1],O=this.circles[3*I+2];T.push({key:this.circleKeys[I],x1:z-O,y1:R-O,x2:z+O,y2:R+O})}}else this._forEachCell(t,s,c,p,this._queryCell,T,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},E);return T}query(t,s,c,p){return this._query(t,s,c,p,!1,null)}hitTest(t,s,c,p,g,x){return this._query(t,s,c,p,!0,g,x).length>0}hitTestCircle(t,s,c,p,g){const x=t-c,E=t+c,T=s-c,I=s+c;if(E<0||x>this.width||I<0||T>this.height)return!1;const z=[];return this._forEachCell(x,T,E,I,this._queryCellCircle,z,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},g),z.length>0}_queryCell(t,s,c,p,g,x,E,T){const{seenUids:I,hitTest:z,overlapMode:R}=E,O=this.boxCells[g];if(O!==null){const Z=this.bboxes;for(const q of O)if(!I.box[q]){I.box[q]=!0;const re=4*q,le=this.boxKeys[q];if(t<=Z[re+2]&&s<=Z[re+3]&&c>=Z[re+0]&&p>=Z[re+1]&&(!T||T(le))&&(!z||!Ie(R,le.overlapMode))&&(x.push({key:le,x1:Z[re],y1:Z[re+1],x2:Z[re+2],y2:Z[re+3]}),z))return!0}}const W=this.circleCells[g];if(W!==null){const Z=this.circles;for(const q of W)if(!I.circle[q]){I.circle[q]=!0;const re=3*q,le=this.circleKeys[q];if(this._circleAndRectCollide(Z[re],Z[re+1],Z[re+2],t,s,c,p)&&(!T||T(le))&&(!z||!Ie(R,le.overlapMode))){const ge=Z[re],X=Z[re+1],be=Z[re+2];if(x.push({key:le,x1:ge-be,y1:X-be,x2:ge+be,y2:X+be}),z)return!0}}}return!1}_queryCellCircle(t,s,c,p,g,x,E,T){const{circle:I,seenUids:z,overlapMode:R}=E,O=this.boxCells[g];if(O!==null){const Z=this.bboxes;for(const q of O)if(!z.box[q]){z.box[q]=!0;const re=4*q,le=this.boxKeys[q];if(this._circleAndRectCollide(I.x,I.y,I.radius,Z[re+0],Z[re+1],Z[re+2],Z[re+3])&&(!T||T(le))&&!Ie(R,le.overlapMode))return x.push(!0),!0}}const W=this.circleCells[g];if(W!==null){const Z=this.circles;for(const q of W)if(!z.circle[q]){z.circle[q]=!0;const re=3*q,le=this.circleKeys[q];if(this._circlesCollide(Z[re],Z[re+1],Z[re+2],I.x,I.y,I.radius)&&(!T||T(le))&&!Ie(R,le.overlapMode))return x.push(!0),!0}}}_forEachCell(t,s,c,p,g,x,E,T){const I=this._convertToXCellCoord(t),z=this._convertToYCellCoord(s),R=this._convertToXCellCoord(c),O=this._convertToYCellCoord(p);for(let W=I;W<=R;W++)for(let Z=z;Z<=O;Z++)if(g.call(this,t,s,c,p,this.xCellCount*Z+W,x,E,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,p,g,x){const E=p-t,T=g-s,I=c+x;return I*I>E*E+T*T}_circleAndRectCollide(t,s,c,p,g,x,E){const T=(x-p)/2,I=Math.abs(t-(p+T));if(I>T+c)return!1;const z=(E-g)/2,R=Math.abs(s-(g+z));if(R>z+c)return!1;if(I<=T||R<=z)return!0;const O=I-T,W=R-z;return O*O+W*W<=c*c}}function $n(h,t,s,c,p){const g=l.create();return t?(l.scale(g,g,[1/p,1/p,1]),s||l.rotateZ(g,g,c.angle)):l.multiply(g,c.labelPlaneMatrix,h),g}function dr(h,t,s,c,p){if(t){const g=l.clone(h);return l.scale(g,g,[p,p,1]),s||l.rotateZ(g,g,-c.angle),g}return c.glCoordMatrix}function Nt(h,t,s){let c;s?(c=[h.x,h.y,s(h.x,h.y),1],l.transformMat4(c,c,t)):(c=[h.x,h.y,0,1],on(c,c,t));const p=c[3];return{point:new l.pointGeometry(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Ln(h,t){return .5+h/t*.5}function ri(h,t){const s=h[0]/h[3],c=h[1]/h[3];return s>=-t[0]&&s<=t[0]&&c>=-t[1]&&c<=t[1]}function xr(h,t,s,c,p,g,x,E,T,I){const z=c?h.textSizeData:h.iconSizeData,R=l.evaluateSizeForZoom(z,s.transform.zoom),O=[256/s.width*2+1,256/s.height*2+1],W=c?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;W.clear();const Z=h.lineVertexArray,q=c?h.text.placedSymbolArray:h.icon.placedSymbolArray,re=s.transform.width/s.transform.height;let le=!1;for(let ge=0;ge<q.length;ge++){const X=q.get(ge);if(X.hidden||X.writingMode===l.WritingMode.vertical&&!le){Dt(X.numGlyphs,W);continue}let be;if(le=!1,I?(be=[X.anchorX,X.anchorY,I(X.anchorX,X.anchorY),1],l.transformMat4(be,be,t)):(be=[X.anchorX,X.anchorY,0,1],on(be,be,t)),!ri(be,O)){Dt(X.numGlyphs,W);continue}const _e=Ln(s.transform.cameraToCenterDistance,be[3]),Me=l.evaluateSizeForFeature(z,R,X),Pe=x?Me/_e:Me*_e,Be=new l.pointGeometry(X.anchorX,X.anchorY),Ce=Nt(Be,p,I).point,st={},Ye=Ut(X,Pe,!1,E,t,p,g,h.glyphOffsetArray,Z,W,Ce,Be,st,re,T,I);le=Ye.useVertical,(Ye.notEnoughRoom||le||Ye.needsFlipping&&Ut(X,Pe,!0,E,t,p,g,h.glyphOffsetArray,Z,W,Ce,Be,st,re,T,I).notEnoughRoom)&&Dt(X.numGlyphs,W)}c?h.text.dynamicLayoutVertexBuffer.updateData(W):h.icon.dynamicLayoutVertexBuffer.updateData(W)}function Gn(h,t,s,c,p,g,x,E,T,I,z,R,O){const W=E.glyphStartIndex+E.numGlyphs,Z=E.lineStartIndex,q=E.lineStartIndex+E.lineLength,re=t.getoffsetX(E.glyphStartIndex),le=t.getoffsetX(W-1),ge=pr(h*re,s,c,p,g,x,E.segment,Z,q,T,I,z,R,O);if(!ge)return null;const X=pr(h*le,s,c,p,g,x,E.segment,Z,q,T,I,z,R,O);return X?{first:ge,last:X}:null}function Ae(h,t,s,c){return h===l.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*c?{useVertical:!0}:(h===l.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Ut(h,t,s,c,p,g,x,E,T,I,z,R,O,W,Z,q){const re=t/24,le=h.lineOffsetX*re,ge=h.lineOffsetY*re;let X;if(h.numGlyphs>1){const be=h.glyphStartIndex+h.numGlyphs,_e=h.lineStartIndex,Me=h.lineStartIndex+h.lineLength,Pe=Gn(re,E,le,ge,s,z,R,h,T,g,O,Z,q);if(!Pe)return{notEnoughRoom:!0};const Be=Nt(Pe.first.point,x,q).point,Ce=Nt(Pe.last.point,x,q).point;if(c&&!s){const st=Ae(h.writingMode,Be,Ce,W);if(st)return st}X=[Pe.first];for(let st=h.glyphStartIndex+1;st<be-1;st++)X.push(pr(re*E.getoffsetX(st),le,ge,s,z,R,h.segment,_e,Me,T,g,O,Z,q));X.push(Pe.last)}else{if(c&&!s){const _e=Nt(R,p,q).point,Me=h.lineStartIndex+h.segment+1,Pe=new l.pointGeometry(T.getx(Me),T.gety(Me)),Be=Nt(Pe,p,q),Ce=Be.signedDistanceFromCamera>0?Be.point:Ft(R,Pe,_e,1,p,q),st=Ae(h.writingMode,_e,Ce,W);if(st)return st}const be=pr(re*E.getoffsetX(h.glyphStartIndex),le,ge,s,z,R,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,T,g,O,Z,q);if(!be)return{notEnoughRoom:!0};X=[be]}for(const be of X)l.addDynamicAttributes(I,be.point,be.angle);return{}}function Ft(h,t,s,c,p,g){const x=Nt(h.add(h.sub(t)._unit()),p,g).point,E=s.sub(x);return s.add(E._mult(c/E.mag()))}function pr(h,t,s,c,p,g,x,E,T,I,z,R,O,W){const Z=c?h-t:h+t;let q=Z>0?1:-1,re=0;c&&(q*=-1,re=Math.PI),q<0&&(re+=Math.PI);let le=q>0?E+x:E+x+1,ge=p,X=p,be=0,_e=0;const Me=Math.abs(Z),Pe=[];for(;be+_e<=Me;){if(le+=q,le<E||le>=T)return null;if(X=ge,Pe.push(ge),ge=R[le],ge===void 0){const ct=new l.pointGeometry(I.getx(le),I.gety(le)),Ot=Nt(ct,z,W);if(Ot.signedDistanceFromCamera>0)ge=R[le]=Ot.point;else{const jt=le-q;ge=Ft(be===0?g:new l.pointGeometry(I.getx(jt),I.gety(jt)),ct,X,Me-be+1,z,W)}}be+=_e,_e=X.dist(ge)}const Be=(Me-be)/_e,Ce=ge.sub(X),st=Ce.mult(Be)._add(X);st._add(Ce._unit()._perp()._mult(s*q));const Ye=re+Math.atan2(ge.y-X.y,ge.x-X.x);return Pe.push(st),{point:st,angle:O?Ye:0,path:Pe}}const Mi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(h,t){for(let s=0;s<h;s++){const c=t.length;t.resize(c+4),t.float32.set(Mi,3*c)}}function on(h,t,s){const c=t[0],p=t[1];return h[0]=s[0]*c+s[4]*p+s[12],h[1]=s[1]*c+s[5]*p+s[13],h[3]=s[3]*c+s[7]*p+s[15],h}const Qn=100;class ii{constructor(t,s=new We(t.width+200,t.height+200,25),c=new We(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Qn,this.screenBottomBoundary=t.height+Qn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,c,p,g,x){const E=this.projectAndGetPerspectiveRatio(p,t.anchorPointX,t.anchorPointY,x),T=c*E.perspectiveRatio,I=t.x1*T+E.point.x,z=t.y1*T+E.point.y,R=t.x2*T+E.point.x,O=t.y2*T+E.point.y;return!this.isInsideGrid(I,z,R,O)||s!=="always"&&this.grid.hitTest(I,z,R,O,s,g)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,z,R,O],offscreen:this.isOffscreen(I,z,R,O)}}placeCollisionCircles(t,s,c,p,g,x,E,T,I,z,R,O,W,Z){const q=[],re=new l.pointGeometry(s.anchorX,s.anchorY),le=Nt(re,x,Z),ge=Ln(this.transform.cameraToCenterDistance,le.signedDistanceFromCamera),X=(z?g/ge:g*ge)/l.ONE_EM,be=Nt(re,E,Z).point,_e=Gn(X,p,s.lineOffsetX*X,s.lineOffsetY*X,!1,be,re,s,c,E,{},!1,Z);let Me=!1,Pe=!1,Be=!0;if(_e){const Ce=.5*O*ge+W,st=new l.pointGeometry(-100,-100),Ye=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ct=new ji,Ot=_e.first,jt=_e.last;let St=[];for(let tn=Ot.path.length-1;tn>=1;tn--)St.push(Ot.path[tn]);for(let tn=1;tn<jt.path.length;tn++)St.push(jt.path[tn]);const yn=2.5*Ce;if(T){const tn=St.map(nn=>Nt(nn,T,Z));St=tn.some(nn=>nn.signedDistanceFromCamera<=0)?[]:tn.map(nn=>nn.point)}let _n=[];if(St.length>0){const tn=St[0].clone(),nn=St[0].clone();for(let wn=1;wn<St.length;wn++)tn.x=Math.min(tn.x,St[wn].x),tn.y=Math.min(tn.y,St[wn].y),nn.x=Math.max(nn.x,St[wn].x),nn.y=Math.max(nn.y,St[wn].y);_n=tn.x>=st.x&&nn.x<=Ye.x&&tn.y>=st.y&&nn.y<=Ye.y?[St]:nn.x<st.x||tn.x>Ye.x||nn.y<st.y||tn.y>Ye.y?[]:l.clipLine([St],st.x,st.y,Ye.x,Ye.y)}for(const tn of _n){ct.reset(tn,.25*Ce);let nn=0;nn=ct.length<=.5*Ce?1:Math.ceil(ct.paddedLength/yn)+1;for(let wn=0;wn<nn;wn++){const Er=wn/Math.max(nn-1,1),Bo=ct.lerp(Er),go=Bo.x+Qn,Oo=Bo.y+Qn;q.push(go,Oo,Ce,0);const Is=go-Ce,Ki=Oo-Ce,xi=go+Ce,Qo=Oo+Ce;if(Be=Be&&this.isOffscreen(Is,Ki,xi,Qo),Pe=Pe||this.isInsideGrid(Is,Ki,xi,Qo),t!=="always"&&this.grid.hitTestCircle(go,Oo,Ce,t,R)&&(Me=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!I&&Me||!Pe||ge<this.perspectiveRatioCutoff?[]:q,offscreen:Be,collisionDetected:Me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,p=1/0,g=-1/0,x=-1/0;for(const z of t){const R=new l.pointGeometry(z.x+Qn,z.y+Qn);c=Math.min(c,R.x),p=Math.min(p,R.y),g=Math.max(g,R.x),x=Math.max(x,R.y),s.push(R)}const E=this.grid.query(c,p,g,x).concat(this.ignoredGrid.query(c,p,g,x)),T={},I={};for(const z of E){const R=z.key;if(T[R.bucketInstanceId]===void 0&&(T[R.bucketInstanceId]={}),T[R.bucketInstanceId][R.featureIndex])continue;const O=[new l.pointGeometry(z.x1,z.y1),new l.pointGeometry(z.x2,z.y1),new l.pointGeometry(z.x2,z.y2),new l.pointGeometry(z.x1,z.y2)];l.polygonIntersectsPolygon(s,O)&&(T[R.bucketInstanceId][R.featureIndex]=!0,I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]=[]),I[R.bucketInstanceId].push(R.featureIndex))}return I}insertCollisionBox(t,s,c,p,g,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,p,g,x){const E=c?this.ignoredGrid:this.grid,T={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:s};for(let I=0;I<t.length;I+=4)E.insertCircle(T,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,s,c,p){let g;return p?(g=[s,c,p(s,c),1],l.transformMat4(g,g,t)):(g=[s,c,0,1],on(g,g,t)),{point:new l.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+Qn,(-g[1]/g[3]+1)/2*this.transform.height+Qn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,s,c,p){return c<Qn||t>=this.screenRightBoundary||p<Qn||s>this.screenBottomBoundary}isInsideGrid(t,s,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=l.identity([]);return l.translate(t,t,[-100,-100,0]),t}}function Xn(h,t,s){return t*(l.EXTENT/(h.tileSize*Math.pow(2,s-h.tileID.overscaledZ)))}class zr{constructor(t,s,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class dn{constructor(t,s,c,p,g){this.text=new zr(t?t.text:null,s,c,g),this.icon=new zr(t?t.icon:null,s,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mo{constructor(t,s,c){this.text=t,this.icon=s,this.skipFade=c}}class Lr{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Po{constructor(t,s,c,p,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=g}}class oo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function so(h,t,s,c,p){const{horizontalAlign:g,verticalAlign:x}=l.getAnchorAlignment(h),E=-(g-.5)*t,T=-(x-.5)*s,I=l.evaluateVariableOffset(h,c);return new l.pointGeometry(E+I[0]*p,T+I[1]*p)}function ao(h,t,s,c,p,g){const{x1:x,x2:E,y1:T,y2:I,anchorPointX:z,anchorPointY:R}=h,O=new l.pointGeometry(t,s);return c&&O._rotate(p?g:-g),{x1:x+O.x,y1:T+O.y,x2:E+O.x,y2:I+O.y,anchorPointX:z,anchorPointY:R}}class ${constructor(t,s,c,p,g){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new ii(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new oo(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,c,p){const g=c.getBucket(s),x=c.latestFeatureIndex;if(!g||!x||s.id!==g.layerIds[0])return;const E=c.collisionBoxArray,T=g.layers[0].layout,I=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),z=c.tileSize/l.EXTENT,R=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),O=T.get("text-pitch-alignment")==="map",W=T.get("text-rotation-alignment")==="map",Z=Xn(c,1,this.transform.zoom),q=$n(R,O,W,this.transform,Z);let re=null;if(O){const ge=dr(R,O,W,this.transform,Z);re=l.multiply([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[g.bucketInstanceId]=new Po(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,c.tileID);const le={bucket:g,layout:T,posMatrix:R,textLabelPlaneMatrix:q,labelToScreenMatrix:re,scale:I,textPixelRatio:z,holdingForFade:c.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const ge of g.sortKeyRanges){const{sortKey:X,symbolInstanceStart:be,symbolInstanceEnd:_e}=ge;t.push({sortKey:X,symbolInstanceStart:be,symbolInstanceEnd:_e,parameters:le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:le})}attemptAnchorPlacement(t,s,c,p,g,x,E,T,I,z,R,O,W,Z,q,re){const le=[O.textOffset0,O.textOffset1],ge=so(t,c,p,le,g),X=this.collisionIndex.placeCollisionBox(ao(s,ge.x,ge.y,x,E,this.transform.angle),R,T,I,z.predicate,re);if((!q||this.collisionIndex.placeCollisionBox(ao(q,ge.x,ge.y,x,E,this.transform.angle),R,T,I,z.predicate,re).box.length!==0)&&X.box.length>0){let be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(be=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:le,width:c,height:p,anchor:t,textBoxScale:g,prevAnchor:be},this.markUsedJustification(W,t,O,Z),W.allowVerticalPlacement&&(this.markUsedOrientation(W,Z,O),this.placedOrientations[O.crossTileID]=Z),{shift:ge,placedGlyphBoxes:X}}}placeLayerBucketPart(t,s,c){const{bucket:p,layout:g,posMatrix:x,textLabelPlaneMatrix:E,labelToScreenMatrix:T,textPixelRatio:I,holdingForFade:z,collisionBoxArray:R,partiallyEvaluatedTextSize:O,collisionGroup:W}=t.parameters,Z=g.get("text-optional"),q=g.get("icon-optional"),re=l.getOverlapMode(g,"text-overlap","text-allow-overlap"),le=re==="always",ge=l.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),X=ge==="always",be=g.get("text-rotation-alignment")==="map",_e=g.get("text-pitch-alignment")==="map",Me=g.get("icon-text-fit")!=="none",Pe=g.get("symbol-z-order")==="viewport-y",Be=le&&(X||!p.hasIconData()||q),Ce=X&&(le||!p.hasTextData()||Z);!p.collisionArrays&&R&&p.deserializeCollisionBoxes(R);const st=(Ye,ct)=>{if(s[Ye.crossTileID])return;if(z)return void(this.placements[Ye.crossTileID]=new Mo(!1,!1,!1));let Ot=!1,jt=!1,St=!0,yn=null,_n={box:null,offscreen:null},tn={box:null,offscreen:null},nn=null,wn=null,Er=null,Bo=0,go=0,Oo=0;ct.textFeatureIndex?Bo=ct.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(Bo=Ye.featureIndex),ct.verticalTextFeatureIndex&&(go=ct.verticalTextFeatureIndex);const Is=this.retainedQueryData[p.bucketInstanceId].tileID,Ki=this.terrain?(fr,qt)=>this.terrain.getElevation(Is,fr,qt):null;for(const fr of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const qt=ct[fr];qt&&(qt.elevation=Ki?Ki(qt.anchorPointX,qt.anchorPointY):0)}const xi=ct.textBox;if(xi){const fr=pn=>{let Tr=l.WritingMode.horizontal;if(p.allowVerticalPlacement&&!pn&&this.prevPlacement){const Cr=this.prevPlacement.placedOrientations[Ye.crossTileID];Cr&&(this.placedOrientations[Ye.crossTileID]=Cr,Tr=Cr,this.markUsedOrientation(p,Tr,Ye))}return Tr},qt=(pn,Tr)=>{if(p.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&ct.verticalTextBox){for(const Cr of p.writingModes)if(Cr===l.WritingMode.vertical?(_n=Tr(),tn=_n):_n=pn(),_n&&_n.box&&_n.box.length)break}else _n=pn()};if(g.get("text-variable-anchor")){let pn=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye.crossTileID]){const Bn=this.prevPlacement.variableOffsets[Ye.crossTileID];pn.indexOf(Bn.anchor)>0&&(pn=pn.filter(Ji=>Ji!==Bn.anchor),pn.unshift(Bn.anchor))}const Tr=(Bn,Ji,Ws)=>{const Wu=Bn.x2-Bn.x1,Ca=Bn.y2-Bn.y1,dh=Ye.textBoxScale,Xu=Me&&ge==="never"?Ji:null;let Ms={box:[],offscreen:!1};const Xs=re!=="never"?2*pn.length:pn.length;for(let Hs=0;Hs<Xs;++Hs){const Hl=this.attemptAnchorPlacement(pn[Hs%pn.length],Bn,Wu,Ca,dh,be,_e,I,x,W,Hs>=pn.length?re:"never",Ye,p,Ws,Xu,Ki);if(Hl&&(Ms=Hl.placedGlyphBoxes,Ms&&Ms.box&&Ms.box.length)){Ot=!0,yn=Hl.shift;break}}return Ms};qt(()=>Tr(xi,ct.iconBox,l.WritingMode.horizontal),()=>{const Bn=ct.verticalTextBox;return p.allowVerticalPlacement&&!(_n&&_n.box&&_n.box.length)&&Ye.numVerticalGlyphVertices>0&&Bn?Tr(Bn,ct.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),_n&&(Ot=_n.box,St=_n.offscreen);const Cr=fr(_n&&_n.box);if(!Ot&&this.prevPlacement){const Bn=this.prevPlacement.variableOffsets[Ye.crossTileID];Bn&&(this.variableOffsets[Ye.crossTileID]=Bn,this.markUsedJustification(p,Bn.anchor,Ye,Cr))}}else{const pn=(Tr,Cr)=>{const Bn=this.collisionIndex.placeCollisionBox(Tr,re,I,x,W.predicate,Ki);return Bn&&Bn.box&&Bn.box.length&&(this.markUsedOrientation(p,Cr,Ye),this.placedOrientations[Ye.crossTileID]=Cr),Bn};qt(()=>pn(xi,l.WritingMode.horizontal),()=>{const Tr=ct.verticalTextBox;return p.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&Tr?pn(Tr,l.WritingMode.vertical):{box:null,offscreen:null}}),fr(_n&&_n.box&&_n.box.length)}}if(nn=_n,Ot=nn&&nn.box&&nn.box.length>0,St=nn&&nn.offscreen,Ye.useRuntimeCollisionCircles){const fr=p.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex),qt=l.evaluateSizeForFeature(p.textSizeData,O,fr),pn=g.get("text-padding");wn=this.collisionIndex.placeCollisionCircles(re,fr,p.lineVertexArray,p.glyphOffsetArray,qt,x,E,T,c,_e,W.predicate,Ye.collisionCircleDiameter,pn,Ki),wn.circles.length&&wn.collisionDetected&&!c&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Ot=le||wn.circles.length>0&&!wn.collisionDetected,St=St&&wn.offscreen}if(ct.iconFeatureIndex&&(Oo=ct.iconFeatureIndex),ct.iconBox){const fr=qt=>{const pn=Me&&yn?ao(qt,yn.x,yn.y,be,_e,this.transform.angle):qt;return this.collisionIndex.placeCollisionBox(pn,ge,I,x,W.predicate,Ki)};tn&&tn.box&&tn.box.length&&ct.verticalIconBox?(Er=fr(ct.verticalIconBox),jt=Er.box.length>0):(Er=fr(ct.iconBox),jt=Er.box.length>0),St=St&&Er.offscreen}const Qo=Z||Ye.numHorizontalGlyphVertices===0&&Ye.numVerticalGlyphVertices===0,Xl=q||Ye.numIconVertices===0;if(Qo||Xl?Xl?Qo||(jt=jt&&Ot):Ot=jt&&Ot:jt=Ot=jt&&Ot,Ot&&nn&&nn.box&&this.collisionIndex.insertCollisionBox(nn.box,re,g.get("text-ignore-placement"),p.bucketInstanceId,tn&&tn.box&&go?go:Bo,W.ID),jt&&Er&&this.collisionIndex.insertCollisionBox(Er.box,ge,g.get("icon-ignore-placement"),p.bucketInstanceId,Oo,W.ID),wn&&(Ot&&this.collisionIndex.insertCollisionCircles(wn.circles,re,g.get("text-ignore-placement"),p.bucketInstanceId,Bo,W.ID),c)){const fr=p.bucketInstanceId;let qt=this.collisionCircleArrays[fr];qt===void 0&&(qt=this.collisionCircleArrays[fr]=new Lr);for(let pn=0;pn<wn.circles.length;pn+=4)qt.circles.push(wn.circles[pn+0]),qt.circles.push(wn.circles[pn+1]),qt.circles.push(wn.circles[pn+2]),qt.circles.push(wn.collisionDetected?1:0)}if(Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ye.crossTileID]=new Mo(Ot||Be,jt||Ce,St||p.justReloaded),s[Ye.crossTileID]=!0};if(Pe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ye=p.getSortedSymbolIndexes(this.transform.angle);for(let ct=Ye.length-1;ct>=0;--ct){const Ot=Ye[ct];st(p.symbolInstances.get(Ot),p.collisionArrays[Ot])}}else for(let Ye=t.symbolInstanceStart;Ye<t.symbolInstanceEnd;Ye++)st(p.symbolInstances.get(Ye),p.collisionArrays[Ye]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){const Ye=this.collisionCircleArrays[p.bucketInstanceId];l.invert(Ye.invProjMatrix,x),Ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,s,c,p){let g;g=p===l.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(s)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const E of x)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=g>=0&&E!==g?0:c.crossTileID)}markUsedOrientation(t,s,c){const p=s===l.WritingMode.horizontal||s===l.WritingMode.horizontalOnly?s:0,g=s===l.WritingMode.vertical?s:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const E of x)t.text.placedSymbolArray.get(E).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const T in this.placements){const I=this.placements[T],z=g[T];z?(this.opacities[T]=new dn(z,p,I.text,I.icon),c=c||I.text!==z.text.placed||I.icon!==z.icon.placed):(this.opacities[T]=new dn(null,p,I.text,I.icon,I.skipFade),c=c||I.text||I.icon)}for(const T in g){const I=g[T];if(!this.opacities[T]){const z=new dn(I,p,!1,!1);z.isHidden()||(this.opacities[T]=z,c=c||I.text.placed||I.icon.placed)}}for(const T in x)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=x[T]);for(const T in E)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=E[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const c={};for(const p of s){const g=p.getBucket(t);g&&p.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,c,p.collisionBoxArray)}}updateBucketOpacities(t,s,c){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0].layout,g=new dn(null,0,!1,!1,!0),x=p.get("text-allow-overlap"),E=p.get("icon-allow-overlap"),T=p.get("text-variable-anchor"),I=p.get("text-rotation-alignment")==="map",z=p.get("text-pitch-alignment")==="map",R=p.get("icon-text-fit")!=="none",O=new dn(null,0,x&&(E||!t.hasIconData()||p.get("icon-optional")),E&&(x||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const W=(Z,q,re)=>{for(let le=0;le<q/4;le++)Z.opacityVertexArray.emplaceBack(re)};for(let Z=0;Z<t.symbolInstances.length;Z++){const q=t.symbolInstances.get(Z),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:le,crossTileID:ge}=q;let X=this.opacities[ge];s[ge]?X=g:X||(X=O,this.opacities[ge]=X),s[ge]=!0;const be=q.numIconVertices>0,_e=this.placedOrientations[q.crossTileID],Me=_e===l.WritingMode.vertical,Pe=_e===l.WritingMode.horizontal||_e===l.WritingMode.horizontalOnly;if(re>0||le>0){const Be=se(X.text);W(t.text,re,Me?Te:Be),W(t.text,le,Pe?Te:Be);const Ce=X.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(ct=>{ct>=0&&(t.text.placedSymbolArray.get(ct).hidden=Ce||Me?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=Ce||Pe?1:0);const st=this.variableOffsets[q.crossTileID];st&&this.markUsedJustification(t,st.anchor,q,_e);const Ye=this.placedOrientations[q.crossTileID];Ye&&(this.markUsedJustification(t,"left",q,Ye),this.markUsedOrientation(t,Ye,q))}if(be){const Be=se(X.icon),Ce=!(R&&q.verticalPlacedIconSymbolIndex&&Me);q.placedIconSymbolIndex>=0&&(W(t.icon,q.numIconVertices,Ce?Be:Te),t.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=X.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(W(t.icon,q.numVerticalIconVertices,Ce?Te:Be),t.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=X.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Be=t.collisionArrays[Z];if(Be){let Ce=new l.pointGeometry(0,0);if(Be.textBox||Be.verticalTextBox){let Ye=!0;if(T){const ct=this.variableOffsets[ge];ct?(Ce=so(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textBoxScale),I&&Ce._rotate(z?this.transform.angle:-this.transform.angle)):Ye=!1}Be.textBox&&M(t.textCollisionBox.collisionVertexArray,X.text.placed,!Ye||Me,Ce.x,Ce.y),Be.verticalTextBox&&M(t.textCollisionBox.collisionVertexArray,X.text.placed,!Ye||Pe,Ce.x,Ce.y)}const st=Boolean(!Pe&&Be.verticalIconBox);Be.iconBox&&M(t.iconCollisionBox.collisionVertexArray,X.icon.placed,st,R?Ce.x:0,R?Ce.y:0),Be.verticalIconBox&&M(t.iconCollisionBox.collisionVertexArray,X.icon.placed,!st,R?Ce.x:0,R?Ce.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Z.invProjMatrix,t.placementViewportMatrix=Z.viewportMatrix,t.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function M(h,t,s,c,p){h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0)}const D=Math.pow(2,25),V=Math.pow(2,24),j=Math.pow(2,17),Y=Math.pow(2,16),oe=Math.pow(2,9),te=Math.pow(2,8),Q=Math.pow(2,1);function se(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,s=Math.floor(127*h.opacity);return s*D+t*V+s*j+t*Y+s*oe+t*te+s*Q+t}const Te=0;class Re{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,c,p,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((E,T)=>E.sortKey-T.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,g())return!0;return!1}}class Ee{constructor(t,s,c,p,g,x,E,T){this.placement=new $(t,s,x,E,T),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c){const p=l.exported.now(),g=()=>{const x=l.exported.now()-p;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=E)&&(!x.maxzoom||x.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Re(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const dt=512/l.EXTENT/2;class mt{constructor(t,s,c){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(let p=0;p<s.length;p++){const g=s.get(p),x=g.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,s){const c=dt/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*l.EXTENT+t.anchorX)*c),y:Math.floor((s.canonical.y*l.EXTENT+t.anchorY)*c)}}findMatches(t,s,c){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const E=this.indexedSymbolInstances[x.key];if(!E)continue;const T=this.getScaledCoordinates(x,s);for(const I of E)if(Math.abs(I.coord.x-T.x)<=p&&Math.abs(I.coord.y-T.y)<=p&&!c[I.crossTileID]){c[I.crossTileID]=!0,x.crossTileID=I.crossTileID;break}}}}class je{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Tt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const p=this.indexes[c],g={};for(const x in p){const E=p[x];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),g[E.tileID.key]=E}this.indexes[c]=g}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const E in x){const T=x[E];T.tileID.isChildOf(t)&&T.findMatches(s.symbolInstances,t,p)}else{const E=x[t.scaledTo(Number(g)).key];E&&E.findMatches(s.symbolInstances,t,p)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=c.generate(),p[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new mt(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[c])delete this.usedCrossTileIDs[t][p.crossTileID]}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const p=this.indexes[c];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[g]),delete p[g],s=!0)}return s}}class At{constructor(){this.layerIndexes={},this.crossTileIDs=new je,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new Tt);let g=!1;const x={};p.handleWrapJump(c);for(const E of s){const T=E.getBucket(t);T&&t.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(E.tileID,T,this.crossTileIDs)&&(g=!0),x[T.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}var Wt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Lt extends l.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(c=>c.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),l.ortho(c.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[c.key]=new _r(c,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((c,p)=>this.renderHistory.indexOf(c)===p).slice(0,this.renderHistorySize);for(const c of this._renderableTilesKeys)s[c]=!0;for(const c of this.renderHistory)s[c]=!0;for(const c in this._tiles)s[c]||(this._tiles[c].clearTextures(t),delete this._tiles[c])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(p.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),s[c]=g}else if(p.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=p.canonical.z-t.canonical.z,E=p.canonical.x-(p.canonical.x>>x<<x),T=p.canonical.y-(p.canonical.y>>x<<x),I=l.EXTENT>>x;l.ortho(g.posMatrix,0,I,0,I,0,1),l.translate(g.posMatrix,g.posMatrix,[-E*I,-T*I,0]),s[c]=g}else if(t.canonical.isChildOf(p.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-p.canonical.z,E=t.canonical.x-(t.canonical.x>>x<<x),T=t.canonical.y-(t.canonical.y>>x<<x),I=l.EXTENT>>x;l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(g.posMatrix,g.posMatrix,[E*I,T*I,0]),l.scale(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),s[c]=g}}return s}getSourceTile(t,s){const c=this.sourceCache._source;let p=t.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&s)for(;p>=c.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(p--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class Vt{constructor(t,s,c){this.style=t,this.sourceCache=new Lt(s),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.elevationOffset=typeof c.elevationOffset=="number"?c.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,c,p=l.EXTENT){if(!(s>=0&&s<p&&c>=0&&c<p))return this.elevationOffset;let g=0;const x=this.getTerrainData(t);if(x.tile&&x.tile.dem){const E=l.transformMat4$1([],[s/p*l.EXTENT,c/p*l.EXTENT],x.u_terrain_matrix),T=[E[0]*x.tile.dem.dim,E[1]*x.tile.dem.dim],I=[Math.floor(T[0]),Math.floor(T[1])],z=x.tile.dem.get(I[0],I[1]),R=x.tile.dem.get(I[0],I[1]+1),O=x.tile.dem.get(I[0]+1,I[1]),W=x.tile.dem.get(I[0]+1,I[1]+1);g=l.number(l.number(z,R,T[0]-I[0]),l.number(O,W,T[0]-I[0]),T[1]-I[1])}return g}rememberForRerender(t,s){for(const c in this.sourceCache._tiles){const p=this.sourceCache._tiles[c];(p.tileID.equals(s)||p.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(p.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][p.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,c,p=l.EXTENT){return(this.getDEMElevation(t,s,c,p)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.style.map.painter.context,g=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new $e(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new $e(p,new l.RGBAImage({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new $e(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const c=s&&s+s.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?g=t.canonical.z-p:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),E=t.canonical.y-(t.canonical.y>>g<<g),T=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<g),1/(l.EXTENT<<g),0]);l.translate(T,T,[x*l.EXTENT,E*l.EXTENT,0]),this._demMatrixCache[t.key]={matrix:T,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,c=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new $e(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new $e(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(c,p,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let E=0;E<this._coordsTextureSize;E++,x+=4)s[x+0]=255&E,s[x+1]=255&g,s[x+2]=E>>8<<4|g>>8,s[x+3]=0;const c=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new $e(t,c,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){const s=new Uint8Array(4),c=this.style.map.painter,p=c.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(t.x,c.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,s),p.bindFramebuffer.set(null);const x=s[0]+(s[2]>>4<<8),E=s[1]+((15&s[2])<<8),T=this.coordsIndex[255-s[3]],I=T&&this.sourceCache.getTileByID(T);if(!I)return null;const z=this._coordsTextureSize,R=(1<<I.tileID.canonical.z)*z;return new l.MercatorCoordinate((I.tileID.canonical.x*z+x)/R,(I.tileID.canonical.y*z+E)/R,this.getElevation(I.tileID,x,E,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new l.PosArray,c=new l.TriangleIndexArray,p=this.meshSize,g=l.EXTENT/p,x=p*p;for(let E=0;E<=p;E++)for(let T=0;T<=p;T++)s.emplaceBack(T*g,E*g);for(let E=0;E<x;E+=p+1)for(let T=0;T<p;T++)c.emplaceBack(T+E,p+T+E+1,p+T+E+2),c.emplaceBack(T+E,p+T+E+2,T+E+1);return this._mesh={indexBuffer:t.createIndexBuffer(c),vertexBuffer:t.createVertexBuffer(s,Wt.members),segments:l.SegmentVector.simpleSegment(0,0,s.length,c.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return s&&s.dem&&(c.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,c.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),c}}const Kt=(h,t)=>l.emitValidationErrors(h,t&&t.filter(s=>s.identifier!=="source.canvas")),Bt=l.pick(Jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),er=l.pick(Jt,["setCenter","setZoom","setBearing","setPitch"]),Cn=function(){const h={},t=l.spec.$version;for(const s in l.spec.$root){const c=l.spec.$root[s];if(c.required){let p=null;p=s==="version"?t:c.type==="array"?[]:{},p!=null&&(h[s]=p)}}return h}();class Dn extends l.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new kt(ni(),this),this.imageManager=new pe,this.imageManager.setEventedParent(this),this.glyphManager=new Ge(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new xn(256,512),this.crossTileSymbolIndex=new At,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const c=this;this._rtlTextPluginCallback=Dn.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(l.triggerPluginCompletionEvent(g),x&&x.every(E=>E))for(const E in c.sourceCaches)c.sourceCaches[E].reload()})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const E in this._layers){const T=this._layers[E];T.source===x.id&&this._validateLayer(T)}})}loadURL(t,s={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const c=typeof s.validate!="boolean"||s.validate,p=this.map._requestManager.transformRequest(t,l.ResourceType.Style);this._request=l.getJSON(p,(g,x)=>{this._request=null,g?this.fire(new l.ErrorEvent(g)):x&&this._load(x,c)})}loadJSON(t,s={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Cn,!1)}_load(t,s){if(s&&Kt(this,l.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const p in t.sources)this.addSource(p,t.sources[p],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const c=ps(this.stylesheet.layers);this._order=c.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of c)p=l.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ft(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,c,p,g){let x,E,T;const I=p>1?"@2x":"";let z=l.getJSON(c.transformRequest(c.normalizeSpriteURL(s,I,".json"),l.ResourceType.SpriteJSON),(W,Z)=>{z=null,T||(T=W,x=Z,O())}),R=l.getImage(c.transformRequest(c.normalizeSpriteURL(s,I,".png"),l.ResourceType.SpriteImage),(W,Z)=>{R=null,T||(T=W,E=Z,O())});function O(){if(T)g(T);else if(x&&E){const W=l.exported.getImageData(E),Z={};for(const q in x){const{width:re,height:le,x:ge,y:X,sdf:be,pixelRatio:_e,stretchX:Me,stretchY:Pe,content:Be}=x[q],Ce=new l.RGBAImage({width:re,height:le});l.RGBAImage.copy(W,Ce,{x:ge,y:X},{x:0,y:0},{width:re,height:le}),Z[q]={data:Ce,pixelRatio:_e,sdf:be,stretchX:Me,stretchY:Pe,content:Be}}g(null,Z)}}return{cancel(){z&&(z.cancel(),z=null),R&&(R.cancel(),R=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,c)=>{if(this._spriteRequest=null,s)this.fire(new l.ErrorEvent(s));else if(c)for(const p in c)this.imageManager.addImage(p,c[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const c=t.sourceLayer;if(!c)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const c of t){const p=this._layers[c];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const x in this._updatedSources){const E=this._updatedSources[x];if(E==="reload")this._reloadSource(x);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(x)}}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];c[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in c){const g=this.sourceCaches[p];c[p]!==g.used&&g.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new Vt(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=c=>{c.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=c=>{c.tile&&(c.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(c.sourceId,c.tile.tileID)):c.source.type==="geojson"&&this.terrain.rememberForRerender(c.sourceId,c.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Kt(this,l.validateStyle(t)))return!1;(t=l.clone$1(t)).layers=ps(t.layers);const s=function(p,g){if(!p)return[{command:Jt.setStyle,args:[g]}];let x=[];try{if(!fe(p.version,g.version))return[{command:Jt.setStyle,args:[g]}];fe(p.center,g.center)||x.push({command:Jt.setCenter,args:[g.center]}),fe(p.zoom,g.zoom)||x.push({command:Jt.setZoom,args:[g.zoom]}),fe(p.bearing,g.bearing)||x.push({command:Jt.setBearing,args:[g.bearing]}),fe(p.pitch,g.pitch)||x.push({command:Jt.setPitch,args:[g.pitch]}),fe(p.sprite,g.sprite)||x.push({command:Jt.setSprite,args:[g.sprite]}),fe(p.glyphs,g.glyphs)||x.push({command:Jt.setGlyphs,args:[g.glyphs]}),fe(p.transition,g.transition)||x.push({command:Jt.setTransition,args:[g.transition]}),fe(p.light,g.light)||x.push({command:Jt.setLight,args:[g.light]});const E={},T=[];(function(z,R,O,W){let Z;for(Z in R=R||{},z=z||{})Object.prototype.hasOwnProperty.call(z,Z)&&(Object.prototype.hasOwnProperty.call(R,Z)||Io(Z,O,W));for(Z in R)Object.prototype.hasOwnProperty.call(R,Z)&&(Object.prototype.hasOwnProperty.call(z,Z)?fe(z[Z],R[Z])||(z[Z].type==="geojson"&&R[Z].type==="geojson"&&fs(z,R,Z)?O.push({command:Jt.setGeoJSONSourceData,args:[Z,R[Z].data]}):mi(Z,R,O,W)):Wn(Z,R,O))})(p.sources,g.sources,T,E);const I=[];p.layers&&p.layers.forEach(z=>{E[z.source]?x.push({command:Jt.removeLayer,args:[z.id]}):I.push(z)}),x=x.concat(T),function(z,R,O){R=R||[];const W=(z=z||[]).map(Vi),Z=R.map(Vi),q=z.reduce(Wo,{}),re=R.reduce(Wo,{}),le=W.slice(),ge=Object.create(null);let X,be,_e,Me,Pe,Be,Ce;for(X=0,be=0;X<W.length;X++)_e=W[X],Object.prototype.hasOwnProperty.call(re,_e)?be++:(O.push({command:Jt.removeLayer,args:[_e]}),le.splice(le.indexOf(_e,be),1));for(X=0,be=0;X<Z.length;X++)_e=Z[Z.length-1-X],le[le.length-1-X]!==_e&&(Object.prototype.hasOwnProperty.call(q,_e)?(O.push({command:Jt.removeLayer,args:[_e]}),le.splice(le.lastIndexOf(_e,le.length-be),1)):be++,Be=le[le.length-X],O.push({command:Jt.addLayer,args:[re[_e],Be]}),le.splice(le.length-X,0,_e),ge[_e]=!0);for(X=0;X<Z.length;X++)if(_e=Z[X],Me=q[_e],Pe=re[_e],!ge[_e]&&!fe(Me,Pe))if(fe(Me.source,Pe.source)&&fe(Me["source-layer"],Pe["source-layer"])&&fe(Me.type,Pe.type)){for(Ce in Ii(Me.layout,Pe.layout,O,_e,null,Jt.setLayoutProperty),Ii(Me.paint,Pe.paint,O,_e,null,Jt.setPaintProperty),fe(Me.filter,Pe.filter)||O.push({command:Jt.setFilter,args:[_e,Pe.filter]}),fe(Me.minzoom,Pe.minzoom)&&fe(Me.maxzoom,Pe.maxzoom)||O.push({command:Jt.setLayerZoomRange,args:[_e,Pe.minzoom,Pe.maxzoom]}),Me)Object.prototype.hasOwnProperty.call(Me,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?Ii(Me[Ce],Pe[Ce],O,_e,Ce.slice(6),Jt.setPaintProperty):fe(Me[Ce],Pe[Ce])||O.push({command:Jt.setLayerProperty,args:[_e,Ce,Pe[Ce]]}));for(Ce in Pe)Object.prototype.hasOwnProperty.call(Pe,Ce)&&!Object.prototype.hasOwnProperty.call(Me,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?Ii(Me[Ce],Pe[Ce],O,_e,Ce.slice(6),Jt.setPaintProperty):fe(Me[Ce],Pe[Ce])||O.push({command:Jt.setLayerProperty,args:[_e,Ce,Pe[Ce]]}))}else O.push({command:Jt.removeLayer,args:[_e]}),Be=le[le.lastIndexOf(_e)+1],O.push({command:Jt.addLayer,args:[Pe,Be]})}(I,g.layers,x)}catch(E){console.warn("Unable to compute style diff:",E),x=[{command:Jt.setStyle,args:[g]}]}return x}(this.serialize(),t).filter(p=>!(p.command in er));if(s.length===0)return!1;const c=s.filter(p=>!(p.command in Bt));if(c.length>0)throw new Error(`Unimplemented: ${c.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new l.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.validateStyle.source,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[t]=new jr(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new l.ErrorEvent(new Error(`Layer "${p}" already exists on this map.`)));let g;if(t.type==="custom"){if(Kt(this,l.validateCustomStyleLayer(t)))return;g=l.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=l.clone$1(t),t=l.extend(t,{source:p})),this._validate(l.validateStyle.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;g=l.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[g.id]=g.serialize()}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===c||(s!=null&&(p.minzoom=s),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!fe(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.validateStyle.filter,`layers.${p.id}.filter`,s,null,c)||(p.filter=l.clone$1(s),this._updateLayer(p)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?fe(g.getLayoutProperty(s),c)||(g.setLayoutProperty(s,c,p),this._updateLayer(g)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const c=this.getLayer(t);if(c)return c.getLayoutProperty(s);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?fe(g.getPaintProperty(s),c)||(g.setPaintProperty(s,c,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const c=t.source,p=t.sourceLayer,g=this.sourceCaches[c];if(g===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&p?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,t.id,s)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const c=t.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const g=p.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,t.id,s):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,c=t.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,t.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",c={},p=[];for(let x=this._order.length-1;x>=0;x--){const E=this._order[x];if(s(E)){c[E]=x;for(const T of t){const I=T[E];if(I)for(const z of I)p.push(z)}}}p.sort((x,E)=>E.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const E=this._order[x];if(s(E))for(let T=p.length-1;T>=0;T--){const I=p[T].feature;if(c[I.layer.id]<x)break;g.push(I),p.pop()}else for(const T of t){const I=T[E];if(I)for(const z of I)g.push(z.feature)}}return g}queryRenderedFeatures(t,s,c){s&&s.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const x of s.layers){const E=this._layers[x];if(!E)return this.fire(new l.ErrorEvent(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];p[E.source]=!0}}const g=[];s.availableImages=this._availableImages;for(const x in this.sourceCaches)s.layers&&!p[x]||g.push(Ur(this.sourceCaches[x],this._layers,this._serializedLayers,t,s,c));return this.placement&&g.push(function(x,E,T,I,z,R,O){const W={},Z=R.queryRenderedSymbols(I),q=[];for(const re of Object.keys(Z).map(Number))q.push(O[re]);q.sort(Vr);for(const re of q){const le=re.featureIndex.lookupSymbolFeatures(Z[re.bucketInstanceId],E,re.bucketIndex,re.sourceLayerIndex,z.filter,z.layers,z.availableImages,x);for(const ge in le){const X=W[ge]=W[ge]||[],be=le[ge];be.sort((_e,Me)=>{const Pe=re.featureSortOrder;if(Pe){const Be=Pe.indexOf(_e.featureIndex);return Pe.indexOf(Me.featureIndex)-Be}return Me.featureIndex-_e.featureIndex});for(const _e of be)X.push(_e)}}for(const re in W)W[re].forEach(le=>{const ge=le.feature,X=T[x[re].source].getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=X});return W}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s&&s.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const c=this.sourceCaches[t];return c?function(p,g){const x=p.getRenderableIds().map(I=>p.getTileByID(I)),E=[],T={};for(let I=0;I<x.length;I++){const z=x[I],R=z.tileID.canonical.key;T[R]||(T[R]=!0,z.querySourceFeatures(E,g))}return E}(c,s):[]}addSourceType(t,s,c){return Dn.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Dn.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const x in t)if(!fe(t[x],c[x])){p=!0;break}if(!p)return;const g={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}_validate(t,s,c,p,g={}){return(!g||g.validate!==!1)&&Kt(this,t.call(l.validateStyle,l.extend({key:s,style:this.serialize(),value:c,styleSpec:l.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,c,p,g=!1){let x=!1,E=!1;const T={};for(const I of this._order){const z=this._layers[I];if(z.type!=="symbol")continue;if(!T[z.source]){const O=this.sourceCaches[z.source];T[z.source]=O.getRenderableIds(!0).map(W=>O.getTileByID(W)).sort((W,Z)=>Z.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,T[z.source],t.center.lng);x=x||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ee(t,this.terrain,this._order,g,s,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),E=!0),x&&this.pauseablePlacement.placement.setStale()),E||x)for(const I of this._order){const z=this._layers[I];z.type==="symbol"&&this.placement.updateLayerOpacities(z,T[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,c){this.imageManager.getImages(s.icons,c),this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,c){this.glyphManager.getGlyphs(s.stacks,c)}getResource(t,s,c){return l.makeRequest(s,c)}}Dn.getSourceType=function(h){return Tn[h]},Dn.setSourceType=function(h,t){Tn[h]=t},Dn.registerForPluginStateChange=l.registerForPluginStateChange;var Dr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Xo={prelude:en(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:en(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:en(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:en(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:en("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:en(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:en(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:en("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:en("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:en("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:en(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:en(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:en(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:en(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:en(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:en(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:en(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:en(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:en(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:en(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:en(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:en(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:en(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:en(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:en(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:en(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:en("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Dr),terrainDepth:en("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Dr),terrainCoords:en("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Dr)};function en(h,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),p=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,E={};return{fragmentSource:h=h.replace(s,(T,I,z,R,O)=>(E[O]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${z} ${R} ${O};
#else
uniform ${z} ${R} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${z} ${R} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(s,(T,I,z,R,O)=>{const W=R==="float"?"vec2":"vec4",Z=O.match(/color/)?"color":W;return E[O]?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${z} ${W} a_${O};
varying ${z} ${R} ${O};
#else
uniform ${z} ${R} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${z} ${R} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${z} ${R} ${O} = u_${O};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${z} ${W} a_${O};
#else
uniform ${z} ${R} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${z} ${R} ${O} = a_${O};
#else
    ${z} ${R} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${z} ${R} ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${z} ${R} ${O} = u_${O};
#endif
`}),staticAttributes:c,staticUniforms:x}}class lo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,c,p,g,x,E,T,I){this.context=t;let z=this.boundPaintVertexBuffers.length!==p.length;for(let R=0;!z&&R<p.length;R++)this.boundPaintVertexBuffers[R]!==p[R]&&(z=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===c&&!z&&this.boundIndexBuffer===g&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===T&&this.boundDynamicVertexBuffer3===I?(t.bindVertexArrayOES.set(this.vao),E&&E.bind(),g&&g.dynamicDraw&&g.bind(),T&&T.bind(),I&&I.bind()):this.freshBind(s,c,p,g,x,E,T,I)}freshBind(t,s,c,p,g,x,E,T){let I;const z=t.numAttributes,R=this.context,O=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=T;else{I=R.currentNumAttributes||0;for(let W=z;W<I;W++)O.disableVertexAttribArray(W)}s.enableAttributes(O,t);for(const W of c)W.enableAttributes(O,t);x&&x.enableAttributes(O,t),E&&E.enableAttributes(O,t),T&&T.enableAttributes(O,t),s.bind(),s.setVertexAttribPointers(O,t,g);for(const W of c)W.bind(),W.setVertexAttribPointers(O,t,g);x&&(x.bind(),x.setVertexAttribPointers(O,t,g)),p&&p.bind(),E&&(E.bind(),E.setVertexAttribPointers(O,t,g)),T&&(T.bind(),T.setVertexAttribPointers(O,t,g)),R.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function da(h){const t=[];for(let s=0;s<h.length;s++){if(h[s]===null)continue;const c=h[s].split(" ");t.push(c.pop())}return t}class Ul{constructor(t,s,c,p,g,x,E){const T=t.gl;this.program=T.createProgram();const I=da(c.staticAttributes),z=p?p.getBinderAttributes():[],R=I.concat(z),O=Xo.prelude.staticUniforms?da(Xo.prelude.staticUniforms):[],W=c.staticUniforms?da(c.staticUniforms):[],Z=p?p.getBinderUniforms():[],q=O.concat(W).concat(Z),re=[];for(const Pe of q)re.indexOf(Pe)<0&&re.push(Pe);const le=p?p.defines():[];x&&le.push("#define OVERDRAW_INSPECTOR;"),E&&le.push("#define TERRAIN3D;");const ge=le.concat(Xo.prelude.fragmentSource,c.fragmentSource).join(`
`),X=le.concat(Xo.prelude.vertexSource,c.vertexSource).join(`
`),be=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(be,ge),T.compileShader(be),T.attachShader(this.program,be);const _e=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(_e,X),T.compileShader(_e),T.attachShader(this.program,_e),this.attributes={};const Me={};this.numAttributes=R.length;for(let Pe=0;Pe<this.numAttributes;Pe++)R[Pe]&&(T.bindAttribLocation(this.program,Pe,R[Pe]),this.attributes[R[Pe]]=Pe);T.linkProgram(this.program),T.deleteShader(_e),T.deleteShader(be);for(let Pe=0;Pe<re.length;Pe++){const Be=re[Pe];if(Be&&!Me[Be]){const Ce=T.getUniformLocation(this.program,Be);Ce&&(Me[Be]=Ce)}}this.fixedUniforms=g(t,Me),this.terrainUniforms=((Pe,Be)=>({u_depth:new l.Uniform1i(Pe,Be.u_depth),u_terrain:new l.Uniform1i(Pe,Be.u_terrain),u_terrain_dim:new l.Uniform1f(Pe,Be.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Pe,Be.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Pe,Be.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(Pe,Be.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(Pe,Be.u_terrain_exaggeration)}))(t,Me),this.binderUniforms=p?p.getUniforms(t,Me):[]}draw(t,s,c,p,g,x,E,T,I,z,R,O,W,Z,q,re,le,ge){const X=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(g),t.setCullFace(x),T){t.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,T.depthTexture),t.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,T.texture);for(const _e in this.terrainUniforms)this.terrainUniforms[_e].set(T[_e])}for(const _e in this.fixedUniforms)this.fixedUniforms[_e].set(E[_e]);q&&q.setUniforms(t,this.binderUniforms,W,{zoom:Z});let be=0;switch(s){case X.LINES:be=2;break;case X.TRIANGLES:be=3;break;case X.LINE_STRIP:be=1}for(const _e of O.get()){const Me=_e.vaos||(_e.vaos={});(Me[I]||(Me[I]=new lo)).bind(t,this,z,q?q.getPaintVertexBuffers():[],R,_e.vertexOffset,re,le,ge),X.drawElements(s,_e.primitiveLength*be,X.UNSIGNED_SHORT,_e.primitiveOffset*be*2)}}}function Vl(h,t,s){const c=1/Xn(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,x=g*(s.tileID.canonical.x+s.tileID.wrap*p),E=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[c,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[x>>16,E>>16],u_pixel_coord_lower:[65535&x,65535&E]}}const Qa=(h,t,s,c)=>{const p=t.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],E=l.create$1();p.properties.get("anchor")==="viewport"&&l.fromRotation(E,-t.transform.angle),l.transformMat3(x,x,E);const T=p.properties.get("color");return{u_matrix:h,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:c}},jl=(h,t,s,c,p,g,x)=>l.extend(Qa(h,t,s,c),Vl(g,t,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),pa=h=>({u_matrix:h}),el=(h,t,s,c)=>l.extend(pa(h),Vl(s,t,c)),$l=(h,t)=>({u_matrix:h,u_world:t}),Gl=(h,t,s,c,p)=>l.extend(el(h,t,s,c),{u_world:p}),tl=(h,t,s,c)=>{const p=h.transform;let g,x;if(c.paint.get("circle-pitch-alignment")==="map"){const E=Xn(s,1,p.zoom);g=!0,x=[E,E]}else g=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,s,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:x}},v=(h,t,s)=>{const c=Xn(s,1,t.zoom),p=Math.pow(2,t.zoom-s.tileID.overscaledZ),g=s.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[t.pixelsToGLUnits[0]/(c*p),t.pixelsToGLUnits[1]/(c*p)],u_overscale_factor:g}},C=(h,t,s=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:s}),B=h=>({u_matrix:h}),ne=(h,t,s,c)=>({u_matrix:h,u_extrude_scale:Xn(t,1,s),u_intensity:c});function ye(h,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.MercatorCoordinate(0,c/s).toLngLat().lat,new l.MercatorCoordinate(0,(c+1)/s).toLngLat().lat]}const ae=(h,t,s,c)=>{const p=h.transform;return{u_matrix:ve(h,t,s,c),u_ratio:1/Xn(t,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},me=(h,t,s,c,p)=>l.extend(ae(h,t,s,p),{u_image:0,u_image_height:c}),Oe=(h,t,s,c,p)=>{const g=h.transform,x=Ue(t,g);return{u_matrix:ve(h,t,s,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Xn(t,1,g.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Fe=(h,t,s,c,p,g)=>{const x=h.lineAtlas,E=Ue(t,h.transform),T=s.layout.get("line-cap")==="round",I=x.getDash(c.from,T),z=x.getDash(c.to,T),R=I.width*p.fromScale,O=z.width*p.toScale;return l.extend(ae(h,t,s,g),{u_patternscale_a:[E/R,-I.height/2],u_patternscale_b:[E/O,-z.height/2],u_sdfgamma:x.width/(256*Math.min(R,O)*h.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:z.y,u_mix:p.t})};function Ue(h,t){return 1/Xn(h,1,t.tileZoom)}function ve(h,t,s,c){return h.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Ke=(h,t,s,c,p)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:at(p.paint.get("raster-hue-rotate"))};var g,x};function at(h){h*=Math.PI/180;const t=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const wt=(h,t,s,c,p,g,x,E,T,I)=>{const z=p.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:z.width/z.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:E,u_is_text:+T,u_pitch_with_map:+c,u_texsize:I,u_texture:0}},zt=(h,t,s,c,p,g,x,E,T,I,z)=>{const R=p.transform;return l.extend(wt(h,t,s,c,p,g,x,E,T,I),{u_gamma_scale:c?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+z})},Un=(h,t,s,c,p,g,x,E,T,I)=>l.extend(zt(h,t,s,c,p,g,x,E,!0,T,!0),{u_texsize_icon:I,u_texture_icon:1}),De=(h,t,s)=>({u_matrix:h,u_opacity:t,u_color:s}),pt=(h,t,s,c,p,g)=>l.extend(function(x,E,T,I){const z=T.imageManager.getPattern(x.from.toString()),R=T.imageManager.getPattern(x.to.toString()),{width:O,height:W}=T.imageManager.getPixelSize(),Z=Math.pow(2,I.tileID.overscaledZ),q=I.tileSize*Math.pow(2,T.transform.tileZoom)/Z,re=q*(I.tileID.canonical.x+I.tileID.wrap*Z),le=q*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[O,W],u_mix:E.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Xn(I,1,T.transform.tileZoom),u_pixel_coord_upper:[re>>16,le>>16],u_pixel_coord_lower:[65535&re,65535&le]}}(c,g,s,p),{u_matrix:h,u_opacity:t}),cn={fillExtrusion:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_lightpos:new l.Uniform3f(h,t.u_lightpos),u_lightintensity:new l.Uniform1f(h,t.u_lightintensity),u_lightcolor:new l.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(h,t.u_vertical_gradient),u_opacity:new l.Uniform1f(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_lightpos:new l.Uniform3f(h,t.u_lightpos),u_lightintensity:new l.Uniform1f(h,t.u_lightintensity),u_lightcolor:new l.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new l.Uniform1f(h,t.u_height_factor),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade),u_opacity:new l.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(h,t.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(h,t.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(h,t.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(h,t.u_extrude_scale),u_overscale_factor:new l.Uniform1f(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new l.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new l.UniformColor(h,t.u_color),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_overlay:new l.Uniform1i(h,t.u_overlay),u_overlay_scale:new l.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new l.Uniform1f(h,t.u_extrude_scale),u_intensity:new l.Uniform1f(h,t.u_intensity),u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world),u_image:new l.Uniform1i(h,t.u_image),u_color_ramp:new l.Uniform1i(h,t.u_color_ramp),u_opacity:new l.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_latrange:new l.Uniform2f(h,t.u_latrange),u_light:new l.Uniform2f(h,t.u_light),u_shadow:new l.UniformColor(h,t.u_shadow),u_highlight:new l.UniformColor(h,t.u_highlight),u_accent:new l.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_dimension:new l.Uniform2f(h,t.u_dimension),u_zoom:new l.Uniform1f(h,t.u_zoom),u_unpack:new l.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_image:new l.Uniform1i(h,t.u_image),u_image_height:new l.Uniform1f(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texsize:new l.Uniform2f(h,t.u_texsize),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_image:new l.Uniform1i(h,t.u_image),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_ratio:new l.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(h,t.u_patternscale_a),u_patternscale_b:new l.Uniform2f(h,t.u_patternscale_b),u_sdfgamma:new l.Uniform1f(h,t.u_sdfgamma),u_image:new l.Uniform1i(h,t.u_image),u_tex_y_a:new l.Uniform1f(h,t.u_tex_y_a),u_tex_y_b:new l.Uniform1f(h,t.u_tex_y_b),u_mix:new l.Uniform1f(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new l.Uniform2f(h,t.u_tl_parent),u_scale_parent:new l.Uniform1f(h,t.u_scale_parent),u_buffer_scale:new l.Uniform1f(h,t.u_buffer_scale),u_fade_t:new l.Uniform1f(h,t.u_fade_t),u_opacity:new l.Uniform1f(h,t.u_opacity),u_image0:new l.Uniform1i(h,t.u_image0),u_image1:new l.Uniform1i(h,t.u_image1),u_brightness_low:new l.Uniform1f(h,t.u_brightness_low),u_brightness_high:new l.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new l.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new l.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new l.Uniform3f(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texture:new l.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texture:new l.Uniform1i(h,t.u_texture),u_gamma_scale:new l.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texsize_icon:new l.Uniform2f(h,t.u_texsize_icon),u_texture:new l.Uniform1i(h,t.u_texture),u_texture_icon:new l.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new l.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_opacity:new l.Uniform1f(h,t.u_opacity),u_color:new l.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_opacity:new l.Uniform1f(h,t.u_opacity),u_image:new l.Uniform1i(h,t.u_image),u_pattern_tl_a:new l.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(h,t.u_pattern_br_b),u_texsize:new l.Uniform2f(h,t.u_texsize),u_mix:new l.Uniform1f(h,t.u_mix),u_pattern_size_a:new l.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new l.Uniform1f(h,t.u_scale_a),u_scale_b:new l.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texture:new l.Uniform1i(h,t.u_texture)}),terrainDepth:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),terrainCoords:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texture:new l.Uniform1i(h,t.u_texture),u_terrain_coords_id:new l.Uniform1f(h,t.u_terrain_coords_id)})};class an{constructor(t,s,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const kn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bt{constructor(t,s,c,p){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const p=s.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,c){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[kn[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class uo extends Gt{getDefault(){return l.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sn extends Gt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Rr extends Gt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class or extends Gt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fa extends Gt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $r extends Gt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gi extends Gt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Bs extends Gt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Os extends Gt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class nl extends Gt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ma extends Gt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ho extends Gt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ga extends Gt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class ya extends Gt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class _a extends Gt{getDefault(){return l.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ao extends Gt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class rl extends Gt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ms extends Gt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Bu extends Gt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class il extends Gt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ns extends Gt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ol extends Gt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class sl extends Gt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class al extends Gt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ko extends Gt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class va extends Gt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ll extends Gt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ul extends Gt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class gs extends Gt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Zl extends Gt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class cl extends Gt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ys extends Gt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class oi extends ys{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class $i extends ys{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yi{constructor(t,s,c,p){this.context=t,this.width=s,this.height=c;const g=t.gl,x=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new oi(t,x),p&&(this.depthAttachment=new $i(t,x)),g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class mn{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}mn.Replace=[1,0],mn.disabled=new mn(mn.Replace,l.Color.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,l.Color.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class co{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new uo(this),this.clearDepth=new sn(this),this.clearStencil=new Rr(this),this.colorMask=new or(this),this.depthMask=new fa(this),this.stencilMask=new $r(this),this.stencilFunc=new gi(this),this.stencilOp=new Bs(this),this.stencilTest=new Os(this),this.depthRange=new nl(this),this.depthTest=new ma(this),this.depthFunc=new Ho(this),this.blend=new ga(this),this.blendFunc=new ya(this),this.blendColor=new _a(this),this.blendEquation=new Ao(this),this.cullFace=new rl(this),this.cullFaceSide=new ms(this),this.frontFace=new Bu(this),this.program=new il(this),this.activeTexture=new Ns(this),this.viewport=new ol(this),this.bindFramebuffer=new sl(this),this.bindRenderbuffer=new al(this),this.bindTexture=new Ko(this),this.bindVertexBuffer=new va(this),this.bindElementBuffer=new ll(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ul(this),this.pixelStoreUnpack=new gs(this),this.pixelStoreUnpackPremultiplyAlpha=new Zl(this),this.pixelStoreUnpackFlipY=new cl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new an(this,t,s)}createVertexBuffer(t,s,c){return new bt(this,t,s,c)}createRenderbuffer(t,s,c){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,c){return new yi(this,t,s,c)}clear({color:t,depth:s}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){fe(t.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Zt{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}Zt.ReadOnly=!1,Zt.ReadWrite=!0,Zt.disabled=new Zt(519,Zt.ReadOnly,[0,1]);const Yt=7680;class hn{constructor(t,s,c,p,g,x){this.test=t,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=x}}hn.disabled=new hn({func:519,mask:0},0,0,Yt,Yt,Yt);class En{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}let _s;function vs(h,t,s,c,p,g,x){const E=h.context,T=E.gl,I=h.useProgram("collisionBox"),z=[];let R=0,O=0;for(let X=0;X<c.length;X++){const be=c[X],_e=t.getTile(be),Me=_e.getBucket(s);if(!Me)continue;let Pe=be.posMatrix;p[0]===0&&p[1]===0||(Pe=h.translatePosMatrix(be.posMatrix,_e,p,g));const Be=x?Me.textCollisionBox:Me.iconCollisionBox,Ce=Me.collisionCircleArray;if(Ce.length>0){const st=l.create(),Ye=Pe;l.mul(st,Me.placementInvProjMatrix,h.transform.glCoordMatrix),l.mul(st,st,Me.placementViewportMatrix),z.push({circleArray:Ce,circleOffset:O,transform:Ye,invTransform:st,coord:be}),R+=Ce.length/4,O=R}Be&&I.draw(E,T.LINES,Zt.disabled,hn.disabled,h.colorModeForRenderPass(),En.disabled,v(Pe,h.transform,_e),h.style.terrain&&h.style.terrain.getTerrainData(be),s.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,h.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!x||!z.length)return;const W=h.useProgram("collisionCircle"),Z=new l.CollisionCircleLayoutArray;Z.resize(4*R),Z._trim();let q=0;for(const X of z)for(let be=0;be<X.circleArray.length/4;be++){const _e=4*be,Me=X.circleArray[_e+0],Pe=X.circleArray[_e+1],Be=X.circleArray[_e+2],Ce=X.circleArray[_e+3];Z.emplace(q++,Me,Pe,Be,Ce,0),Z.emplace(q++,Me,Pe,Be,Ce,1),Z.emplace(q++,Me,Pe,Be,Ce,2),Z.emplace(q++,Me,Pe,Be,Ce,3)}(!_s||_s.length<2*R)&&(_s=function(X){const be=2*X,_e=new l.QuadTriangleArray;_e.resize(be),_e._trim();for(let Me=0;Me<be;Me++){const Pe=6*Me;_e.uint16[Pe+0]=4*Me+0,_e.uint16[Pe+1]=4*Me+1,_e.uint16[Pe+2]=4*Me+2,_e.uint16[Pe+3]=4*Me+2,_e.uint16[Pe+4]=4*Me+3,_e.uint16[Pe+5]=4*Me+0}return _e}(R));const re=E.createIndexBuffer(_s,!0),le=E.createVertexBuffer(Z,l.collisionCircleLayout.members,!0);for(const X of z){const be={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(ge=h.transform).cameraToCenterDistance,u_viewport_size:[ge.width,ge.height]};W.draw(E,T.TRIANGLES,Zt.disabled,hn.disabled,h.colorModeForRenderPass(),En.disabled,be,h.style.terrain&&h.style.terrain.getTerrainData(X.coord),s.id,le,re,l.SegmentVector.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ge;le.destroy(),re.destroy()}En.disabled=new En(!1,1029,2305),En.backCCW=new En(!0,1029,2305);const Ou=l.identity(new Float32Array(16));function ql(h,t,s,c,p,g){const{horizontalAlign:x,verticalAlign:E}=l.getAnchorAlignment(h),T=-(x-.5)*t,I=-(E-.5)*s,z=l.evaluateVariableOffset(h,c);return new l.pointGeometry((T/p+z[0])*g,(I/p+z[1])*g)}function hl(h,t,s,c,p,g,x,E,T,I,z){const R=h.text.placedSymbolArray,O=h.text.dynamicLayoutVertexArray,W=h.icon.dynamicLayoutVertexArray,Z={};O.clear();for(let q=0;q<R.length;q++){const re=R.get(q),le=h.allowVerticalPlacement&&!re.placedOrientation,ge=re.hidden||!re.crossTileID||le?null:c[re.crossTileID];if(ge){const X=new l.pointGeometry(re.anchorX,re.anchorY),be=Nt(X,s?x:g,z),_e=Ln(p.cameraToCenterDistance,be.signedDistanceFromCamera);let Me=l.evaluateSizeForFeature(h.textSizeData,T,re)*_e/l.ONE_EM;s&&(Me*=h.tilePixelRatio/E);const{width:Pe,height:Be,anchor:Ce,textOffset:st,textBoxScale:Ye}=ge,ct=ql(Ce,Pe,Be,st,Ye,Me),Ot=s?Nt(X.add(ct),g,z).point:be.point.add(t?ct.rotate(-p.angle):ct),jt=h.allowVerticalPlacement&&re.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let St=0;St<re.numGlyphs;St++)l.addDynamicAttributes(O,Ot,jt);I&&re.associatedIconIndex>=0&&(Z[re.associatedIconIndex]={shiftedAnchor:Ot,angle:jt})}else Dt(re.numGlyphs,O)}if(I){W.clear();const q=h.icon.placedSymbolArray;for(let re=0;re<q.length;re++){const le=q.get(re);if(le.hidden)Dt(le.numGlyphs,W);else{const ge=Z[re];if(ge)for(let X=0;X<le.numGlyphs;X++)l.addDynamicAttributes(W,ge.shiftedAnchor,ge.angle);else Dt(le.numGlyphs,W)}}h.icon.dynamicLayoutVertexBuffer.updateData(W)}h.text.dynamicLayoutVertexBuffer.updateData(O)}function xa(h,t,s){return s.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function ho(h,t,s,c,p,g,x,E,T,I,z,R){const O=h.context,W=O.gl,Z=h.transform,q=E==="map",re=T==="map",le=E!=="viewport"&&s.layout.get("symbol-placement")!=="point",ge=q&&!re&&!le,X=!s.layout.get("symbol-sort-key").isConstant();let be=!1;const _e=h.depthModeForSublayer(0,Zt.ReadOnly),Me=s.layout.get("text-variable-anchor"),Pe=[];for(const Be of c){const Ce=t.getTile(Be),st=Ce.getBucket(s);if(!st)continue;const Ye=p?st.text:st.icon;if(!Ye||!Ye.segments.get().length)continue;const ct=Ye.programConfigurations.get(s.id),Ot=p||st.sdfIcons,jt=p?st.textSizeData:st.iconSizeData,St=re||Z.pitch!==0,yn=h.useProgram(xa(Ot,p,st),ct),_n=l.evaluateSizeForZoom(jt,Z.zoom),tn=h.style.terrain&&h.style.terrain.getTerrainData(Be);let nn,wn,Er,Bo,go=[0,0],Oo=null;if(p){if(wn=Ce.glyphAtlasTexture,Er=W.LINEAR,nn=Ce.glyphAtlasTexture.size,st.iconsInText){go=Ce.imageAtlasTexture.size,Oo=Ce.imageAtlasTexture;const Ji=jt.kind==="composite"||jt.kind==="camera";Bo=St||h.options.rotating||h.options.zooming||Ji?W.LINEAR:W.NEAREST}}else{const Ji=s.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;wn=Ce.imageAtlasTexture,Er=Ot||h.options.rotating||h.options.zooming||Ji||St?W.LINEAR:W.NEAREST,nn=Ce.imageAtlasTexture.size}const Is=Xn(Ce,1,h.transform.zoom),Ki=$n(Be.posMatrix,re,q,h.transform,Is),xi=dr(Be.posMatrix,re,q,h.transform,Is),Qo=Me&&st.hasTextData(),Xl=s.layout.get("icon-text-fit")!=="none"&&Qo&&st.hasIconData();if(le){const Ji=h.style.terrain?(Wu,Ca)=>h.style.terrain.getElevation(Be,Wu,Ca):null,Ws=s.layout.get("text-rotation-alignment")==="map";xr(st,Be.posMatrix,h,p,Ki,xi,re,I,Ws,Ji)}const fr=h.translatePosMatrix(Be.posMatrix,Ce,g,x),qt=le||p&&Me||Xl?Ou:Ki,pn=h.translatePosMatrix(xi,Ce,g,x,!0),Tr=Ot&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cr;Cr=Ot?st.iconsInText?Un(jt.kind,_n,ge,re,h,fr,qt,pn,nn,go):zt(jt.kind,_n,ge,re,h,fr,qt,pn,p,nn,!0):wt(jt.kind,_n,ge,re,h,fr,qt,pn,p,nn);const Bn={program:yn,buffers:Ye,uniformValues:Cr,atlasTexture:wn,atlasTextureIcon:Oo,atlasInterpolation:Er,atlasInterpolationIcon:Bo,isSDF:Ot,hasHalo:Tr};if(X&&st.canOverlap){be=!0;const Ji=Ye.segments.get();for(const Ws of Ji)Pe.push({segments:new l.SegmentVector([Ws]),sortKey:Ws.sortKey,state:Bn,terrainData:tn})}else Pe.push({segments:Ye.segments,sortKey:0,state:Bn,terrainData:tn})}be&&Pe.sort((Be,Ce)=>Be.sortKey-Ce.sortKey);for(const Be of Pe){const Ce=Be.state;if(O.activeTexture.set(W.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,W.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(O.activeTexture.set(W.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ce.isSDF){const st=Ce.uniformValues;Ce.hasHalo&&(st.u_is_halo=1,Us(Ce.buffers,Be.segments,s,h,Ce.program,_e,z,R,st,Be.terrainData)),st.u_is_halo=0}Us(Ce.buffers,Be.segments,s,h,Ce.program,_e,z,R,Ce.uniformValues,Be.terrainData)}}function Us(h,t,s,c,p,g,x,E,T,I){const z=c.context;p.draw(z,z.gl.TRIANGLES,g,x,E,En.disabled,T,I,s.id,h.layoutVertexBuffer,h.indexBuffer,t,s.paint,c.transform.zoom,h.programConfigurations.get(s.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function _i(h,t,s,c,p,g,x){const E=h.context.gl,T=s.paint.get("fill-pattern"),I=T&&T.constantOr(1),z=s.getCrossfadeParameters();let R,O,W,Z,q;x?(O=I&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(O=I?"fillPattern":"fill",R=E.TRIANGLES);for(const re of c){const le=t.getTile(re);if(I&&!le.patternsLoaded())continue;const ge=le.getBucket(s);if(!ge)continue;const X=ge.programConfigurations.get(s.id),be=h.useProgram(O,X),_e=h.style.terrain&&h.style.terrain.getTerrainData(re);I&&(h.context.activeTexture.set(E.TEXTURE0),le.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),X.updatePaintBuffers(z));const Me=T.constantOr(null);if(Me&&le.imageAtlas){const Ce=le.imageAtlas,st=Ce.patternPositions[Me.to.toString()],Ye=Ce.patternPositions[Me.from.toString()];st&&Ye&&X.setConstantPatternPositions(st,Ye)}const Pe=_e?re:null,Be=h.translatePosMatrix(Pe?Pe.posMatrix:re.posMatrix,le,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){Z=ge.indexBuffer2,q=ge.segments2;const Ce=[E.drawingBufferWidth,E.drawingBufferHeight];W=O==="fillOutlinePattern"&&I?Gl(Be,h,z,le,Ce):$l(Be,Ce)}else Z=ge.indexBuffer,q=ge.segments,W=I?el(Be,h,z,le):pa(Be);be.draw(h.context,R,p,h.stencilModeForClipping(re),g,En.disabled,W,_e,s.id,ge.layoutVertexBuffer,Z,q,s.paint,h.transform.zoom,X)}}function Vs(h,t,s,c,p,g,x){const E=h.context,T=E.gl,I=s.paint.get("fill-extrusion-pattern"),z=I.constantOr(1),R=s.getCrossfadeParameters(),O=s.paint.get("fill-extrusion-opacity");for(const W of c){const Z=t.getTile(W),q=Z.getBucket(s);if(!q)continue;const re=h.style.terrain&&h.style.terrain.getTerrainData(W),le=q.programConfigurations.get(s.id),ge=h.useProgram(z?"fillExtrusionPattern":"fillExtrusion",le);z&&(h.context.activeTexture.set(T.TEXTURE0),Z.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),le.updatePaintBuffers(R));const X=I.constantOr(null);if(X&&Z.imageAtlas){const Pe=Z.imageAtlas,Be=Pe.patternPositions[X.to.toString()],Ce=Pe.patternPositions[X.from.toString()];Be&&Ce&&le.setConstantPatternPositions(Be,Ce)}const be=h.translatePosMatrix(W.posMatrix,Z,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_e=s.paint.get("fill-extrusion-vertical-gradient"),Me=z?jl(be,h,_e,O,W,R,Z):Qa(be,h,_e,O);ge.draw(E,E.gl.TRIANGLES,p,g,x,En.backCCW,Me,re,s.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,s.paint,h.transform.zoom,le,h.style.terrain&&q.centroidVertexBuffer)}}function po(h,t,s,c,p,g,x){const E=h.context,T=E.gl,I=s.fbo;if(!I)return;const z=h.useProgram("hillshade"),R=h.style.terrain&&h.style.terrain.getTerrainData(t);E.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.colorAttachment.get()),z.draw(E,T.TRIANGLES,p,g,x,En.disabled,((O,W,Z,q)=>{const re=Z.paint.get("hillshade-shadow-color"),le=Z.paint.get("hillshade-highlight-color"),ge=Z.paint.get("hillshade-accent-color");let X=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=O.transform.angle);const be=!O.options.moving;return{u_matrix:q?q.posMatrix:O.transform.calculatePosMatrix(W.tileID.toUnwrapped(),be),u_image:0,u_latrange:ye(0,W.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),X],u_shadow:re,u_highlight:le,u_accent:ge}})(h,s,c,R?t:null),R,c.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function dl(h,t,s,c,p,g){const x=h.context,E=x.gl,T=t.dem;if(T&&T.data){const I=T.dim,z=T.stride,R=T.getPixels();if(x.activeTexture.set(E.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(z),t.demTexture){const W=t.demTexture;W.update(R,{premultiply:!1}),W.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else t.demTexture=new $e(x,R,E.RGBA,{premultiply:!1}),t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);x.activeTexture.set(E.TEXTURE0);let O=t.fbo;if(!O){const W=new $e(x,{width:I,height:I,data:null},E.RGBA);W.bind(E.LINEAR,E.CLAMP_TO_EDGE),O=t.fbo=x.createFramebuffer(I,I,!0),O.colorAttachment.set(W.texture)}x.bindFramebuffer.set(O.framebuffer),x.viewport.set([0,0,I,I]),h.useProgram("hillshadePrepare").draw(x,E.TRIANGLES,c,p,g,En.disabled,((W,Z)=>{const q=Z.stride,re=l.create();return l.ortho(re,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(re,re,[0,-l.EXTENT,0]),{u_matrix:re,u_image:1,u_dimension:[q,q],u_zoom:W.overscaledZ,u_unpack:Z.getUnpackVector()}})(t.tileID,T),null,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function wa(h,t,s,c,p,g){const x=c.paint.get("raster-fade-duration");if(!g&&x>0){const E=l.exported.now(),T=(E-h.timeAdded)/x,I=t?(E-t.timeAdded)/x:-1,z=s.getSource(),R=p.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(h.tileID.overscaledZ-R),W=O&&h.refreshedUponExpiration?1:l.clamp(O?T:1-I,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}const Jo=new l.Color(1,0,0,1),si=new l.Color(0,1,0,1),pl=new l.Color(0,0,1,1),ba=new l.Color(1,0,1,1),fl=new l.Color(0,1,1,1);function Pi(h,t,s,c){ws(h,0,t+s/2,h.transform.width,s,c)}function xs(h,t,s,c){ws(h,t-s/2,0,s,h.transform.height,c)}function ws(h,t,s,c,p,g){const x=h.context,E=x.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*h.pixelRatio,s*h.pixelRatio,c*h.pixelRatio,p*h.pixelRatio),x.clear({color:g}),E.disable(E.SCISSOR_TEST)}function ce(h,t,s){const c=h.context,p=c.gl,g=s.posMatrix,x=h.useProgram("debug"),E=Zt.disabled,T=hn.disabled,I=h.colorModeForRenderPass(),z="$debug",R=h.style.terrain&&h.style.terrain.getTerrainData(s);c.activeTexture.set(p.TEXTURE0),h.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE);const O=t.getTileByID(s.key).latestRawTileData,W=Math.floor((O&&O.byteLength||0)/1024),Z=t.getTile(s).tileSize,q=512/Math.min(Z,512)*(s.overscaledZ/h.transform.zoom)*.5;let re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(re+=` => ${s.overscaledZ}`),function(le,ge){le.initDebugOverlayCanvas();const X=le.debugOverlayCanvas,be=le.context.gl,_e=le.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,X.width,X.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(ge,5,5),_e.strokeText(ge,5,5),le.debugOverlayTexture.update(X),le.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(h,`${re} ${W}kB`),x.draw(c,p.TRIANGLES,E,T,mn.alphaBlended,En.disabled,C(g,l.Color.transparent,q),null,z,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),x.draw(c,p.LINE_STRIP,E,T,I,En.disabled,C(g,l.Color.red),R,z,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function ke(h,t,s){const c=h.context,p=c.gl,g=h.colorModeForRenderPass(),x=new Zt(p.LEQUAL,Zt.ReadWrite,h.depthRangeFor3D),E=h.useProgram("terrain"),T=t.getTerrainMesh(),I=t.getTerrainData(s.tileID);c.bindFramebuffer.set(null),c.viewport.set([0,0,h.width,h.height]),c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const z=h.transform.calculatePosMatrix(s.tileID.toUnwrapped());E.draw(c,p.TRIANGLES,x,hn.disabled,g,En.backCCW,{u_matrix:z,u_texture:0},I,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}function et(h,t,s,c){const p=h.context,g=s.tileSize*t.qualityFactor;s.textures[c]||(s.textures[c]=h.getTileTexture(g)||new $e(p,{width:g,height:g,data:null},p.gl.RGBA),s.textures[c].bind(p.gl.LINEAR,p.gl.CLAMP_TO_EDGE),c===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const x=t.getRTTFramebuffer();x.colorAttachment.set(s.textures[c].texture),p.bindFramebuffer.set(x.framebuffer),p.viewport.set([0,0,g,g])}class Ct{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const p=t.sourceCaches[c].getVisibleCoordinates();for(const g of p){const x=s.sourceCache.getTerrainCoords(g);for(const E in x)this._coordsDescendingInv[c][E]||(this._coordsDescendingInv[c][E]=[]),this._coordsDescendingInv[c][E].push(x[E])}}for(const c of t._order){const p=t._layers[c],g=p.source;if(this._renderToTexture[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(E=>E.key).sort().join()}}return this._renderableTiles.forEach(c=>{for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][c.tileID.key];g&&g!==c.textureCoords[p]&&c.clearTextures(this.painter),s.needsRerender(p,c.tileID)&&c.clearTextures(this.painter)}this._rerender[c.tileID.key]=!c.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,c=this.painter,p=c.style._order,g=c.currentLayer,x=g+1===p.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(p[g]),!x))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&x){this._prevType=s;const E=this._stacks.length-1,T=this._stacks[E]||[];for(const I of this._renderableTiles){if(et(c,c.style.terrain,I,E),this._rerender[I.tileID.key]){c.context.clear({color:l.Color.transparent});for(let z=0;z<T.length;z++){const R=c.style._layers[T[z]],O=R.source?this._coordsDescendingInv[R.source][I.tileID.key]:[I.tileID];c._renderTileClippingMasks(R,O),c.renderLayer(c,c.style.sourceCaches[R.source],R,O),R.source&&(I.textureCoords[R.source]=this._coordsDescendingInvStr[R.source][I.tileID.key])}}ke(c,c.style.terrain,I)}if(s==="hillshade"){this._stacks.push([p[g]]);for(const I of this._renderableTiles){const z=this._coordsDescendingInv[t.source][I.tileID.key];et(c,c.style.terrain,I,this._stacks.length-1),c.context.clear({color:l.Color.transparent}),c._renderTileClippingMasks(t,z),c.renderLayer(c,c.style.sourceCaches[t.source],t,z),ke(c,c.style.terrain,I)}return!0}return this._renderToTexture[s]}return!1}}const gn={symbol:function(h,t,s,c,p){if(h.renderPass!=="translucent")return;const g=hn.disabled,x=h.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(E,T,I,z,R,O,W){const Z=T.transform,q=R==="map",re=O==="map";for(const le of E){const ge=z.getTile(le),X=ge.getBucket(I);if(!X||!X.text||!X.text.segments.get().length)continue;const be=l.evaluateSizeForZoom(X.textSizeData,Z.zoom),_e=Xn(ge,1,T.transform.zoom),Me=$n(le.posMatrix,re,q,T.transform,_e),Pe=I.layout.get("icon-text-fit")!=="none"&&X.hasIconData();if(be){const Be=Math.pow(2,Z.zoom-ge.tileID.overscaledZ);hl(X,q,re,W,Z,Me,le.posMatrix,Be,be,Pe,T.style.terrain?(Ce,st)=>T.style.terrain.getElevation(le,Ce,st):null)}}}(c,h,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&ho(h,t,s,c,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),g,x),s.paint.get("text-opacity").constantOr(1)!==0&&ho(h,t,s,c,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),g,x),t.map.showCollisionBoxes&&(vs(h,t,s,c,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),vs(h,t,s,c,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),E=!s.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const T=h.context,I=T.gl,z=h.depthModeForSublayer(0,Zt.ReadOnly),R=hn.disabled,O=h.colorModeForRenderPass(),W=[];for(let Z=0;Z<c.length;Z++){const q=c[Z],re=t.getTile(q),le=re.getBucket(s);if(!le)continue;const ge=le.programConfigurations.get(s.id),X=h.useProgram("circle",ge),be=le.layoutVertexBuffer,_e=le.indexBuffer,Me=h.style.terrain&&h.style.terrain.getTerrainData(q),Pe={programConfiguration:ge,program:X,layoutVertexBuffer:be,indexBuffer:_e,uniformValues:tl(h,q,re,s),terrainData:Me};if(E){const Be=le.segments.get();for(const Ce of Be)W.push({segments:new l.SegmentVector([Ce]),sortKey:Ce.sortKey,state:Pe})}else W.push({segments:le.segments,sortKey:0,state:Pe})}E&&W.sort((Z,q)=>Z.sortKey-q.sortKey);for(const Z of W){const{programConfiguration:q,program:re,layoutVertexBuffer:le,indexBuffer:ge,uniformValues:X,terrainData:be}=Z.state;re.draw(T,I.TRIANGLES,z,R,O,En.disabled,X,be,s.id,le,ge,Z.segments,s.paint,h.transform.zoom,q)}},heatmap:function(h,t,s,c){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,g=p.gl,x=hn.disabled,E=new mn([g.ONE,g.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(T,I,z){const R=T.gl;T.activeTexture.set(R.TEXTURE1),T.viewport.set([0,0,I.width/4,I.height/4]);let O=z.heatmapFbo;if(O)R.bindTexture(R.TEXTURE_2D,O.colorAttachment.get()),T.bindFramebuffer.set(O.framebuffer);else{const W=R.createTexture();R.bindTexture(R.TEXTURE_2D,W),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),O=z.heatmapFbo=T.createFramebuffer(I.width/4,I.height/4,!1),function(Z,q,re,le){const ge=Z.gl;ge.texImage2D(ge.TEXTURE_2D,0,ge.RGBA,q.width/4,q.height/4,0,ge.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:ge.UNSIGNED_BYTE,null),le.colorAttachment.set(re)}(T,I,W,O)}})(p,h,s),p.clear({color:l.Color.transparent});for(let T=0;T<c.length;T++){const I=c[T];if(t.hasRenderableParent(I))continue;const z=t.getTile(I),R=z.getBucket(s);if(!R)continue;const O=R.programConfigurations.get(s.id),W=h.useProgram("heatmap",O),{zoom:Z}=h.transform;W.draw(p,g.TRIANGLES,Zt.disabled,x,E,En.disabled,ne(I.posMatrix,z,Z,s.paint.get("heatmap-intensity")),null,s.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,s.paint,h.transform.zoom,O)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,g){const x=p.context,E=x.gl,T=g.heatmapFbo;if(!T)return;x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,T.colorAttachment.get()),x.activeTexture.set(E.TEXTURE1);let I=g.colorRampTexture;I||(I=g.colorRampTexture=new $e(x,g.colorRamp,E.RGBA)),I.bind(E.LINEAR,E.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(x,E.TRIANGLES,Zt.disabled,hn.disabled,p.colorModeForRenderPass(),En.disabled,((z,R,O,W)=>{const Z=l.create();l.ortho(Z,0,z.width,z.height,0,0,1);const q=z.context.gl;return{u_matrix:Z,u_world:[q.drawingBufferWidth,q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}})(p,g),null,g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(h,s))},line:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const x=h.depthModeForSublayer(0,Zt.ReadOnly),E=h.colorModeForRenderPass(),T=s.paint.get("line-dasharray"),I=s.paint.get("line-pattern"),z=I.constantOr(1),R=s.paint.get("line-gradient"),O=s.getCrossfadeParameters(),W=z?"linePattern":T?"lineSDF":R?"lineGradient":"line",Z=h.context,q=Z.gl;let re=!0;for(const le of c){const ge=t.getTile(le);if(z&&!ge.patternsLoaded())continue;const X=ge.getBucket(s);if(!X)continue;const be=X.programConfigurations.get(s.id),_e=h.context.program.get(),Me=h.useProgram(W,be),Pe=re||Me.program!==_e,Be=h.style.terrain&&h.style.terrain.getTerrainData(le),Ce=I.constantOr(null);if(Ce&&ge.imageAtlas){const ct=ge.imageAtlas,Ot=ct.patternPositions[Ce.to.toString()],jt=ct.patternPositions[Ce.from.toString()];Ot&&jt&&be.setConstantPatternPositions(Ot,jt)}const st=Be?le:null,Ye=z?Oe(h,ge,s,O,st):T?Fe(h,ge,s,T,O,st):R?me(h,ge,s,X.lineClipsArray.length,st):ae(h,ge,s,st);if(z)Z.activeTexture.set(q.TEXTURE0),ge.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),be.updatePaintBuffers(O);else if(T&&(Pe||h.lineAtlas.dirty))Z.activeTexture.set(q.TEXTURE0),h.lineAtlas.bind(Z);else if(R){const ct=X.gradients[s.id];let Ot=ct.texture;if(s.gradientVersion!==ct.version){let jt=256;if(s.stepInterpolant){const St=t.getSource().maxzoom,yn=le.canonical.z===St?Math.ceil(1<<h.transform.maxZoom-le.canonical.z):1;jt=l.clamp(l.nextPowerOfTwo(X.maxLineLength/l.EXTENT*1024*yn),256,Z.maxTextureSize)}ct.gradient=l.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:jt,image:ct.gradient||void 0,clips:X.lineClipsArray}),ct.texture?ct.texture.update(ct.gradient):ct.texture=new $e(Z,ct.gradient,q.RGBA),ct.version=s.gradientVersion,Ot=ct.texture}Z.activeTexture.set(q.TEXTURE0),Ot.bind(s.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}Me.draw(Z,q.TRIANGLES,x,h.stencilModeForClipping(le),E,En.disabled,Ye,Be,s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,h.transform.zoom,be,X.layoutVertexBuffer2),re=!1}},fill:function(h,t,s,c){const p=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=h.colorModeForRenderPass(),E=s.paint.get("fill-pattern"),T=h.opaquePassEnabledForLayer()&&!E.constantOr(1)&&p.constantOr(l.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===T){const I=h.depthModeForSublayer(1,h.renderPass==="opaque"?Zt.ReadWrite:Zt.ReadOnly);_i(h,t,s,c,I,x,!1)}if(h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const I=h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Zt.ReadOnly);_i(h,t,s,c,I,x,!0)}},"fill-extrusion":function(h,t,s,c){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&h.renderPass==="translucent"){const g=new Zt(h.context.gl.LEQUAL,Zt.ReadWrite,h.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Vs(h,t,s,c,g,hn.disabled,mn.disabled),Vs(h,t,s,c,g,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const x=h.colorModeForRenderPass();Vs(h,t,s,c,g,hn.disabled,x)}}},hillshade:function(h,t,s,c){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const p=h.context,g=h.depthModeForSublayer(0,Zt.ReadOnly),x=h.colorModeForRenderPass(),[E,T]=h.renderPass==="translucent"?h.stencilConfigForOverlap(c):[{},c];for(const I of T){const z=t.getTile(I);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&h.renderPass==="offscreen"?dl(h,z,s,g,hn.disabled,x):h.renderPass==="translucent"&&po(h,I,z,s,g,E[I.overscaledZ],x)}p.viewport.set([0,0,h.width,h.height])},raster:function(h,t,s,c){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!c.length)return;const p=h.context,g=p.gl,x=t.getSource(),E=h.useProgram("raster"),T=h.colorModeForRenderPass(),[I,z]=x instanceof Pt?[{},c]:h.stencilConfigForOverlap(c),R=z[z.length-1].overscaledZ,O=!h.options.moving;for(const W of z){const Z=h.depthModeForSublayer(W.overscaledZ-R,s.paint.get("raster-opacity")===1?Zt.ReadWrite:Zt.ReadOnly,g.LESS),q=t.getTile(W);q.registerFadeDuration(s.paint.get("raster-fade-duration"));const re=t.findLoadedParent(W,0),le=wa(q,re,t,s,h.transform,h.style.terrain);let ge,X;const be=s.paint.get("raster-resampling")==="nearest"?g.NEAREST:g.LINEAR;p.activeTexture.set(g.TEXTURE0),q.texture.bind(be,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(g.TEXTURE1),re?(re.texture.bind(be,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),ge=Math.pow(2,re.tileID.overscaledZ-q.tileID.overscaledZ),X=[q.tileID.canonical.x*ge%1,q.tileID.canonical.y*ge%1]):q.texture.bind(be,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const _e=h.style.terrain&&h.style.terrain.getTerrainData(W),Me=_e?W:null,Pe=Me?Me.posMatrix:h.transform.calculatePosMatrix(W.toUnwrapped(),O),Be=Ke(Pe,X||[0,0],ge||1,le,s);x instanceof Pt?E.draw(p,g.TRIANGLES,Z,hn.disabled,T,En.disabled,Be,_e,s.id,x.boundsBuffer,h.quadTriangleIndexBuffer,x.boundsSegments):E.draw(p,g.TRIANGLES,Z,I[W.overscaledZ],T,En.disabled,Be,_e,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,t,s,c){const p=s.paint.get("background-color"),g=s.paint.get("background-opacity");if(g===0)return;const x=h.context,E=x.gl,T=h.transform,I=T.tileSize,z=s.paint.get("background-pattern");if(h.isPatternMissing(z))return;const R=!z&&p.a===1&&g===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==R)return;const O=hn.disabled,W=h.depthModeForSublayer(0,R==="opaque"?Zt.ReadWrite:Zt.ReadOnly),Z=h.colorModeForRenderPass(),q=h.useProgram(z?"backgroundPattern":"background"),re=c||T.coveringTiles({tileSize:I,terrain:h.style.terrain});z&&(x.activeTexture.set(E.TEXTURE0),h.imageManager.bind(h.context));const le=s.getCrossfadeParameters();for(const ge of re){const X=c?ge.posMatrix:h.transform.calculatePosMatrix(ge.toUnwrapped()),be=z?pt(X,g,h,z,{tileID:ge,tileSize:I},le):De(X,g,p),_e=h.style.terrain&&h.style.terrain.getTerrainData(ge);q.draw(x,E.TRIANGLES,W,O,Z,En.disabled,be,_e,s.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}},debug:function(h,t,s){for(let c=0;c<s.length;c++)ce(h,t,s[c])},custom:function(h,t,s){const c=h.context,p=s.implementation;if(h.renderPass==="offscreen"){const g=p.prerender;g&&(h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),g.call(p,c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),c.setStencilMode(hn.disabled);const g=p.renderingMode==="3d"?new Zt(h.context.gl.LEQUAL,Zt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Zt.ReadOnly);c.setDepthMode(g),p.render(c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState(),c.bindFramebuffer.set(null)}}};class Xt{constructor(t,s){this.context=new co(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=jr.maxUnderzooming+jr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new At,this.gpuTimers={}}resize(t,s,c){if(this.width=t*c,this.height=s*c,this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new l.PosArray;s.emplaceBack(0,0),s.emplaceBack(l.EXTENT,0),s.emplaceBack(0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,Wt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const c=new l.PosArray;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=t.createVertexBuffer(c,Wt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const p=new l.RasterBoundsArray;p.emplaceBack(0,0,0,0),p.emplaceBack(l.EXTENT,0,l.EXTENT,0),p.emplaceBack(0,l.EXTENT,0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(p,ut.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,Wt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.LineStripIndexArray;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const E=new l.TriangleIndexArray;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new $e(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const T=this.context.gl;this.stencilClearMode=new hn({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.create();l.ortho(c,0,this.width,this.height,0,0,1),l.scale(c,c,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Zt.disabled,this.stencilClearMode,mn.disabled,En.disabled,B(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const c=this.context,p=c.gl;this.nextStencilID+s.length>256&&this.clearStencil(),c.setColorMode(mn.disabled),c.setDepthMode(Zt.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const E=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,T=this.style.terrain&&this.style.terrain.getTerrainData(x);g.draw(c,p.TRIANGLES,Zt.disabled,new hn({func:p.ALWAYS,mask:0},E,255,p.KEEP,p.KEEP,p.REPLACE),mn.disabled,En.disabled,B(x.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new hn({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new hn({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((x,E)=>E.overscaledZ-x.overscaledZ),p=c[c.length-1].overscaledZ,g=c[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let E=0;E<g;E++)x[E+p]=new hn({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,c]}return[{[p]:hn.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new mn([t.CONSTANT_COLOR,t.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}depthModeForSublayer(t,s,c){if(!this.opaquePassEnabledForLayer())return Zt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Zt(c||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const c=this.style._order,p=this.style.sourceCaches,g=this.style.terrain&&new Ct(this);for(const I in p){const z=p[I];z.used&&z.prepare(this.context)}const x={},E={},T={};for(const I in p){const z=p[I];x[I]=z.getVisibleCoordinates(),E[I]=x[I].slice().reverse(),T[I]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<c.length;I++)if(this.style._layers[c[I]].is3D()){this.opaquePassCutoff=I;break}if(g){this.opaquePassCutoff=0;const I=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||I.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,R){const O=z.context,W=O.gl,Z=mn.unblended,q=new Zt(W.LEQUAL,Zt.ReadWrite,[0,1]),re=R.getTerrainMesh(),le=R.sourceCache.getRenderableTiles(),ge=z.useProgram("terrainDepth");O.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),O.clear({color:l.Color.transparent,depth:1});for(const X of le){const be=R.getTerrainData(X.tileID),_e=z.transform.calculatePosMatrix(X.tileID.toUnwrapped());ge.draw(O,W.TRIANGLES,q,hn.disabled,Z,En.backCCW,{u_matrix:_e},be,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,R){const O=z.context,W=O.gl,Z=mn.unblended,q=new Zt(W.LEQUAL,Zt.ReadWrite,[0,1]),re=R.getTerrainMesh(),le=R.getCoordsTexture(),ge=R.sourceCache.getRenderableTiles(),X=z.useProgram("terrainCoords");O.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),O.clear({color:l.Color.transparent,depth:1}),R.coordsIndex=[];for(const be of ge){const _e=R.getTerrainData(be.tileID);O.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,le.texture);const Me=z.transform.calculatePosMatrix(be.tileID.toUnwrapped());X.draw(O,W.TRIANGLES,q,hn.disabled,Z,En.backCCW,{u_matrix:Me,u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0},_e,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),R.coordsIndex.push(be.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const I of c){const z=this.style._layers[I];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const R=E[z.source];(z.type==="custom"||R.length)&&this.renderLayer(this,p[z.source],z,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!g)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[c[this.currentLayer]],z=p[I.source],R=x[I.source];this._renderTileClippingMasks(I,R),this.renderLayer(this,z,I,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const I=this.style._layers[c[this.currentLayer]],z=p[I.source];if(g&&g.renderLayer(I))continue;const R=(I.type==="symbol"?T:E)[I.source];this._renderTileClippingMasks(I,x[I.source]),this.renderLayer(this,z,I,R)}if(this.options.showTileBoundaries){let I,z;Object.values(this.style._layers).forEach(R=>{R.source&&!R.isHidden(this.transform.zoom)&&(R.source!==(z&&z.id)&&(z=this.style.sourceCaches[R.source]),(!I||I.getSource().maxzoom<z.getSource().maxzoom)&&(I=z))}),I&&gn.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const z=I.transform.padding;Pi(I,I.transform.height-(z.top||0),3,Jo),Pi(I,z.bottom||0,3,si),xs(I,z.left||0,3,pl),xs(I,I.transform.width-(z.right||0),3,ba);const R=I.transform.centerPoint;(function(O,W,Z,q){ws(O,W-1,Z-10,2,20,q),ws(O,W-10,Z-1,20,2,q)})(I,R.x,I.transform.height-R.y,fl)}(this),this.context.setDefault()}renderLayer(t,s,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,this.gpuTimingStart(c),gn[c.type](t,s,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),c.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,c.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const c in t){const p=t[c],g=this.context.extTimerQuery,x=g.getQueryObjectEXT(p.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(p.query),s[c]=x}return s}translatePosMatrix(t,s,c,p,g){if(!c[0]&&!c[1])return t;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const I=Math.sin(x),z=Math.cos(x);c=[c[0]*z-c[1]*I,c[0]*I+c[1]*z]}const E=[g?c[0]:Xn(s,c[0],this.transform.zoom),g?c[1]:Xn(s,c[1],this.transform.zoom),0],T=new Float32Array(16);return l.translate(T,t,E),T}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!s||!c}useProgram(t,s){this.cache=this.cache||{};const c=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new Ul(this.context,t,Xo[t],s,cn[t],this._showOverdrawInspector,this.style.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new $e(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class In{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const T=1/(E=l.transformMat4([],E,t))[3]/s*p;return l.mul$1(E,E,[T,T,1/E[3],T])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const T=l.sub([],g[E[0]],g[E[1]]),I=l.sub([],g[E[2]],g[E[1]]),z=l.normalize([],l.cross([],T,I)),R=-l.dot(z,g[E[1]]);return z.concat(R)});return new In(g,x)}}class Pn{constructor(t,s){this.min=t,this.max=s,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=l.clone$2(this.min),p=l.clone$2(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Pn(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let p=0;p<t.planes.length;p++){const g=t.planes[p];let x=0;for(let E=0;E<s.length;E++)l.dot$1(g,s[E])>=0&&x++;if(x===0)return 0;x!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let E=0;E<t.points.length;E++){const T=t.points[E][p]-this.min[p];g=Math.min(g,T),x=Math.max(x,T)}if(x<0||g>this.max[p]-this.min[p])return 0}return 1}}class wr{constructor(t=0,s=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=p}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=l.number(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=l.number(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=l.number(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=l.number(t.right,s.right,c)),this}getCenter(t,s){const c=l.clamp((this.left+t-this.right)/2,0,t),p=l.clamp((this.top+s-this.bottom)/2,0,s);return new l.pointGeometry(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new wr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Rn{constructor(t,s,c,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wr,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Rn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-l.wrap(t,-180,180)*Math.PI/180;var c;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(c=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c),function(p,g,x){var E=g[0],T=g[1],I=g[2],z=g[3],R=Math.sin(x),O=Math.cos(x);p[0]=E*O+I*R,p[1]=T*O+z*R,p[2]=E*-R+I*O,p[3]=T*-R+z*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=l.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new l.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new l.pointGeometry(0,0)),p=this.pointCoordinate(new l.pointGeometry(this.width,0)),g=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new l.pointGeometry(0,this.height)),E=Math.floor(Math.min(c.x,p.x,g.x,x.x)),T=Math.floor(Math.max(c.x,p.x,g.x,x.x)),I=1;for(let z=E-I;z<=T+I;z++)z!==0&&s.push(new l.UnwrappedTileID(z,t))}return s}coveringTiles(t){var s,c;let p=this.coveringZoomLevel(t);const g=p;if(t.minzoom!==void 0&&p<t.minzoom)return[];t.maxzoom!==void 0&&p>t.maxzoom&&(p=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),E=l.MercatorCoordinate.fromLngLat(this.center),T=Math.pow(2,p),I=[T*x.x,T*x.y,0],z=[T*E.x,T*E.y,0],R=In.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let O=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=p);const W=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,Z=X=>({aabb:new Pn([X*T,0,0],[(X+1)*T,T,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),q=[],re=[],le=p,ge=t.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let X=1;X<=3;X++)q.push(Z(-X)),q.push(Z(X));for(q.push(Z(0));q.length>0;){const X=q.pop(),be=X.x,_e=X.y;let Me=X.fullyVisible;if(!Me){const ct=X.aabb.intersects(R);if(ct===0)continue;Me=ct===2}const Pe=t.terrain?I:z,Be=X.aabb.distanceX(Pe),Ce=X.aabb.distanceY(Pe),st=Math.max(Math.abs(Be),Math.abs(Ce)),Ye=W+(1<<le-X.zoom)-2;if(X.zoom===le||st>Ye&&X.zoom>=O){const ct=le-X.zoom,Ot=I[0]-.5-(be<<ct),jt=I[1]-.5-(_e<<ct);re.push({tileID:new l.OverscaledTileID(X.zoom===le?ge:X.zoom,X.wrap,X.zoom,be,_e),distanceSq:l.sqrLen([z[0]-.5-be,z[1]-.5-_e]),tileDistanceToCamera:Math.sqrt(Ot*Ot+jt*jt)})}else for(let ct=0;ct<4;ct++){const Ot=(be<<1)+ct%2,jt=(_e<<1)+(ct>>1),St=X.zoom+1;let yn=X.aabb.quadrant(ct);if(t.terrain){const _n=new l.OverscaledTileID(St,X.wrap,St,Ot,jt),tn=t.terrain.getMinMaxElevation(_n),nn=(s=tn.minElevation)!==null&&s!==void 0?s:this.elevation,wn=(c=tn.maxElevation)!==null&&c!==void 0?c:this.elevation;yn=new Pn([yn.min[0],yn.min[1],nn],[yn.max[0],yn.max[1],wn])}q.push({aabb:yn,zoom:St,x:Ot,y:jt,wrap:X.wrap,fullyVisible:Me})}}return re.sort((X,be)=>X.distanceSq-be.distanceSq).map(X=>X.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=l.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(t.lng)*this.worldSize,l.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new l.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const c=l.MercatorCoordinate.fromLngLat(t),p=(1<<this.tileZoom)*l.EXTENT,g=c.x*p,x=c.y*p,E=Math.floor(g/l.EXTENT),T=Math.floor(x/l.EXTENT),I=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,E,T);return s.getElevation(I,g%l.EXTENT,x%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),c=this.getElevation(s,t);if(!(this.elevation-c))return;const p=this.getCameraPosition(),g=l.MercatorCoordinate.fromLngLat(p.lngLat,p.altitude),x=l.MercatorCoordinate.fromLngLat(s,c),E=g.x-x.x,T=g.y-x.y,I=g.z-x.z,z=Math.sqrt(E*E+T*T+I*I),R=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=c,this._center=s,this.zoom=R}setLocationAtPoint(t,s){const c=this.pointCoordinate(s),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new l.MercatorCoordinate(g.x-(c.x-p.x),g.y-(c.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return l.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const O=s.pointCoordinate(t);if(O!=null)return O}const c=[t.x,t.y,0,1],p=[t.x,t.y,1,1];l.transformMat4(c,c,this.pixelMatrixInverse),l.transformMat4(p,p,this.pixelMatrixInverse);const g=c[3],x=p[3],E=c[1]/g,T=p[1]/x,I=c[2]/g,z=p[2]/x,R=I===z?0:(0-I)/(z-I);return new l.MercatorCoordinate(l.number(c[0]/g,p[0]/x,R)/this.worldSize,l.number(E,T,R)/this.worldSize)}coordinatePoint(t,s=0,c=this.pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return l.transformMat4(p,p,c),new l.pointGeometry(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,t))).extend(this.pointLocation(new l.pointGeometry(this.width,t))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const c=t.key,p=s?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),E=g.x+Math.pow(2,g.z)*t.wrap,T=l.identity(new Float64Array(16));return l.translate(T,T,[E*x,g.y*x,0]),l.scale(T,T,[x/l.EXTENT,x/l.EXTENT,1]),l.multiply(T,s?this.alignedProjMatrix:this.projMatrix,T),p[c]=new Float32Array(T),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,c,p,g=-90,x=90,E=-180,T=180;const I=this.size,z=this._unmodified;if(this.latRange){const W=this.latRange;g=l.mercatorYfromLat(W[1])*this.worldSize,x=l.mercatorYfromLat(W[0])*this.worldSize,t=x-g<I.y?I.y/(x-g):0}if(this.lngRange){const W=this.lngRange;E=l.wrap(l.mercatorXfromLng(W[0])*this.worldSize,0,this.worldSize),T=l.wrap(l.mercatorXfromLng(W[1])*this.worldSize,0,this.worldSize),T<E&&(T+=this.worldSize),s=T-E<I.x?I.x/(T-E):0}const R=this.point,O=Math.max(s||0,t||0);if(O)return this.center=this.unproject(new l.pointGeometry(s?(T+E)/2:R.x,t?(x+g)/2:R.y)),this.zoom+=this.scaleZoom(O),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const W=R.y,Z=I.y/2;W-Z<g&&(p=g+Z),W+Z>x&&(p=x-Z)}if(this.lngRange){const W=(E+T)/2,Z=l.wrap(R.x,W-this.worldSize/2,W+this.worldSize/2),q=I.x/2;Z-q<E&&(c=E+q),Z+q>T&&(c=T-q)}c===void 0&&p===void 0||(this.center=this.unproject(new l.pointGeometry(c!==void 0?c:R.x,p!==void 0?p:R.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let p=l.identity(new Float64Array(16));l.scale(p,p,[this.width/2,-this.height/2,1]),l.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.identity(new Float64Array(16)),l.scale(p,p,[1,-1,1]),l.translate(p,p,[-1,-1,0]),l.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const g=Math.PI/2+this._pitch,x=this._fov*(.5+t.y/this.height),E=Math.sin(x)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-g-x,.01,Math.PI-.01)),T=this.getHorizon(),I=2*Math.atan(T/this.cameraToCenterDistance)*(.5+t.y/(2*T)),z=Math.sin(I)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-g-I,.01,Math.PI-.01)),R=Math.cos(Math.PI/2-this._pitch)*E+this.cameraToSeaLevelDistance,O=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,W=1.01*Math.min(R,O),Z=this.height/50;p=new Float64Array(16),l.perspective(p,this._fov,this.width/this.height,Z,W),p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,l.scale(p,p,[1,-1,1]),l.translate(p,p,[0,0,-this.cameraToCenterDistance]),l.rotateX(p,p,this._pitch),l.rotateZ(p,p,this.angle),l.translate(p,p,[-s,-c,0]),this.mercatorMatrix=l.scale([],p,[this.worldSize,this.worldSize,this.worldSize]),l.scale(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,p),l.translate(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.invert([],p),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,p);const q=this.width%2/2,re=this.height%2/2,le=Math.cos(this.angle),ge=Math.sin(this.angle),X=s-Math.round(s)+le*q+ge*re,be=c-Math.round(c)+le*re+ge*q,_e=new Float64Array(p);if(l.translate(_e,_e,[X>.5?X-1:X,be>.5?be-1:be,0]),this.alignedProjMatrix=_e,p=l.invert(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let c=s.x,p=s.y,g=s.x,x=s.y;for(const E of t)c=Math.min(c,E.x),p=Math.min(p,E.y),g=Math.max(g,E.x),x=Math.max(x,E.y);return[new l.pointGeometry(c,p),new l.pointGeometry(g,p),new l.pointGeometry(g,x),new l.pointGeometry(c,x),new l.pointGeometry(c,p)]}}}class Hn{constructor(t){this._hashName=t&&encodeURIComponent(t),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,c){let p=!1,g=null;const x=()=>{g=null,p&&(s(),g=setTimeout(x,300),p=!1)};return()=>(p=!0,g||x(),g)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(s.lng*g)/g,E=Math.round(s.lat*g)/g,T=this._map.getBearing(),I=this._map.getPitch();let z="";if(z+=t?`/${x}/${E}/${c}`:`${c}/${E}/${x}`,(T||I)&&(z+="/"+Math.round(10*T)/10),I&&(z+=`/${Math.round(I)}`),this._hashName){const R=this._hashName;let O=!1;const W=window.location.hash.slice(1).split("&").map(Z=>{const q=Z.split("=")[0];return q===R?(O=!0,`${q}=${z}`):Z}).filter(Z=>Z);return O||W.push(`${R}=${z}`),`#${W.join("&")}`}return`#${z}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Gr={linearity:.3,easing:l.bezier(0,0,.3,1)},Gi=l.extend({deceleration:2500,maxSpeed:1400},Gr),br=l.extend({deceleration:20,maxSpeed:1400},Gr),Zi=l.extend({deceleration:1e3,maxSpeed:360},Gr),Ai=l.extend({deceleration:1e3,maxSpeed:90},Gr);class js{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=l.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const g=fo(s.pan.mag(),c,l.extend({},Gi,t||{}));p.offset=s.pan.mult(g.amount/s.pan.mag()),p.center=this._map.transform.center,qi(p,g)}if(s.zoom){const g=fo(s.zoom,c,br);p.zoom=this._map.transform.zoom+g.amount,qi(p,g)}if(s.bearing){const g=fo(s.bearing,c,Zi);p.bearing=this._map.transform.bearing+l.clamp(g.amount,-179,179),qi(p,g)}if(s.pitch){const g=fo(s.pitch,c,Ai);p.pitch=this._map.transform.pitch+g.amount,qi(p,g)}if(p.zoom||p.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),l.extend(p,{noMoveStart:!0})}}function qi(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function fo(h,t,s){const{maxSpeed:c,linearity:p,deceleration:g}=s,x=l.clamp(h*p/(t/1e3),-c,c),E=Math.abs(x)/(g*p);return{easing:s.easing,duration:1e3*E,amount:x*(E/2)}}class Zr extends l.Event{constructor(t,s,c,p={}){const g=H.mousePos(s.getCanvasContainer(),c),x=s.unproject(g);super(t,l.extend({point:g,lngLat:x,originalEvent:c},p)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class $s extends l.Event{constructor(t,s,c){const p=t==="touchend"?c.changedTouches:c.touches,g=H.touchPos(s.getCanvasContainer(),p),x=g.map(T=>s.unproject(T)),E=g.reduce((T,I,z,R)=>T.add(I.div(R.length)),new l.pointGeometry(0,0));super(t,{points:g,point:E,lngLats:x,lngLat:s.unproject(E),originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ai extends l.Event{constructor(t,s,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class bn{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ai(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Zr(t.type,this._map,t))}mouseup(t){this._map.fire(new Zr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Zr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Zr(t.type,this._map,t))}mouseover(t){this._map.fire(new Zr(t.type,this._map,t))}mouseout(t){this._map.fire(new Zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $s(t.type,this._map,t))}touchmove(t){this._map.fire(new $s(t.type,this._map,t))}touchend(t){this._map.fire(new $s(t.type,this._map,t))}touchcancel(t){this._map.fire(new $s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qt{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gs{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(H.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=H.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(p.x,c.x),x=Math.max(p.x,c.x),E=Math.min(p.y,c.y),T=Math.max(p.y,c.y);H.setTransform(this._box,`translate(${g}px,${E}px)`),this._box.style.width=x-g+"px",this._box.style.height=T-E+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const c=this._startPos,p=s;if(this.reset(),H.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(c,p,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new l.Event(t,{originalEvent:s}))}}function Sr(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const s={};for(let c=0;c<h.length;c++)s[h[c].identifier]=t[c];return s}class Yo{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){const g=new l.pointGeometry(0,0);for(const x of p)g._add(x);return g.div(p.length)}(s),this.touches=Sr(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const p=Sr(c,s);for(const g in this.touches){const x=this.touches[g],E=p[g];(!E||E.dist(x)>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class qr{constructor(t){this.singleTap=new Yo(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const p=this.singleTap.touchend(t,s,c);if(p){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class mo{constructor(){this._zoomIn=new qr({numTouches:1,numTaps:2}),this._zoomOut=new qr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const p=this._zoomIn.touchend(t,s,c),g=this._zoomOut.touchend(t,s,c);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zo={0:1,2:2};class Lo{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const c=H.mouseButton(t);this._correctButton(t,c)&&(this._lastPoint=s,this._eventButton=c)}mousemoveWindow(t,s){const c=this._lastPoint;if(c){if(t.preventDefault(),function(p,g){const x=zo[g];return p.buttons===void 0||(p.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(c,s)}}mouseupWindow(t){this._lastPoint&&H.mouseButton(t)===this._eventButton&&(this._moved&&H.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Do extends Lo{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Wr extends Lo{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=.8*(s.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class rt extends Lo{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=-.5*(s.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class ml{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,c)}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const p=Sr(c,s),g=new l.pointGeometry(0,0),x=new l.pointGeometry(0,0);let E=0;for(const I in p){const z=p[I],R=this._touches[I];R&&(g._add(z),x._add(z.sub(R)),E++,p[I]=z)}if(this._touches=p,E<this._minTouches||!x.mag())return;const T=x.div(E);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(E),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,c){return{}}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,g]=this._firstTwoTouches,x=Xi(c,s,p),E=Xi(c,s,g);if(!x||!E)return;const T=this._aroundCenter?null:x.add(E).div(2);return this._move([x,E],T,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=Xi(c,s,p),E=Xi(c,s,g);x&&E||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xi(h,t,s){for(let c=0;c<h.length;c++)if(h[c].identifier===s)return t[c]}function bs(h,t){return Math.log(h/t)/Math.LN2}class Je extends Wi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(bs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bs(this._distance,c),pinchAround:s}}}function Zs(h,t){return 180*h.angleWith(t)/Math.PI}class Sa extends Wi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Zs(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=Zs(t,this._startVector);return Math.abs(c)<s}}function Ss(h){return Math.abs(h.y)>Math.abs(h.x)}class Nu extends Wi{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,c){super.touchstart(t,s,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Ss(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=s.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Ss(t)&&Ss(s)&&x}}const rh={panStep:100,bearingStep:15,pitchStep:10};class ih{constructor(){const t=rh;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,p=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:E=>{const T=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Jd,zoom:s?Math.round(T)+s*(t.shiftKey?2:1):T,bearing:E.getBearing()+c*this._bearingStep,pitch:E.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jd(h){return h*(2-h)}const oh=4.000244140625;class Uu{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=l.exported.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%oh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=H.mousePos(this._el,t);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>oh?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&T!==0&&(T=1/T);const I=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(I*T))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,p=this._easing;let g,x=!1;if(this._type==="wheel"&&c&&p){const E=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),T=p(E);g=l.number(c,s,T),E<1?this._frameId||(this._frameId=!0):x=!0}else g=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=l.ease;if(this._prevEase){const c=this._prevEase,p=(l.exported.now()-c.start)/c.duration,g=c.easing(p+.01)-c.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,E=Math.sqrt(.0729-x*x);s=l.bezier(x,E,.25,1)}return this._prevEase={start:l.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class Vu{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ju{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $u{constructor(){this._tap=new qr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=s[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,s,c))}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=s[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,s,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vi{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Es{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class sh{constructor(t,s,c,p){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ea=h=>h.zoom||h.drag||h.pitch||h.rotate;class Gu extends l.Event{}function gl(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ah{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new js(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),l.bindAll(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners)H.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,c]of this._listeners)H.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new bn(s,t));const p=s.boxZoom=new Gs(s,t);this._add("boxZoom",p);const g=new mo,x=new ju;s.doubleClickZoom=new Vu(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const E=new $u;this._add("tapDragZoom",E);const T=s.touchPitch=new Nu(s);this._add("touchPitch",T);const I=new Wr(t),z=new rt(t);s.dragRotate=new Es(t,I,z),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const R=new Do(t),O=new ml(t,s);s.dragPan=new vi(c,R,O),this._add("mousePan",R),this._add("touchPan",O,["touchZoom","touchRotate"]);const W=new Sa,Z=new Je;s.touchZoomRotate=new sh(c,Z,W,E),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]);const q=s.scrollZoom=new Uu(s,this);this._add("scrollZoom",q,["mousePan"]);const re=s.keyboard=new ih;this._add("keyboard",re),this._add("blockableMapEvent",new Qt(s));for(const le of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[le]&&s[le].enable(t[le])}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ea(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,c){for(const p in t)if(p!==c&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const c=t.type==="renderFrame"?void 0:t,p={needsRenderFrame:!1},g={},x={},E=t.touches,T=E?this._getMapTouches(E):void 0,I=T?H.touchPos(this._el,T):H.mousePos(this._el,t);for(const{handlerName:O,handler:W,allowed:Z}of this._handlers){if(!W.isEnabled())continue;let q;this._blockedByActive(x,Z,O)?W.reset():W[s||t.type]&&(q=W[s||t.type](t,I,T),this.mergeHandlerResult(p,g,q,O,c),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||W.isActive())&&(x[O]=W)}const z={};for(const O in this._previousActiveHandlers)x[O]||(z[O]=c);this._previousActiveHandlers=x,(Object.keys(z).length||gl(p))&&(this._changes.push([p,g,z]),this._triggerRenderFrame()),(Object.keys(x).length||gl(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=p;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(t,s,c,p,g){if(!c)return;l.extend(t,c);const x={handlerName:p,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(s.zoom=x),c.panDelta!==void 0&&(s.drag=x),c.pitchDelta!==void 0&&(s.pitch=x),c.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},c={};for(const[p,g,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new l.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),l.extend(s,g),l.extend(c,x);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const p=this._map,g=p.transform,x=p.style&&p.style.terrain;if(!(gl(t)||x&&this._drag))return this._fireEvents(s,c,!0);let{panDelta:E,zoomDelta:T,bearingDelta:I,pitchDelta:z,around:R,pinchAround:O}=t;O!==void 0&&(R=O),p._stop(!0),R=R||p.transform.centerPoint;const W=g.pointLocation(E?R.sub(E):R);I&&(g.bearing+=I),z&&(g.pitch+=z),T&&(g.zoom+=T),x?s.drag&&!this._drag?(this._drag={center:g.centerPoint,lngLat:g.pointLocation(R),point:R,handlerName:s.drag.handlerName},p.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&c[this._drag.handlerName]?(p.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(g.center=g.pointLocation(g.centerPoint.sub(E))):g.setLocationAtPoint(W,R),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const p=Ea(this._eventsInProgress),g=Ea(t),x={};for(const z in t){const{originalEvent:R}=t[z];this._eventsInProgress[z]||(x[`${z}start`]=R),this._eventsInProgress[z]=t[z]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const z in x)this._fireEvent(z,x[z]);g&&this._fireEvent("move",g.originalEvent);for(const z in t){const{originalEvent:R}=t[z];this._fireEvent(z,R)}const E={};let T;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:O}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],T=s[R]||O,E[`${z}end`]=T)}for(const z in E)this._fireEvent(z,E[z]);const I=Ea(this._eventsInProgress);if(c&&(p||g)&&!I){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;z?(R(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:T})):(this._map.fire(new l.Event("moveend",{originalEvent:T})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new l.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Gu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hi={extend:(h,...t)=>l.extend(h,...t),run(h){h()},logToElement(h,t=!1,s="log"){const c=window.document.getElementById(s);c&&(t&&(c.innerHTML=""),c.innerHTML+=`<br>${h}`)}};class Fn extends l.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=l.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,l.extend({offset:t},s),c)}panTo(t,s,c){return this.easeTo(l.extend({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(l.extend({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(l.extend({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,l.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=l.LngLatBounds.convert(t);const c=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,s)}_cameraForBoxAndBearing(t,s,c,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=l.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const _e=p.padding;p.padding={top:_e,bottom:_e,right:_e,left:_e}}p.padding=l.extend(g,p.padding);const x=this.transform,E=x.padding,T=x.project(l.LngLat.convert(t)),I=x.project(l.LngLat.convert(s)),z=T.rotate(-c*Math.PI/180),R=I.rotate(-c*Math.PI/180),O=new l.pointGeometry(Math.max(z.x,R.x),Math.max(z.y,R.y)),W=new l.pointGeometry(Math.min(z.x,R.x),Math.min(z.y,R.y)),Z=O.sub(W),q=(x.width-(E.left+E.right+p.padding.left+p.padding.right))/Z.x,re=(x.height-(E.top+E.bottom+p.padding.top+p.padding.bottom))/Z.y;if(re<0||q<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const le=Math.min(x.scaleZoom(x.scale*Math.min(q,re)),p.maxZoom),ge=l.pointGeometry.convert(p.offset),X=new l.pointGeometry((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c*Math.PI/180),be=ge.add(X).mult(x.scale/x.zoomScale(le));return{center:x.unproject(T.add(I).div(2).sub(be)),zoom:le,bearing:c}}fitBounds(t,s,c){return this._fitInternal(this.cameraForBounds(t,s),s,c)}fitScreenCoordinates(t,s,c,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(t)),this.transform.pointLocation(l.pointGeometry.convert(s)),c,p),p,g)}_fitInternal(t,s,c){return t?(delete(s=l.extend(t,s)).padding,s.linear?this.easeTo(s,c):this.flyTo(s,c)):this}jumpTo(t,s){this.stop();const c=this.transform;let p=!1,g=!1,x=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(p=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=l.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(g=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),p&&this.fire(new l.Event("zoomstart",s)).fire(new l.Event("zoom",s)).fire(new l.Event("zoomend",s)),g&&this.fire(new l.Event("rotatestart",s)).fire(new l.Event("rotate",s)).fire(new l.Event("rotateend",s)),x&&this.fire(new l.Event("pitchstart",s)).fire(new l.Event("pitch",s)).fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,c,p=0){const g=l.MercatorCoordinate.fromLngLat(t,s),x=l.MercatorCoordinate.fromLngLat(c,p),E=x.x-g.x,T=x.y-g.y,I=x.z-g.z,z=Math.hypot(E,T,I);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(E,T),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),W=180*Math.atan2(E,-T)/Math.PI;let Z=180*Math.acos(R/z)/Math.PI;return Z=I<0?90-Z:90+Z,{center:x.toLngLat(),zoom:O,pitch:Z,bearing:W}}easeTo(t,s){this._stop(!1,t.easeId),((t=l.extend({offset:[0,0],duration:500,easing:l.ease},t)).animate===!1||!t.essential&&l.exported.prefersReducedMotion)&&(t.duration=0);const c=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),E=this.getPadding(),T="zoom"in t?+t.zoom:p,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:x,R="padding"in t?t.padding:c.padding,O=l.pointGeometry.convert(t.offset);let W=c.centerPoint.add(O);const Z=c.pointLocation(W),q=l.LngLat.convert(t.center||Z);this._normalizeCenter(q);const re=c.project(Z),le=c.project(q).sub(re),ge=c.zoomScale(T-p);let X,be;t.around&&(X=l.LngLat.convert(t.around),be=c.locationPoint(X));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||T!==p,this._rotating=this._rotating||g!==I,this._pitching=this._pitching||z!==x,this._padding=!c.isPaddingEqual(R),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,_e),this._ease(Me=>{if(this._zooming&&(c.zoom=l.number(p,T,Me)),this._rotating&&(c.bearing=l.number(g,I,Me)),this._pitching&&(c.pitch=l.number(x,z,Me)),this._padding&&(c.interpolatePadding(E,R,Me),W=c.centerPoint.add(O)),X)c.setLocationAtPoint(X,be);else{const Pe=c.zoomScale(c.zoom-p),Be=T>p?Math.min(2,ge):Math.max(.5,ge),Ce=Math.pow(Be,1-Me),st=c.unproject(re.add(le.mult(Me*Ce)).mult(Pe));c.setLocationAtPoint(c.renderWorldCopies?st.wrap():st,W)}this._fireMoveEvents(s)},Me=>{this._afterEase(s,Me)},t),this}_prepareEase(t,s,c={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),s||c.moving||this.fire(new l.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new l.Event("move",t)),this._zooming&&this.fire(new l.Event("zoom",t)),this._rotating&&this.fire(new l.Event("rotate",t)),this._pitching&&this.fire(new l.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const c=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new l.Event("zoomend",t)),p&&this.fire(new l.Event("rotateend",t)),g&&this.fire(new l.Event("pitchend",t)),this.fire(new l.Event("moveend",t))}flyTo(t,s){if(!t.essential&&l.exported.prefersReducedMotion){const St=l.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(St,s)}this.stop(),t=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},t);const c=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),E=this.getPadding(),T="zoom"in t?l.clamp(+t.zoom,c.minZoom,c.maxZoom):p,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:x,R="padding"in t?t.padding:c.padding,O=c.zoomScale(T-p),W=l.pointGeometry.convert(t.offset);let Z=c.centerPoint.add(W);const q=c.pointLocation(Z),re=l.LngLat.convert(t.center||q);this._normalizeCenter(re);const le=c.project(q),ge=c.project(re).sub(le);let X=t.curve;const be=Math.max(c.width,c.height),_e=be/O,Me=ge.mag();if("minZoom"in t){const St=l.clamp(Math.min(t.minZoom,p,T),c.minZoom,c.maxZoom),yn=be/c.zoomScale(St-p);X=Math.sqrt(yn/Me*2)}const Pe=X*X;function Be(St){const yn=(_e*_e-be*be+(St?-1:1)*Pe*Pe*Me*Me)/(2*(St?_e:be)*Pe*Me);return Math.log(Math.sqrt(yn*yn+1)-yn)}function Ce(St){return(Math.exp(St)-Math.exp(-St))/2}function st(St){return(Math.exp(St)+Math.exp(-St))/2}const Ye=Be(0);let ct=function(St){return st(Ye)/st(Ye+X*St)},Ot=function(St){return be*((st(Ye)*(Ce(yn=Ye+X*St)/st(yn))-Ce(Ye))/Pe)/Me;var yn},jt=(Be(1)-Ye)/X;if(Math.abs(Me)<1e-6||!isFinite(jt)){if(Math.abs(be-_e)<1e-6)return this.easeTo(t,s);const St=_e<be?-1:1;jt=Math.abs(Math.log(_e/be))/X,Ot=function(){return 0},ct=function(yn){return Math.exp(St*X*yn)}}return t.duration="duration"in t?+t.duration:1e3*jt/("screenSpeed"in t?+t.screenSpeed/X:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==I,this._pitching=z!==x,this._padding=!c.isPaddingEqual(R),this._prepareEase(s,!1),this._ease(St=>{const yn=St*jt,_n=1/ct(yn);c.zoom=St===1?T:p+c.scaleZoom(_n),this._rotating&&(c.bearing=l.number(g,I,St)),this._pitching&&(c.pitch=l.number(x,z,St)),this._padding&&(c.interpolatePadding(E,R,St),Z=c.centerPoint.add(W));const tn=St===1?re:c.unproject(le.add(ge.mult(Ot(yn))).mult(_n));c.setLocationAtPoint(c.renderWorldCopies?tn.wrap():tn,Z),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=l.exported.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=l.wrap(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}}class yl{constructor(t={}){this.options=t,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const c=this._map._getUIString(`AttributionControl.${s}`);t.title=c,t.setAttribute("aria-label",c)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const g=s[p];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Wl{constructor(t={}){this.options=t,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=H.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class lh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const uh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},ch={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Yd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ro{constructor(t,s,c=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Wr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new rt({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),H.addEventListener(s,"mousedown",this.mousedown),H.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(s,"touchmove",this.touchmove),H.addEventListener(s,"touchend",this.touchend),H.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),H.disableDrag()}move(t,s){const c=this.map,p=this.mouseRotate.mousemoveWindow(t,s);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(t,s);g&&g.pitchDelta&&c.setPitch(c.getPitch()+g.pitchDelta)}}off(){const t=this.element;H.removeEventListener(t,"mousedown",this.mousedown),H.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(t,"touchmove",this.touchmove),H.removeEventListener(t,"touchend",this.touchend),H.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(l.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),H.mousePos(this.element,t)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,H.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function _l(h,t,s){if(h=new l.LngLat(h.lng,h.lat),t){const c=new l.LngLat(h.lng-360,h.lat),p=new l.LngLat(h.lng+360,h.lat),g=s.locationPoint(h).distSqr(t);s.locationPoint(c).distSqr(t)<g?h=c:s.locationPoint(p).distSqr(t)<g&&(h=p)}for(;Math.abs(h.lng-s.center.lng)>180;){const c=s.locationPoint(h);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const _t={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mt(h,t,s){const c=h.classList;for(const p in _t)c.remove(`maplibregl-${s}-anchor-${p}`,`mapboxgl-${s}-anchor-${p}`);c.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class Ta extends l.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=l.extend({element:t},s)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=l.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div"),this._element.setAttribute("aria-label","Map marker");const c=H.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${g}px`),c.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const x=H.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const E=H.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const T=H.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of I){const X=H.createNS("http://www.w3.org/2000/svg","ellipse");X.setAttributeNS(null,"opacity","0.04"),X.setAttributeNS(null,"cx","10.5"),X.setAttributeNS(null,"cy","5.80029008"),X.setAttributeNS(null,"rx",ge.rx),X.setAttributeNS(null,"ry",ge.ry),T.appendChild(X)}const z=H.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const R=H.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(R);const O=H.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const W=H.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(W);const Z=H.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const q=H.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=H.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const le=H.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),q.appendChild(re),q.appendChild(le),E.appendChild(T),E.appendChild(z),E.appendChild(O),E.appendChild(Z),E.appendChild(q),c.appendChild(E),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(c),this._offset=l.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),Mt(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,c=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=_l(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let c="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?c="rotateX(0deg)":this._pitchAlignment==="map"&&(c=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${_t[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${c} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const p=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=p.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=l.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Zu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ts,Fr=0,Cs=!1;const Fo={maxWidth:100,unit:"metric"};function hh(h,t,s){const c=s&&s.maxWidth||100,p=h._container.clientHeight/2,g=h.unproject([0,p]),x=h.unproject([c,p]),E=g.distanceTo(x);if(s&&s.unit==="imperial"){const T=3.2808*E;T>5280?ks(t,c,T/5280,h._getUIString("ScaleControl.Miles")):ks(t,c,T,h._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?ks(t,c,E/1852,h._getUIString("ScaleControl.NauticalMiles")):E>=1e3?ks(t,c,E/1e3,h._getUIString("ScaleControl.Kilometers")):ks(t,c,E,h._getUIString("ScaleControl.Meters"))}function ks(h,t,s,c){const p=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let E=g/x;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(T){const I=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*I)/I}(E),x*E}(s);h.style.width=t*(p/s)+"px",h.innerHTML=`${p}&nbsp;${c}`}const Kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qu(h){if(h){if(typeof h=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(h,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,h),"top-left":new l.pointGeometry(t,t),"top-right":new l.pointGeometry(-t,t),bottom:new l.pointGeometry(0,-h),"bottom-left":new l.pointGeometry(t,-t),"bottom-right":new l.pointGeometry(-t,-t),left:new l.pointGeometry(h,0),right:new l.pointGeometry(-h,0)}}if(h instanceof l.pointGeometry||Array.isArray(h)){const t=l.pointGeometry.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.pointGeometry.convert(h.center||[0,0]),top:l.pointGeometry.convert(h.top||[0,0]),"top-left":l.pointGeometry.convert(h["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(h["top-right"]||[0,0]),bottom:l.pointGeometry.convert(h.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(h["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(h["bottom-right"]||[0,0]),left:l.pointGeometry.convert(h.left||[0,0]),right:l.pointGeometry.convert(h.right||[0,0])}}return qu(new l.pointGeometry(0,0))}const qs={supported:G,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Fn{constructor(h){var t;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(h=l.extend({},ch,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Rn(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new lh,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},uh,h.locale),this._clickTolerance=h.clickTolerance,this._pixelRatio=(t=h.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new tt(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ah(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new Hn(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,l.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new yl({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new Wl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new l.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,s,c){return c==null&&this.style.terrain&&(c=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(h,t,s,c)}resize(h){const t=this._containerDimensions(),s=t[0],c=t[1];this._resizeCanvas(s,c,this.getPixelRatio()),this.transform.resize(s,c),this.painter.resize(s,c,this.getPixelRatio());const p=!this._moving;return p&&(this.stop(),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h))),this.fire(new l.Event("resize",h)),p&&this.fire(new l.Event("moveend",h)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(h){const[t,s]=this._containerDimensions();this._pixelRatio=h,this._resizeCanvas(t,s,h),this.painter.resize(t,s,h)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(l.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(l.LngLat.convert(h),this.style&&this.style.terrain)}unproject(h){return this.transform.pointLocation(l.pointGeometry.convert(h),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(h,t,s){if(h==="mouseenter"||h==="mouseover"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?c||(c=!0,s.call(this,new Zr(h,this,g.originalEvent,{features:x}))):c=!1},mouseout:()=>{c=!1}}}}if(h==="mouseleave"||h==="mouseout"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,s.call(this,new Zr(h,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,s.call(this,new Zr(h,this,x.originalEvent)))}}}}{const c=p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length&&(p.features=g,s.call(this,p),delete p.features)};return{layer:t,listener:s,delegates:{[h]:c}}}}on(h,t,s){if(s===void 0)return super.on(h,t);const c=this._createDelegatedListener(h,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(c);for(const p in c.delegates)this.on(p,c.delegates[p]);return this}once(h,t,s){if(s===void 0)return super.once(h,t);const c=this._createDelegatedListener(h,t,s);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,t,s){return s===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(c=>{const p=this._delegatedListeners[h];for(let g=0;g<p.length;g++){const x=p[g];if(x.layer===t&&x.listener===s){for(const E in x.delegates)this.off(E,x.delegates[E]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let s;if(t!==void 0||h===void 0||h instanceof l.pointGeometry||Array.isArray(h)||(t=h,h=void 0),t=t||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof h[0]=="number")s=[l.pointGeometry.convert(h)];else{const c=l.pointGeometry.convert(h[0]),p=l.pointGeometry.convert(h[1]);s=[c,new l.pointGeometry(p.x,c.y),p,new l.pointGeometry(c.x,p.y),c]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Dn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const s=this._requestManager.transformRequest(h,l.ResourceType.Style);l.getJSON(s,(c,p)=>{c?this.fire(new l.ErrorEvent(c)):p&&this._updateDiff(p,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(s){l.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){return this.style.setTerrain(h),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const s=h[t]._tiles;for(const c in s){const p=s[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(h,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,s)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:s=1,sdf:c=!1,stretchX:p,stretchY:g,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||l.isImageBitmap(t)){const{width:E,height:T,data:I}=l.exported.getImageData(t);this.style.addImage(h,{data:new l.RGBAImage({width:E,height:T},I),pixelRatio:s,stretchX:p,stretchY:g,content:x,sdf:c,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:T,data:I}=t,z=t;this.style.addImage(h,{data:new l.RGBAImage({width:E,height:T},new Uint8Array(I)),pixelRatio:s,stretchX:p,stretchY:g,content:x,sdf:c,version:0,userImage:z}),z.onAdd&&z.onAdd(this,h)}}}updateImage(h,t){const s=this.style.getImage(h);if(!s)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.isImageBitmap(t)?l.exported.getImageData(t):t,{width:p,height:g,data:x}=c;if(p===void 0||g===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||g!==s.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||l.isImageBitmap(t));s.data.replace(x,E),this.style.updateImage(h,s)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){l.getImage(this._requestManager.transformRequest(h,l.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,s){return this.style.setLayerZoomRange(h,t,s),this._update(!0)}setFilter(h,t,s={}){return this.style.setFilter(h,t,s),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,s,c={}){return this.style.setPaintProperty(h,t,s,c),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,s,c={}){return this.style.setLayoutProperty(h,t,s,c),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=H.create("div","maplibregl-canvas-container mapboxgl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const c=this._controlContainer=H.create("div","maplibregl-control-container mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=H.create("div",`maplibregl-ctrl-${g} mapboxgl-ctrl-${g}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const h=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=H.create("div","maplibregl-cooperative-gesture-screen",h);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",c=>{c.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",c=>{c.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",c=>{this._onCooperativeGesture(c,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(h,t,s){this._canvas.width=s*h,this._canvas.height=s*t,this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h=l.extend({},G.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(this.painter=new Xt(t,this.transform),l.exported$1.testSupport(t)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(h,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let t,s=0;const c=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,t),s=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,E=l.exported.now();this.style.zoomHistory.update(x,E);const T=new l.EvaluationParameters(x,{now:E,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=T.crossFadingFactor();I===1&&I===this._crossFadingFactor||(p=!0,this._crossFadingFactor=I),this.style.update(T)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const x=l.exported.now()-s;c.endQueryEXT(c.TIME_ELAPSED_EXT,t),setTimeout(()=>{const E=c.getQueryObjectEXT(t,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(t),this.fire(new l.Event("gpu-timing-frame",{cpuTime:x,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(x);this.fire(new l.Event("gpu-timing-layer",{layerTimes:E}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._cooperativeGestures&&H.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(h=>{l.PerformanceUtils.frame(h),this._frame=null,this._render(h)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){l.setCacheLimits(h,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(h){this.options=l.extend({},Yd,h),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),H.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),H.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=H.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map.getZoom(),t=h===this._map.getMaxZoom(),s=h===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ro(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const s=H.create("button",h,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(h,t){const s=this._map._getUIString(`NavigationControl.${t}`);h.title=s,h.setAttribute("aria-label",s)}},GeolocateControl:class extends l.Evented{constructor(h){super(),this.options=l.extend({},Zu,h),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(h){var t;return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Ts!==void 0?t(Ts):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{Ts=s.state!=="denied",t(Ts)}):(Ts=!!window.navigator.geolocation,t(Ts)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fr=0,Cs=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),s=h.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new l.LngLat(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,c=this._map.getBearing(),p=l.extend({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),p,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new l.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.clientHeight/2,t=this._map.unproject([0,h]),s=this._map.unproject([1,h]),c=t.distanceTo(s),p=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Cs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ta(this._dotElement),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ta({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fr--,Cs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Fr++,Fr>1?(h={maximumAge:6e5,timeout:0},Cs=!0):(h=this.options.positionOptions,Cs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yl,LogoControl:Wl,ScaleControl:class{constructor(h){this.options=l.extend({},Fo,h),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){hh(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,hh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(h){this.options=h,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(h){super(),this.options=l.extend(Object.create(Kn),h),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=l.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=h;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_update(h){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=H.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(g=>this._container.classList.add(g)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_l(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h))return;const t=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat);let s=this.options.anchor;const c=qu(this.options.offset);if(!s){const g=this._container.offsetWidth,x=this._container.offsetHeight;let E;E=t.y+c.bottom.y<x?["top"]:t.y>this._map.transform.height-x?["bottom"]:[],t.x<g/2?E.push("left"):t.x>this._map.transform.width-g/2&&E.push("right"),s=E.length===0?"bottom":E.join("-")}const p=t.add(c[s]).round();H.setTransform(this._container,`${_t[s]} translate(${p.x}px,${p.y}px)`),Mt(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(sr);h&&h.focus()}_onClose(){this.remove()}},Marker:Ta,Style:Dn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:un,GeoJSONSource:ei,ImageSource:Pt,RasterDEMTileSource:It,RasterTileSource:zn,VectorTileSource:cr,VideoSource:He,prewarm:function(){ni().acquire(Pr)},clearPrewarmedResources:function(){const h=vr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Pr),vr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Ar.workerCount},set workerCount(h){Ar.workerCount=h},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){l.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){l.clearTileCache(h)},workerUrl:"",addProtocol(h,t){l.config.REGISTERED_PROTOCOLS[h]=t},removeProtocol(h){delete l.config.REGISTERED_PROTOCOLS[h]}};return Hi.extend(qs,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),qs});var P=_;return P})})(U2);const V2=sm;var am={},j2={get exports(){return am},set exports(n){am=n}};(function(n,o){(function(u,m){n.exports=m()})(su,function(){var u=function(v,C){var B={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ne={on:function(ae,me,Oe){if(B[ae]===void 0)throw new Error("Invalid event type: "+ae);B[ae].push({selector:me,fn:Oe})},render:function(ae){C.store.featureChanged(ae)}},ye=function(ae,me){for(var Oe=B[ae],Fe=Oe.length;Fe--;){var Ue=Oe[Fe];if(Ue.selector(me)){Ue.fn.call(ne,me)||C.store.render(),C.ui.updateMapClasses();break}}};return v.start.call(ne),{render:v.render,stop:function(){v.stop&&v.stop()},trash:function(){v.trash&&(v.trash(),C.store.render())},combineFeatures:function(){v.combineFeatures&&v.combineFeatures()},uncombineFeatures:function(){v.uncombineFeatures&&v.uncombineFeatures()},drag:function(ae){ye("drag",ae)},click:function(ae){ye("click",ae)},mousemove:function(ae){ye("mousemove",ae)},mousedown:function(ae){ye("mousedown",ae)},mouseup:function(ae){ye("mouseup",ae)},mouseout:function(ae){ye("mouseout",ae)},keydown:function(ae){ye("keydown",ae)},keyup:function(ae){ye("keyup",ae)},touchstart:function(ae){ye("touchstart",ae)},touchmove:function(ae){ye("touchmove",ae)},touchend:function(ae){ye("touchend",ae)},tap:function(ae){ye("tap",ae)}}},m=6378137;function _(v){var C=0;if(v&&v.length>0){C+=Math.abs(b(v[0]));for(var B=1;B<v.length;B++)C-=Math.abs(b(v[B]))}return C}function b(v){var C,B,ne,ye,ae,me,Oe=0,Fe=v.length;if(Fe>2){for(me=0;me<Fe;me++)me===Fe-2?(ne=Fe-2,ye=Fe-1,ae=0):me===Fe-1?(ne=Fe-1,ye=0,ae=1):(ne=me,ye=me+1,ae=me+2),C=v[ne],B=v[ye],Oe+=(P(v[ae][0])-P(C[0]))*Math.sin(P(B[1]));Oe=Oe*m*m/2}return Oe}function P(v){return v*Math.PI/180}var l={geometry:function v(C){var B,ne=0;switch(C.type){case"Polygon":return _(C.coordinates);case"MultiPolygon":for(B=0;B<C.coordinates.length;B++)ne+=_(C.coordinates[B]);return ne;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(B=0;B<C.geometries.length;B++)ne+=v(C.geometries[B]);return ne}},ring:b},G="mapboxgl-ctrl",J="mapbox-gl-draw_ctrl-draw-btn",we="mapbox-gl-draw_line",fe="mapbox-gl-draw_polygon",H="mapbox-gl-draw_point",tt="mapbox-gl-draw_trash",Xe="mapbox-gl-draw_combine",$e="mapbox-gl-draw_uncombine",fn="mapboxgl-ctrl-group",pe="active",ie="mapbox-gl-draw_boxselect",he="mapbox-gl-draw-hot",Ne="mapbox-gl-draw-cold",Ge="add",lt="move",yt="drag",ft="pointer",xn="none",kt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},rn="Feature",Nn="Polygon",cr="LineString",zn="Point",hr="FeatureCollection",It="Multi",ei="MultiPoint",ut="MultiLineString",Pt="MultiPolygon",He={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},un="draw.create",Tn="draw.delete",fi="draw.update",Ur="draw.selectionchange",Vr="draw.modechange",_r="draw.actionable",ti="draw.render",ko="draw.combine",jr="draw.uncombine",hs="move",Fs="change_coordinates",Pr="feature",Ar="midpoint",io="vertex",vr="true",ni="false",ds=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ps={Point:0,LineString:1,Polygon:2};function Jt(v,C){var B=ps[v.geometry.type]-ps[C.geometry.type];return B===0&&v.geometry.type===Nn?v.area-C.area:B}function Wn(v){if(this._items={},this._nums={},this._length=v?v.length:0,v)for(var C=0,B=v.length;C<B;C++)this.add(v[C]),v[C]!==void 0&&(typeof v[C]=="string"?this._items[v[C]]=C:this._nums[v[C]]=C)}Wn.prototype.add=function(v){return this.has(v)||(this._length++,typeof v=="string"?this._items[v]=this._length:this._nums[v]=this._length),this},Wn.prototype.delete=function(v){return this.has(v)===!1||(this._length--,delete this._items[v],delete this._nums[v]),this},Wn.prototype.has=function(v){return(typeof v=="string"||typeof v=="number")&&(this._items[v]!==void 0||this._nums[v]!==void 0)},Wn.prototype.values=function(){var v=this,C=[];return Object.keys(this._items).forEach(function(B){C.push({k:B,v:v._items[B]})}),Object.keys(this._nums).forEach(function(B){C.push({k:JSON.parse(B),v:v._nums[B]})}),C.sort(function(B,ne){return B.v-ne.v}).map(function(B){return B.k})},Wn.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Io=[Pr,Ar,io],mi={click:function(v,C,B){return fs(v,C,B,B.options.clickBuffer)},touch:function(v,C,B){return fs(v,C,B,B.options.touchBuffer)}};function fs(v,C,B,ne){if(B.map===null)return[];var ye=v?function(Ue,ve){return ve===void 0&&(ve=0),[[Ue.point.x-ve,Ue.point.y-ve],[Ue.point.x+ve,Ue.point.y+ve]]}(v,ne):C,ae={};B.options.styles&&(ae.layers=B.options.styles.map(function(Ue){return Ue.id}));var me=B.map.queryRenderedFeatures(ye,ae).filter(function(Ue){return Io.indexOf(Ue.properties.meta)!==-1}),Oe=new Wn,Fe=[];return me.forEach(function(Ue){var ve=Ue.properties.id;Oe.has(ve)||(Oe.add(ve),Fe.push(Ue))}),function(Ue){return Ue.map(function(ve){return ve.geometry.type===Nn&&(ve.area=l.geometry({type:rn,property:{},geometry:ve.geometry})),ve}).sort(Jt).map(function(ve){return delete ve.area,ve})}(Fe)}function Ii(v,C){var B=mi.click(v,null,C),ne={mouse:xn};return B[0]&&(ne.mouse=B[0].properties.active===vr?lt:ft,ne.feature=B[0].properties.meta),C.events.currentModeName().indexOf("draw")!==-1&&(ne.mouse=Ge),C.ui.queueMapClasses(ne),C.ui.updateMapClasses(),B[0]}function Vi(v,C){var B=v.x-C.x,ne=v.y-C.y;return Math.sqrt(B*B+ne*ne)}function Wo(v,C,B){B===void 0&&(B={});var ne=B.fineTolerance!=null?B.fineTolerance:4,ye=B.grossTolerance!=null?B.grossTolerance:12,ae=B.interval!=null?B.interval:500;v.point=v.point||C.point,v.time=v.time||C.time;var me=Vi(v.point,C.point);return me<ne||me<ye&&C.time-v.time<ae}function ji(v,C,B){B===void 0&&(B={});var ne=B.tolerance!=null?B.tolerance:25,ye=B.interval!=null?B.interval:250;return v.point=v.point||C.point,v.time=v.time||C.time,Vi(v.point,C.point)<ne&&C.time-v.time<ye}function Ie(v,C){return v(C={exports:{}},C.exports),C.exports}var We=Ie(function(v){var C=v.exports=function(B,ne){if(ne||(ne=16),B===void 0&&(B=128),B<=0)return"0";for(var ye=Math.log(Math.pow(2,B))/Math.log(ne),ae=2;ye===1/0;ae*=2)ye=Math.log(Math.pow(2,B/ae))/Math.log(ne)*ae;var me=ye-Math.floor(ye),Oe="";for(ae=0;ae<Math.floor(ye);ae++)Oe=Math.floor(Math.random()*ne).toString(ne)+Oe;if(me){var Fe=Math.pow(ne,me);Oe=Math.floor(Math.random()*Fe).toString(ne)+Oe}var Ue=parseInt(Oe,ne);return Ue!==1/0&&Ue>=Math.pow(2,B)?C(B,ne):Oe};C.rack=function(B,ne,ye){var ae=function(Oe){var Fe=0;do{if(Fe++>10){if(!ye)throw new Error("too many ID collisions, use more bits");B+=ye}var Ue=C(B,ne)}while(Object.hasOwnProperty.call(me,Ue));return me[Ue]=Oe,Ue},me=ae.hats={};return ae.get=function(Oe){return ae.hats[Oe]},ae.set=function(Oe,Fe){return ae.hats[Oe]=Fe,ae},ae.bits=B||128,ae.base=ne||16,ae}}),$n=function(v,C){this.ctx=v,this.properties=C.properties||{},this.coordinates=C.geometry.coordinates,this.id=C.id||We(),this.type=C.geometry.type};$n.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},$n.prototype.incomingCoords=function(v){this.setCoordinates(v)},$n.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},$n.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},$n.prototype.setProperty=function(v,C){this.properties[v]=C},$n.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:rn,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},$n.prototype.internal=function(v){var C={id:this.id,meta:Pr,"meta:type":this.type,active:ni,mode:v};if(this.ctx.options.userProperties)for(var B in this.properties)C["user_"+B]=this.properties[B];return{type:rn,properties:C,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var dr=function(v,C){$n.call(this,v,C)};(dr.prototype=Object.create($n.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},dr.prototype.updateCoordinate=function(v,C,B){this.coordinates=arguments.length===3?[C,B]:[v,C],this.changed()},dr.prototype.getCoordinate=function(){return this.getCoordinates()};var Nt=function(v,C){$n.call(this,v,C)};(Nt.prototype=Object.create($n.prototype)).isValid=function(){return this.coordinates.length>1},Nt.prototype.addCoordinate=function(v,C,B){this.changed();var ne=parseInt(v,10);this.coordinates.splice(ne,0,[C,B])},Nt.prototype.getCoordinate=function(v){var C=parseInt(v,10);return JSON.parse(JSON.stringify(this.coordinates[C]))},Nt.prototype.removeCoordinate=function(v){this.changed(),this.coordinates.splice(parseInt(v,10),1)},Nt.prototype.updateCoordinate=function(v,C,B){var ne=parseInt(v,10);this.coordinates[ne]=[C,B],this.changed()};var Ln=function(v,C){$n.call(this,v,C),this.coordinates=this.coordinates.map(function(B){return B.slice(0,-1)})};(Ln.prototype=Object.create($n.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(v){return v.length>2})},Ln.prototype.incomingCoords=function(v){this.coordinates=v.map(function(C){return C.slice(0,-1)}),this.changed()},Ln.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},Ln.prototype.addCoordinate=function(v,C,B){this.changed();var ne=v.split(".").map(function(ye){return parseInt(ye,10)});this.coordinates[ne[0]].splice(ne[1],0,[C,B])},Ln.prototype.removeCoordinate=function(v){this.changed();var C=v.split(".").map(function(ne){return parseInt(ne,10)}),B=this.coordinates[C[0]];B&&(B.splice(C[1],1),B.length<3&&this.coordinates.splice(C[0],1))},Ln.prototype.getCoordinate=function(v){var C=v.split(".").map(function(ne){return parseInt(ne,10)}),B=this.coordinates[C[0]];return JSON.parse(JSON.stringify(B[C[1]]))},Ln.prototype.getCoordinates=function(){return this.coordinates.map(function(v){return v.concat([v[0]])})},Ln.prototype.updateCoordinate=function(v,C,B){this.changed();var ne=v.split("."),ye=parseInt(ne[0],10),ae=parseInt(ne[1],10);this.coordinates[ye]===void 0&&(this.coordinates[ye]=[]),this.coordinates[ye][ae]=[C,B]};var ri={MultiPoint:dr,MultiLineString:Nt,MultiPolygon:Ln},xr=function(v,C,B,ne,ye){var ae=B.split("."),me=parseInt(ae[0],10),Oe=ae[1]?ae.slice(1).join("."):null;return v[me][C](Oe,ne,ye)},Gn=function(v,C){if($n.call(this,v,C),delete this.coordinates,this.model=ri[C.geometry.type],this.model===void 0)throw new TypeError(C.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(C.geometry.coordinates)};function Ae(v){this.map=v.map,this.drawConfig=JSON.parse(JSON.stringify(v.options||{})),this._ctx=v}(Gn.prototype=Object.create($n.prototype))._coordinatesToFeatures=function(v){var C=this,B=this.model.bind(this);return v.map(function(ne){return new B(C.ctx,{id:We(),type:rn,properties:{},geometry:{coordinates:ne,type:C.type.replace("Multi","")}})})},Gn.prototype.isValid=function(){return this.features.every(function(v){return v.isValid()})},Gn.prototype.setCoordinates=function(v){this.features=this._coordinatesToFeatures(v),this.changed()},Gn.prototype.getCoordinate=function(v){return xr(this.features,"getCoordinate",v)},Gn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(v){return v.type===Nn?v.getCoordinates():v.coordinates})))},Gn.prototype.updateCoordinate=function(v,C,B){xr(this.features,"updateCoordinate",v,C,B),this.changed()},Gn.prototype.addCoordinate=function(v,C,B){xr(this.features,"addCoordinate",v,C,B),this.changed()},Gn.prototype.removeCoordinate=function(v){xr(this.features,"removeCoordinate",v),this.changed()},Gn.prototype.getFeatures=function(){return this.features},Ae.prototype.setSelected=function(v){return this._ctx.store.setSelected(v)},Ae.prototype.setSelectedCoordinates=function(v){var C=this;this._ctx.store.setSelectedCoordinates(v),v.reduce(function(B,ne){return B[ne.feature_id]===void 0&&(B[ne.feature_id]=!0,C._ctx.store.get(ne.feature_id).changed()),B},{})},Ae.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ae.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ae.prototype.isSelected=function(v){return this._ctx.store.isSelected(v)},Ae.prototype.getFeature=function(v){return this._ctx.store.get(v)},Ae.prototype.select=function(v){return this._ctx.store.select(v)},Ae.prototype.deselect=function(v){return this._ctx.store.deselect(v)},Ae.prototype.deleteFeature=function(v,C){return C===void 0&&(C={}),this._ctx.store.delete(v,C)},Ae.prototype.addFeature=function(v){return this._ctx.store.add(v)},Ae.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ae.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ae.prototype.setActionableState=function(v){v===void 0&&(v={});var C={trash:v.trash||!1,combineFeatures:v.combineFeatures||!1,uncombineFeatures:v.uncombineFeatures||!1};return this._ctx.events.actionable(C)},Ae.prototype.changeMode=function(v,C,B){return C===void 0&&(C={}),B===void 0&&(B={}),this._ctx.events.changeMode(v,C,B)},Ae.prototype.updateUIClasses=function(v){return this._ctx.ui.queueMapClasses(v)},Ae.prototype.activateUIButton=function(v){return this._ctx.ui.setActiveButton(v)},Ae.prototype.featuresAt=function(v,C,B){if(B===void 0&&(B="click"),B!=="click"&&B!=="touch")throw new Error("invalid buffer type");return mi[B](v,C,this._ctx)},Ae.prototype.newFeature=function(v){var C=v.geometry.type;return C===zn?new dr(this._ctx,v):C===cr?new Nt(this._ctx,v):C===Nn?new Ln(this._ctx,v):new Gn(this._ctx,v)},Ae.prototype.isInstanceOf=function(v,C){if(v===zn)return C instanceof dr;if(v===cr)return C instanceof Nt;if(v===Nn)return C instanceof Ln;if(v==="MultiFeature")return C instanceof Gn;throw new Error("Unknown feature class: "+v)},Ae.prototype.doRender=function(v){return this._ctx.store.featureChanged(v)},Ae.prototype.onSetup=function(){},Ae.prototype.onDrag=function(){},Ae.prototype.onClick=function(){},Ae.prototype.onMouseMove=function(){},Ae.prototype.onMouseDown=function(){},Ae.prototype.onMouseUp=function(){},Ae.prototype.onMouseOut=function(){},Ae.prototype.onKeyUp=function(){},Ae.prototype.onKeyDown=function(){},Ae.prototype.onTouchStart=function(){},Ae.prototype.onTouchMove=function(){},Ae.prototype.onTouchEnd=function(){},Ae.prototype.onTap=function(){},Ae.prototype.onStop=function(){},Ae.prototype.onTrash=function(){},Ae.prototype.onCombineFeature=function(){},Ae.prototype.onUncombineFeature=function(){},Ae.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Ut={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Ft=Object.keys(Ut);function pr(v){var C=Object.keys(v);return function(B,ne){ne===void 0&&(ne={});var ye={},ae=C.reduce(function(me,Oe){return me[Oe]=v[Oe],me},new Ae(B));return{start:function(){var me=this;ye=ae.onSetup(ne),Ft.forEach(function(Oe){var Fe,Ue=Ut[Oe],ve=function(){return!1};v[Ue]&&(ve=function(){return!0}),me.on(Oe,ve,(Fe=Ue,function(Ke){return ae[Fe](ye,Ke)}))})},stop:function(){ae.onStop(ye)},trash:function(){ae.onTrash(ye)},combineFeatures:function(){ae.onCombineFeatures(ye)},uncombineFeatures:function(){ae.onUncombineFeatures(ye)},render:function(me,Oe){ae.toDisplayFeatures(ye,me,Oe)}}}}function Mi(v){return[].concat(v).filter(function(C){return C!==void 0})}function Dt(){var v=this;if(!(v.ctx.map&&v.ctx.map.getSource(he)!==void 0))return Fe();var C=v.ctx.events.currentModeName();v.ctx.ui.queueMapClasses({mode:C});var B=[],ne=[];v.isDirty?ne=v.getAllIds():(B=v.getChangedIds().filter(function(Ue){return v.get(Ue)!==void 0}),ne=v.sources.hot.filter(function(Ue){return Ue.properties.id&&B.indexOf(Ue.properties.id)===-1&&v.get(Ue.properties.id)!==void 0}).map(function(Ue){return Ue.properties.id})),v.sources.hot=[];var ye=v.sources.cold.length;v.sources.cold=v.isDirty?[]:v.sources.cold.filter(function(Ue){var ve=Ue.properties.id||Ue.properties.parent;return B.indexOf(ve)===-1});var ae=ye!==v.sources.cold.length||ne.length>0;function me(Ue,ve){var Ke=v.get(Ue).internal(C);v.ctx.events.currentModeRender(Ke,function(at){v.sources[ve].push(at)})}if(B.forEach(function(Ue){return me(Ue,"hot")}),ne.forEach(function(Ue){return me(Ue,"cold")}),ae&&v.ctx.map.getSource(Ne).setData({type:hr,features:v.sources.cold}),v.ctx.map.getSource(he).setData({type:hr,features:v.sources.hot}),v._emitSelectionChange&&(v.ctx.map.fire(Ur,{features:v.getSelected().map(function(Ue){return Ue.toGeoJSON()}),points:v.getSelectedCoordinates().map(function(Ue){return{type:rn,properties:{},geometry:{type:zn,coordinates:Ue.coordinates}}})}),v._emitSelectionChange=!1),v._deletedFeaturesToEmit.length){var Oe=v._deletedFeaturesToEmit.map(function(Ue){return Ue.toGeoJSON()});v._deletedFeaturesToEmit=[],v.ctx.map.fire(Tn,{features:Oe})}function Fe(){v.isDirty=!1,v.clearChangedIds()}Fe(),v.ctx.map.fire(ti,{})}function on(v){var C,B=this;this._features={},this._featureIds=new Wn,this._selectedFeatureIds=new Wn,this._selectedCoordinates=[],this._changedFeatureIds=new Wn,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=v,this.sources={hot:[],cold:[]},this.render=function(){C||(C=requestAnimationFrame(function(){C=null,Dt.call(B)}))},this.isDirty=!1}function Qn(v,C){var B=v._selectedCoordinates.filter(function(ne){return v._selectedFeatureIds.has(ne.feature_id)});v._selectedCoordinates.length===B.length||C.silent||(v._emitSelectionChange=!0),v._selectedCoordinates=B}on.prototype.createRenderBatch=function(){var v=this,C=this.render,B=0;return this.render=function(){B++},function(){v.render=C,B>0&&v.render()}},on.prototype.setDirty=function(){return this.isDirty=!0,this},on.prototype.featureChanged=function(v){return this._changedFeatureIds.add(v),this},on.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},on.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},on.prototype.getAllIds=function(){return this._featureIds.values()},on.prototype.add=function(v){return this.featureChanged(v.id),this._features[v.id]=v,this._featureIds.add(v.id),this},on.prototype.delete=function(v,C){var B=this;return C===void 0&&(C={}),Mi(v).forEach(function(ne){B._featureIds.has(ne)&&(B._featureIds.delete(ne),B._selectedFeatureIds.delete(ne),C.silent||B._deletedFeaturesToEmit.indexOf(B._features[ne])===-1&&B._deletedFeaturesToEmit.push(B._features[ne]),delete B._features[ne],B.isDirty=!0)}),Qn(this,C),this},on.prototype.get=function(v){return this._features[v]},on.prototype.getAll=function(){var v=this;return Object.keys(this._features).map(function(C){return v._features[C]})},on.prototype.select=function(v,C){var B=this;return C===void 0&&(C={}),Mi(v).forEach(function(ne){B._selectedFeatureIds.has(ne)||(B._selectedFeatureIds.add(ne),B._changedFeatureIds.add(ne),C.silent||(B._emitSelectionChange=!0))}),this},on.prototype.deselect=function(v,C){var B=this;return C===void 0&&(C={}),Mi(v).forEach(function(ne){B._selectedFeatureIds.has(ne)&&(B._selectedFeatureIds.delete(ne),B._changedFeatureIds.add(ne),C.silent||(B._emitSelectionChange=!0))}),Qn(this,C),this},on.prototype.clearSelected=function(v){return v===void 0&&(v={}),this.deselect(this._selectedFeatureIds.values(),{silent:v.silent}),this},on.prototype.setSelected=function(v,C){var B=this;return C===void 0&&(C={}),v=Mi(v),this.deselect(this._selectedFeatureIds.values().filter(function(ne){return v.indexOf(ne)===-1}),{silent:C.silent}),this.select(v.filter(function(ne){return!B._selectedFeatureIds.has(ne)}),{silent:C.silent}),this},on.prototype.setSelectedCoordinates=function(v){return this._selectedCoordinates=v,this._emitSelectionChange=!0,this},on.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},on.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},on.prototype.getSelected=function(){var v=this;return this._selectedFeatureIds.values().map(function(C){return v.get(C)})},on.prototype.getSelectedCoordinates=function(){var v=this;return this._selectedCoordinates.map(function(C){return{coordinates:v.get(C.feature_id).getCoordinate(C.coord_path)}})},on.prototype.isSelected=function(v){return this._selectedFeatureIds.has(v)},on.prototype.setFeatureProperty=function(v,C,B){this.get(v).setProperty(C,B),this.featureChanged(v)},on.prototype.storeMapConfig=function(){var v=this;ds.forEach(function(C){v.ctx.map[C]&&(v._mapInitialConfig[C]=v.ctx.map[C].isEnabled())})},on.prototype.restoreMapConfig=function(){var v=this;Object.keys(this._mapInitialConfig).forEach(function(C){v._mapInitialConfig[C]?v.ctx.map[C].enable():v.ctx.map[C].disable()})},on.prototype.getInitialConfigValue=function(v){return this._mapInitialConfig[v]===void 0||this._mapInitialConfig[v]};var ii=function(){for(var v=arguments,C={},B=0;B<arguments.length;B++){var ne=v[B];for(var ye in ne)Xn.call(ne,ye)&&(C[ye]=ne[ye])}return C},Xn=Object.prototype.hasOwnProperty,zr=["mode","feature","mouse"];function dn(v){var C=null,B=null,ne={onRemove:function(){return v.map.off("load",ne.connect),clearInterval(B),ne.removeLayers(),v.store.restoreMapConfig(),v.ui.removeButtons(),v.events.removeEventListeners(),v.ui.clearMapClasses(),v.map=null,v.container=null,v.store=null,C&&C.parentNode&&C.parentNode.removeChild(C),C=null,this},connect:function(){v.map.off("load",ne.connect),clearInterval(B),ne.addLayers(),v.store.storeMapConfig(),v.events.addEventListeners()},onAdd:function(ye){var ae=ye.fire;return ye.fire=function(me,Oe){var Fe=arguments;return ae.length===1&&arguments.length!==1&&(Fe=[ii({},{type:me},Oe)]),ae.apply(ye,Fe)},v.map=ye,v.events=function(me){var Oe=Object.keys(me.options.modes).reduce(function(De,pt){return De[pt]=pr(me.options.modes[pt]),De},{}),Fe={},Ue={},ve={},Ke=null,at=null;ve.drag=function(De,pt){pt({point:De.point,time:new Date().getTime()})?(me.ui.queueMapClasses({mouse:yt}),at.drag(De)):De.originalEvent.stopPropagation()},ve.mousedrag=function(De){ve.drag(De,function(pt){return!Wo(Fe,pt)})},ve.touchdrag=function(De){ve.drag(De,function(pt){return!ji(Ue,pt)})},ve.mousemove=function(De){if((De.originalEvent.buttons!==void 0?De.originalEvent.buttons:De.originalEvent.which)===1)return ve.mousedrag(De);var pt=Ii(De,me);De.featureTarget=pt,at.mousemove(De)},ve.mousedown=function(De){Fe={time:new Date().getTime(),point:De.point};var pt=Ii(De,me);De.featureTarget=pt,at.mousedown(De)},ve.mouseup=function(De){var pt=Ii(De,me);De.featureTarget=pt,Wo(Fe,{point:De.point,time:new Date().getTime()})?at.click(De):at.mouseup(De)},ve.mouseout=function(De){at.mouseout(De)},ve.touchstart=function(De){if(De.originalEvent.preventDefault(),me.options.touchEnabled){Ue={time:new Date().getTime(),point:De.point};var pt=mi.touch(De,null,me)[0];De.featureTarget=pt,at.touchstart(De)}},ve.touchmove=function(De){if(De.originalEvent.preventDefault(),me.options.touchEnabled)return at.touchmove(De),ve.touchdrag(De)},ve.touchend=function(De){if(De.originalEvent.preventDefault(),me.options.touchEnabled){var pt=mi.touch(De,null,me)[0];De.featureTarget=pt,ji(Ue,{time:new Date().getTime(),point:De.point})?at.tap(De):at.touchend(De)}};var wt=function(De){return!(De===8||De===46||De>=48&&De<=57)};function zt(De,pt,cn){cn===void 0&&(cn={}),at.stop();var an=Oe[De];if(an===void 0)throw new Error(De+" is not valid");Ke=De;var kn=an(me,pt);at=u(kn,me),cn.silent||me.map.fire(Vr,{mode:De}),me.store.setDirty(),me.store.render()}ve.keydown=function(De){(De.srcElement||De.target).classList[0]==="mapboxgl-canvas"&&(De.keyCode!==8&&De.keyCode!==46||!me.options.controls.trash?wt(De.keyCode)?at.keydown(De):De.keyCode===49&&me.options.controls.point?zt(He.DRAW_POINT):De.keyCode===50&&me.options.controls.line_string?zt(He.DRAW_LINE_STRING):De.keyCode===51&&me.options.controls.polygon&&zt(He.DRAW_POLYGON):(De.preventDefault(),at.trash()))},ve.keyup=function(De){wt(De.keyCode)&&at.keyup(De)},ve.zoomend=function(){me.store.changeZoom()},ve.data=function(De){if(De.dataType==="style"){var pt=me.setup,cn=me.map,an=me.options,kn=me.store;an.styles.some(function(bt){return cn.getLayer(bt.id)})||(pt.addLayers(),kn.setDirty(),kn.render())}};var Un={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Ke=me.options.defaultMode,at=u(Oe[Ke](me),me)},changeMode:zt,actionable:function(De){var pt=!1;Object.keys(De).forEach(function(cn){if(Un[cn]===void 0)throw new Error("Invalid action type");Un[cn]!==De[cn]&&(pt=!0),Un[cn]=De[cn]}),pt&&me.map.fire(_r,{actions:Un})},currentModeName:function(){return Ke},currentModeRender:function(De,pt){return at.render(De,pt)},fire:function(De,pt){ve[De]&&ve[De](pt)},addEventListeners:function(){me.map.on("mousemove",ve.mousemove),me.map.on("mousedown",ve.mousedown),me.map.on("mouseup",ve.mouseup),me.map.on("data",ve.data),me.map.on("touchmove",ve.touchmove),me.map.on("touchstart",ve.touchstart),me.map.on("touchend",ve.touchend),me.container.addEventListener("mouseout",ve.mouseout),me.options.keybindings&&(me.container.addEventListener("keydown",ve.keydown),me.container.addEventListener("keyup",ve.keyup))},removeEventListeners:function(){me.map.off("mousemove",ve.mousemove),me.map.off("mousedown",ve.mousedown),me.map.off("mouseup",ve.mouseup),me.map.off("data",ve.data),me.map.off("touchmove",ve.touchmove),me.map.off("touchstart",ve.touchstart),me.map.off("touchend",ve.touchend),me.container.removeEventListener("mouseout",ve.mouseout),me.options.keybindings&&(me.container.removeEventListener("keydown",ve.keydown),me.container.removeEventListener("keyup",ve.keyup))},trash:function(De){at.trash(De)},combineFeatures:function(){at.combineFeatures()},uncombineFeatures:function(){at.uncombineFeatures()},getMode:function(){return Ke}}}(v),v.ui=function(me){var Oe={},Fe=null,Ue={mode:null,feature:null,mouse:null},ve={mode:null,feature:null,mouse:null};function Ke(De){ve=ii(ve,De)}function at(){var De,pt;if(me.container){var cn=[],an=[];zr.forEach(function(kn){ve[kn]!==Ue[kn]&&(cn.push(kn+"-"+Ue[kn]),ve[kn]!==null&&an.push(kn+"-"+ve[kn]))}),cn.length>0&&(De=me.container.classList).remove.apply(De,cn),an.length>0&&(pt=me.container.classList).add.apply(pt,an),Ue=ii(Ue,ve)}}function wt(De,pt){pt===void 0&&(pt={});var cn=document.createElement("button");return cn.className=J+" "+pt.className,cn.setAttribute("title",pt.title),pt.container.appendChild(cn),cn.addEventListener("click",function(an){if(an.preventDefault(),an.stopPropagation(),an.target===Fe)return zt(),void pt.onDeactivate();Un(De),pt.onActivate()},!0),cn}function zt(){Fe&&(Fe.classList.remove(pe),Fe=null)}function Un(De){zt();var pt=Oe[De];pt&&pt&&De!=="trash"&&(pt.classList.add(pe),Fe=pt)}return{setActiveButton:Un,queueMapClasses:Ke,updateMapClasses:at,clearMapClasses:function(){Ke({mode:null,feature:null,mouse:null}),at()},addButtons:function(){var De=me.options.controls,pt=document.createElement("div");return pt.className=fn+" "+G,De&&(De[kt.LINE]&&(Oe[kt.LINE]=wt(kt.LINE,{container:pt,className:we,title:"LineString tool "+(me.options.keybindings?"(l)":""),onActivate:function(){return me.events.changeMode(He.DRAW_LINE_STRING)},onDeactivate:function(){return me.events.trash()}})),De[kt.POLYGON]&&(Oe[kt.POLYGON]=wt(kt.POLYGON,{container:pt,className:fe,title:"Polygon tool "+(me.options.keybindings?"(p)":""),onActivate:function(){return me.events.changeMode(He.DRAW_POLYGON)},onDeactivate:function(){return me.events.trash()}})),De[kt.POINT]&&(Oe[kt.POINT]=wt(kt.POINT,{container:pt,className:H,title:"Marker tool "+(me.options.keybindings?"(m)":""),onActivate:function(){return me.events.changeMode(He.DRAW_POINT)},onDeactivate:function(){return me.events.trash()}})),De.trash&&(Oe.trash=wt("trash",{container:pt,className:tt,title:"Delete",onActivate:function(){me.events.trash()}})),De.combine_features&&(Oe.combine_features=wt("combineFeatures",{container:pt,className:Xe,title:"Combine",onActivate:function(){me.events.combineFeatures()}})),De.uncombine_features&&(Oe.uncombine_features=wt("uncombineFeatures",{container:pt,className:$e,title:"Uncombine",onActivate:function(){me.events.uncombineFeatures()}}))),pt},removeButtons:function(){Object.keys(Oe).forEach(function(De){var pt=Oe[De];pt.parentNode&&pt.parentNode.removeChild(pt),delete Oe[De]})}}}(v),v.container=ye.getContainer(),v.store=new on(v),C=v.ui.addButtons(),v.options.boxSelect&&(ye.boxZoom.disable(),ye.dragPan.disable(),ye.dragPan.enable()),ye.loaded()?ne.connect():(ye.on("load",ne.connect),B=setInterval(function(){ye.loaded()&&ne.connect()},16)),v.events.start(),C},addLayers:function(){v.map.addSource(Ne,{data:{type:hr,features:[]},type:"geojson"}),v.map.addSource(he,{data:{type:hr,features:[]},type:"geojson"}),v.options.styles.forEach(function(ye){v.map.addLayer(ye)}),v.store.setDirty(!0),v.store.render()},removeLayers:function(){v.options.styles.forEach(function(ye){v.map.getLayer(ye.id)&&v.map.removeLayer(ye.id)}),v.map.getSource(Ne)&&v.map.removeSource(Ne),v.map.getSource(he)&&v.map.removeSource(he)}};return v.setup=ne,ne}function Mo(v){return function(C){var B=C.featureTarget;return!!B&&!!B.properties&&B.properties.meta===v}}function Lr(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===vr&&v.featureTarget.properties.meta===Pr}function Po(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===ni&&v.featureTarget.properties.meta===Pr}function oo(v){return v.featureTarget===void 0}function so(v){var C=v.featureTarget;return!!C&&!!C.properties&&C.properties.meta===io}function ao(v){return!!v.originalEvent&&v.originalEvent.shiftKey===!0}function $(v){return v.keyCode===27}function M(v){return v.keyCode===13}var D=V;function V(v,C){this.x=v,this.y=C}function j(v,C){var B=C.getBoundingClientRect();return new D(v.clientX-B.left-(C.clientLeft||0),v.clientY-B.top-(C.clientTop||0))}function Y(v,C,B,ne){return{type:rn,properties:{meta:io,parent:v,coord_path:B,active:ne?vr:ni},geometry:{type:zn,coordinates:C}}}function oe(v,C,B){C===void 0&&(C={}),B===void 0&&(B=null);var ne,ye=v.geometry,ae=ye.type,me=ye.coordinates,Oe=v.properties&&v.properties.id,Fe=[];function Ue(Ke,at){var wt="",zt=null;Ke.forEach(function(Un,De){var pt=at!=null?at+"."+De:String(De),cn=Y(Oe,Un,pt,ve(pt));if(C.midpoints&&zt){var an=function(bt,Gt,uo){var sn=Gt.geometry.coordinates,Rr=uo.geometry.coordinates;if(sn[1]>85||sn[1]<-85||Rr[1]>85||Rr[1]<-85)return null;var or={lng:(sn[0]+Rr[0])/2,lat:(sn[1]+Rr[1])/2};return{type:rn,properties:{meta:Ar,parent:bt,lng:or.lng,lat:or.lat,coord_path:uo.properties.coord_path},geometry:{type:zn,coordinates:[or.lng,or.lat]}}}(Oe,zt,cn);an&&Fe.push(an)}zt=cn;var kn=JSON.stringify(Un);wt!==kn&&Fe.push(cn),De===0&&(wt=kn)})}function ve(Ke){return!!C.selectedPaths&&C.selectedPaths.indexOf(Ke)!==-1}return ae===zn?Fe.push(Y(Oe,me,B,ve(B))):ae===Nn?me.forEach(function(Ke,at){Ue(Ke,B!==null?B+"."+at:String(at))}):ae===cr?Ue(me,B):ae.indexOf(It)===0&&(ne=ae.replace(It,""),me.forEach(function(Ke,at){var wt={type:rn,properties:v.properties,geometry:{type:ne,coordinates:Ke}};Fe=Fe.concat(oe(wt,C,at))})),Fe}V.prototype={clone:function(){return new V(this.x,this.y)},add:function(v){return this.clone()._add(v)},sub:function(v){return this.clone()._sub(v)},multByPoint:function(v){return this.clone()._multByPoint(v)},divByPoint:function(v){return this.clone()._divByPoint(v)},mult:function(v){return this.clone()._mult(v)},div:function(v){return this.clone()._div(v)},rotate:function(v){return this.clone()._rotate(v)},rotateAround:function(v,C){return this.clone()._rotateAround(v,C)},matMult:function(v){return this.clone()._matMult(v)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(v){return this.x===v.x&&this.y===v.y},dist:function(v){return Math.sqrt(this.distSqr(v))},distSqr:function(v){var C=v.x-this.x,B=v.y-this.y;return C*C+B*B},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith:function(v){return this.angleWithSep(v.x,v.y)},angleWithSep:function(v,C){return Math.atan2(this.x*C-this.y*v,this.x*v+this.y*C)},_matMult:function(v){var C=v[0]*this.x+v[1]*this.y,B=v[2]*this.x+v[3]*this.y;return this.x=C,this.y=B,this},_add:function(v){return this.x+=v.x,this.y+=v.y,this},_sub:function(v){return this.x-=v.x,this.y-=v.y,this},_mult:function(v){return this.x*=v,this.y*=v,this},_div:function(v){return this.x/=v,this.y/=v,this},_multByPoint:function(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint:function(v){return this.x/=v.x,this.y/=v.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var v=this.y;return this.y=this.x,this.x=-v,this},_rotate:function(v){var C=Math.cos(v),B=Math.sin(v),ne=C*this.x-B*this.y,ye=B*this.x+C*this.y;return this.x=ne,this.y=ye,this},_rotateAround:function(v,C){var B=Math.cos(v),ne=Math.sin(v),ye=C.x+B*(this.x-C.x)-ne*(this.y-C.y),ae=C.y+ne*(this.x-C.x)+B*(this.y-C.y);return this.x=ye,this.y=ae,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},V.convert=function(v){return v instanceof V?v:Array.isArray(v)?new V(v[0],v[1]):v};var te=function(v){setTimeout(function(){v.map&&v.map.doubleClickZoom&&v._ctx&&v._ctx.store&&v._ctx.store.getInitialConfigValue&&v._ctx.store.getInitialConfigValue("doubleClickZoom")&&v.map.doubleClickZoom.enable()},0)},Q=function(v){setTimeout(function(){v.map&&v.map.doubleClickZoom&&v.map.doubleClickZoom.disable()},0)},se=function(v){if(!v||!v.type)return null;var C=Te[v.type];if(!C)return null;if(C==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:v}]};if(C==="feature")return{type:"FeatureCollection",features:[v]};if(C==="featurecollection")return v},Te={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Re(v){switch(v&&v.type||null){case"FeatureCollection":return v.features=v.features.reduce(function(C,B){return C.concat(Re(B))},[]),v;case"Feature":return v.geometry?Re(v.geometry).map(function(C){var B={type:"Feature",properties:JSON.parse(JSON.stringify(v.properties)),geometry:C};return v.id!==void 0&&(B.id=v.id),B}):[v];case"MultiPoint":return v.coordinates.map(function(C){return{type:"Point",coordinates:C}});case"MultiPolygon":return v.coordinates.map(function(C){return{type:"Polygon",coordinates:C}});case"MultiLineString":return v.coordinates.map(function(C){return{type:"LineString",coordinates:C}});case"GeometryCollection":return v.geometries.map(Re).reduce(function(C,B){return C.concat(B)},[]);case"Point":case"Polygon":case"LineString":return[v]}}var Ee=function(v){if(!v)return[];var C=Re(se(v)),B=[];return C.features.forEach(function(ne){ne.geometry&&(B=B.concat(function ye(ae){return Array.isArray(ae)&&ae.length&&typeof ae[0]=="number"?[ae]:ae.reduce(function(me,Oe){return Array.isArray(Oe)&&Array.isArray(Oe[0])?me.concat(ye(Oe)):(me.push(Oe),me)},[])}(ne.geometry.coordinates)))}),B},dt=Ie(function(v){var C=v.exports=function(ve){return new B(ve)};function B(ve){this.value=ve}function ne(ve,Ke,at){var wt=[],zt=[],Un=!0;return function De(pt){var cn=at?ye(pt):pt,an={},kn=!0,bt={node:cn,node_:pt,path:[].concat(wt),parent:zt[zt.length-1],parents:zt,key:wt.slice(-1)[0],isRoot:wt.length===0,level:wt.length,circular:null,update:function(sn,Rr){bt.isRoot||(bt.parent.node[bt.key]=sn),bt.node=sn,Rr&&(kn=!1)},delete:function(sn){delete bt.parent.node[bt.key],sn&&(kn=!1)},remove:function(sn){Oe(bt.parent.node)?bt.parent.node.splice(bt.key,1):delete bt.parent.node[bt.key],sn&&(kn=!1)},keys:null,before:function(sn){an.before=sn},after:function(sn){an.after=sn},pre:function(sn){an.pre=sn},post:function(sn){an.post=sn},stop:function(){Un=!1},block:function(){kn=!1}};if(!Un)return bt;function Gt(){if(typeof bt.node=="object"&&bt.node!==null){bt.keys&&bt.node_===bt.node||(bt.keys=ae(bt.node)),bt.isLeaf=bt.keys.length==0;for(var sn=0;sn<zt.length;sn++)if(zt[sn].node_===pt){bt.circular=zt[sn];break}}else bt.isLeaf=!0,bt.keys=null;bt.notLeaf=!bt.isLeaf,bt.notRoot=!bt.isRoot}Gt();var uo=Ke.call(bt,bt.node);return uo!==void 0&&bt.update&&bt.update(uo),an.before&&an.before.call(bt,bt.node),kn&&(typeof bt.node!="object"||bt.node===null||bt.circular||(zt.push(bt),Gt(),Fe(bt.keys,function(sn,Rr){wt.push(sn),an.pre&&an.pre.call(bt,bt.node[sn],sn);var or=De(bt.node[sn]);at&&Ue.call(bt.node,sn)&&(bt.node[sn]=or.node),or.isLast=Rr==bt.keys.length-1,or.isFirst=Rr==0,an.post&&an.post.call(bt,or),wt.pop()}),zt.pop()),an.after&&an.after.call(bt,bt.node)),bt}(ve).node}function ye(ve){if(typeof ve=="object"&&ve!==null){var Ke;if(Oe(ve))Ke=[];else if(me(ve)==="[object Date]")Ke=new Date(ve.getTime?ve.getTime():ve);else if(function(zt){return me(zt)==="[object RegExp]"}(ve))Ke=new RegExp(ve);else if(function(zt){return me(zt)==="[object Error]"}(ve))Ke={message:ve.message};else if(function(zt){return me(zt)==="[object Boolean]"}(ve))Ke=new Boolean(ve);else if(function(zt){return me(zt)==="[object Number]"}(ve))Ke=new Number(ve);else if(function(zt){return me(zt)==="[object String]"}(ve))Ke=new String(ve);else if(Object.create&&Object.getPrototypeOf)Ke=Object.create(Object.getPrototypeOf(ve));else if(ve.constructor===Object)Ke={};else{var at=ve.constructor&&ve.constructor.prototype||ve.__proto__||{},wt=function(){};wt.prototype=at,Ke=new wt}return Fe(ae(ve),function(zt){Ke[zt]=ve[zt]}),Ke}return ve}B.prototype.get=function(ve){for(var Ke=this.value,at=0;at<ve.length;at++){var wt=ve[at];if(!Ke||!Ue.call(Ke,wt)){Ke=void 0;break}Ke=Ke[wt]}return Ke},B.prototype.has=function(ve){for(var Ke=this.value,at=0;at<ve.length;at++){var wt=ve[at];if(!Ke||!Ue.call(Ke,wt))return!1;Ke=Ke[wt]}return!0},B.prototype.set=function(ve,Ke){for(var at=this.value,wt=0;wt<ve.length-1;wt++){var zt=ve[wt];Ue.call(at,zt)||(at[zt]={}),at=at[zt]}return at[ve[wt]]=Ke,Ke},B.prototype.map=function(ve){return ne(this.value,ve,!0)},B.prototype.forEach=function(ve){return this.value=ne(this.value,ve,!1),this.value},B.prototype.reduce=function(ve,Ke){var at=arguments.length===1,wt=at?this.value:Ke;return this.forEach(function(zt){this.isRoot&&at||(wt=ve.call(this,wt,zt))}),wt},B.prototype.paths=function(){var ve=[];return this.forEach(function(Ke){ve.push(this.path)}),ve},B.prototype.nodes=function(){var ve=[];return this.forEach(function(Ke){ve.push(this.node)}),ve},B.prototype.clone=function(){var ve=[],Ke=[];return function at(wt){for(var zt=0;zt<ve.length;zt++)if(ve[zt]===wt)return Ke[zt];if(typeof wt=="object"&&wt!==null){var Un=ye(wt);return ve.push(wt),Ke.push(Un),Fe(ae(wt),function(De){Un[De]=at(wt[De])}),ve.pop(),Ke.pop(),Un}return wt}(this.value)};var ae=Object.keys||function(ve){var Ke=[];for(var at in ve)Ke.push(at);return Ke};function me(ve){return Object.prototype.toString.call(ve)}var Oe=Array.isArray||function(ve){return Object.prototype.toString.call(ve)==="[object Array]"},Fe=function(ve,Ke){if(ve.forEach)return ve.forEach(Ke);for(var at=0;at<ve.length;at++)Ke(ve[at],at,ve)};Fe(ae(B.prototype),function(ve){C[ve]=function(Ke){var at=[].slice.call(arguments,1),wt=new B(Ke);return wt[ve].apply(wt,at)}});var Ue=Object.hasOwnProperty||function(ve,Ke){return Ke in ve}}),mt=je;function je(v){if(!(this instanceof je))return new je(v);this._bbox=v||[1/0,1/0,-1/0,-1/0],this._valid=!!v}je.prototype.include=function(v){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],v[0]),this._bbox[1]=Math.min(this._bbox[1],v[1]),this._bbox[2]=Math.max(this._bbox[2],v[0]),this._bbox[3]=Math.max(this._bbox[3],v[1]),this},je.prototype.equals=function(v){var C;return C=v instanceof je?v.bbox():v,this._bbox[0]==C[0]&&this._bbox[1]==C[1]&&this._bbox[2]==C[2]&&this._bbox[3]==C[3]},je.prototype.center=function(v){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},je.prototype.union=function(v){var C;return this._valid=!0,C=v instanceof je?v.bbox():v,this._bbox[0]=Math.min(this._bbox[0],C[0]),this._bbox[1]=Math.min(this._bbox[1],C[1]),this._bbox[2]=Math.max(this._bbox[2],C[2]),this._bbox[3]=Math.max(this._bbox[3],C[3]),this},je.prototype.bbox=function(){return this._valid?this._bbox:null},je.prototype.contains=function(v){if(!v)return this._fastContains();if(!this._valid)return null;var C=v[0],B=v[1];return this._bbox[0]<=C&&this._bbox[1]<=B&&this._bbox[2]>=C&&this._bbox[3]>=B},je.prototype.intersect=function(v){return this._valid?(C=v instanceof je?v.bbox():v,!(this._bbox[0]>C[2]||this._bbox[2]<C[0]||this._bbox[3]<C[1]||this._bbox[1]>C[3])):null;var C},je.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var v="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",v)},je.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Tt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},At=Object.keys(Tt),Wt=function(v){return Lt(v).bbox()};function Lt(v){for(var C=mt(),B=Ee(v),ne=0;ne<B.length;ne++)C.include(B[ne]);return C}Wt.polygon=function(v){return Lt(v).polygon()},Wt.bboxify=function(v){return dt(v).map(function(C){C&&At.some(function(B){return!!C[B]&&Tt[B].indexOf(C.type)!==-1})&&(C.bbox=Lt(C).bbox(),this.update(C))})};function Vt(v,C){var B=-90,ne=90,ye=-90,ae=90,me=270,Oe=-270;v.forEach(function(Ue){var ve=Wt(Ue),Ke=ve[1],at=ve[3],wt=ve[0],zt=ve[2];Ke>B&&(B=Ke),at<ne&&(ne=at),at>ye&&(ye=at),Ke<ae&&(ae=Ke),wt<me&&(me=wt),zt>Oe&&(Oe=zt)});var Fe=C;return B+Fe.lat>85&&(Fe.lat=85-B),ye+Fe.lat>90&&(Fe.lat=90-ye),ne+Fe.lat<-85&&(Fe.lat=-85-ne),ae+Fe.lat<-90&&(Fe.lat=-90-ae),me+Fe.lng<=-270&&(Fe.lng+=360*Math.ceil(Math.abs(Fe.lng)/360)),Oe+Fe.lng>=270&&(Fe.lng-=360*Math.ceil(Math.abs(Fe.lng)/360)),Fe}function Kt(v,C){var B=Vt(v.map(function(ne){return ne.toGeoJSON()}),C);v.forEach(function(ne){var ye,ae=ne.getCoordinates(),me=function(Fe){var Ue={lng:Fe[0]+B.lng,lat:Fe[1]+B.lat};return[Ue.lng,Ue.lat]},Oe=function(Fe){return Fe.map(function(Ue){return me(Ue)})};ne.type===zn?ye=me(ae):ne.type===cr||ne.type===ei?ye=ae.map(me):ne.type===Nn||ne.type===ut?ye=ae.map(Oe):ne.type===Pt&&(ye=ae.map(function(Fe){return Fe.map(function(Ue){return Oe(Ue)})})),ne.incomingCoords(ye)})}var Bt={onSetup:function(v){var C=this,B={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:v.featureIds||[]};return this.setSelected(B.initiallySelectedFeatureIds.filter(function(ne){return C.getFeature(ne)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),B},fireUpdate:function(){this.map.fire(fi,{action:hs,features:this.getSelected().map(function(v){return v.toGeoJSON()})})},fireActionable:function(){var v=this,C=this.getSelected(),B=C.filter(function(Oe){return v.isInstanceOf("MultiFeature",Oe)}),ne=!1;if(C.length>1){ne=!0;var ye=C[0].type.replace("Multi","");C.forEach(function(Oe){Oe.type.replace("Multi","")!==ye&&(ne=!1)})}var ae=B.length>0,me=C.length>0;this.setActionableState({combineFeatures:ne,uncombineFeatures:ae,trash:me})},getUniqueIds:function(v){return v.length?v.map(function(C){return C.properties.id}).filter(function(C){return C!==void 0}).reduce(function(C,B){return C.add(B),C},new Wn).values():[]},stopExtendedInteractions:function(v){v.boxSelectElement&&(v.boxSelectElement.parentNode&&v.boxSelectElement.parentNode.removeChild(v.boxSelectElement),v.boxSelectElement=null),this.map.dragPan.enable(),v.boxSelecting=!1,v.canBoxSelect=!1,v.dragMoving=!1,v.canDragMove=!1},onStop:function(){te(this)},onMouseMove:function(v){return this.stopExtendedInteractions(v),!0},onMouseOut:function(v){return!v.dragMoving||this.fireUpdate()}};Bt.onTap=Bt.onClick=function(v,C){return oo(C)?this.clickAnywhere(v,C):Mo(io)(C)?this.clickOnVertex(v,C):function(B){return!!B.featureTarget&&!!B.featureTarget.properties&&B.featureTarget.properties.meta===Pr}(C)?this.clickOnFeature(v,C):void 0},Bt.clickAnywhere=function(v){var C=this,B=this.getSelectedIds();B.length&&(this.clearSelectedFeatures(),B.forEach(function(ne){return C.doRender(ne)})),te(this),this.stopExtendedInteractions(v)},Bt.clickOnVertex=function(v,C){this.changeMode(He.DIRECT_SELECT,{featureId:C.featureTarget.properties.parent,coordPath:C.featureTarget.properties.coord_path,startPos:C.lngLat}),this.updateUIClasses({mouse:lt})},Bt.startOnActiveFeature=function(v,C){this.stopExtendedInteractions(v),this.map.dragPan.disable(),this.doRender(C.featureTarget.properties.id),v.canDragMove=!0,v.dragMoveLocation=C.lngLat},Bt.clickOnFeature=function(v,C){var B=this;Q(this),this.stopExtendedInteractions(v);var ne=ao(C),ye=this.getSelectedIds(),ae=C.featureTarget.properties.id,me=this.isSelected(ae);if(!ne&&me&&this.getFeature(ae).type!==zn)return this.changeMode(He.DIRECT_SELECT,{featureId:ae});me&&ne?(this.deselect(ae),this.updateUIClasses({mouse:ft}),ye.length===1&&te(this)):!me&&ne?(this.select(ae),this.updateUIClasses({mouse:lt})):me||ne||(ye.forEach(function(Oe){return B.doRender(Oe)}),this.setSelected(ae),this.updateUIClasses({mouse:lt})),this.doRender(ae)},Bt.onMouseDown=function(v,C){return Lr(C)?this.startOnActiveFeature(v,C):this.drawConfig.boxSelect&&function(B){return!!B.originalEvent&&!!B.originalEvent.shiftKey&&B.originalEvent.button===0}(C)?this.startBoxSelect(v,C):void 0},Bt.startBoxSelect=function(v,C){this.stopExtendedInteractions(v),this.map.dragPan.disable(),v.boxSelectStartLocation=j(C.originalEvent,this.map.getContainer()),v.canBoxSelect=!0},Bt.onTouchStart=function(v,C){if(Lr(C))return this.startOnActiveFeature(v,C)},Bt.onDrag=function(v,C){return v.canDragMove?this.dragMove(v,C):this.drawConfig.boxSelect&&v.canBoxSelect?this.whileBoxSelect(v,C):void 0},Bt.whileBoxSelect=function(v,C){v.boxSelecting=!0,this.updateUIClasses({mouse:Ge}),v.boxSelectElement||(v.boxSelectElement=document.createElement("div"),v.boxSelectElement.classList.add(ie),this.map.getContainer().appendChild(v.boxSelectElement));var B=j(C.originalEvent,this.map.getContainer()),ne=Math.min(v.boxSelectStartLocation.x,B.x),ye=Math.max(v.boxSelectStartLocation.x,B.x),ae=Math.min(v.boxSelectStartLocation.y,B.y),me=Math.max(v.boxSelectStartLocation.y,B.y),Oe="translate("+ne+"px, "+ae+"px)";v.boxSelectElement.style.transform=Oe,v.boxSelectElement.style.WebkitTransform=Oe,v.boxSelectElement.style.width=ye-ne+"px",v.boxSelectElement.style.height=me-ae+"px"},Bt.dragMove=function(v,C){v.dragMoving=!0,C.originalEvent.stopPropagation();var B={lng:C.lngLat.lng-v.dragMoveLocation.lng,lat:C.lngLat.lat-v.dragMoveLocation.lat};Kt(this.getSelected(),B),v.dragMoveLocation=C.lngLat},Bt.onMouseUp=function(v,C){var B=this;if(v.dragMoving)this.fireUpdate();else if(v.boxSelecting){var ne=[v.boxSelectStartLocation,j(C.originalEvent,this.map.getContainer())],ye=this.featuresAt(null,ne,"click"),ae=this.getUniqueIds(ye).filter(function(me){return!B.isSelected(me)});ae.length&&(this.select(ae),ae.forEach(function(me){return B.doRender(me)}),this.updateUIClasses({mouse:lt}))}this.stopExtendedInteractions(v)},Bt.toDisplayFeatures=function(v,C,B){C.properties.active=this.isSelected(C.properties.id)?vr:ni,B(C),this.fireActionable(),C.properties.active===vr&&C.geometry.type!==zn&&oe(C).forEach(B)},Bt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Bt.onCombineFeatures=function(){var v=this.getSelected();if(!(v.length===0||v.length<2)){for(var C=[],B=[],ne=v[0].type.replace("Multi",""),ye=0;ye<v.length;ye++){var ae=v[ye];if(ae.type.replace("Multi","")!==ne)return;ae.type.includes("Multi")?ae.getCoordinates().forEach(function(Oe){C.push(Oe)}):C.push(ae.getCoordinates()),B.push(ae.toGeoJSON())}if(B.length>1){var me=this.newFeature({type:rn,properties:B[0].properties,geometry:{type:"Multi"+ne,coordinates:C}});this.addFeature(me),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([me.id]),this.map.fire(ko,{createdFeatures:[me.toGeoJSON()],deletedFeatures:B})}this.fireActionable()}},Bt.onUncombineFeatures=function(){var v=this,C=this.getSelected();if(C.length!==0){for(var B=[],ne=[],ye=function(me){var Oe=C[me];v.isInstanceOf("MultiFeature",Oe)&&(Oe.getFeatures().forEach(function(Fe){v.addFeature(Fe),Fe.properties=Oe.properties,B.push(Fe.toGeoJSON()),v.select([Fe.id])}),v.deleteFeature(Oe.id,{silent:!0}),ne.push(Oe.toGeoJSON()))},ae=0;ae<C.length;ae++)ye(ae);B.length>1&&this.map.fire(jr,{createdFeatures:B,deletedFeatures:ne}),this.fireActionable()}};var er=Mo(io),Cn=Mo(Ar),Dn={fireUpdate:function(){this.map.fire(fi,{action:Fs,features:this.getSelected().map(function(v){return v.toGeoJSON()})})},fireActionable:function(v){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:v.selectedCoordPaths.length>0})},startDragging:function(v,C){this.map.dragPan.disable(),v.canDragMove=!0,v.dragMoveLocation=C.lngLat},stopDragging:function(v){this.map.dragPan.enable(),v.dragMoving=!1,v.canDragMove=!1,v.dragMoveLocation=null},onVertex:function(v,C){this.startDragging(v,C);var B=C.featureTarget.properties,ne=v.selectedCoordPaths.indexOf(B.coord_path);ao(C)||ne!==-1?ao(C)&&ne===-1&&v.selectedCoordPaths.push(B.coord_path):v.selectedCoordPaths=[B.coord_path];var ye=this.pathsToCoordinates(v.featureId,v.selectedCoordPaths);this.setSelectedCoordinates(ye)},onMidpoint:function(v,C){this.startDragging(v,C);var B=C.featureTarget.properties;v.feature.addCoordinate(B.coord_path,B.lng,B.lat),this.fireUpdate(),v.selectedCoordPaths=[B.coord_path]},pathsToCoordinates:function(v,C){return C.map(function(B){return{feature_id:v,coord_path:B}})},onFeature:function(v,C){v.selectedCoordPaths.length===0?this.startDragging(v,C):this.stopDragging(v)},dragFeature:function(v,C,B){Kt(this.getSelected(),B),v.dragMoveLocation=C.lngLat},dragVertex:function(v,C,B){for(var ne=v.selectedCoordPaths.map(function(Oe){return v.feature.getCoordinate(Oe)}),ye=Vt(ne.map(function(Oe){return{type:rn,properties:{},geometry:{type:zn,coordinates:Oe}}}),B),ae=0;ae<ne.length;ae++){var me=ne[ae];v.feature.updateCoordinate(v.selectedCoordPaths[ae],me[0]+ye.lng,me[1]+ye.lat)}},clickNoTarget:function(){this.changeMode(He.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(He.SIMPLE_SELECT)},clickActiveFeature:function(v){v.selectedCoordPaths=[],this.clearSelectedCoordinates(),v.feature.changed()},onSetup:function(v){var C=v.featureId,B=this.getFeature(C);if(!B)throw new Error("You must provide a featureId to enter direct_select mode");if(B.type===zn)throw new TypeError("direct_select mode doesn't handle point features");var ne={featureId:C,feature:B,dragMoveLocation:v.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:v.coordPath?[v.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(C,ne.selectedCoordPaths)),this.setSelected(C),Q(this),this.setActionableState({trash:!0}),ne},onStop:function(){te(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(v,C,B){v.featureId===C.properties.id?(C.properties.active=vr,B(C),oe(C,{map:this.map,midpoints:!0,selectedPaths:v.selectedCoordPaths}).forEach(B)):(C.properties.active=ni,B(C)),this.fireActionable(v)},onTrash:function(v){v.selectedCoordPaths.sort(function(C,B){return B.localeCompare(C,"en",{numeric:!0})}).forEach(function(C){return v.feature.removeCoordinate(C)}),this.fireUpdate(),v.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(v),v.feature.isValid()===!1&&(this.deleteFeature([v.featureId]),this.changeMode(He.SIMPLE_SELECT,{}))},onMouseMove:function(v,C){var B=Lr(C),ne=er(C),ye=v.selectedCoordPaths.length===0;return B&&ye||ne&&!ye?this.updateUIClasses({mouse:lt}):this.updateUIClasses({mouse:xn}),this.stopDragging(v),!0},onMouseOut:function(v){return v.dragMoving&&this.fireUpdate(),!0}};Dn.onTouchStart=Dn.onMouseDown=function(v,C){return er(C)?this.onVertex(v,C):Lr(C)?this.onFeature(v,C):Cn(C)?this.onMidpoint(v,C):void 0},Dn.onDrag=function(v,C){if(v.canDragMove===!0){v.dragMoving=!0,C.originalEvent.stopPropagation();var B={lng:C.lngLat.lng-v.dragMoveLocation.lng,lat:C.lngLat.lat-v.dragMoveLocation.lat};v.selectedCoordPaths.length>0?this.dragVertex(v,C,B):this.dragFeature(v,C,B),v.dragMoveLocation=C.lngLat}},Dn.onClick=function(v,C){return oo(C)?this.clickNoTarget(v,C):Lr(C)?this.clickActiveFeature(v,C):Po(C)?this.clickInactive(v,C):void this.stopDragging(v)},Dn.onTap=function(v,C){return oo(C)?this.clickNoTarget(v,C):Lr(C)?this.clickActiveFeature(v,C):Po(C)?this.clickInactive(v,C):void 0},Dn.onTouchEnd=Dn.onMouseUp=function(v){v.dragMoving&&this.fireUpdate(),this.stopDragging(v)};var Dr={};function Xo(v,C){return!!v.lngLat&&v.lngLat.lng===C[0]&&v.lngLat.lat===C[1]}Dr.onSetup=function(){var v=this.newFeature({type:rn,properties:{},geometry:{type:zn,coordinates:[]}});return this.addFeature(v),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Ge}),this.activateUIButton(kt.POINT),this.setActionableState({trash:!0}),{point:v}},Dr.stopDrawingAndRemove=function(v){this.deleteFeature([v.point.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)},Dr.onTap=Dr.onClick=function(v,C){this.updateUIClasses({mouse:lt}),v.point.updateCoordinate("",C.lngLat.lng,C.lngLat.lat),this.map.fire(un,{features:[v.point.toGeoJSON()]}),this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.point.id]})},Dr.onStop=function(v){this.activateUIButton(),v.point.getCoordinate().length||this.deleteFeature([v.point.id],{silent:!0})},Dr.toDisplayFeatures=function(v,C,B){var ne=C.properties.id===v.point.id;if(C.properties.active=ne?vr:ni,!ne)return B(C)},Dr.onTrash=Dr.stopDrawingAndRemove,Dr.onKeyUp=function(v,C){if($(C)||M(C))return this.stopDrawingAndRemove(v,C)};var en={onSetup:function(){var v=this.newFeature({type:rn,properties:{},geometry:{type:Nn,coordinates:[[]]}});return this.addFeature(v),this.clearSelectedFeatures(),Q(this),this.updateUIClasses({mouse:Ge}),this.activateUIButton(kt.POLYGON),this.setActionableState({trash:!0}),{polygon:v,currentVertexPosition:0}},clickAnywhere:function(v,C){if(v.currentVertexPosition>0&&Xo(C,v.polygon.coordinates[0][v.currentVertexPosition-1]))return this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.polygon.id]});this.updateUIClasses({mouse:Ge}),v.polygon.updateCoordinate("0."+v.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),v.currentVertexPosition++,v.polygon.updateCoordinate("0."+v.currentVertexPosition,C.lngLat.lng,C.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},onMouseMove:function(v,C){v.polygon.updateCoordinate("0."+v.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),so(C)&&this.updateUIClasses({mouse:ft})}};en.onTap=en.onClick=function(v,C){return so(C)?this.clickOnVertex(v,C):this.clickAnywhere(v,C)},en.onKeyUp=function(v,C){$(C)?(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)):M(C)&&this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},en.onStop=function(v){this.updateUIClasses({mouse:xn}),te(this),this.activateUIButton(),this.getFeature(v.polygon.id)!==void 0&&(v.polygon.removeCoordinate("0."+v.currentVertexPosition),v.polygon.isValid()?this.map.fire(un,{features:[v.polygon.toGeoJSON()]}):(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT,{},{silent:!0})))},en.toDisplayFeatures=function(v,C,B){var ne=C.properties.id===v.polygon.id;if(C.properties.active=ne?vr:ni,!ne)return B(C);if(C.geometry.coordinates.length!==0){var ye=C.geometry.coordinates[0].length;if(!(ye<3)){if(C.properties.meta=Pr,B(Y(v.polygon.id,C.geometry.coordinates[0][0],"0.0",!1)),ye>3){var ae=C.geometry.coordinates[0].length-3;B(Y(v.polygon.id,C.geometry.coordinates[0][ae],"0."+ae,!1))}if(ye<=4){var me=[[C.geometry.coordinates[0][0][0],C.geometry.coordinates[0][0][1]],[C.geometry.coordinates[0][1][0],C.geometry.coordinates[0][1][1]]];if(B({type:rn,properties:C.properties,geometry:{coordinates:me,type:cr}}),ye===3)return}return B(C)}}},en.onTrash=function(v){this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)};var lo={onSetup:function(v){var C,B,ne=(v=v||{}).featureId,ye="forward";if(ne){if(!(C=this.getFeature(ne)))throw new Error("Could not find a feature with the provided featureId");var ae=v.from;if(ae&&ae.type==="Feature"&&ae.geometry&&ae.geometry.type==="Point"&&(ae=ae.geometry),ae&&ae.type==="Point"&&ae.coordinates&&ae.coordinates.length===2&&(ae=ae.coordinates),!ae||!Array.isArray(ae))throw new Error("Please use the `from` property to indicate which point to continue the line from");var me=C.coordinates.length-1;if(C.coordinates[me][0]===ae[0]&&C.coordinates[me][1]===ae[1])B=me+1,C.addCoordinate.apply(C,[B].concat(C.coordinates[me]));else{if(C.coordinates[0][0]!==ae[0]||C.coordinates[0][1]!==ae[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ye="backwards",B=0,C.addCoordinate.apply(C,[B].concat(C.coordinates[0]))}}else C=this.newFeature({type:rn,properties:{},geometry:{type:cr,coordinates:[]}}),B=0,this.addFeature(C);return this.clearSelectedFeatures(),Q(this),this.updateUIClasses({mouse:Ge}),this.activateUIButton(kt.LINE),this.setActionableState({trash:!0}),{line:C,currentVertexPosition:B,direction:ye}},clickAnywhere:function(v,C){if(v.currentVertexPosition>0&&Xo(C,v.line.coordinates[v.currentVertexPosition-1])||v.direction==="backwards"&&Xo(C,v.line.coordinates[v.currentVertexPosition+1]))return this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.line.id]});this.updateUIClasses({mouse:Ge}),v.line.updateCoordinate(v.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),v.direction==="forward"?(v.currentVertexPosition++,v.line.updateCoordinate(v.currentVertexPosition,C.lngLat.lng,C.lngLat.lat)):v.line.addCoordinate(0,C.lngLat.lng,C.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.line.id]})},onMouseMove:function(v,C){v.line.updateCoordinate(v.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),so(C)&&this.updateUIClasses({mouse:ft})}};lo.onTap=lo.onClick=function(v,C){if(so(C))return this.clickOnVertex(v,C);this.clickAnywhere(v,C)},lo.onKeyUp=function(v,C){M(C)?this.changeMode(He.SIMPLE_SELECT,{featureIds:[v.line.id]}):$(C)&&(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT))},lo.onStop=function(v){te(this),this.activateUIButton(),this.getFeature(v.line.id)!==void 0&&(v.line.removeCoordinate(""+v.currentVertexPosition),v.line.isValid()?this.map.fire(un,{features:[v.line.toGeoJSON()]}):(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT,{},{silent:!0})))},lo.onTrash=function(v){this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)},lo.toDisplayFeatures=function(v,C,B){var ne=C.properties.id===v.line.id;if(C.properties.active=ne?vr:ni,!ne)return B(C);C.geometry.coordinates.length<2||(C.properties.meta=Pr,B(Y(v.line.id,C.geometry.coordinates[v.direction==="forward"?C.geometry.coordinates.length-2:1],""+(v.direction==="forward"?C.geometry.coordinates.length-2:1),!1)),B(C))};var da={simple_select:Bt,direct_select:Dn,draw_point:Dr,draw_polygon:en,draw_line_string:lo},Ul={defaultMode:He.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:da,controls:{},userProperties:!1},Vl={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Qa={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function jl(v,C){return v.map(function(B){return B.source?B:ii(B,{id:B.id+"."+C,source:C==="hot"?he:Ne})})}var pa=Ie(function(v,C){var B="[object Arguments]",ne="[object Map]",ye="[object Object]",ae="[object Set]",me=/^\[object .+?Constructor\]$/,Oe=/^(?:0|[1-9]\d*)$/,Fe={};Fe["[object Float32Array]"]=Fe["[object Float64Array]"]=Fe["[object Int8Array]"]=Fe["[object Int16Array]"]=Fe["[object Int32Array]"]=Fe["[object Uint8Array]"]=Fe["[object Uint8ClampedArray]"]=Fe["[object Uint16Array]"]=Fe["[object Uint32Array]"]=!0,Fe[B]=Fe["[object Array]"]=Fe["[object ArrayBuffer]"]=Fe["[object Boolean]"]=Fe["[object DataView]"]=Fe["[object Date]"]=Fe["[object Error]"]=Fe["[object Function]"]=Fe[ne]=Fe["[object Number]"]=Fe[ye]=Fe["[object RegExp]"]=Fe[ae]=Fe["[object String]"]=Fe["[object WeakMap]"]=!1;var Ue=typeof su=="object"&&su&&su.Object===Object&&su,ve=typeof self=="object"&&self&&self.Object===Object&&self,Ke=Ue||ve||Function("return this")(),at=C&&!C.nodeType&&C,wt=at&&v&&!v.nodeType&&v,zt=wt&&wt.exports===at,Un=zt&&Ue.process,De=function(){try{return Un&&Un.binding&&Un.binding("util")}catch{}}(),pt=De&&De.isTypedArray;function cn(ce,ke){for(var et=-1,Ct=ce==null?0:ce.length;++et<Ct;)if(ke(ce[et],et,ce))return!0;return!1}function an(ce){var ke=-1,et=Array(ce.size);return ce.forEach(function(Ct,gn){et[++ke]=[gn,Ct]}),et}function kn(ce){var ke=-1,et=Array(ce.size);return ce.forEach(function(Ct){et[++ke]=Ct}),et}var bt,Gt,uo,sn=Array.prototype,Rr=Function.prototype,or=Object.prototype,fa=Ke["__core-js_shared__"],$r=Rr.toString,gi=or.hasOwnProperty,Bs=(bt=/[^.]+$/.exec(fa&&fa.keys&&fa.keys.IE_PROTO||""))?"Symbol(src)_1."+bt:"",Os=or.toString,nl=RegExp("^"+$r.call(gi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ma=zt?Ke.Buffer:void 0,Ho=Ke.Symbol,ga=Ke.Uint8Array,ya=or.propertyIsEnumerable,_a=sn.splice,Ao=Ho?Ho.toStringTag:void 0,rl=Object.getOwnPropertySymbols,ms=ma?ma.isBuffer:void 0,Bu=(Gt=Object.keys,uo=Object,function(ce){return Gt(uo(ce))}),il=ho(Ke,"DataView"),Ns=ho(Ke,"Map"),ol=ho(Ke,"Promise"),sl=ho(Ke,"Set"),al=ho(Ke,"WeakMap"),Ko=ho(Object,"create"),va=po(il),ll=po(Ns),ul=po(ol),gs=po(sl),Zl=po(al),cl=Ho?Ho.prototype:void 0,ys=cl?cl.valueOf:void 0;function oi(ce){var ke=-1,et=ce==null?0:ce.length;for(this.clear();++ke<et;){var Ct=ce[ke];this.set(Ct[0],Ct[1])}}function $i(ce){var ke=-1,et=ce==null?0:ce.length;for(this.clear();++ke<et;){var Ct=ce[ke];this.set(Ct[0],Ct[1])}}function yi(ce){var ke=-1,et=ce==null?0:ce.length;for(this.clear();++ke<et;){var Ct=ce[ke];this.set(Ct[0],Ct[1])}}function mn(ce){var ke=-1,et=ce==null?0:ce.length;for(this.__data__=new yi;++ke<et;)this.add(ce[ke])}function co(ce){var ke=this.__data__=new $i(ce);this.size=ke.size}function Zt(ce,ke){var et=Jo(ce),Ct=!et&&wa(ce),gn=!et&&!Ct&&si(ce),Xt=!et&&!Ct&&!gn&&xs(ce),In=et||Ct||gn||Xt,Pn=In?function(Hn,Gr){for(var Gi=-1,br=Array(Hn);++Gi<Hn;)br[Gi]=Gr(Gi);return br}(ce.length,String):[],wr=Pn.length;for(var Rn in ce)!ke&&!gi.call(ce,Rn)||In&&(Rn=="length"||gn&&(Rn=="offset"||Rn=="parent")||Xt&&(Rn=="buffer"||Rn=="byteLength"||Rn=="byteOffset")||Vs(Rn,wr))||Pn.push(Rn);return Pn}function Yt(ce,ke){for(var et=ce.length;et--;)if(dl(ce[et][0],ke))return et;return-1}function hn(ce){return ce==null?ce===void 0?"[object Undefined]":"[object Null]":Ao&&Ao in Object(ce)?function(ke){var et=gi.call(ke,Ao),Ct=ke[Ao];try{ke[Ao]=void 0;var gn=!0}catch{}var Xt=Os.call(ke);return gn&&(et?ke[Ao]=Ct:delete ke[Ao]),Xt}(ce):function(ke){return Os.call(ke)}(ce)}function En(ce){return Pi(ce)&&hn(ce)==B}function _s(ce,ke,et,Ct,gn){return ce===ke||(ce==null||ke==null||!Pi(ce)&&!Pi(ke)?ce!=ce&&ke!=ke:function(Xt,In,Pn,wr,Rn,Hn){var Gr=Jo(Xt),Gi=Jo(In),br=Gr?"[object Array]":_i(Xt),Zi=Gi?"[object Array]":_i(In),Ai=(br=br==B?ye:br)==ye,js=(Zi=Zi==B?ye:Zi)==ye,qi=br==Zi;if(qi&&si(Xt)){if(!si(In))return!1;Gr=!0,Ai=!1}if(qi&&!Ai)return Hn||(Hn=new co),Gr||xs(Xt)?ql(Xt,In,Pn,wr,Rn,Hn):function(bn,Qt,Gs,Sr,Yo,qr,mo){switch(Gs){case"[object DataView]":if(bn.byteLength!=Qt.byteLength||bn.byteOffset!=Qt.byteOffset)return!1;bn=bn.buffer,Qt=Qt.buffer;case"[object ArrayBuffer]":return!(bn.byteLength!=Qt.byteLength||!qr(new ga(bn),new ga(Qt)));case"[object Boolean]":case"[object Date]":case"[object Number]":return dl(+bn,+Qt);case"[object Error]":return bn.name==Qt.name&&bn.message==Qt.message;case"[object RegExp]":case"[object String]":return bn==Qt+"";case ne:var zo=an;case ae:var Lo=1&Sr;if(zo||(zo=kn),bn.size!=Qt.size&&!Lo)return!1;var Do=mo.get(bn);if(Do)return Do==Qt;Sr|=2,mo.set(bn,Qt);var Wr=ql(zo(bn),zo(Qt),Sr,Yo,qr,mo);return mo.delete(bn),Wr;case"[object Symbol]":if(ys)return ys.call(bn)==ys.call(Qt)}return!1}(Xt,In,br,Pn,wr,Rn,Hn);if(!(1&Pn)){var fo=Ai&&gi.call(Xt,"__wrapped__"),Zr=js&&gi.call(In,"__wrapped__");if(fo||Zr){var $s=fo?Xt.value():Xt,ai=Zr?In.value():In;return Hn||(Hn=new co),Rn($s,ai,Pn,wr,Hn)}}return qi?(Hn||(Hn=new co),function(bn,Qt,Gs,Sr,Yo,qr){var mo=1&Gs,zo=hl(bn),Lo=zo.length,Do=hl(Qt).length;if(Lo!=Do&&!mo)return!1;for(var Wr=Lo;Wr--;){var rt=zo[Wr];if(!(mo?rt in Qt:gi.call(Qt,rt)))return!1}var ml=qr.get(bn);if(ml&&qr.get(Qt))return ml==Qt;var Wi=!0;qr.set(bn,Qt),qr.set(Qt,bn);for(var Xi=mo;++Wr<Lo;){rt=zo[Wr];var bs=bn[rt],Je=Qt[rt];if(Sr)var Zs=mo?Sr(Je,bs,rt,Qt,bn,qr):Sr(bs,Je,rt,bn,Qt,qr);if(!(Zs===void 0?bs===Je||Yo(bs,Je,Gs,Sr,qr):Zs)){Wi=!1;break}Xi||(Xi=rt=="constructor")}if(Wi&&!Xi){var Sa=bn.constructor,Ss=Qt.constructor;Sa==Ss||!("constructor"in bn)||!("constructor"in Qt)||typeof Sa=="function"&&Sa instanceof Sa&&typeof Ss=="function"&&Ss instanceof Ss||(Wi=!1)}return qr.delete(bn),qr.delete(Qt),Wi}(Xt,In,Pn,wr,Rn,Hn)):!1}(ce,ke,et,Ct,_s,gn))}function vs(ce){return!(!fl(ce)||function(ke){return!!Bs&&Bs in ke}(ce))&&(pl(ce)?nl:me).test(po(ce))}function Ou(ce){if(et=(ke=ce)&&ke.constructor,Ct=typeof et=="function"&&et.prototype||or,ke!==Ct)return Bu(ce);var ke,et,Ct,gn=[];for(var Xt in Object(ce))gi.call(ce,Xt)&&Xt!="constructor"&&gn.push(Xt);return gn}function ql(ce,ke,et,Ct,gn,Xt){var In=1&et,Pn=ce.length,wr=ke.length;if(Pn!=wr&&!(In&&wr>Pn))return!1;var Rn=Xt.get(ce);if(Rn&&Xt.get(ke))return Rn==ke;var Hn=-1,Gr=!0,Gi=2&et?new mn:void 0;for(Xt.set(ce,ke),Xt.set(ke,ce);++Hn<Pn;){var br=ce[Hn],Zi=ke[Hn];if(Ct)var Ai=In?Ct(Zi,br,Hn,ke,ce,Xt):Ct(br,Zi,Hn,ce,ke,Xt);if(Ai!==void 0){if(Ai)continue;Gr=!1;break}if(Gi){if(!cn(ke,function(js,qi){if(fo=qi,!Gi.has(fo)&&(br===js||gn(br,js,et,Ct,Xt)))return Gi.push(qi);var fo})){Gr=!1;break}}else if(br!==Zi&&!gn(br,Zi,et,Ct,Xt)){Gr=!1;break}}return Xt.delete(ce),Xt.delete(ke),Gr}function hl(ce){return function(ke,et,Ct){var gn=et(ke);return Jo(ke)?gn:function(Xt,In){for(var Pn=-1,wr=In.length,Rn=Xt.length;++Pn<wr;)Xt[Rn+Pn]=In[Pn];return Xt}(gn,Ct(ke))}(ce,ws,Us)}function xa(ce,ke){var et,Ct,gn=ce.__data__;return((Ct=typeof(et=ke))=="string"||Ct=="number"||Ct=="symbol"||Ct=="boolean"?et!=="__proto__":et===null)?gn[typeof ke=="string"?"string":"hash"]:gn.map}function ho(ce,ke){var et=function(Ct,gn){return Ct==null?void 0:Ct[gn]}(ce,ke);return vs(et)?et:void 0}oi.prototype.clear=function(){this.__data__=Ko?Ko(null):{},this.size=0},oi.prototype.delete=function(ce){var ke=this.has(ce)&&delete this.__data__[ce];return this.size-=ke?1:0,ke},oi.prototype.get=function(ce){var ke=this.__data__;if(Ko){var et=ke[ce];return et==="__lodash_hash_undefined__"?void 0:et}return gi.call(ke,ce)?ke[ce]:void 0},oi.prototype.has=function(ce){var ke=this.__data__;return Ko?ke[ce]!==void 0:gi.call(ke,ce)},oi.prototype.set=function(ce,ke){var et=this.__data__;return this.size+=this.has(ce)?0:1,et[ce]=Ko&&ke===void 0?"__lodash_hash_undefined__":ke,this},$i.prototype.clear=function(){this.__data__=[],this.size=0},$i.prototype.delete=function(ce){var ke=this.__data__,et=Yt(ke,ce);return!(et<0)&&(et==ke.length-1?ke.pop():_a.call(ke,et,1),--this.size,!0)},$i.prototype.get=function(ce){var ke=this.__data__,et=Yt(ke,ce);return et<0?void 0:ke[et][1]},$i.prototype.has=function(ce){return Yt(this.__data__,ce)>-1},$i.prototype.set=function(ce,ke){var et=this.__data__,Ct=Yt(et,ce);return Ct<0?(++this.size,et.push([ce,ke])):et[Ct][1]=ke,this},yi.prototype.clear=function(){this.size=0,this.__data__={hash:new oi,map:new(Ns||$i),string:new oi}},yi.prototype.delete=function(ce){var ke=xa(this,ce).delete(ce);return this.size-=ke?1:0,ke},yi.prototype.get=function(ce){return xa(this,ce).get(ce)},yi.prototype.has=function(ce){return xa(this,ce).has(ce)},yi.prototype.set=function(ce,ke){var et=xa(this,ce),Ct=et.size;return et.set(ce,ke),this.size+=et.size==Ct?0:1,this},mn.prototype.add=mn.prototype.push=function(ce){return this.__data__.set(ce,"__lodash_hash_undefined__"),this},mn.prototype.has=function(ce){return this.__data__.has(ce)},co.prototype.clear=function(){this.__data__=new $i,this.size=0},co.prototype.delete=function(ce){var ke=this.__data__,et=ke.delete(ce);return this.size=ke.size,et},co.prototype.get=function(ce){return this.__data__.get(ce)},co.prototype.has=function(ce){return this.__data__.has(ce)},co.prototype.set=function(ce,ke){var et=this.__data__;if(et instanceof $i){var Ct=et.__data__;if(!Ns||Ct.length<199)return Ct.push([ce,ke]),this.size=++et.size,this;et=this.__data__=new yi(Ct)}return et.set(ce,ke),this.size=et.size,this};var Us=rl?function(ce){return ce==null?[]:(ce=Object(ce),function(ke,et){for(var Ct=-1,gn=ke==null?0:ke.length,Xt=0,In=[];++Ct<gn;){var Pn=ke[Ct];et(Pn,Ct,ke)&&(In[Xt++]=Pn)}return In}(rl(ce),function(ke){return ya.call(ce,ke)}))}:function(){return[]},_i=hn;function Vs(ce,ke){return!!(ke=ke??9007199254740991)&&(typeof ce=="number"||Oe.test(ce))&&ce>-1&&ce%1==0&&ce<ke}function po(ce){if(ce!=null){try{return $r.call(ce)}catch{}try{return ce+""}catch{}}return""}function dl(ce,ke){return ce===ke||ce!=ce&&ke!=ke}(il&&_i(new il(new ArrayBuffer(1)))!="[object DataView]"||Ns&&_i(new Ns)!=ne||ol&&_i(ol.resolve())!="[object Promise]"||sl&&_i(new sl)!=ae||al&&_i(new al)!="[object WeakMap]")&&(_i=function(ce){var ke=hn(ce),et=ke==ye?ce.constructor:void 0,Ct=et?po(et):"";if(Ct)switch(Ct){case va:return"[object DataView]";case ll:return ne;case ul:return"[object Promise]";case gs:return ae;case Zl:return"[object WeakMap]"}return ke});var wa=En(function(){return arguments}())?En:function(ce){return Pi(ce)&&gi.call(ce,"callee")&&!ya.call(ce,"callee")},Jo=Array.isArray,si=ms||function(){return!1};function pl(ce){if(!fl(ce))return!1;var ke=hn(ce);return ke=="[object Function]"||ke=="[object GeneratorFunction]"||ke=="[object AsyncFunction]"||ke=="[object Proxy]"}function ba(ce){return typeof ce=="number"&&ce>-1&&ce%1==0&&ce<=9007199254740991}function fl(ce){var ke=typeof ce;return ce!=null&&(ke=="object"||ke=="function")}function Pi(ce){return ce!=null&&typeof ce=="object"}var xs=pt?function(ce){return function(ke){return ce(ke)}}(pt):function(ce){return Pi(ce)&&ba(ce.length)&&!!Fe[hn(ce)]};function ws(ce){return(ke=ce)!=null&&ba(ke.length)&&!pl(ke)?Zt(ce):Ou(ce);var ke}v.exports=function(ce,ke){return _s(ce,ke)}}),el={Polygon:Ln,LineString:Nt,Point:dr,MultiPolygon:Gn,MultiLineString:Gn,MultiPoint:Gn};function $l(v,C){return C.modes=He,C.getFeatureIdsAt=function(B){return mi.click({point:B},null,v).map(function(ne){return ne.properties.id})},C.getSelectedIds=function(){return v.store.getSelectedIds()},C.getSelected=function(){return{type:hr,features:v.store.getSelectedIds().map(function(B){return v.store.get(B)}).map(function(B){return B.toGeoJSON()})}},C.getSelectedPoints=function(){return{type:hr,features:v.store.getSelectedCoordinates().map(function(B){return{type:rn,properties:{},geometry:{type:zn,coordinates:B.coordinates}}})}},C.set=function(B){if(B.type===void 0||B.type!==hr||!Array.isArray(B.features))throw new Error("Invalid FeatureCollection");var ne=v.store.createRenderBatch(),ye=v.store.getAllIds().slice(),ae=C.add(B),me=new Wn(ae);return(ye=ye.filter(function(Oe){return!me.has(Oe)})).length&&C.delete(ye),ne(),ae},C.add=function(B){var ne=JSON.parse(JSON.stringify(se(B))).features.map(function(ye){if(ye.id=ye.id||We(),ye.geometry===null)throw new Error("Invalid geometry: null");if(v.store.get(ye.id)===void 0||v.store.get(ye.id).type!==ye.geometry.type){var ae=el[ye.geometry.type];if(ae===void 0)throw new Error("Invalid geometry type: "+ye.geometry.type+".");var me=new ae(v,ye);v.store.add(me)}else{var Oe=v.store.get(ye.id);Oe.properties=ye.properties,pa(Oe.getCoordinates(),ye.geometry.coordinates)||Oe.incomingCoords(ye.geometry.coordinates)}return ye.id});return v.store.render(),ne},C.get=function(B){var ne=v.store.get(B);if(ne)return ne.toGeoJSON()},C.getAll=function(){return{type:hr,features:v.store.getAll().map(function(B){return B.toGeoJSON()})}},C.delete=function(B){return v.store.delete(B,{silent:!0}),C.getMode()!==He.DIRECT_SELECT||v.store.getSelectedIds().length?v.store.render():v.events.changeMode(He.SIMPLE_SELECT,void 0,{silent:!0}),C},C.deleteAll=function(){return v.store.delete(v.store.getAllIds(),{silent:!0}),C.getMode()===He.DIRECT_SELECT?v.events.changeMode(He.SIMPLE_SELECT,void 0,{silent:!0}):v.store.render(),C},C.changeMode=function(B,ne){return ne===void 0&&(ne={}),B===He.SIMPLE_SELECT&&C.getMode()===He.SIMPLE_SELECT?(ye=ne.featureIds||[],ae=v.store.getSelectedIds(),ye.length===ae.length&&JSON.stringify(ye.map(function(me){return me}).sort())===JSON.stringify(ae.map(function(me){return me}).sort())||(v.store.setSelected(ne.featureIds,{silent:!0}),v.store.render()),C):(B===He.DIRECT_SELECT&&C.getMode()===He.DIRECT_SELECT&&ne.featureId===v.store.getSelectedIds()[0]||v.events.changeMode(B,ne,{silent:!0}),C);var ye,ae},C.getMode=function(){return v.events.getMode()},C.trash=function(){return v.events.trash({silent:!0}),C},C.combineFeatures=function(){return v.events.combineFeatures({silent:!0}),C},C.uncombineFeatures=function(){return v.events.uncombineFeatures({silent:!0}),C},C.setFeatureProperty=function(B,ne,ye){return v.store.setFeatureProperty(B,ne,ye),C},C}var Gl=function(v,C){var B={options:v=function(ye){ye===void 0&&(ye={});var ae=ii(ye);return ye.controls||(ae.controls={}),ye.displayControlsDefault===!1?ae.controls=ii(Qa,ye.controls):ae.controls=ii(Vl,ye.controls),(ae=ii(Ul,ae)).styles=jl(ae.styles,"cold").concat(jl(ae.styles,"hot")),ae}(v)};C=$l(B,C),B.api=C;var ne=dn(B);return C.onAdd=ne.onAdd,C.onRemove=ne.onRemove,C.types=kt,C.options=v,C};function tl(v){Gl(v,this)}return tl.modes=da,tl})})(j2);const $2=am;function G2(n){return Fu(()=>new $2({...n}),({map:o})=>{o.on("draw.create",n.onCreate),o.on("draw.update",n.onUpdate),o.on("draw.delete",n.onDelete)},({map:o})=>{o.off("draw.create",n.onCreate),o.off("draw.update",n.onUpdate),o.off("draw.delete",n.onDelete)},{position:n.position}),null}function Z2(){const[n,o]=Rt.useState({}),u=Rt.useCallback(_=>{o(b=>_.features.reduce((P,l)=>(P[l.id]=l,P),{...b}))},[]),m=Rt.useCallback(_=>{o(b=>{const P={...b};for(const l of _.features)delete P[l.id];return P})},[]);return Ec("main",{style:{position:"relative"},children:Ec(ng,{mapLib:V2,mapStyle:"/mapStyle.json",minZoom:2,maxZoom:19,children:Ec(G2,{position:"top-left",displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"draw_polygon",onCreate:u,onUpdate:u,onDelete:m})})})}df.createRoot(document.getElementById("root")).render(Ec(ow.StrictMode,{children:Ec(Z2,{})}));export{su as c};
